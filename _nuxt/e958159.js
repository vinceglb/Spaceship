/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{448:function(t,e,n){"use strict";n.d(e,"a",(function(){return w}));var r=n(444),o=n(446),c=n(449),h=n(450);class l{constructor(t,e){this._delegate=t,this.firebase=e,Object(c._addComponent)(t,new o.a("app-compat",(()=>this),"PUBLIC")),this.container=t.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this._delegate.automaticDataCollectionEnabled=t}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((t=>{this._delegate.checkDestroyed(),t()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),Object(c.deleteApp)(this._delegate))))}_getService(t,e=c._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(t);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:e})}_removeServiceInstance(t,e=c._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(t).clearInstance(e)}_addComponent(component){Object(c._addComponent)(this._delegate,component)}_addOrOverwriteComponent(component){Object(c._addOrOverwriteComponent)(this._delegate,component)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const d={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},f=new r.b("app-compat","Firebase",d);const m=function t(){const e=function(t){const e={},n={__esModule:!0,initializeApp:function(o,h={}){const l=c.initializeApp(o,h);if(Object(r.f)(e,l.name))return e[l.name];const d=new t(l,n);return e[l.name]=d,d},app:o,registerVersion:c.registerVersion,setLogLevel:c.setLogLevel,onLog:c.onLog,apps:null,SDK_VERSION:c.SDK_VERSION,INTERNAL:{registerComponent:function(component){const e=component.name,h=e.replace("-compat","");if(c._registerComponent(component)&&"PUBLIC"===component.type){const c=(t=o())=>{if("function"!=typeof t[h])throw f.create("invalid-app-argument",{appName:e});return t[h]()};void 0!==component.serviceProps&&Object(r.j)(c,component.serviceProps),n[h]=c,t.prototype[h]=function(...t){return this._getService.bind(this,e).apply(this,component.multipleInstances?t:[])}}return"PUBLIC"===component.type?n[h]:null},removeApp:function(t){delete e[t]},useAsService:function(t,e){return"serverAuth"===e?null:e},modularAPIs:c}};function o(t){if(t=t||c._DEFAULT_ENTRY_NAME,!Object(r.f)(e,t))throw f.create("no-app",{appName:t});return e[t]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(e).map((t=>e[t]))}}),o.App=t,n}(l);return e.INTERNAL=Object.assign(Object.assign({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){Object(r.j)(e,t)},createSubscribe:r.h,ErrorFactory:r.b,deepExtend:r.j}),e}(),y=new h.b("@firebase/app-compat");if(Object(r.r)()&&void 0!==self.firebase){y.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const t=self.firebase.SDK_VERSION;t&&t.indexOf("LITE")>=0&&y.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const w=m;var v;Object(c.registerVersion)("@firebase/app-compat","0.2.32",v)},506:function(t,e,n){"use strict";(function(t,r){n.d(e,"a",(function(){return pl})),n.d(e,"b",(function(){return dh})),n.d(e,"c",(function(){return Jc})),n.d(e,"d",(function(){return qc})),n.d(e,"e",(function(){return bl})),n.d(e,"f",(function(){return fh})),n.d(e,"g",(function(){return N})),n.d(e,"h",(function(){return mh})),n.d(e,"i",(function(){return _l})),n.d(e,"j",(function(){return Il})),n.d(e,"k",(function(){return $})),n.d(e,"l",(function(){return ql})),n.d(e,"m",(function(){return xe})),n.d(e,"n",(function(){return X})),n.d(e,"o",(function(){return J})),n.d(e,"p",(function(){return Mc})),n.d(e,"q",(function(){return D})),n.d(e,"r",(function(){return pe})),n.d(e,"s",(function(){return E})),n.d(e,"t",(function(){return kc})),n.d(e,"u",(function(){return Ml})),n.d(e,"v",(function(){return Wl})),n.d(e,"w",(function(){return Ql})),n.d(e,"x",(function(){return sh})),n.d(e,"y",(function(){return zc})),n.d(e,"z",(function(){return Kc})),n.d(e,"A",(function(){return Uc})),n.d(e,"B",(function(){return Pl})),n.d(e,"C",(function(){return Gl})),n.d(e,"D",(function(){return uh})),n.d(e,"E",(function(){return Gc})),n.d(e,"F",(function(){return nh})),n.d(e,"G",(function(){return rh})),n.d(e,"H",(function(){return ah})),n.d(e,"I",(function(){return hl})),n.d(e,"J",(function(){return cl})),n.d(e,"K",(function(){return Zc})),n.d(e,"L",(function(){return Vl})),n.d(e,"M",(function(){return Sl})),n.d(e,"N",(function(){return Dl})),n.d(e,"O",(function(){return Al})),n.d(e,"P",(function(){return Cl})),n.d(e,"Q",(function(){return Nl})),n.d(e,"R",(function(){return kl})),n.d(e,"S",(function(){return Yl})),n.d(e,"T",(function(){return el})),n.d(e,"U",(function(){return nl})),n.d(e,"V",(function(){return ch})),n.d(e,"W",(function(){return hh})),n.d(e,"X",(function(){return Ll})),n.d(e,"Y",(function(){return Fl})),n.d(e,"Z",(function(){return Zh})),n.d(e,"ab",(function(){return Wh})),n.d(e,"bb",(function(){return Qc})),n.d(e,"cb",(function(){return $c})),n.d(e,"db",(function(){return Kl})),n.d(e,"eb",(function(){return $l})),n.d(e,"fb",(function(){return Rl})),n.d(e,"gb",(function(){return v})),n.d(e,"hb",(function(){return Tl})),n.d(e,"ib",(function(){return sl})),n.d(e,"jb",(function(){return il})),n.d(e,"kb",(function(){return Ol})),n.d(e,"lb",(function(){return oh})),n.d(e,"mb",(function(){return Hh}));var o=n(449),c=n(446),h=n(450),l=n(444),d=n(511);const f="@firebase/firestore";class m{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}m.UNAUTHENTICATED=new m(null),m.GOOGLE_CREDENTIALS=new m("google-credentials-uid"),m.FIRST_PARTY=new m("first-party-uid"),m.MOCK_USER=new m("mock-user");let b="10.11.1";const y=new h.b("@firebase/firestore");function w(){return y.logLevel}function v(t){y.setLogLevel(t)}function _(t,...e){if(y.logLevel<=h.a.DEBUG){const n=e.map(T);y.debug(`Firestore (${b}): ${t}`,...n)}}function I(t,...e){if(y.logLevel<=h.a.ERROR){const n=e.map(T);y.error(`Firestore (${b}): ${t}`,...n)}}function E(t,...e){if(y.logLevel<=h.a.WARN){const n=e.map(T);y.warn(`Firestore (${b}): ${t}`,...n)}}function T(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function S(t="Unexpected state"){const e=`FIRESTORE (${b}) INTERNAL ASSERTION FAILED: `+t;throw I(e),new Error(e)}function x(t,e){t||S()}function D(t,e){t||S()}function A(t,e){return t}const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class N extends l.c{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class k{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class R{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class O{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(m.UNAUTHENTICATED)))}shutdown(){}}class P{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class M{constructor(t){this.t=t,this.currentUser=m.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let o=new k;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new k,t.enqueueRetryable((()=>r(this.currentUser)))};const c=()=>{const e=o;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},h=t=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),c()};this.t.onInit((t=>h(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?h(t):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new k)}}),0),c()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(x("string"==typeof e.accessToken),new R(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return x(null===t||"string"==typeof t),new m(t)}}class L{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=m.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class F{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new L(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(m.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class V{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class U{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,_("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(x("string"==typeof t.token),this.R=t.token,new V(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function B(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class j{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=B(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length))}return n}}function z(t,e){return t<e?-1:t>e?1:0}function K(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}function G(t){return t+"\0"}class ${constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new N(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new N(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new N(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new N(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return $.fromMillis(Date.now())}static fromDate(t){return $.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new $(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?z(this.nanoseconds,t.nanoseconds):z(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Q{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Q(t)}static min(){return new Q(new $(0,0))}static max(){return new Q(new $(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class W{constructor(t,e,n){void 0===e?e=0:e>t.length&&S(),void 0===n?n=t.length-e:n>t.length-e&&S(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===W.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof W?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Y extends W{construct(t,e,n){return new Y(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new N(C.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Y(e)}static emptyPath(){return new Y([])}}const H=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class J extends W{construct(t,e,n){return new J(t,e,n)}static isValidIdentifier(t){return H.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),J.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new J(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const o=()=>{if(0===n.length)throw new N(C.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new N(C.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new N(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(o(),r++)}if(o(),i)throw new N(C.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new J(e)}static emptyPath(){return new J([])}}class X{constructor(t){this.path=t}static fromPath(t){return new X(Y.fromString(t))}static fromName(t){return new X(Y.fromString(t).popFirst(5))}static empty(){return new X(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Y.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new X(new Y(t.slice()))}}class Z{constructor(t,e,n,r){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=r}}function tt(t){return t.fields.find((t=>2===t.kind))}function et(t){return t.fields.filter((t=>2!==t.kind))}Z.UNKNOWN_ID=-1;class nt{constructor(t,e){this.fieldPath=t,this.kind=e}}class it{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new it(0,at.min())}}function st(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Q.fromTimestamp(1e9===r?new $(n+1,0):new $(n,r));return new at(i,X.empty(),e)}function ot(t){return new at(t.readTime,t.key,-1)}class at{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new at(Q.min(),X.empty(),-1)}static max(){return new at(Q.max(),X.empty(),-1)}}function ut(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=X.comparator(t.documentKey,e.documentKey),0!==n?n:z(t.largestBatchId,e.largestBatchId))}const ct="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ht{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function lt(t){if(t.code!==C.FAILED_PRECONDITION||t.message!==ct)throw t;_("LocalStore","Unexpectedly lost primary lease")}class ft{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new ft(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof ft?e:ft.resolve(e)}catch(t){return ft.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):ft.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):ft.reject(e)}static resolve(t){return new ft(((e,n)=>{e(t)}))}static reject(t){return new ft(((e,n)=>{n(t)}))}static waitFor(t){return new ft(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=ft.resolve(!1);for(const n of t)e=e.next((t=>t?ft.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new ft(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let c=0;c<i;c++){const a=c;e(t[a]).next((t=>{s[a]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new ft(((n,r)=>{const o=()=>{!0===t()?e().next((()=>{o()}),r):n()};o()}))}}class gt{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new k,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new wt(t,e.error)):this.V.resolve()},this.transaction.onerror=e=>{const n=Et(e.target.error);this.V.reject(new wt(t,n))}}static open(t,e,n,r){try{return new gt(e,t.transaction(r,n))}catch(t){throw new wt(e,t)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(_("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new bt(e)}}class mt{constructor(t,e,n){this.name=t,this.version=e,this.p=n,12.2===mt.S(Object(l.q)())&&I("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return _("SimpleDb","Removing database:",t),_t(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!Object(l.v)())return!1;if(mt.C())return!0;const t=Object(l.q)(),e=mt.S(t),n=0<e&&e<10,r=pt(t),i=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static C(){var e;return void 0!==t&&"YES"===(null===(e=t.__PRIVATE_env)||void 0===e?void 0:e.v)}static F(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}async M(t){return this.db||(_("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new wt(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new N(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new N(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new wt(t,r))},r.onupgradeneeded=t=>{_("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.p.O(e,r.transaction,t.oldVersion,this.version).next((()=>{_("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(t){this.N=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const i="readonly"===e;let s=0;for(;;){++s;try{this.db=await this.M(t);const e=gt.open(this.db,t,i?"readonly":"readwrite",n),s=r(e).next((t=>(e.g(),t))).catch((t=>(e.abort(t),ft.reject(t)))).toPromise();return s.catch((()=>{})),await e.m,s}catch(t){const e=t,n="FirebaseError"!==e.name&&s<3;if(_("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function pt(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class yt{constructor(t){this.B=t,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(t){this.B=t}done(){this.k=!0}$(t){this.q=t}delete(){return _t(this.B.delete())}}class wt extends N{constructor(t,e){super(C.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function vt(t){return"IndexedDbTransactionError"===t.name}class bt{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(_("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),_t(n)}add(t){return _("SimpleDb","ADD",this.store.name,t,t),_t(this.store.add(t))}get(t){return _t(this.store.get(t)).next((e=>(void 0===e&&(e=null),_("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return _("SimpleDb","DELETE",this.store.name,t),_t(this.store.delete(t))}count(){return _("SimpleDb","COUNT",this.store.name),_t(this.store.count())}U(t,e){const n=this.options(t,e),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const t=r.getAll(n.range);return new ft(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}{const t=this.cursor(n),e=[];return this.W(t,((t,n)=>{e.push(n)})).next((()=>e))}}G(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new ft(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}j(t,e){_("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.H=!1;const r=this.cursor(n);return this.W(r,((t,e,n)=>n.delete()))}J(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.W(r,e)}Y(t){const e=this.cursor({});return new ft(((n,r)=>{e.onerror=t=>{const e=Et(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}W(t,e){const n=[];return new ft(((r,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void r();const s=new yt(i),o=e(i.primaryKey,i.value,s);if(o instanceof ft){const t=o.catch((t=>(s.done(),ft.reject(t))));n.push(t)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}})).next((()=>ft.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.H?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function _t(t){return new ft(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Et(t.target.error);n(e)}}))}let It=!1;function Et(t){const e=mt.S(Object(l.q)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return It||(It=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Tt{constructor(t,e){this.asyncQueue=t,this.Z=e,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(t){_("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{_("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){vt(t)?_("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await lt(t)}await this.X(6e4)}))}}class St{constructor(t,e){this.localStore=t,this.persistence=e}async ee(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.te(e,t)))}te(t,e){const n=new Set;let r=e,i=!0;return ft.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((e=>{if(null!==e&&!n.has(e))return _("IndexBackfiller",`Processing collection: ${e}`),this.ne(t,e,r).next((t=>{r-=t,n.add(e)}));i=!1})))).next((()=>e-r))}ne(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((r=>this.localStore.localDocuments.getNextDocuments(t,e,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(t,i).next((()=>this.re(r,n))).next((n=>(_("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(t,e,n)))).next((()=>i.size))}))))}re(t,e){let n=t;return e.changes.forEach(((t,e)=>{const r=ot(e);ut(r,n)>0&&(n=r)})),new at(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}class xt{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ie(t),this.se=t=>e.writeSequenceNumber(t))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}function Dt(t){return null==t}function At(t){return 0===t&&1/t==-1/0}function Ct(t){return"number"==typeof t&&Number.isInteger(t)&&!At(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function Nt(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Rt(e)),e=kt(t.get(n),e);return Rt(e)}function kt(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Rt(t){return t+""}function Ot(t){const e=t.length;if(x(e>=2),2===e)return x(""===t.charAt(0)&&""===t.charAt(1)),Y.emptyPath();const n=e-2,r=[];let o="";for(let i=0;i<e;){const e=t.indexOf("",i);switch((e<0||e>n)&&S(),t.charAt(e+1)){case"":const s=t.substring(i,e);let n;0===o.length?n=s:(o+=s,n=o,o=""),r.push(n);break;case"":o+=t.substring(i,e),o+="\0";break;case"":o+=t.substring(i,e+1);break;default:S()}i=e+2}return new Y(r)}xt.oe=-1;const Pt=["userId","batchId"];function Mt(t,e){return[t,Nt(e)]}function Lt(t,e,n){return[t,Nt(e),n]}const Ft={},Vt=["prefixPath","collectionGroup","readTime","documentId"],Ut=["prefixPath","collectionGroup","documentId"],Bt=["collectionGroup","readTime","prefixPath","documentId"],qt=["canonicalId","targetId"],q=["targetId","path"],jt=["path","targetId"],zt=["collectionId","parent"],Kt=["indexId","uid"],Gt=["uid","sequenceNumber"],$t=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Qt=["indexId","uid","orderedDocumentKey"],Wt=["userId","collectionPath","documentId"],Yt=["userId","collectionPath","largestBatchId"],Ht=["userId","collectionGroup","largestBatchId"],Jt=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Xt=[...Jt,"documentOverlays"],Zt=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],te=Zt,ee=[...te,"indexConfiguration","indexState","indexEntries"],ne=ee;class re extends ht{constructor(t,e){super(),this._e=t,this.currentSequenceNumber=e}}function ie(t,e){const n=A(t);return mt.F(n._e,e)}function se(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function oe(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ae(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class ue{constructor(t,e){this.comparator=t,this.root=e||he.EMPTY}insert(t,e){return new ue(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,he.BLACK,null,null))}remove(t){return new ue(this.comparator,this.root.remove(t,this.comparator).copy(null,null,he.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ce(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ce(this.root,t,this.comparator,!1)}getReverseIterator(){return new ce(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ce(this.root,t,this.comparator,!0)}}class ce{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class he{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:he.RED,this.left=null!=r?r:he.EMPTY,this.right=null!=i?i:he.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new he(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return he.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return he.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,he.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,he.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw S();if(this.right.isRed())throw S();const t=this.left.check();if(t!==this.right.check())throw S();return t+(this.isRed()?0:1)}}he.EMPTY=null,he.RED=!0,he.BLACK=!1,he.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(t,e,n,r,i){return this}insert(t,e,n){return new he(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class le{constructor(t){this.comparator=t,this.data=new ue(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new de(this.data.getIterator())}getIteratorFrom(t){return new de(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof le))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new le(this.comparator);return e.data=t,e}}class de{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function fe(t){return t.hasNext()?t.getNext():void 0}class ge{constructor(t){this.fields=t,t.sort(J.comparator)}static empty(){return new ge([])}unionWith(t){let e=new le(J.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new ge(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return K(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class me extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function pe(){return"undefined"!=typeof atob}class ye{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new me("Invalid base64 string: "+t):t}}(t);return new ye(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ye(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return z(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ye.EMPTY_BYTE_STRING=new ye("");const we=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ve(t){if(x(!!t),"string"==typeof t){let e=0;const n=we.exec(t);if(x(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:be(t.seconds),nanos:be(t.nanos)}}function be(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function _e(t){return"string"==typeof t?ye.fromBase64String(t):ye.fromUint8Array(t)}function Ie(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ee(t){const e=t.mapValue.fields.__previous_value__;return Ie(e)?Ee(e):e}function Te(t){const e=ve(t.mapValue.fields.__local_write_time__.timestampValue);return new $(e.seconds,e.nanos)}class Se{constructor(t,e,n,r,i,s,o,c,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=c,this.useFetchStreams=a}}class xe{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new xe("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof xe&&t.projectId===this.projectId&&t.database===this.database}}const De={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ae={nullValue:"NULL_VALUE"};function Ce(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ie(t)?4:ze(t)?9007199254740991:10:S()}function Ne(t,e){if(t===e)return!0;const n=Ce(t);if(n!==Ce(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Te(t).isEqual(Te(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=ve(t.timestampValue),r=ve(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return _e(t.bytesValue).isEqual(_e(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return be(t.geoPointValue.latitude)===be(e.geoPointValue.latitude)&&be(t.geoPointValue.longitude)===be(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return be(t.integerValue)===be(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=be(t.doubleValue),r=be(e.doubleValue);return n===r?At(n)===At(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return K(t.arrayValue.values||[],e.arrayValue.values||[],Ne);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(se(n)!==se(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Ne(n[t],r[t])))return!1;return!0}(t,e);default:return S()}}function ke(t,e){return void 0!==(t.values||[]).find((t=>Ne(t,e)))}function Re(t,e){if(t===e)return 0;const n=Ce(t),r=Ce(e);if(n!==r)return z(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return z(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=be(t.integerValue||t.doubleValue),r=be(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Oe(t.timestampValue,e.timestampValue);case 4:return Oe(Te(t),Te(e));case 5:return z(t.stringValue,e.stringValue);case 6:return function(t,e){const n=_e(t),r=_e(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=z(n[t],r[t]);if(0!==e)return e}return z(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=z(be(t.latitude),be(e.latitude));return 0!==n?n:z(be(t.longitude),be(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Re(n[t],r[t]);if(e)return e}return z(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===De.mapValue&&e===De.mapValue)return 0;if(t===De.mapValue)return 1;if(e===De.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=z(r[t],s[t]);if(0!==e)return e;const o=Re(n[r[t]],i[s[t]]);if(0!==o)return o}return z(r.length,s.length)}(t.mapValue,e.mapValue);default:throw S()}}function Oe(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return z(t,e);const n=ve(t),r=ve(e),i=z(n.seconds,r.seconds);return 0!==i?i:z(n.nanos,r.nanos)}function Pe(t){return Me(t)}function Me(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=ve(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return _e(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return X.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Me(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${Me(t.fields[i])}`;return n+"}"}(t.mapValue):S()}function Le(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Fe(t){return!!t&&"integerValue"in t}function Ve(t){return!!t&&"arrayValue"in t}function Ue(t){return!!t&&"nullValue"in t}function Be(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function qe(t){return!!t&&"mapValue"in t}function je(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return oe(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=je(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=je(t.arrayValue.values[n]);return e}return Object.assign({},t)}function ze(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}function Ke(t){return"nullValue"in t?Ae:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?Le(xe.empty(),X.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:S()}function Ge(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?Le(xe.empty(),X.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?De:S()}function $e(t,e){const n=Re(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function Qe(t,e){const n=Re(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}class We{constructor(t){this.value=t}static empty(){return new We({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!qe(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=je(e)}setAll(t){let e=J.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=je(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());qe(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ne(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];qe(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){oe(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new We(je(this.value))}}function Ye(t){const e=[];return oe(t.fields,((t,n)=>{const r=new J([t]);if(qe(n)){const t=Ye(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new ge(e)}class He{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new He(t,0,Q.min(),Q.min(),Q.min(),We.empty(),0)}static newFoundDocument(t,e,n,r){return new He(t,1,e,Q.min(),n,r,0)}static newNoDocument(t,e){return new He(t,2,e,Q.min(),Q.min(),We.empty(),0)}static newUnknownDocument(t,e){return new He(t,3,e,Q.min(),Q.min(),We.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Q.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=We.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=We.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof He&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new He(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Je{constructor(t,e){this.position=t,this.inclusive=e}}function Xe(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?X.comparator(X.fromName(o.referenceValue),n.key):Re(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Ze(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ne(t.position[n],e.position[n]))return!1;return!0}class tn{constructor(t,e="asc"){this.field=t,this.dir=e}}function en(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class nn{}class rn extends nn{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new gn(t,e,n):"array-contains"===e?new wn(t,n):"in"===e?new vn(t,n):"not-in"===e?new bn(t,n):"array-contains-any"===e?new _n(t,n):new rn(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new mn(t,n):new pn(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Re(e,this.value)):null!==e&&Ce(this.value)===Ce(e)&&this.matchesComparison(Re(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class sn extends nn{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new sn(t,e)}matches(t){return on(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function on(t){return"and"===t.op}function an(t){return"or"===t.op}function un(t){return cn(t)&&on(t)}function cn(t){for(const e of t.filters)if(e instanceof sn)return!1;return!0}function hn(t){if(t instanceof rn)return t.field.canonicalString()+t.op.toString()+Pe(t.value);if(un(t))return t.filters.map((t=>hn(t))).join(",");{const e=t.filters.map((t=>hn(t))).join(",");return`${t.op}(${e})`}}function ln(t,e){return t instanceof rn?function(t,e){return e instanceof rn&&t.op===e.op&&t.field.isEqual(e.field)&&Ne(t.value,e.value)}(t,e):t instanceof sn?function(t,e){return e instanceof sn&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&ln(n,e.filters[r])),!0)}(t,e):void S()}function dn(t,e){const n=t.filters.concat(e);return sn.create(n,t.op)}function fn(t){return t instanceof rn?function(t){return`${t.field.canonicalString()} ${t.op} ${Pe(t.value)}`}(t):t instanceof sn?function(t){return t.op.toString()+" {"+t.getFilters().map(fn).join(" ,")+"}"}(t):"Filter"}class gn extends rn{constructor(t,e,n){super(t,e,n),this.key=X.fromName(n.referenceValue)}matches(t){const e=X.comparator(t.key,this.key);return this.matchesComparison(e)}}class mn extends rn{constructor(t,e){super(t,"in",e),this.keys=yn("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class pn extends rn{constructor(t,e){super(t,"not-in",e),this.keys=yn("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function yn(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>X.fromName(t.referenceValue)))}class wn extends rn{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ve(e)&&ke(e.arrayValue,this.value)}}class vn extends rn{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&ke(this.value.arrayValue,e)}}class bn extends rn{constructor(t,e){super(t,"not-in",e)}matches(t){if(ke(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!ke(this.value.arrayValue,e)}}class _n extends rn{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ve(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>ke(this.value.arrayValue,t)))}}class In{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ue=null}}function En(t,e=null,n=[],r=[],i=null,s=null,o=null){return new In(t,e,n,r,i,s,o)}function Tn(t){const e=A(t);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>hn(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Dt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Pe(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Pe(t))).join(",")),e.ue=t}return e.ue}function Sn(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!en(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!ln(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ze(t.startAt,e.startAt)&&Ze(t.endAt,e.endAt)}function xn(t){return X.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}function Dn(t,e){return t.filters.filter((t=>t instanceof rn&&t.field.isEqual(e)))}function An(t,e,n){let r=Ae,i=!0;for(const n of Dn(t,e)){let t=Ae,e=!0;switch(n.op){case"<":case"<=":t=Ke(n.value);break;case"==":case"in":case">=":t=n.value;break;case">":t=n.value,e=!1;break;case"!=":case"not-in":t=Ae}$e({value:r,inclusive:i},{value:t,inclusive:e})<0&&(r=t,i=e)}if(null!==n)for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const t=n.position[s];$e({value:r,inclusive:i},{value:t,inclusive:n.inclusive})<0&&(r=t,i=n.inclusive);break}return{value:r,inclusive:i}}function Cn(t,e,n){let r=De,i=!0;for(const n of Dn(t,e)){let t=De,e=!0;switch(n.op){case">=":case">":t=Ge(n.value),e=!1;break;case"==":case"in":case"<=":t=n.value;break;case"<":t=n.value,e=!1;break;case"!=":case"not-in":t=De}Qe({value:r,inclusive:i},{value:t,inclusive:e})>0&&(r=t,i=e)}if(null!==n)for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const t=n.position[s];Qe({value:r,inclusive:i},{value:t,inclusive:n.inclusive})>0&&(r=t,i=n.inclusive);break}return{value:r,inclusive:i}}class Nn{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function kn(t,e,n,r,i,s,o,c){return new Nn(t,e,n,r,i,s,o,c)}function Rn(t){return new Nn(t)}function On(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Pn(t){return null!==t.collectionGroup}function Mn(t){const e=A(t);if(null===e.ce){e.ce=[];const t=new Set;for(const n of e.explicitOrderBy)e.ce.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new le(J.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.ce.push(new tn(r,n))})),t.has(J.keyField().canonicalString())||e.ce.push(new tn(J.keyField(),n))}return e.ce}function Ln(t){const e=A(t);return e.le||(e.le=Fn(e,Mn(t))),e.le}function Fn(t,e){if("F"===t.limitType)return En(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new tn(t.field,e)}));const n=t.endAt?new Je(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Je(t.startAt.position,t.startAt.inclusive):null;return En(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Vn(t,e){const n=t.filters.concat([e]);return new Nn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Un(t,e,n){return new Nn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Bn(t,e){return Sn(Ln(t),Ln(e))&&t.limitType===e.limitType}function qn(t){return`${Tn(Ln(t))}|lt:${t.limitType}`}function jn(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>fn(t))).join(", ")}]`),Dt(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Pe(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Pe(t))).join(",")),`Target(${e})`}(Ln(t))}; limitType=${t.limitType})`}function zn(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):X.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Mn(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=Xe(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Mn(t),e))&&!(t.endAt&&!function(t,e,n){const r=Xe(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Mn(t),e))}(t,e)}function Kn(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Gn(t){return(e,n)=>{let r=!1;for(const i of Mn(t)){const t=$n(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function $n(t,e,n){const r=t.field.isKeyField()?X.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Re(r,i):S()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}class Qn{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){oe(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return ae(this.inner)}size(){return this.innerSize}}const Wn=new ue(X.comparator);function Yn(){return Wn}const Hn=new ue(X.comparator);function Jn(...t){let e=Hn;for(const n of t)e=e.insert(n.key,n);return e}function Xn(t){let e=Hn;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Zn(){return nr()}function er(){return nr()}function nr(){return new Qn((t=>t.toString()),((t,e)=>t.isEqual(e)))}const rr=new ue(X.comparator),ir=new le(X.comparator);function sr(...t){let e=ir;for(const n of t)e=e.add(n);return e}const or=new le(z);function ar(){return or}function ur(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:At(e)?"-0":e}}function cr(t){return{integerValue:""+t}}function lr(t,e){return Ct(e)?cr(e):ur(t,e)}class dr{constructor(){this._=void 0}}function fr(t,e,n){return t instanceof pr?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ie(e)&&(e=Ee(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof yr?wr(t,e):t instanceof vr?_r(t,e):function(t,e){const n=mr(t,e),r=Er(n)+Er(t.Pe);return Fe(n)&&Fe(t.Pe)?cr(r):ur(t.serializer,r)}(t,e)}function gr(t,e,n){return t instanceof yr?wr(t,e):t instanceof vr?_r(t,e):n}function mr(t,e){return t instanceof Ir?function(t){return Fe(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class pr extends dr{}class yr extends dr{constructor(t){super(),this.elements=t}}function wr(t,e){const n=Tr(e);for(const e of t.elements)n.some((t=>Ne(t,e)))||n.push(e);return{arrayValue:{values:n}}}class vr extends dr{constructor(t){super(),this.elements=t}}function _r(t,e){let n=Tr(e);for(const e of t.elements)n=n.filter((t=>!Ne(t,e)));return{arrayValue:{values:n}}}class Ir extends dr{constructor(t,e){super(),this.serializer=t,this.Pe=e}}function Er(t){return be(t.integerValue||t.doubleValue)}function Tr(t){return Ve(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Sr{constructor(t,e){this.field=t,this.transform=e}}class xr{constructor(t,e){this.version=t,this.transformResults=e}}class Dr{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Dr}static exists(t){return new Dr(void 0,t)}static updateTime(t){return new Dr(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ar(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Cr{}function Nr(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Br(t.key,Dr.none()):new Mr(t.key,t.data,Dr.none());{const n=t.data,r=We.empty();let i=new le(J.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new Lr(t.key,r,new ge(i.toArray()),Dr.none())}}function kr(t,e,n){t instanceof Mr?function(t,e,n){const r=t.value.clone(),i=Vr(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Lr?function(t,e,n){if(!Ar(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Vr(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Fr(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Rr(t,e,n,r){return t instanceof Mr?function(t,e,n,r){if(!Ar(t.precondition,e))return n;const i=t.value.clone(),s=Ur(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof Lr?function(t,e,n,r){if(!Ar(t.precondition,e))return n;const i=Ur(t.fieldTransforms,r,e),s=e.data;return s.setAll(Fr(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Ar(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Or(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=mr(r.transform,t||null);null!=i&&(null===n&&(n=We.empty()),n.set(r.field,i))}return n||null}function Pr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&K(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof yr&&e instanceof yr||t instanceof vr&&e instanceof vr?K(t.elements,e.elements,Ne):t instanceof Ir&&e instanceof Ir?Ne(t.Pe,e.Pe):t instanceof pr&&e instanceof pr}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Mr extends Cr{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Lr extends Cr{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Fr(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Vr(t,e,n){const r=new Map;x(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,c=e.data.field(s.field);r.set(s.field,gr(o,c,n[i]))}return r}function Ur(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,fr(t,s,e))}return r}class Br extends Cr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qr extends Cr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class jr{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&kr(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Rr(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Rr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=er();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const c=Nr(s,o);null!==c&&n.set(r.key,c),s.isValidDocument()||s.convertToNoDocument(Q.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),sr())}isEqual(t){return this.batchId===t.batchId&&K(this.mutations,t.mutations,((t,e)=>Pr(t,e)))&&K(this.baseMutations,t.baseMutations,((t,e)=>Pr(t,e)))}}class zr{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){x(t.mutations.length===n.length);let r=rr;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new zr(t,e,n,r)}}class Kr{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Gr{constructor(t,e){this.count=t,this.unchangedNames=e}}var $r,Qr;function Wr(t){switch(t){default:return S();case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0}}function Yr(t){if(void 0===t)return I("GRPC error has no .code"),C.UNKNOWN;switch(t){case $r.OK:return C.OK;case $r.CANCELLED:return C.CANCELLED;case $r.UNKNOWN:return C.UNKNOWN;case $r.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case $r.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case $r.INTERNAL:return C.INTERNAL;case $r.UNAVAILABLE:return C.UNAVAILABLE;case $r.UNAUTHENTICATED:return C.UNAUTHENTICATED;case $r.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case $r.NOT_FOUND:return C.NOT_FOUND;case $r.ALREADY_EXISTS:return C.ALREADY_EXISTS;case $r.PERMISSION_DENIED:return C.PERMISSION_DENIED;case $r.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case $r.ABORTED:return C.ABORTED;case $r.OUT_OF_RANGE:return C.OUT_OF_RANGE;case $r.UNIMPLEMENTED:return C.UNIMPLEMENTED;case $r.DATA_LOSS:return C.DATA_LOSS;default:return S()}}(Qr=$r||($r={}))[Qr.OK=0]="OK",Qr[Qr.CANCELLED=1]="CANCELLED",Qr[Qr.UNKNOWN=2]="UNKNOWN",Qr[Qr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qr[Qr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qr[Qr.NOT_FOUND=5]="NOT_FOUND",Qr[Qr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qr[Qr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qr[Qr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qr[Qr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qr[Qr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qr[Qr.ABORTED=10]="ABORTED",Qr[Qr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qr[Qr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qr[Qr.INTERNAL=13]="INTERNAL",Qr[Qr.UNAVAILABLE=14]="UNAVAILABLE",Qr[Qr.DATA_LOSS=15]="DATA_LOSS";let Hr=null;function Jr(){return new TextEncoder}const Xr=new d.e([4294967295,4294967295],0);function Zr(t){const e=Jr().encode(t),n=new d.f;return n.update(e),new Uint8Array(n.digest())}function ti(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new d.e([n,r],0),new d.e([i,s],0)]}class ei{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new ni(`Invalid padding: ${e}`);if(n<0)throw new ni(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new ni(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new ni(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=d.e.fromNumber(this.Ie)}Ee(t,e,n){let r=t.add(e.multiply(d.e.fromNumber(n)));return 1===r.compare(Xr)&&(r=new d.e([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Ie)return!1;const e=Zr(t),[n,r]=ti(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,r,t);if(!this.de(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new ei(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.Ie)return;const e=Zr(t),[n,r]=ti(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,r,t);this.Ae(e)}}Ae(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class ni extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ri{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,ii.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new ri(Q.min(),r,new ue(z),Yn(),sr())}}class ii{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new ii(n,e,sr(),sr(),sr())}}class si{constructor(t,e,n,r){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=r}}class oi{constructor(t,e){this.targetId=t,this.me=e}}class ai{constructor(t,e,n=ye.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class ui{constructor(){this.fe=0,this.ge=di(),this.pe=ye.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}Ce(){let t=sr(),e=sr(),n=sr();return this.ge.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:S()}})),new ii(this.pe,this.ye,t,e,n)}ve(){this.we=!1,this.ge=di()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,x(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class ci{constructor(t){this.Le=t,this.Be=new Map,this.ke=Yn(),this.qe=hi(),this.Qe=new ue(z)}Ke(t){for(const e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(const e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,(e=>{const n=this.Ge(e);switch(t.state){case 0:this.ze(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),n.De(t.resumeToken));break;default:S()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach(((t,n)=>{this.ze(n)&&e(n)}))}He(t){const e=t.targetId,n=t.me.count,r=this.Je(e);if(r){const i=r.target;if(xn(i))if(0===n){const t=new X(i.path);this.Ue(e,t,He.newNoDocument(t,Q.min()))}else x(1===n);else{const r=this.Ye(e);if(r!==n){const n=this.Ze(t),i=n?this.Xe(n,t,r):1;if(0!==i){this.je(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,t)}null==Hr||Hr.et(function(t,e,n,r,i){var s,o,c,a,u,h;const l={localCacheCount:t,existenceFilterCount:e.count,databaseId:n.database,projectId:n.projectId},d=e.unchangedNames;return d&&(l.bloomFilter={applied:0===i,hashCount:null!==(s=null==d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(a=null===(c=null===(o=null==d?void 0:d.bits)||void 0===o?void 0:o.bitmap)||void 0===c?void 0:c.length)&&void 0!==a?a:0,padding:null!==(h=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==h?h:0,mightContain:t=>{var e;return null!==(e=null==r?void 0:r.mightContain(t))&&void 0!==e&&e}}),l}(r,t.me,this.Le.tt(),n,i))}}}}Ze(t){const e=t.me.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=_e(n).toUint8Array()}catch(t){if(t instanceof me)return E("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new ei(s,r,i)}catch(t){return E(t instanceof ni?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Ie?null:o}Xe(t,e,n){return e.me.count===n-this.nt(t,e.targetId)?0:2}nt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Le.tt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.Ue(e,n,null),r++)})),r}rt(t){const e=new Map;this.Be.forEach(((n,r)=>{const i=this.Je(r);if(i){if(n.current&&xn(i.target)){const e=new X(i.target.path);null!==this.ke.get(e)||this.it(r,e)||this.Ue(r,e,He.newNoDocument(e,t))}n.be&&(e.set(r,n.Ce()),n.ve())}}));let n=sr();this.qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Je(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.ke.forEach(((e,n)=>n.setReadTime(t)));const r=new ri(t,e,this.Qe,this.ke,n);return this.ke=Yn(),this.qe=hi(),this.Qe=new ue(z),r}$e(t,e){if(!this.ze(t))return;const n=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,n){if(!this.ze(t))return;const r=this.Ge(t);this.it(t,e)?r.Fe(e,1):r.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ye(t){const e=this.Ge(t).Ce();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new ui,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new le(z),this.qe=this.qe.insert(t,e)),e}ze(t){const e=null!==this.Je(t);return e||_("WatchChangeAggregator","Detected inactive target",t),e}Je(t){const e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new ui),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.Ue(t,e,null)}))}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function hi(){return new ue(X.comparator)}function di(){return new ue(X.comparator)}const fi={asc:"ASCENDING",desc:"DESCENDING"},gi={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},mi={and:"AND",or:"OR"};class pi{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function yi(t,e){return t.useProto3Json||Dt(e)?e:{value:e}}function wi(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function vi(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function bi(t,e){return wi(t,e.toTimestamp())}function _i(t){return x(!!t),Q.fromTimestamp(function(t){const e=ve(t);return new $(e.seconds,e.nanos)}(t))}function Ii(t,e){return Ei(t,e).canonicalString()}function Ei(t,e){const n=function(t){return new Y(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Ti(t){const e=Y.fromString(t);return x($i(e)),e}function Si(t,e){return Ii(t.databaseId,e.path)}function xi(t,e){const n=Ti(e);if(n.get(1)!==t.databaseId.projectId)throw new N(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new N(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new X(Ni(n))}function Di(t,e){return Ii(t.databaseId,e)}function Ai(t){const e=Ti(t);return 4===e.length?Y.emptyPath():Ni(e)}function Ci(t){return new Y(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ni(t){return x(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function ki(t,e,n){return{name:Si(t,e),fields:n.value.mapValue.fields}}function Ri(t,e,n){const r=xi(t,e.name),i=_i(e.updateTime),s=e.createTime?_i(e.createTime):Q.min(),o=new We({mapValue:{fields:e.fields}}),c=He.newFoundDocument(r,i,s,o);return n&&c.setHasCommittedMutations(),n?c.setHasCommittedMutations():c}function Oi(t,e){let n;if(e instanceof Mr)n={update:ki(t,e.key,e.value)};else if(e instanceof Br)n={delete:Si(t,e.key)};else if(e instanceof Lr)n={update:ki(t,e.key,e.data),updateMask:Gi(e.fieldMask)};else{if(!(e instanceof qr))return S();n={verify:Si(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof pr)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof yr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof vr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ir)return{fieldPath:e.field.canonicalString(),increment:n.Pe};throw S()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:bi(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:S()}(t,e.precondition)),n}function Pi(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Dr.updateTime(_i(t.updateTime)):void 0!==t.exists?Dr.exists(t.exists):Dr.none()}(e.currentDocument):Dr.none(),r=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)x("REQUEST_TIME"===e.setToServerValue),n=new pr;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new yr(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new vr(t)}else"increment"in e?n=new Ir(t,e.increment):S();const r=J.fromServerFormat(e.fieldPath);return new Sr(r,n)}(t,e))):[];if(e.update){e.update.name;const i=xi(t,e.update.name),s=new We({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new ge(e.map((t=>J.fromServerFormat(t))))}(e.updateMask);return new Lr(i,s,t,n,r)}return new Mr(i,s,n,r)}if(e.delete){const r=xi(t,e.delete);return new Br(r,n)}if(e.verify){const r=xi(t,e.verify);return new qr(r,n)}return S()}function Mi(t,e){return{documents:[Di(t,e.path)]}}function Li(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Di(t,i);const s=function(t){if(0!==t.length)return Ki(sn.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:ji(t.field),direction:Ui(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const c=yi(t,e.limit);return null!==c&&(n.structuredQuery.limit=c),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{_t:n,parent:i}}function Fi(t){let e=Ai(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){x(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=Vi(t);return e instanceof sn&&un(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new tn(zi(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let c=null;n.limit&&(c=function(t){let e;return e="object"==typeof t?t.value:t,Dt(e)?null:e}(n.limit));let a=null;n.startAt&&(a=function(t){const e=!!t.before,n=t.values||[];return new Je(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new Je(n,e)}(n.endAt)),kn(e,i,o,s,c,"F",a,u)}function Vi(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=zi(t.unaryFilter.field);return rn.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=zi(t.unaryFilter.field);return rn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=zi(t.unaryFilter.field);return rn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=zi(t.unaryFilter.field);return rn.create(i,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(t):void 0!==t.fieldFilter?function(t){return rn.create(zi(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return sn.create(t.compositeFilter.filters.map((t=>Vi(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return S()}}(t.compositeFilter.op))}(t):S()}function Ui(t){return fi[t]}function Bi(t){return gi[t]}function qi(t){return mi[t]}function ji(t){return{fieldPath:t.canonicalString()}}function zi(t){return J.fromServerFormat(t.fieldPath)}function Ki(t){return t instanceof rn?function(t){if("=="===t.op){if(Be(t.value))return{unaryFilter:{field:ji(t.field),op:"IS_NAN"}};if(Ue(t.value))return{unaryFilter:{field:ji(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Be(t.value))return{unaryFilter:{field:ji(t.field),op:"IS_NOT_NAN"}};if(Ue(t.value))return{unaryFilter:{field:ji(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ji(t.field),op:Bi(t.op),value:t.value}}}(t):t instanceof sn?function(t){const e=t.getFilters().map((t=>Ki(t)));return 1===e.length?e[0]:{compositeFilter:{op:qi(t.op),filters:e}}}(t):S()}function Gi(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function $i(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Qi{constructor(t,e,n,r,i=Q.min(),s=Q.min(),o=ye.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=c}withSequenceNumber(t){return new Qi(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Qi(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Qi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Qi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Wi{constructor(t){this.ut=t}}function Yi(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Hi(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(t,e){return{name:Si(t,e.key),fields:e.data.value.mapValue.fields,updateTime:wi(t,e.version.toTimestamp()),createTime:wi(t,e.createTime.toTimestamp())}}(t.ut,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Ji(e.version)};else{if(!e.isUnknownDocument())return S();r.unknownDocument={path:n.path.toArray(),version:Ji(e.version)}}return r}function Hi(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ji(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Xi(t){const e=new $(t.seconds,t.nanoseconds);return Q.fromTimestamp(e)}function Zi(t,e){const n=(e.baseMutations||[]).map((e=>Pi(t.ut,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const r=e.mutations[t+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const r=e.mutations.map((e=>Pi(t.ut,e))),i=$.fromMillis(e.localWriteTimeMs);return new jr(e.batchId,i,n,r)}function ts(t){const e=Xi(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Xi(t.lastLimboFreeSnapshotVersion):Q.min();let r;return r=function(t){return void 0!==t.documents}(t.query)?function(t){return x(1===t.documents.length),Ln(Rn(Ai(t.documents[0])))}(t.query):function(t){return Ln(Fi(t))}(t.query),new Qi(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,ye.fromBase64String(t.resumeToken))}function es(t,e){const n=Ji(e.snapshotVersion),r=Ji(e.lastLimboFreeSnapshotVersion);let i;i=xn(e.target)?Mi(t.ut,e.target):Li(t.ut,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Tn(e.target),readTime:n,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function ns(t){const e=Fi({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Un(e,e.limit,"L"):e}function rs(t,e){return new Kr(e.largestBatchId,Pi(t.ut,e.overlayMutation))}function is(t,e){const n=e.path.lastSegment();return[t,Nt(e.path.popLast()),n]}function ss(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:Ji(r.readTime),documentKey:Nt(r.documentKey.path),largestBatchId:r.largestBatchId}}class os{getBundleMetadata(t,e){return as(t).get(e).next((t=>{if(t)return function(t){return{id:t.bundleId,createTime:Xi(t.createTime),version:t.version}}(t)}))}saveBundleMetadata(t,e){return as(t).put(function(t){return{bundleId:t.id,createTime:Ji(_i(t.createTime)),version:t.version}}(e))}getNamedQuery(t,e){return us(t).get(e).next((t=>{if(t)return function(t){return{name:t.name,query:ns(t.bundledQuery),readTime:Xi(t.readTime)}}(t)}))}saveNamedQuery(t,e){return us(t).put(function(t){return{name:t.name,readTime:Ji(_i(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function as(t){return ie(t,"bundles")}function us(t){return ie(t,"namedQueries")}class cs{constructor(t,e){this.serializer=t,this.userId=e}static ct(t,e){const n=e.uid||"";return new cs(t,n)}getOverlay(t,e){return hs(t).get(is(this.userId,e)).next((t=>t?rs(this.serializer,t):null))}getOverlays(t,e){const n=Zn();return ft.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){const r=[];return n.forEach(((n,i)=>{const s=new Kr(e,i);r.push(this.lt(t,s))})),ft.waitFor(r)}removeOverlaysForBatchId(t,e,n){const r=new Set;e.forEach((t=>r.add(Nt(t.getCollectionPath()))));const i=[];return r.forEach((e=>{const r=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);i.push(hs(t).j("collectionPathOverlayIndex",r))})),ft.waitFor(i)}getOverlaysForCollection(t,e,n){const r=Zn(),i=Nt(e),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return hs(t).U("collectionPathOverlayIndex",s).next((t=>{for(const e of t){const t=rs(this.serializer,e);r.set(t.getKey(),t)}return r}))}getOverlaysForCollectionGroup(t,e,n,r){const i=Zn();let s;const o=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return hs(t).J({index:"collectionGroupOverlayIndex",range:o},((t,e,n)=>{const o=rs(this.serializer,e);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}lt(t,e){return hs(t).put(function(t,e,n){const[r,i,s]=is(e,n.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Oi(t.ut,n.mutation)}}(this.serializer,this.userId,e))}}function hs(t){return ie(t,"documentOverlays")}class ls{constructor(){}ht(t,e){this.Pt(t,e),e.It()}Pt(t,e){if("nullValue"in t)this.Tt(e,5);else if("booleanValue"in t)this.Tt(e,10),e.Et(t.booleanValue?1:0);else if("integerValue"in t)this.Tt(e,15),e.Et(be(t.integerValue));else if("doubleValue"in t){const n=be(t.doubleValue);isNaN(n)?this.Tt(e,13):(this.Tt(e,15),At(n)?e.Et(0):e.Et(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Tt(e,20),"string"==typeof n&&(n=ve(n)),e.dt(`${n.seconds||""}`),e.Et(n.nanos||0)}else if("stringValue"in t)this.At(t.stringValue,e),this.Rt(e);else if("bytesValue"in t)this.Tt(e,30),e.Vt(_e(t.bytesValue)),this.Rt(e);else if("referenceValue"in t)this.ft(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Tt(e,45),e.Et(n.latitude||0),e.Et(n.longitude||0)}else"mapValue"in t?ze(t)?this.Tt(e,Number.MAX_SAFE_INTEGER):(this.gt(t.mapValue,e),this.Rt(e)):"arrayValue"in t?(this.yt(t.arrayValue,e),this.Rt(e)):S()}At(t,e){this.Tt(e,25),this.wt(t,e)}wt(t,e){e.dt(t)}gt(t,e){const n=t.fields||{};this.Tt(e,55);for(const t of Object.keys(n))this.At(t,e),this.Pt(n[t],e)}yt(t,e){const n=t.values||[];this.Tt(e,50);for(const t of n)this.Pt(t,e)}ft(t,e){this.Tt(e,37),X.fromName(t).path.forEach((t=>{this.Tt(e,60),this.wt(t,e)}))}Tt(t,e){t.Et(e)}Rt(t){t.Et(2)}}function ds(t){if(0===t)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function fs(t){const e=64-function(t){let e=0;for(let n=0;n<8;++n){const r=ds(255&t[n]);if(e+=r,8!==r)break}return e}(t);return Math.ceil(e/8)}ls.St=new ls;class gs{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Dt(n.value),n=e.next();this.Ct()}vt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Ft(n.value),n=e.next();this.Mt()}xt(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Dt(t);else if(t<2048)this.Dt(960|t>>>6),this.Dt(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Dt(480|t>>>12),this.Dt(128|63&t>>>6),this.Dt(128|63&t);else{const t=e.codePointAt(0);this.Dt(240|t>>>18),this.Dt(128|63&t>>>12),this.Dt(128|63&t>>>6),this.Dt(128|63&t)}}this.Ct()}Ot(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Ft(t);else if(t<2048)this.Ft(960|t>>>6),this.Ft(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Ft(480|t>>>12),this.Ft(128|63&t>>>6),this.Ft(128|63&t);else{const t=e.codePointAt(0);this.Ft(240|t>>>18),this.Ft(128|63&t>>>12),this.Ft(128|63&t>>>6),this.Ft(128|63&t)}}this.Mt()}Nt(t){const e=this.Lt(t),n=fs(e);this.Bt(1+n),this.buffer[this.position++]=255&n;for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=255&e[t]}kt(t){const e=this.Lt(t),n=fs(e);this.Bt(1+n),this.buffer[this.position++]=~(255&n);for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=~(255&e[t])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(t){this.Bt(t.length),this.buffer.set(t,this.position),this.position+=t.length}Ut(){return this.buffer.slice(0,this.position)}Lt(t){const e=function(t){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t,!1),new Uint8Array(e.buffer)}(t),n=0!=(128&e[0]);e[0]^=n?255:128;for(let t=1;t<e.length;++t)e[t]^=n?255:0;return e}Dt(t){const e=255&t;0===e?(this.Qt(0),this.Qt(255)):255===e?(this.Qt(255),this.Qt(0)):this.Qt(e)}Ft(t){const e=255&t;0===e?(this.$t(0),this.$t(255)):255===e?(this.$t(255),this.$t(0)):this.$t(t)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(t){this.Bt(1),this.buffer[this.position++]=t}$t(t){this.Bt(1),this.buffer[this.position++]=~t}Bt(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class ms{constructor(t){this.Wt=t}Vt(t){this.Wt.bt(t)}dt(t){this.Wt.xt(t)}Et(t){this.Wt.Nt(t)}It(){this.Wt.qt()}}class ps{constructor(t){this.Wt=t}Vt(t){this.Wt.vt(t)}dt(t){this.Wt.Ot(t)}Et(t){this.Wt.kt(t)}It(){this.Wt.Kt()}}class ys{constructor(){this.Wt=new gs,this.Gt=new ms(this.Wt),this.zt=new ps(this.Wt)}seed(t){this.Wt.seed(t)}jt(t){return 0===t?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class ws{constructor(t,e,n,r){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=r}Ht(){const t=this.directionalValue.length,e=0===t||255===this.directionalValue[t-1]?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new ws(this.indexId,this.documentKey,this.arrayValue,n)}}function vs(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=bs(t.arrayValue,e.arrayValue),0!==n?n:(n=bs(t.directionalValue,e.directionalValue),0!==n?n:X.comparator(t.documentKey,e.documentKey)))}function bs(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(0!==r)return r}return t.length-e.length}class _s{constructor(t){this.Jt=new le(((t,e)=>J.comparator(t.field,e.field))),this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Yt=t.orderBy,this.Zt=[];for(const e of t.filters){const t=e;t.isInequality()?this.Jt=this.Jt.add(t):this.Zt.push(t)}}get Xt(){return this.Jt.size>1}en(t){if(x(t.collectionGroup===this.collectionId),this.Xt)return!1;const e=tt(t);if(void 0!==e&&!this.tn(e))return!1;const n=et(t);let r=new Set,i=0,s=0;for(;i<n.length&&this.tn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Jt.size>0){const t=this.Jt.getIterator().getNext();if(!r.has(t.field.canonicalString())){const e=n[i];if(!this.nn(t,e)||!this.rn(this.Yt[s++],e))return!1}++i}for(;i<n.length;++i){const t=n[i];if(s>=this.Yt.length||!this.rn(this.Yt[s++],t))return!1}return!0}sn(){if(this.Xt)return null;let t=new le(J.comparator);const e=[];for(const n of this.Zt)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)e.push(new nt(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new nt(n.field,0))}for(const n of this.Yt)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new nt(n.field,"asc"===n.dir?0:1)));return new Z(Z.UNKNOWN_ID,this.collectionId,e,it.empty())}tn(t){for(const e of this.Zt)if(this.nn(e,t))return!0;return!1}nn(t,e){if(void 0===t||!t.field.isEqual(e.fieldPath))return!1;const n="array-contains"===t.op||"array-contains-any"===t.op;return 2===e.kind===n}rn(t,e){return!!t.field.isEqual(e.fieldPath)&&(0===e.kind&&"asc"===t.dir||1===e.kind&&"desc"===t.dir)}}function Is(t){var e,n;if(x(t instanceof rn||t instanceof sn),t instanceof rn){if(t instanceof vn){const r=(null===(n=null===(e=t.value.arrayValue)||void 0===e?void 0:e.values)||void 0===n?void 0:n.map((e=>rn.create(t.field,"==",e))))||[];return sn.create(r,"or")}return t}const r=t.filters.map((t=>Is(t)));return sn.create(r,t.op)}function Es(t){if(0===t.getFilters().length)return[];const e=Ds(Is(t));return x(xs(e)),Ts(e)||Ss(e)?[e]:e.getFilters()}function Ts(t){return t instanceof rn}function Ss(t){return t instanceof sn&&un(t)}function xs(t){return Ts(t)||Ss(t)||function(t){if(t instanceof sn&&an(t)){for(const e of t.getFilters())if(!Ts(e)&&!Ss(e))return!1;return!0}return!1}(t)}function Ds(t){if(x(t instanceof rn||t instanceof sn),t instanceof rn)return t;if(1===t.filters.length)return Ds(t.filters[0]);const e=t.filters.map((t=>Ds(t)));let n=sn.create(e,t.op);return n=Ns(n),xs(n)?n:(x(n instanceof sn),x(on(n)),x(n.filters.length>1),n.filters.reduce(((t,e)=>As(t,e))))}function As(t,e){let n;return x(t instanceof rn||t instanceof sn),x(e instanceof rn||e instanceof sn),n=t instanceof rn?e instanceof rn?function(t,e){return sn.create([t,e],"and")}(t,e):Cs(t,e):e instanceof rn?Cs(e,t):function(t,e){if(x(t.filters.length>0&&e.filters.length>0),on(t)&&on(e))return dn(t,e.getFilters());const n=an(t)?t:e,r=an(t)?e:t,i=n.filters.map((t=>As(t,r)));return sn.create(i,"or")}(t,e),Ns(n)}function Cs(t,e){if(on(e))return dn(e,t.getFilters());{const n=e.filters.map((e=>As(t,e)));return sn.create(n,"or")}}function Ns(t){if(x(t instanceof rn||t instanceof sn),t instanceof rn)return t;const e=t.getFilters();if(1===e.length)return Ns(e[0]);if(cn(t))return t;const n=e.map((t=>Ns(t))),r=[];return n.forEach((e=>{e instanceof rn?r.push(e):e instanceof sn&&(e.op===t.op?r.push(...e.filters):r.push(e))})),1===r.length?r[0]:sn.create(r,t.op)}class ks{constructor(){this.on=new Rs}addToCollectionParentIndex(t,e){return this.on.add(e),ft.resolve()}getCollectionParents(t,e){return ft.resolve(this.on.getEntries(e))}addFieldIndex(t,e){return ft.resolve()}deleteFieldIndex(t,e){return ft.resolve()}deleteAllFieldIndexes(t){return ft.resolve()}createTargetIndexes(t,e){return ft.resolve()}getDocumentsMatchingTarget(t,e){return ft.resolve(null)}getIndexType(t,e){return ft.resolve(0)}getFieldIndexes(t,e){return ft.resolve([])}getNextCollectionGroupToUpdate(t){return ft.resolve(null)}getMinOffset(t,e){return ft.resolve(at.min())}getMinOffsetFromCollectionGroup(t,e){return ft.resolve(at.min())}updateCollectionGroup(t,e,n){return ft.resolve()}updateIndexEntries(t,e){return ft.resolve()}}class Rs{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new le(Y.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new le(Y.comparator)).toArray()}}const Os=new Uint8Array(0);class Ps{constructor(t,e){this.databaseId=e,this._n=new Rs,this.an=new Qn((t=>Tn(t)),((t,e)=>Sn(t,e))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this._n.has(e)){const n=e.lastSegment(),r=e.popLast();t.addOnCommittedListener((()=>{this._n.add(e)}));const i={collectionId:n,parent:Nt(r)};return Ms(t).put(i)}return ft.resolve()}getCollectionParents(t,e){const n=[],r=IDBKeyRange.bound([e,""],[G(e),""],!1,!0);return Ms(t).U(r).next((t=>{for(const r of t){if(r.collectionId!==e)break;n.push(Ot(r.parent))}return n}))}addFieldIndex(t,e){const n=Fs(t),r=function(t){return{indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map((t=>[t.fieldPath.canonicalString(),t.kind]))}}(e);delete r.indexId;const i=n.add(r);if(e.indexState){const n=Vs(t);return i.next((t=>{n.put(ss(t,this.uid,e.indexState.sequenceNumber,e.indexState.offset))}))}return i.next()}deleteFieldIndex(t,e){const n=Fs(t),r=Vs(t),i=Ls(t);return n.delete(e.indexId).next((()=>r.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}deleteAllFieldIndexes(t){const e=Fs(t),n=Ls(t),r=Vs(t);return e.j().next((()=>n.j())).next((()=>r.j()))}createTargetIndexes(t,e){return ft.forEach(this.un(e),(e=>this.getIndexType(t,e).next((n=>{if(0===n||1===n){const n=new _s(e).sn();if(null!=n)return this.addFieldIndex(t,n)}}))))}getDocumentsMatchingTarget(t,e){const n=Ls(t);let r=!0;const i=new Map;return ft.forEach(this.un(e),(e=>this.cn(t,e).next((t=>{r&&(r=!!t),i.set(e,t)})))).next((()=>{if(r){let t=sr();const r=[];return ft.forEach(i,((i,s)=>{_("IndexedDbIndexManager",`Using index ${function(t){return`id=${t.indexId}|cg=${t.collectionGroup}|f=${t.fields.map((t=>`${t.fieldPath}:${t.kind}`)).join(",")}`}(i)} to execute ${Tn(e)}`);const o=function(t,e){const n=tt(e);if(void 0===n)return null;for(const e of Dn(t,n.fieldPath))switch(e.op){case"array-contains-any":return e.value.arrayValue.values||[];case"array-contains":return[e.value]}return null}(s,i),c=function(t,e){const n=new Map;for(const r of et(e))for(const e of Dn(t,r.fieldPath))switch(e.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),e.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),e.value),Array.from(n.values())}return null}(s,i),a=function(t,e){const n=[];let r=!0;for(const i of et(e)){const e=0===i.kind?An(t,i.fieldPath,t.startAt):Cn(t,i.fieldPath,t.startAt);n.push(e.value),r&&(r=e.inclusive)}return new Je(n,r)}(s,i),u=function(t,e){const n=[];let r=!0;for(const i of et(e)){const e=0===i.kind?Cn(t,i.fieldPath,t.endAt):An(t,i.fieldPath,t.endAt);n.push(e.value),r&&(r=e.inclusive)}return new Je(n,r)}(s,i),h=this.ln(i,s,a),l=this.ln(i,s,u),d=this.hn(i,s,c),f=this.Pn(i.indexId,o,h,a.inclusive,l,u.inclusive,d);return ft.forEach(f,(i=>n.G(i,e.limit).next((e=>{e.forEach((e=>{const n=X.fromSegments(e.documentKey);t.has(n)||(t=t.add(n),r.push(n))}))}))))})).next((()=>r))}return ft.resolve(null)}))}un(t){let e=this.an.get(t);return e||(e=0===t.filters.length?[t]:Es(sn.create(t.filters,"and")).map((e=>En(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt))),this.an.set(t,e),e)}Pn(t,e,n,r,i,s,o){const c=(null!=e?e.length:1)*Math.max(n.length,i.length),a=c/(null!=e?e.length:1),u=[];for(let h=0;h<c;++h){const c=e?this.In(e[h/a]):Os,l=this.Tn(t,c,n[h%a],r),d=this.En(t,c,i[h%a],s),f=o.map((e=>this.Tn(t,c,e,!0)));u.push(...this.createRange(l,d,f))}return u}Tn(t,e,n,r){const i=new ws(t,X.empty(),e,n);return r?i:i.Ht()}En(t,e,n,r){const i=new ws(t,X.empty(),e,n);return r?i.Ht():i}cn(t,e){const n=new _s(e),r=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,r).next((t=>{let e=null;for(const r of t)n.en(r)&&(!e||r.fields.length>e.fields.length)&&(e=r);return e}))}getIndexType(t,e){let n=2;const r=this.un(e);return ft.forEach(r,(e=>this.cn(t,e).next((t=>{t?0!==n&&t.fields.length<function(t){let e=new le(J.comparator),n=!1;for(const r of t.filters)for(const t of r.getFlattenedFilters())t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n=!0:e=e.add(t.field));for(const n of t.orderBy)n.field.isKeyField()||(e=e.add(n.field));return e.size+(n?1:0)}(e)&&(n=1):n=0})))).next((()=>function(t){return null!==t.limit}(e)&&r.length>1&&2===n?1:n))}dn(t,e){const n=new ys;for(const r of et(t)){const t=e.data.field(r.fieldPath);if(null==t)return null;const i=n.jt(r.kind);ls.St.ht(t,i)}return n.Ut()}In(t){const e=new ys;return ls.St.ht(t,e.jt(0)),e.Ut()}An(t,e){const n=new ys;return ls.St.ht(Le(this.databaseId,e),n.jt(function(t){const e=et(t);return 0===e.length?0:e[e.length-1].kind}(t))),n.Ut()}hn(t,e,n){if(null===n)return[];let r=[];r.push(new ys);let i=0;for(const s of et(t)){const t=n[i++];for(const n of r)if(this.Rn(e,s.fieldPath)&&Ve(t))r=this.Vn(r,s,t);else{const e=n.jt(s.kind);ls.St.ht(t,e)}}return this.mn(r)}ln(t,e,n){return this.hn(t,e,n.position)}mn(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Ut();return e}Vn(t,e,n){const r=[...t],i=[];for(const t of n.arrayValue.values||[])for(const n of r){const r=new ys;r.seed(n.Ut()),ls.St.ht(t,r.jt(e.kind)),i.push(r)}return i}Rn(t,e){return!!t.filters.find((t=>t instanceof rn&&t.field.isEqual(e)&&("in"===t.op||"not-in"===t.op)))}getFieldIndexes(t,e){const n=Fs(t),r=Vs(t);return(e?n.U("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.U()).next((t=>{const e=[];return ft.forEach(t,(t=>r.get([t.indexId,this.uid]).next((n=>{e.push(function(t,e){const n=e?new it(e.sequenceNumber,new at(Xi(e.readTime),new X(Ot(e.documentKey)),e.largestBatchId)):it.empty(),r=t.fields.map((([t,e])=>new nt(J.fromServerFormat(t),e)));return new Z(t.indexId,t.collectionGroup,r,n)}(t,n))})))).next((()=>e))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((t=>0===t.length?null:(t.sort(((t,e)=>{const n=t.indexState.sequenceNumber-e.indexState.sequenceNumber;return 0!==n?n:z(t.collectionGroup,e.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(t,e,n){const r=Fs(t),i=Vs(t);return this.fn(t).next((t=>r.U("collectionGroupIndex",IDBKeyRange.bound(e,e)).next((e=>ft.forEach(e,(e=>i.put(ss(e.indexId,this.uid,t,n))))))))}updateIndexEntries(t,e){const n=new Map;return ft.forEach(e,((e,r)=>{const i=n.get(e.collectionGroup);return(i?ft.resolve(i):this.getFieldIndexes(t,e.collectionGroup)).next((i=>(n.set(e.collectionGroup,i),ft.forEach(i,(n=>this.gn(t,e,n).next((e=>{const i=this.pn(r,n);return e.isEqual(i)?ft.resolve():this.yn(t,r,n,e,i)})))))))}))}wn(t,e,n,r){return Ls(t).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.An(n,e.key),documentKey:e.key.path.toArray()})}Sn(t,e,n,r){return Ls(t).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.An(n,e.key),e.key.path.toArray()])}gn(t,e,n){const r=Ls(t);let i=new le(vs);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.An(n,e)])},((t,r)=>{i=i.add(new ws(n.indexId,e,r.arrayValue,r.directionalValue))})).next((()=>i))}pn(t,e){let n=new le(vs);const r=this.dn(e,t);if(null==r)return n;const i=tt(e);if(null!=i){const s=t.data.field(i.fieldPath);if(Ve(s))for(const i of s.arrayValue.values||[])n=n.add(new ws(e.indexId,t.key,this.In(i),r))}else n=n.add(new ws(e.indexId,t.key,Os,r));return n}yn(t,e,n,r,i){_("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const s=[];return function(t,e,n,r,i){const s=t.getIterator(),o=e.getIterator();let c=fe(s),a=fe(o);for(;c||a;){let t=!1,e=!1;if(c&&a){const r=n(c,a);r<0?e=!0:r>0&&(t=!0)}else null!=c?e=!0:t=!0;t?(r(a),a=fe(o)):e?(i(c),c=fe(s)):(c=fe(s),a=fe(o))}}(r,i,vs,(r=>{s.push(this.wn(t,e,n,r))}),(r=>{s.push(this.Sn(t,e,n,r))})),ft.waitFor(s)}fn(t){let e=1;return Vs(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((t,n,r)=>{r.done(),e=n.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((t,e)=>vs(t,e))).filter(((t,e,n)=>!e||0!==vs(t,n[e-1])));const r=[];r.push(t);for(const i of n){const n=vs(i,t),s=vs(i,e);if(0===n)r[0]=t.Ht();else if(n>0&&s<0)r.push(i),r.push(i.Ht());else if(s>0)break}r.push(e);const i=[];for(let t=0;t<r.length;t+=2){if(this.bn(r[t],r[t+1]))return[];const e=[r[t].indexId,this.uid,r[t].arrayValue,r[t].directionalValue,Os,[]],n=[r[t+1].indexId,this.uid,r[t+1].arrayValue,r[t+1].directionalValue,Os,[]];i.push(IDBKeyRange.bound(e,n))}return i}bn(t,e){return vs(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Us)}getMinOffset(t,e){return ft.mapArray(this.un(e),(e=>this.cn(t,e).next((t=>t||S())))).next(Us)}}function Ms(t){return ie(t,"collectionParents")}function Ls(t){return ie(t,"indexEntries")}function Fs(t){return ie(t,"indexConfiguration")}function Vs(t){return ie(t,"indexState")}function Us(t){x(0!==t.length);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const i=t[r].indexState.offset;ut(i,e)<0&&(e=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new at(e.readTime,e.documentKey,n)}const Bs={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class qs{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new qs(t,qs.DEFAULT_COLLECTION_PERCENTILE,qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function js(t,e,n){const r=t.store("mutations"),i=t.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let c=0;const a=r.J({range:o},((t,e,n)=>(c++,n.delete())));s.push(a.next((()=>{x(1===c)})));const u=[];for(const t of n.mutations){const r=Lt(e,t.key.path,n.batchId);s.push(i.delete(r)),u.push(t.key)}return ft.waitFor(s).next((()=>u))}function zs(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw S();e=t.noDocument}return JSON.stringify(e).length}qs.DEFAULT_COLLECTION_PERCENTILE=10,qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qs.DEFAULT=new qs(41943040,qs.DEFAULT_COLLECTION_PERCENTILE,qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qs.DISABLED=new qs(-1,0,0);class Ks{constructor(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.Dn={}}static ct(t,e,n,r){x(""!==t.uid);const i=t.isAuthenticated()?t.uid:"";return new Ks(i,e,n,r)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return $s(t).J({index:"userMutationsIndex",range:n},((t,n,r)=>{e=!1,r.done()})).next((()=>e))}addMutationBatch(t,e,n,r){const i=Qs(t),s=$s(t);return s.add({}).next((o=>{x("number"==typeof o);const c=new jr(o,e,n,r),a=function(t,e,n){const r=n.baseMutations.map((e=>Oi(t.ut,e))),i=n.mutations.map((e=>Oi(t.ut,e)));return{userId:e,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,c),u=[];let h=new le(((t,e)=>z(t.canonicalString(),e.canonicalString())));for(const t of r){const e=Lt(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),u.push(s.put(a)),u.push(i.put(e,Ft))}return h.forEach((e=>{u.push(this.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.Dn[o]=c.keys()})),ft.waitFor(u).next((()=>c))}))}lookupMutationBatch(t,e){return $s(t).get(e).next((t=>t?(x(t.userId===this.userId),Zi(this.serializer,t)):null))}Cn(t,e){return this.Dn[e]?ft.resolve(this.Dn[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.Dn[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return $s(t).J({index:"userMutationsIndex",range:r},((t,e,r)=>{e.userId===this.userId&&(x(e.batchId>=n),i=Zi(this.serializer,e)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return $s(t).J({index:"userMutationsIndex",range:e,reverse:!0},((t,e,r)=>{n=e.batchId,r.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return $s(t).U("userMutationsIndex",e).next((t=>t.map((t=>Zi(this.serializer,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=Mt(this.userId,e.path),r=IDBKeyRange.lowerBound(n),i=[];return Qs(t).J({range:r},((n,r,s)=>{const[o,c,a]=n,u=Ot(c);if(o===this.userId&&e.path.isEqual(u))return $s(t).get(a).next((t=>{if(!t)throw S();x(t.userId===this.userId),i.push(Zi(this.serializer,t))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new le(z);const r=[];return e.forEach((e=>{const i=Mt(this.userId,e.path),s=IDBKeyRange.lowerBound(i),o=Qs(t).J({range:s},((t,r,i)=>{const[s,o,c]=t,a=Ot(o);s===this.userId&&e.path.isEqual(a)?n=n.add(c):i.done()}));r.push(o)})),ft.waitFor(r).next((()=>this.vn(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1,i=Mt(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new le(z);return Qs(t).J({range:s},((t,e,i)=>{const[s,c,a]=t,u=Ot(c);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(a)):i.done()})).next((()=>this.vn(t,o)))}vn(t,e){const n=[],r=[];return e.forEach((e=>{r.push($s(t).get(e).next((t=>{if(null===t)throw S();x(t.userId===this.userId),n.push(Zi(this.serializer,t))})))})),ft.waitFor(r).next((()=>n))}removeMutationBatch(t,e){return js(t._e,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.Fn(e.batchId)})),ft.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}Fn(t){delete this.Dn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return ft.resolve();const n=IDBKeyRange.lowerBound(function(t){return[t]}(this.userId)),r=[];return Qs(t).J({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=Ot(t[1]);r.push(e)}else n.done()})).next((()=>{x(0===r.length)}))}))}containsKey(t,e){return Gs(t,this.userId,e)}Mn(t){return Ws(t).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Gs(t,e,n){const r=Mt(e,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Qs(t).J({range:s,H:!0},((t,n,r)=>{const[s,c,a]=t;s===e&&c===i&&(o=!0),r.done()})).next((()=>o))}function $s(t){return ie(t,"mutations")}function Qs(t){return ie(t,"documentMutations")}function Ws(t){return ie(t,"mutationQueues")}class Ys{constructor(t){this.xn=t}next(){return this.xn+=2,this.xn}static On(){return new Ys(0)}static Nn(){return new Ys(-1)}}class Hs{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Ln(t).next((e=>{const n=new Ys(e.highestTargetId);return e.highestTargetId=n.next(),this.Bn(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.Ln(t).next((t=>Q.fromTimestamp(new $(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.Ln(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.Ln(t).next((r=>(r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.Bn(t,r))))}addTargetData(t,e){return this.kn(t,e).next((()=>this.Ln(t).next((n=>(n.targetCount+=1,this.qn(e,n),this.Bn(t,n))))))}updateTargetData(t,e){return this.kn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>Js(t).delete(e.targetId))).next((()=>this.Ln(t))).next((e=>(x(e.targetCount>0),e.targetCount-=1,this.Bn(t,e))))}removeTargets(t,e,n){let r=0;const i=[];return Js(t).J(((s,o)=>{const c=ts(o);c.sequenceNumber<=e&&null===n.get(c.targetId)&&(r++,i.push(this.removeTargetData(t,c)))})).next((()=>ft.waitFor(i))).next((()=>r))}forEachTarget(t,e){return Js(t).J(((t,n)=>{const r=ts(n);e(r)}))}Ln(t){return Xs(t).get("targetGlobalKey").next((t=>(x(null!==t),t)))}Bn(t,e){return Xs(t).put("targetGlobalKey",e)}kn(t,e){return Js(t).put(es(this.serializer,e))}qn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Ln(t).next((t=>t.targetCount))}getTargetData(t,e){const n=Tn(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Js(t).J({range:r,index:"queryTargetsIndex"},((t,n,r)=>{const s=ts(n);Sn(e,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(t,e,n){const r=[],i=Zs(t);return e.forEach((e=>{const s=Nt(e.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(t,n,e))})),ft.waitFor(r)}removeMatchingKeys(t,e,n){const r=Zs(t);return ft.forEach(e,(e=>{const i=Nt(e.path);return ft.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=Zs(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Zs(t);let i=sr();return r.J({range:n,H:!0},((t,e,n)=>{const r=Ot(t[1]),s=new X(r);i=i.add(s)})).next((()=>i))}containsKey(t,e){const n=Nt(e.path),r=IDBKeyRange.bound([n],[G(n)],!1,!0);let i=0;return Zs(t).J({index:"documentTargetsIndex",H:!0,range:r},(([t,e],n,r)=>{0!==t&&(i++,r.done())})).next((()=>i>0))}ot(t,e){return Js(t).get(e).next((t=>t?ts(t):null))}}function Js(t){return ie(t,"targets")}function Xs(t){return ie(t,"targetGlobal")}function Zs(t){return ie(t,"targetDocuments")}function to([t,e],[n,r]){const i=z(t,n);return 0===i?z(e,r):i}class eo{constructor(t){this.Qn=t,this.buffer=new le(to),this.Kn=0}$n(){return++this.Kn}Un(t){const e=[t,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();to(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class no{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Wn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return null!==this.Wn}Gn(t){_("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Wn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){vt(t)?_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await lt(t)}await this.Gn(3e5)}))}}class ro{constructor(t,e){this.zn=t,this.params=e}calculateTargetCount(t,e){return this.zn.jn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return ft.resolve(xt.oe);const n=new eo(e);return this.zn.forEachTarget(t,(t=>n.Un(t.sequenceNumber))).next((()=>this.zn.Hn(t,(t=>n.Un(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.zn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.zn.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector","Garbage collection skipped; disabled"),ft.resolve(Bs)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bs):this.Jn(t,e)))}getCacheSize(t){return this.zn.getCacheSize(t)}Jn(t,e){let n,r,i,s,o,a,u;const c=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(u=Date.now(),w()<=h.a.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-c}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(u-a)+"ms\n"+`Total Duration: ${u-c}ms`),ft.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t}))))}}function io(t,e){return new ro(t,e)}class so{constructor(t,e){this.db=t,this.garbageCollector=io(this,e)}jn(t){const e=this.Yn(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Yn(t){let e=0;return this.Hn(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Hn(t,e){return this.Zn(t,((t,n)=>e(n)))}addReference(t,e,n){return oo(t,n)}removeReference(t,e,n){return oo(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return oo(t,e)}Xn(t,e){return function(t,e){let n=!1;return Ws(t).Y((r=>Gs(t,r,e).next((t=>(t&&(n=!0),ft.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Zn(t,((s,o)=>{if(o<=e){const e=this.Xn(t,s).next((e=>{if(!e)return i++,n.getEntry(t,s).next((()=>(n.removeEntry(s,Q.min()),Zs(t).delete(function(t){return[0,Nt(t.path)]}(s)))))}));r.push(e)}})).next((()=>ft.waitFor(r))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return oo(t,e)}Zn(t,e){const n=Zs(t);let r,i=xt.oe;return n.J({index:"documentTargetsIndex"},(([t,n],{path:s,sequenceNumber:o})=>{0===t?(i!==xt.oe&&e(new X(Ot(r)),i),i=o,r=s):i=xt.oe})).next((()=>{i!==xt.oe&&e(new X(Ot(r)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function oo(t,e){return Zs(t).put(function(t,e){return{targetId:0,path:Nt(t.path),sequenceNumber:e}}(e,t.currentSequenceNumber))}class ao{constructor(){this.changes=new Qn((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,He.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?ft.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class uo{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return fo(t).put(n)}removeEntry(t,e,n){return fo(t).delete(function(t,e){const n=t.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Hi(e),n[n.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.er(t,n))))}getEntry(t,e){let n=He.newInvalidDocument(e);return fo(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(go(e))},((t,r)=>{n=this.tr(e,r)})).next((()=>n))}nr(t,e){let n={size:0,document:He.newInvalidDocument(e)};return fo(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(go(e))},((t,r)=>{n={document:this.tr(e,r),size:zs(r)}})).next((()=>n))}getEntries(t,e){let n=Yn();return this.rr(t,e,((t,e)=>{const r=this.tr(t,e);n=n.insert(t,r)})).next((()=>n))}ir(t,e){let n=Yn(),r=new ue(X.comparator);return this.rr(t,e,((t,e)=>{const i=this.tr(t,e);n=n.insert(t,i),r=r.insert(t,zs(e))})).next((()=>({documents:n,sr:r})))}rr(t,e,n){if(e.isEmpty())return ft.resolve();let r=new le(po);e.forEach((t=>r=r.add(t)));const i=IDBKeyRange.bound(go(r.first()),go(r.last())),s=r.getIterator();let o=s.getNext();return fo(t).J({index:"documentKeyIndex",range:i},((t,e,r)=>{const i=X.fromSegments([...e.prefixPath,e.collectionGroup,e.documentId]);for(;o&&po(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,e),o=s.hasNext()?s.getNext():null),o?r.$(go(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(t,e,n,r,i){const s=e.path,o=[s.popLast().toArray(),s.lastSegment(),Hi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return fo(t).U(IDBKeyRange.bound(o,c,!0)).next((t=>{null==i||i.incrementDocumentReadCount(t.length);let n=Yn();for(const i of t){const t=this.tr(X.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);t.isFoundDocument()&&(zn(e,t)||r.has(t.key))&&(n=n.insert(t.key,t))}return n}))}getAllFromCollectionGroup(t,e,n,r){let i=Yn();const s=mo(e,n),o=mo(e,at.max());return fo(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((t,e,n)=>{const s=this.tr(X.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(t){return new ho(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return lo(t).get("remoteDocumentGlobalKey").next((t=>(x(!!t),t)))}er(t,e){return lo(t).put("remoteDocumentGlobalKey",e)}tr(t,e){if(e){const t=function(t,e){let n;if(e.document)n=Ri(t.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const t=X.fromSegments(e.noDocument.path),r=Xi(e.noDocument.readTime);n=He.newNoDocument(t,r),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return S();{const t=X.fromSegments(e.unknownDocument.path),r=Xi(e.unknownDocument.version);n=He.newUnknownDocument(t,r)}}return e.readTime&&n.setReadTime(function(t){const e=new $(t[0],t[1]);return Q.fromTimestamp(e)}(e.readTime)),n}(this.serializer,e);if(!t.isNoDocument()||!t.version.isEqual(Q.min()))return t}return He.newInvalidDocument(t)}}function co(t){return new uo(t)}class ho extends ao{constructor(t,e){super(),this._r=t,this.trackRemovals=e,this.ar=new Qn((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,r=new le(((t,e)=>z(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.ar.get(i);if(e.push(this._r.removeEntry(t,i,o.readTime)),s.isValidDocument()){const c=Yi(this._r.serializer,s);r=r.add(i.path.popLast());const a=zs(c);n+=a-o.size,e.push(this._r.addEntry(t,i,c))}else if(n-=o.size,this.trackRemovals){const n=Yi(this._r.serializer,s.convertToNoDocument(Q.min()));e.push(this._r.addEntry(t,i,n))}})),r.forEach((n=>{e.push(this._r.indexManager.addToCollectionParentIndex(t,n))})),e.push(this._r.updateMetadata(t,n)),ft.waitFor(e)}getFromCache(t,e){return this._r.nr(t,e).next((t=>(this.ar.set(e,{size:t.size,readTime:t.document.readTime}),t.document)))}getAllFromCache(t,e){return this._r.ir(t,e).next((({documents:t,sr:e})=>(e.forEach(((e,n)=>{this.ar.set(e,{size:n,readTime:t.get(e).readTime})})),t)))}}function lo(t){return ie(t,"remoteDocumentGlobal")}function fo(t){return ie(t,"remoteDocumentsV14")}function go(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function mo(t,e){const n=e.documentKey.path.toArray();return[t,Hi(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function po(t,e){const n=t.path.toArray(),r=e.path.toArray();let i=0;for(let t=0;t<n.length-2&&t<r.length-2;++t)if(i=z(n[t],r[t]),i)return i;return i=z(n.length,r.length),i||(i=z(n[n.length-2],r[r.length-2]),i||z(n[n.length-1],r[r.length-1]))}class yo{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class wo{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Rr(n.mutation,t,ge.empty(),$.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,sr()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=sr()){const r=Zn();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=Jn();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Zn();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,sr())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=Yn();const s=nr(),o=nr();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Lr)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Rr(o.mutation,e,o.mutation.getFieldMask(),$.now())):s.set(e.key,ge.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new yo(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=nr();let r=new ue(((t,e)=>t-e)),i=sr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||ge.empty();o=i.applyToLocalView(s,o),n.set(t,o);const c=(r.get(i.batchId)||sr()).add(t);r=r.insert(i.batchId,c)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),c=r.key,a=r.value,u=er();a.forEach((t=>{if(!i.has(t)){const r=Nr(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,c,u))}return ft.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return X.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Pn(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):ft.resolve(Zn());let o=-1,c=i;return s.next((e=>ft.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?ft.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{c=c.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,c,e,sr()))).next((t=>({batchId:o,changes:Xn(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new X(e)).next((t=>{let e=Jn();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=Jn();return this.indexManager.getCollectionParents(t,i).next((o=>ft.forEach(o,(o=>{const c=function(t,e){return new Nn(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,c,n,r).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r)))).next((t=>{i.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,He.newInvalidDocument(r)))}));let n=Jn();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&Rr(s.mutation,r,ge.empty(),$.now()),zn(e,r)&&(n=n.insert(t,r))})),n}))}}class vo{constructor(t){this.serializer=t,this.ur=new Map,this.cr=new Map}getBundleMetadata(t,e){return ft.resolve(this.ur.get(e))}saveBundleMetadata(t,e){return this.ur.set(e.id,function(t){return{id:t.id,version:t.version,createTime:_i(t.createTime)}}(e)),ft.resolve()}getNamedQuery(t,e){return ft.resolve(this.cr.get(e))}saveNamedQuery(t,e){return this.cr.set(e.name,function(t){return{name:t.name,query:ns(t.bundledQuery),readTime:_i(t.readTime)}}(e)),ft.resolve()}}class bo{constructor(){this.overlays=new ue(X.comparator),this.lr=new Map}getOverlay(t,e){return ft.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Zn();return ft.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.lt(t,e,r)})),ft.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.lr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.lr.delete(n)),ft.resolve()}getOverlaysForCollection(t,e,n){const r=Zn(),i=e.length+1,s=new X(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return ft.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new ue(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Zn(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Zn(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return ft.resolve(o)}lt(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.lr.get(r.largestBatchId).delete(n.key);this.lr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Kr(e,n));let i=this.lr.get(e);void 0===i&&(i=sr(),this.lr.set(e,i)),this.lr.set(e,i.add(n.key))}}class _o{constructor(){this.hr=new le(Io.Pr),this.Ir=new le(Io.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(t,e){const n=new Io(t,e);this.hr=this.hr.add(n),this.Ir=this.Ir.add(n)}Er(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.dr(new Io(t,e))}Ar(t,e){t.forEach((t=>this.removeReference(t,e)))}Rr(t){const e=new X(new Y([])),n=new Io(e,t),r=new Io(e,t+1),i=[];return this.Ir.forEachInRange([n,r],(t=>{this.dr(t),i.push(t.key)})),i}Vr(){this.hr.forEach((t=>this.dr(t)))}dr(t){this.hr=this.hr.delete(t),this.Ir=this.Ir.delete(t)}mr(t){const e=new X(new Y([])),n=new Io(e,t),r=new Io(e,t+1);let i=sr();return this.Ir.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new Io(t,0),n=this.hr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Io{constructor(t,e){this.key=t,this.gr=e}static Pr(t,e){return X.comparator(t.key,e.key)||z(t.gr,e.gr)}static Tr(t,e){return z(t.gr,e.gr)||X.comparator(t.key,e.key)}}class Eo{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.pr=1,this.yr=new le(Io.Pr)}checkEmpty(t){return ft.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new jr(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.yr=this.yr.add(new Io(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return ft.resolve(s)}lookupMutationBatch(t,e){return ft.resolve(this.wr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.Sr(n),i=r<0?0:r;return ft.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ft.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(t){return ft.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Io(e,0),r=new Io(e,Number.POSITIVE_INFINITY),i=[];return this.yr.forEachInRange([n,r],(t=>{const e=this.wr(t.gr);i.push(e)})),ft.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new le(z);return e.forEach((t=>{const e=new Io(t,0),r=new Io(t,Number.POSITIVE_INFINITY);this.yr.forEachInRange([e,r],(t=>{n=n.add(t.gr)}))})),ft.resolve(this.br(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;X.isDocumentKey(i)||(i=i.child(""));const s=new Io(new X(i),0);let o=new le(z);return this.yr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.gr)),!0)}),s),ft.resolve(this.br(o))}br(t){const e=[];return t.forEach((t=>{const n=this.wr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){x(0===this.Dr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.yr;return ft.forEach(e.mutations,(r=>{const i=new Io(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.yr=n}))}Fn(t){}containsKey(t,e){const n=new Io(e,0),r=this.yr.firstAfterOrEqual(n);return ft.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,ft.resolve()}Dr(t,e){return this.Sr(t)}Sr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}wr(t){const e=this.Sr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class To{constructor(t){this.Cr=t,this.docs=new ue(X.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.Cr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return ft.resolve(n?n.document.mutableCopy():He.newInvalidDocument(e))}getEntries(t,e){let n=Yn();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():He.newInvalidDocument(t))})),ft.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=Yn();const s=e.path,o=new X(s.child("")),c=this.docs.getIteratorFrom(o);for(;c.hasNext();){const{key:t,value:{document:o}}=c.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||ut(ot(o),n)<=0||(r.has(o.key)||zn(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ft.resolve(i)}getAllFromCollectionGroup(t,e,n,r){S()}vr(t,e){return ft.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new So(this)}getSize(t){return ft.resolve(this.size)}}class So extends ao{constructor(t){super(),this._r=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this._r.addEntry(t,r)):this._r.removeEntry(n)})),ft.waitFor(e)}getFromCache(t,e){return this._r.getEntry(t,e)}getAllFromCache(t,e){return this._r.getEntries(t,e)}}class xo{constructor(t){this.persistence=t,this.Fr=new Qn((t=>Tn(t)),Sn),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.Mr=0,this.Or=new _o,this.targetCount=0,this.Nr=Ys.On()}forEachTarget(t,e){return this.Fr.forEach(((t,n)=>e(n))),ft.resolve()}getLastRemoteSnapshotVersion(t){return ft.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return ft.resolve(this.Mr)}allocateTargetId(t){return this.highestTargetId=this.Nr.next(),ft.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Mr&&(this.Mr=e),ft.resolve()}kn(t){this.Fr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Nr=new Ys(e),this.highestTargetId=e),t.sequenceNumber>this.Mr&&(this.Mr=t.sequenceNumber)}addTargetData(t,e){return this.kn(e),this.targetCount+=1,ft.resolve()}updateTargetData(t,e){return this.kn(e),ft.resolve()}removeTargetData(t,e){return this.Fr.delete(e.target),this.Or.Rr(e.targetId),this.targetCount-=1,ft.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.Fr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Fr.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),ft.waitFor(i).next((()=>r))}getTargetCount(t){return ft.resolve(this.targetCount)}getTargetData(t,e){const n=this.Fr.get(e)||null;return ft.resolve(n)}addMatchingKeys(t,e,n){return this.Or.Er(e,n),ft.resolve()}removeMatchingKeys(t,e,n){this.Or.Ar(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),ft.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Or.Rr(e),ft.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Or.mr(e);return ft.resolve(n)}containsKey(t,e){return ft.resolve(this.Or.containsKey(e))}}class Do{constructor(t,e){this.Lr={},this.overlays={},this.Br=new xt(0),this.kr=!1,this.kr=!0,this.referenceDelegate=t(this),this.qr=new xo(this),this.indexManager=new ks,this.remoteDocumentCache=function(t){return new To(t)}((t=>this.referenceDelegate.Qr(t))),this.serializer=new Wi(e),this.Kr=new vo(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new bo,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Lr[t.toKey()];return n||(n=new Eo(e,this.referenceDelegate),this.Lr[t.toKey()]=n),n}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(t,e,n){_("MemoryPersistence","Starting transaction:",t);const r=new Ao(this.Br.next());return this.referenceDelegate.$r(),n(r).next((t=>this.referenceDelegate.Ur(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Wr(t,e){return ft.or(Object.values(this.Lr).map((n=>()=>n.containsKey(t,e))))}}class Ao extends ht{constructor(t){super(),this.currentSequenceNumber=t}}class Co{constructor(t){this.persistence=t,this.Gr=new _o,this.zr=null}static jr(t){return new Co(t)}get Hr(){if(this.zr)return this.zr;throw S()}addReference(t,e,n){return this.Gr.addReference(n,e),this.Hr.delete(n.toString()),ft.resolve()}removeReference(t,e,n){return this.Gr.removeReference(n,e),this.Hr.add(n.toString()),ft.resolve()}markPotentiallyOrphaned(t,e){return this.Hr.add(e.toString()),ft.resolve()}removeTarget(t,e){this.Gr.Rr(e.targetId).forEach((t=>this.Hr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Hr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}$r(){this.zr=new Set}Ur(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ft.forEach(this.Hr,(n=>{const r=X.fromPath(n);return this.Jr(t,r).next((t=>{t||e.removeEntry(r,Q.min())}))})).next((()=>(this.zr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Jr(t,e).next((t=>{t?this.Hr.delete(e.toString()):this.Hr.add(e.toString())}))}Qr(t){return 0}Jr(t,e){return ft.or([()=>ft.resolve(this.Gr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Wr(t,e)])}}class No{constructor(t){this.serializer=t}O(t,e,n,r){const i=new gt("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore("owner")}(t),function(t){t.createObjectStore("mutationQueues",{keyPath:"userId"}),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Pt,{unique:!0}),t.createObjectStore("documentMutations")}(t),ko(t),function(t){t.createObjectStore("remoteDocuments")}(t));let s=ft.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore("targetDocuments"),t.deleteObjectStore("targets"),t.deleteObjectStore("targetGlobal")}(t),ko(t)),s=s.next((()=>function(t){const e=t.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Q.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(t,e){return e.store("mutations").U().next((n=>{t.deleteObjectStore("mutations"),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Pt,{unique:!0});const r=e.store("mutations"),i=n.map((t=>r.put(t)));return ft.waitFor(i)}))}(t,i)))),s=s.next((()=>{!function(t){t.createObjectStore("clientMetadata",{keyPath:"clientId"})}(t)}))),n<5&&r>=5&&(s=s.next((()=>this.Zr(i)))),n<6&&r>=6&&(s=s.next((()=>(function(t){t.createObjectStore("remoteDocumentGlobal")}(t),this.Xr(i))))),n<7&&r>=7&&(s=s.next((()=>this.ei(i)))),n<8&&r>=8&&(s=s.next((()=>this.ti(t,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t)}))),n<10&&r>=10&&(s=s.next((()=>this.ni(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(t){t.createObjectStore("bundles",{keyPath:"bundleId"})}(t),function(t){t.createObjectStore("namedQueries",{keyPath:"name"})}(t)}))),n<12&&r>=12&&(s=s.next((()=>{!function(t){const e=t.createObjectStore("documentOverlays",{keyPath:Wt});e.createIndex("collectionPathOverlayIndex",Yt,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",Ht,{unique:!1})}(t)}))),n<13&&r>=13&&(s=s.next((()=>function(t){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:Vt});e.createIndex("documentKeyIndex",Ut),e.createIndex("collectionGroupIndex",Bt)}(t))).next((()=>this.ri(t,i))).next((()=>t.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.ii(t,i)))),n<15&&r>=15&&(s=s.next((()=>function(t){t.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),t.createObjectStore("indexState",{keyPath:Kt}).createIndex("sequenceNumberIndex",Gt,{unique:!1}),t.createObjectStore("indexEntries",{keyPath:$t}).createIndex("documentKeyIndex",Qt,{unique:!1})}(t)))),n<16&&r>=16&&(s=s.next((()=>{e.objectStore("indexState").clear()})).next((()=>{e.objectStore("indexEntries").clear()}))),s}Xr(t){let e=0;return t.store("remoteDocuments").J(((t,n)=>{e+=zs(n)})).next((()=>{const n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Zr(t){const e=t.store("mutationQueues"),n=t.store("mutations");return e.U().next((e=>ft.forEach(e,(e=>{const r=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",r).next((n=>ft.forEach(n,(n=>{x(n.userId===e.userId);const r=Zi(this.serializer,n);return js(t,e.userId,r).next((()=>{}))}))))}))))}ei(t){const e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next((t=>{const r=[];return n.J(((n,i)=>{const s=new Y(n),o=function(t){return[0,Nt(t)]}(s);r.push(e.get(o).next((n=>n?ft.resolve():(n=>e.put({targetId:0,path:Nt(n),sequenceNumber:t.highestListenSequenceNumber}))(s))))})).next((()=>ft.waitFor(r)))}))}ti(t,e){t.createObjectStore("collectionParents",{keyPath:zt});const n=e.store("collectionParents"),r=new Rs,o=t=>{if(r.add(t)){const e=t.lastSegment(),r=t.popLast();return n.put({collectionId:e,parent:Nt(r)})}};return e.store("remoteDocuments").J({H:!0},((t,e)=>{const n=new Y(t);return o(n.popLast())})).next((()=>e.store("documentMutations").J({H:!0},(([t,e,n],r)=>{const i=Ot(e);return o(i.popLast())}))))}ni(t){const e=t.store("targets");return e.J(((t,n)=>{const r=ts(n),i=es(this.serializer,r);return e.put(i)}))}ri(t,e){const n=e.store("remoteDocuments"),r=[];return n.J(((t,n)=>{const i=e.store("remoteDocumentsV14"),s=function(t){return t.document?new X(Y.fromString(t.document.name).popFirst(5)):t.noDocument?X.fromSegments(t.noDocument.path):t.unknownDocument?X.fromSegments(t.unknownDocument.path):S()}(n).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))})).next((()=>ft.waitFor(r)))}ii(t,e){const n=e.store("mutations"),r=co(this.serializer),i=new Do(Co.jr,this.serializer.ut);return n.U().next((t=>{const n=new Map;return t.forEach((t=>{var e;let r=null!==(e=n.get(t.userId))&&void 0!==e?e:sr();Zi(this.serializer,t).keys().forEach((t=>r=r.add(t))),n.set(t.userId,r)})),ft.forEach(n,((t,n)=>{const s=new m(n),o=cs.ct(this.serializer,s),c=i.getIndexManager(s),a=Ks.ct(s,this.serializer,c,i.referenceDelegate);return new wo(r,a,o,c).recalculateAndSaveOverlaysForDocumentKeys(new re(e,xt.oe),t).next()}))}))}}function ko(t){t.createObjectStore("targetDocuments",{keyPath:q}).createIndex("documentTargetsIndex",jt,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",qt,{unique:!0}),t.createObjectStore("targetGlobal")}const Ro="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Oo{constructor(t,e,n,r,i,s,o,c,a,u,h=16){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.si=i,this.window=s,this.document=o,this.oi=a,this._i=u,this.ai=h,this.Br=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=t=>Promise.resolve(),!Oo.D())throw new N(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new so(this,r),this.Ii=e+"main",this.serializer=new Wi(c),this.Ti=new mt(this.Ii,this.ai,new No(this.serializer)),this.qr=new Hs(this.referenceDelegate,this.serializer),this.remoteDocumentCache=co(this.serializer),this.Kr=new os,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,!1===u&&I("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(C.FAILED_PRECONDITION,Ro);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.qr.getHighestSequenceNumber(t)))})).then((t=>{this.Br=new xt(t,this.oi)})).then((()=>{this.kr=!0})).catch((t=>(this.Ti&&this.Ti.close(),Promise.reject(t))))}mi(t){return this.Pi=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ti.L((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.si.enqueueAndForget((async()=>{this.started&&await this.di()})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>Mo(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.fi(t).next((t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable((()=>this.Pi(!1))))}))})).next((()=>this.gi(t))).next((e=>this.isPrimary&&!e?this.pi(t).next((()=>!1)):!!e&&this.yi(t).next((()=>!0)))))).catch((t=>{if(vt(t))return _("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.si.enqueueRetryable((()=>this.Pi(t))),this.isPrimary=t}))}fi(t){return Po(t).get("owner").next((t=>ft.resolve(this.wi(t))))}Si(t){return Mo(t).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Di(this.hi,18e5)){this.hi=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=ie(t,"clientMetadata");return e.U().next((t=>{const n=this.Ci(t,18e5),r=t.filter((t=>-1===n.indexOf(t)));return ft.forEach(r,(t=>e.delete(t.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.Ei)for(const e of t)this.Ei.removeItem(this.vi(e.clientId))}}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.di().then((()=>this.bi())).then((()=>this.Vi()))))}wi(t){return!!t&&t.ownerId===this.clientId}gi(t){return this._i?ft.resolve(!0):Po(t).get("owner").next((e=>{if(null!==e&&this.Di(e.leaseTimestampMs,5e3)&&!this.Fi(e.ownerId)){if(this.wi(e)&&this.networkEnabled)return!0;if(!this.wi(e)){if(!e.allowTabSynchronization)throw new N(C.FAILED_PRECONDITION,Ro);return!1}}return!(!this.networkEnabled||!this.inForeground)||Mo(t).U().next((t=>void 0===this.Ci(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,r=this.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&_("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.kr=!1,this.Mi(),this.li&&(this.li.cancel(),this.li=null),this.xi(),this.Oi(),await this.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(t=>{const e=new re(t,xt.oe);return this.pi(e).next((()=>this.Si(e)))})),this.Ti.close(),this.Ni()}Ci(t,e){return t.filter((t=>this.Di(t.updateTimeMs,e)&&!this.Fi(t.clientId)))}Li(){return this.runTransaction("getActiveClients","readonly",(t=>Mo(t).U().next((t=>this.Ci(t,18e5).map((t=>t.clientId))))))}get started(){return this.kr}getMutationQueue(t,e){return Ks.ct(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Ps(t,this.serializer.ut.databaseId)}getDocumentOverlayCache(t){return cs.ct(this.serializer,t)}getBundleCache(){return this.Kr}runTransaction(t,e,n){_("IndexedDbPersistence","Starting transaction:",t);const r="readonly"===e?"readonly":"readwrite",i=function(t){return 16===t?ne:15===t?ee:14===t?te:13===t?Zt:12===t?Xt:11===t?Jt:void S()}(this.ai);let s;return this.Ti.runTransaction(t,r,i,(r=>(s=new re(r,this.Br?this.Br.next():xt.oe),"readwrite-primary"===e?this.fi(s).next((t=>!!t||this.gi(s))).next((e=>{if(!e)throw I(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.si.enqueueRetryable((()=>this.Pi(!1))),new N(C.FAILED_PRECONDITION,ct);return n(s)})).next((t=>this.yi(s).next((()=>t)))):this.Bi(s).next((()=>n(s)))))).then((t=>(s.raiseOnCommittedEvent(),t)))}Bi(t){return Po(t).get("owner").next((t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new N(C.FAILED_PRECONDITION,Ro)}))}yi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Po(t).put("owner",e)}static D(){return mt.D()}pi(t){const e=Po(t);return e.get("owner").next((t=>this.wi(t)?(_("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):ft.resolve()))}Di(t,e){const n=Date.now();return!(t<n-e||t>n&&(I(`Detected an update time that is in the future: ${t} > ${n}`),1))}Ai(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.di())))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;Object(l.z)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(t){var e;try{const n=null!==(null===(e=this.Ei)||void 0===e?void 0:e.getItem(this.vi(t)));return _("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return I("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(t){I("Failed to set zombie client id.",t)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch(t){}}vi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Po(t){return ie(t,"owner")}function Mo(t){return ie(t,"clientMetadata")}function Lo(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class Fo{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.ki=n,this.qi=r}static Qi(t,e){let n=sr(),r=sr();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Fo(t,e.fromCache,n,r)}}class Vo{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Uo{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=Object(l.z)()?8:pt(Object(l.q)())>0?6:4}initialize(t,e){this.Gi=t,this.indexManager=e,this.Ki=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.zi(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.ji(t,e,r,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new Vo;return this.Hi(t,e,n).next((r=>{if(i.result=r,this.$i)return this.Ji(t,e,n,r.size)}))})).next((()=>i.result))}Ji(t,e,n,r){return n.documentReadCount<this.Ui?(w()<=h.a.DEBUG&&_("QueryEngine","SDK will not create cache indexes for query:",jn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),ft.resolve()):(w()<=h.a.DEBUG&&_("QueryEngine","Query:",jn(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Wi*r?(w()<=h.a.DEBUG&&_("QueryEngine","The SDK decides to create cache indexes for query:",jn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ln(e))):ft.resolve())}zi(t,e){if(On(e))return ft.resolve(null);let n=Ln(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Un(e,null,"F"),n=Ln(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=sr(...r);return this.Gi.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Yi(e,r);return this.Zi(e,s,i,n.readTime)?this.zi(t,Un(e,null,"F")):this.Xi(t,s,e,n)}))))})))))}ji(t,e,n,r){return On(e)||r.isEqual(Q.min())?ft.resolve(null):this.Gi.getDocuments(t,n).next((i=>{const s=this.Yi(e,i);return this.Zi(e,s,n,r)?ft.resolve(null):(w()<=h.a.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),jn(e)),this.Xi(t,s,e,st(r,-1)).next((t=>t)))}))}Yi(t,e){let n=new le(Gn(t));return e.forEach(((e,r)=>{zn(t,r)&&(n=n.add(r))})),n}Zi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Hi(t,e,n){return w()<=h.a.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",jn(e)),this.Gi.getDocumentsMatchingQuery(t,e,at.min(),n)}Xi(t,e,n,r){return this.Gi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Bo{constructor(t,e,n,r){this.persistence=t,this.es=e,this.serializer=r,this.ts=new ue(z),this.ns=new Qn((t=>Tn(t)),Sn),this.rs=new Map,this.ss=t.getRemoteDocumentCache(),this.qr=t.getTargetCache(),this.Kr=t.getBundleCache(),this.os(n)}os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new wo(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ts)))}}function qo(t,e,n,r){return new Bo(t,e,n,r)}async function jo(t,e){const n=A(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n.os(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=sr();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({_s:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function zo(t){const e=A(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.qr.getLastRemoteSnapshotVersion(t)))}function Ko(t,e,n){let r=sr(),i=sr();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Yn();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Q.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):_("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{us:r,cs:i}}))}function Go(t,e){const n=A(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function $o(t,e){const n=A(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.qr.getTargetData(t,e).next((i=>i?(r=i,ft.resolve(r)):n.qr.allocateTargetId(t).next((i=>(r=new Qi(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ts.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ts=n.ts.insert(t.targetId,t),n.ns.set(e,t.targetId)),t}))}async function Qo(t,e,n){const r=A(t),i=r.ts.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!vt(t))throw t;_("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}function Wo(t,e,n){const r=A(t);let i=Q.min(),s=sr();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=A(t),i=r.ns.get(n);return void 0!==i?ft.resolve(r.ts.get(i)):r.qr.getTargetData(e,n)}(r,t,Ln(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.es.getDocumentsMatchingQuery(t,e,n?i:Q.min(),n?s:sr()))).next((t=>(Jo(r,Kn(e),t),{documents:t,ls:s})))))}function Yo(t,e){const n=A(t),r=A(n.qr),i=n.ts.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(t=>r.ot(t,e).next((t=>t?t.target:null))))}function Ho(t,e){const n=A(t),r=n.rs.get(e)||Q.min();return n.persistence.runTransaction("Get new document changes","readonly",(t=>n.ss.getAllFromCollectionGroup(t,e,st(r,-1),Number.MAX_SAFE_INTEGER))).then((t=>(Jo(n,e,t),t)))}function Jo(t,e,n){let r=t.rs.get(e)||Q.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.rs.set(e,r)}async function Xo(t,e,n=sr()){const r=await $o(t,Ln(ns(e.bundledQuery))),i=A(t);return i.persistence.runTransaction("Save named query","readwrite",(t=>{const s=_i(e.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.Kr.saveNamedQuery(t,e);const o=r.withResumeToken(ye.EMPTY_BYTE_STRING,s);return i.ts=i.ts.insert(o.targetId,o),i.qr.updateTargetData(t,o).next((()=>i.qr.removeMatchingKeysForTargetId(t,r.targetId))).next((()=>i.qr.addMatchingKeys(t,n,r.targetId))).next((()=>i.Kr.saveNamedQuery(t,e)))}))}function Zo(t,e){return`firestore_clients_${t}_${e}`}function ta(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function ea(t,e){return`firestore_targets_${t}_${e}`}class na{constructor(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}static Ts(t,e,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new N(r.error.code,r.error.message))),s?new na(t,e,r.state,i):(I("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Es(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class ra{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ts(t,e){const n=JSON.parse(e);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new N(n.error.code,n.error.message))),i?new ra(t,n.state,r):(I("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Es(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class ia{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ts(t,e){const n=JSON.parse(e);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ar();for(let t=0;r&&t<n.activeTargetIds.length;++t)r=Ct(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return r?new ia(t,i):(I("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class sa{constructor(t,e){this.clientId=t,this.onlineState=e}static Ts(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new sa(e.clientId,e.onlineState):(I("SharedClientState",`Failed to parse online state: ${t}`),null)}}class oa{constructor(){this.activeTargetIds=ar()}ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}As(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Es(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class aa{constructor(t,e,n,r,i){this.window=t,this.si=e,this.persistenceKey=n,this.Rs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new ue(z),this.started=!1,this.ps=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ys=Zo(this.persistenceKey,this.Rs),this.ws=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.gs=this.gs.insert(this.Rs,new oa),this.Ss=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Cs=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.vs=function(t){return`firestore_bundle_loaded_v2_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.Li();for(const e of t){if(e===this.Rs)continue;const t=this.getItem(Zo(this.persistenceKey,e));if(t){const n=ia.Ts(e,t);n&&(this.gs=this.gs.insert(n.clientId,n))}}this.Fs();const e=this.storage.getItem(this.Cs);if(e){const t=this.Ms(e);t&&this.xs(t)}for(const t of this.ps)this.fs(t);this.ps=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.ws,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(t){let e=!1;return this.gs.forEach(((n,r)=>{r.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.Ns(t,"pending")}updateMutationState(t,e,n){this.Ns(t,e,n),this.Ls(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(ea(this.persistenceKey,t));if(n){const r=ra.Ts(t,n);r&&(e=r.state)}}return this.Bs.ds(t),this.Fs(),e}removeLocalQueryTarget(t){this.Bs.As(t),this.Fs()}isLocalQueryTarget(t){return this.Bs.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(ea(this.persistenceKey,t))}updateQueryState(t,e,n){this.ks(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.Ls(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.qs(t)}notifyBundleLoaded(t){this.Qs(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return _("SharedClientState","READ",t,e),e}setItem(t,e){_("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){_("SharedClientState","REMOVE",t),this.storage.removeItem(t)}fs(t){const e=t;if(e.storageArea===this.storage){if(_("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ys)return void I("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.Ss.test(e.key)){if(null==e.newValue){const t=this.Ks(e.key);return this.$s(t,null)}{const t=this.Us(e.key,e.newValue);if(t)return this.$s(t.clientId,t)}}else if(this.bs.test(e.key)){if(null!==e.newValue){const t=this.Ws(e.key,e.newValue);if(t)return this.Gs(t)}}else if(this.Ds.test(e.key)){if(null!==e.newValue){const t=this.zs(e.key,e.newValue);if(t)return this.js(t)}}else if(e.key===this.Cs){if(null!==e.newValue){const t=this.Ms(e.newValue);if(t)return this.xs(t)}}else if(e.key===this.ws){const t=function(t){let e=xt.oe;if(null!=t)try{const n=JSON.parse(t);x("number"==typeof n),e=n}catch(t){I("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==xt.oe&&this.sequenceNumberHandler(t)}else if(e.key===this.vs){const t=this.Hs(e.newValue);await Promise.all(t.map((t=>this.syncEngine.Js(t))))}}else this.ps.push(e)}))}}get Bs(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Bs.Es())}Ns(t,e,n){const r=new na(this.currentUser,t,e,n),i=ta(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Es())}Ls(t){const e=ta(this.persistenceKey,this.currentUser,t);this.removeItem(e)}qs(t){const e={clientId:this.Rs,onlineState:t};this.storage.setItem(this.Cs,JSON.stringify(e))}ks(t,e,n){const r=ea(this.persistenceKey,t),i=new ra(t,e,n);this.setItem(r,i.Es())}Qs(t){const e=JSON.stringify(Array.from(t));this.setItem(this.vs,e)}Ks(t){const e=this.Ss.exec(t);return e?e[1]:null}Us(t,e){const n=this.Ks(t);return ia.Ts(n,e)}Ws(t,e){const n=this.bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return na.Ts(new m(i),r,e)}zs(t,e){const n=this.Ds.exec(t),r=Number(n[1]);return ra.Ts(r,e)}Ms(t){return sa.Ts(t)}Hs(t){return JSON.parse(t)}async Gs(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Ys(t.batchId,t.state,t.error);_("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}js(t){return this.syncEngine.Zs(t.targetId,t.state,t.error)}$s(t,e){const n=e?this.gs.insert(t,e):this.gs.remove(t),r=this.Os(this.gs),i=this.Os(n),s=[],o=[];return i.forEach((t=>{r.has(t)||s.push(t)})),r.forEach((t=>{i.has(t)||o.push(t)})),this.syncEngine.Xs(s,o).then((()=>{this.gs=n}))}xs(t){this.gs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Os(t){let e=ar();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class ua{constructor(){this.eo=new oa,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.eo.ds(t),this.no[t]||"not-current"}updateQueryState(t,e,n){this.no[t]=e}removeLocalQueryTarget(t){this.eo.As(t)}isLocalQueryTarget(t){return this.eo.activeTargetIds.has(t)}clearQueryState(t){delete this.no[t]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(t){return this.eo.activeTargetIds.has(t)}start(){return this.eo=new oa,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class ca{ro(t){}shutdown(){}}class ha{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(t){this.ao.push(t)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ao)t(0)}_o(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ao)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let la=null;function da(){return null===la?la=268435456+Math.round(2147483648*Math.random()):la++,"0x"+la.toString(16)}const fa={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ga{constructor(t){this.co=t.co,this.lo=t.lo}ho(t){this.Po=t}Io(t){this.To=t}Eo(t){this.Ao=t}onMessage(t){this.Ro=t}close(){this.lo()}send(t){this.co(t)}Vo(){this.Po()}mo(){this.To()}fo(t){this.Ao(t)}po(t){this.Ro(t)}}const ma="WebChannelConnection";class pa extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.yo=e+"://"+t.host,this.wo=`projects/${n}/databases/${r}`,this.So="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get bo(){return!1}Do(t,e,n,r,i){const s=da(),o=this.Co(t,e.toUriEncodedString());_("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const c={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(c,r,i),this.Fo(t,o,c,n).then((e=>(_("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw E("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}Mo(t,e,n,r,i,s){return this.Do(t,e,n,r,i)}vo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+b,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}Co(t,e){const n=fa[t];return`${this.yo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Fo(t,e,n,r){const i=da();return new Promise(((s,o)=>{const c=new d.i;c.setWithCredentials(!0),c.listenOnce(d.c.COMPLETE,(()=>{try{switch(c.getLastErrorCode()){case d.a.NO_ERROR:const e=c.getResponseJson();_(ma,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),s(e);break;case d.a.TIMEOUT:_(ma,`RPC '${t}' ${i} timed out`),o(new N(C.DEADLINE_EXCEEDED,"Request time out"));break;case d.a.HTTP_ERROR:const n=c.getStatus();if(_(ma,`RPC '${t}' ${i} failed with status:`,n,"response text:",c.getResponseText()),n>0){let t=c.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(e)>=0?e:C.UNKNOWN}(e.status);o(new N(t,e.message))}else o(new N(C.UNKNOWN,"Server responded with status "+c.getStatus()))}else o(new N(C.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{_(ma,`RPC '${t}' ${i} completed.`)}}));const a=JSON.stringify(r);_(ma,`RPC '${t}' ${i} sending request:`,r),c.send(e,"POST",a,n,15)}))}xo(t,e,n){const r=da(),i=[this.yo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Object(d.j)(),o=Object(d.k)(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},a=this.longPollingOptions.timeoutSeconds;void 0!==a&&(c.longPollingTimeout=Math.round(1e3*a)),this.useFetchStreams&&(c.xmlHttpFactory=new d.d({})),this.vo(c.initMessageHeaders,e,n),c.encodeInitMessageHeaders=!0;const u=i.join("");_(ma,`Creating RPC '${t}' stream ${r}: ${u}`,c);const h=s.createWebChannel(u,c);let l=!1,f=!1;const m=new ga({co:e=>{f?_(ma,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(_(ma,`Opening RPC '${t}' stream ${r} transport.`),h.open(),l=!0),_(ma,`RPC '${t}' stream ${r} sending:`,e),h.send(e))},lo:()=>h.close()}),y=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return y(h,d.h.EventType.OPEN,(()=>{f||(_(ma,`RPC '${t}' stream ${r} transport opened.`),m.Vo())})),y(h,d.h.EventType.CLOSE,(()=>{f||(f=!0,_(ma,`RPC '${t}' stream ${r} transport closed`),m.fo())})),y(h,d.h.EventType.ERROR,(e=>{f||(f=!0,E(ma,`RPC '${t}' stream ${r} transport errored:`,e),m.fo(new N(C.UNAVAILABLE,"The operation could not be completed")))})),y(h,d.h.EventType.MESSAGE,(e=>{var n;if(!f){const i=e.data[0];x(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){_(ma,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=$r[t];if(void 0!==e)return Yr(e)}(e),i=o.message;void 0===n&&(n=C.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),f=!0,m.fo(new N(n,i)),h.close()}else _(ma,`RPC '${t}' stream ${r} received:`,i),m.po(i)}})),y(o,d.b.STAT_EVENT,(e=>{e.stat===d.g.PROXY?_(ma,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===d.g.NOPROXY&&_(ma,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{m.mo()}),0),m}}function ya(){return"undefined"!=typeof window?window:null}function wa(){return"undefined"!=typeof document?document:null}function va(t){return new pi(t,!0)}class ba{constructor(t,e,n=1e3,r=1.5,i=6e4){this.si=t,this.timerId=e,this.Oo=n,this.No=r,this.Lo=i,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(t){this.cancel();const e=Math.floor(this.Bo+this.$o()),n=Math.max(0,Date.now()-this.qo),r=Math.max(0,e-n);r>0&&_("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Bo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,r,(()=>(this.qo=Date.now(),t()))),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){null!==this.ko&&(this.ko.skipDelay(),this.ko=null)}cancel(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}}class _a{constructor(t,e,n,r,i,s,o,c){this.si=t,this.Wo=n,this.Go=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=c,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new ba(t,e)}Yo(){return 1===this.state||5===this.state||this.Zo()}Zo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Xo()}async stop(){this.Yo()&&await this.close(0)}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&null===this.jo&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,(()=>this.n_())))}r_(t){this.i_(),this.stream.send(t)}async n_(){if(this.Zo())return this.close(0)}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}async close(t,e){this.i_(),this.s_(),this.Jo.cancel(),this.zo++,4!==t?this.Jo.reset():e&&e.code===C.RESOURCE_EXHAUSTED?(I(e.toString()),I("Using maximum backoff delay to prevent overloading the backend."),this.Jo.Qo()):e&&e.code===C.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.o_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Eo(e)}o_(){}auth(){this.state=1;const t=this.__(this.zo),e=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.zo===e&&this.a_(t,n)}),(e=>{t((()=>{const t=new N(C.UNKNOWN,"Fetching auth token failed: "+e.message);return this.u_(t)}))}))}a_(t,e){const n=this.__(this.zo);this.stream=this.c_(t,e),this.stream.ho((()=>{n((()=>this.listener.ho()))})),this.stream.Io((()=>{n((()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,(()=>(this.Zo()&&(this.state=3),Promise.resolve()))),this.listener.Io())))})),this.stream.Eo((t=>{n((()=>this.u_(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Xo(){this.state=5,this.Jo.Ko((async()=>{this.state=0,this.start()}))}u_(t){return _("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}__(t){return e=>{this.si.enqueueAndForget((()=>this.zo===t?e():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ia extends _a{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}c_(t,e){return this.connection.xo("Listen",t,e)}onMessage(t){this.Jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const o=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:S()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(x(void 0===e||"string"==typeof e),ye.fromBase64String(e||"")):(x(void 0===e||e instanceof r||e instanceof Uint8Array),ye.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),c=e.targetChange.cause,h=c&&function(t){const e=void 0===t.code?C.UNKNOWN:Yr(t.code);return new N(e,t.message||"")}(c);n=new ai(o,i,s,h||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=xi(t,r.document.name),s=_i(r.document.updateTime),o=r.document.createTime?_i(r.document.createTime):Q.min(),c=new We({mapValue:{fields:r.document.fields}}),a=He.newFoundDocument(i,s,o,c),u=r.targetIds||[],h=r.removedTargetIds||[];n=new si(u,h,a.key,a)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=xi(t,r.document),s=r.readTime?_i(r.readTime):Q.min(),o=He.newNoDocument(i,s),c=r.removedTargetIds||[];n=new si([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=xi(t,r.document),s=r.removedTargetIds||[];n=new si([],s,i,null)}else{if(!("filter"in e))return S();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new Gr(r,i),o=t.targetId;n=new oi(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Q.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Q.min():e.readTime?_i(e.readTime):Q.min()}(t);return this.listener.l_(e,n)}h_(t){const e={};e.database=Ci(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=xn(r)?{documents:Mi(t,r)}:{query:Li(t,r)._t},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=vi(t,e.resumeToken);const r=yi(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(Q.min())>0){n.readTime=wi(t,e.snapshotVersion.toTimestamp());const r=yi(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.r_(e)}P_(t){const e={};e.database=Ci(this.serializer),e.removeTarget=t,this.r_(e)}}class Ea extends _a{constructor(t,e,n,r,i,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(t,e){return this.connection.xo("Write",t,e)}onMessage(t){if(x(!!t.streamToken),this.lastStreamToken=t.streamToken,this.I_){this.Jo.reset();const e=function(t,e){return t&&t.length>0?(x(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?_i(t.updateTime):_i(e);return n.isEqual(Q.min())&&(n=_i(e)),new xr(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=_i(t.commitTime);return this.listener.d_(n,e)}return x(!t.writeResults||0===t.writeResults.length),this.I_=!0,this.listener.A_()}R_(){const t={};t.database=Ci(this.serializer),this.r_(t)}E_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Oi(this.serializer,t)))};this.r_(e)}}class Ta extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.V_=!1}m_(){if(this.V_)throw new N(C.FAILED_PRECONDITION,"The client has already been terminated.")}Do(t,e,n,r){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Do(t,Ei(e,n),r,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new N(C.UNKNOWN,t.toString())}))}Mo(t,e,n,r,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Mo(t,Ei(e,n),r,s,o,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new N(C.UNKNOWN,t.toString())}))}terminate(){this.V_=!0,this.connection.terminate()}}class Sa{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve()))))}D_(t){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.S_("Offline")))}set(t){this.C_(),this.g_=0,"Online"===t&&(this.y_=!1),this.S_(t)}S_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}b_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(I(e),this.y_=!1):_("OnlineStateTracker",e)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class xa{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=i,this.O_.ro((t=>{n.enqueueAndForget((async()=>{Ma(this)&&(_("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=A(t);e.M_.add(4),await Aa(e),e.N_.set("Unknown"),e.M_.delete(4),await Da(e)}(this))}))})),this.N_=new Sa(n,r)}}async function Da(t){if(Ma(t))for(const e of t.x_)await e(!0)}async function Aa(t){for(const e of t.x_)await e(!1)}function Ca(t,e){const n=A(t);n.F_.has(e.targetId)||(n.F_.set(e.targetId,e),Pa(n)?Oa(n):tu(n).Zo()&&ka(n,e))}function Na(t,e){const n=A(t),r=tu(n);n.F_.delete(e),r.Zo()&&Ra(n,e),0===n.F_.size&&(r.Zo()?r.t_():Ma(n)&&n.N_.set("Unknown"))}function ka(t,e){if(t.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Q.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}tu(t).h_(e)}function Ra(t,e){t.L_.xe(e),tu(t).P_(e)}function Oa(t){t.L_=new ci({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.F_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),tu(t).start(),t.N_.w_()}function Pa(t){return Ma(t)&&!tu(t).Yo()&&t.F_.size>0}function Ma(t){return 0===A(t).M_.size}function La(t){t.L_=void 0}async function Fa(t){t.N_.set("Online")}async function Va(t){t.F_.forEach(((e,n)=>{ka(t,e)}))}async function Ua(t,e){La(t),Pa(t)?(t.N_.D_(e),Oa(t)):t.N_.set("Unknown")}async function Ba(t,e,n){if(t.N_.set("Online"),e instanceof ai&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.F_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.F_.delete(r),t.L_.removeTarget(r))}(t,e)}catch(n){_("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await qa(t,n)}else if(e instanceof si?t.L_.Ke(e):e instanceof oi?t.L_.He(e):t.L_.We(e),!n.isEqual(Q.min()))try{const e=await zo(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.L_.rt(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.F_.get(r);i&&t.F_.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.F_.get(e);if(!r)return;t.F_.set(e,r.withResumeToken(ye.EMPTY_BYTE_STRING,r.snapshotVersion)),Ra(t,e);const i=new Qi(r.target,e,n,r.sequenceNumber);ka(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){_("RemoteStore","Failed to raise snapshot:",e),await qa(t,e)}}async function qa(t,e,n){if(!vt(e))throw e;t.M_.add(1),await Aa(t),t.N_.set("Offline"),n||(n=()=>zo(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{_("RemoteStore","Retrying IndexedDB access"),await n(),t.M_.delete(1),await Da(t)}))}function ja(t,e){return e().catch((n=>qa(t,n,e)))}async function za(t){const e=A(t),n=eu(e);let r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;Ka(e);)try{const t=await Go(e.localStore,r);if(null===t){0===e.v_.length&&n.t_();break}r=t.batchId,Ga(e,t)}catch(t){await qa(e,t)}$a(e)&&Qa(e)}function Ka(t){return Ma(t)&&t.v_.length<10}function Ga(t,e){t.v_.push(e);const n=eu(t);n.Zo()&&n.T_&&n.E_(e.mutations)}function $a(t){return Ma(t)&&!eu(t).Yo()&&t.v_.length>0}function Qa(t){eu(t).start()}async function Wa(t){eu(t).R_()}async function Ya(t){const e=eu(t);for(const n of t.v_)e.E_(n.mutations)}async function Ha(t,e,n){const r=t.v_.shift(),i=zr.from(r,e,n);await ja(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await za(t)}async function Ja(t,e){e&&eu(t).T_&&await async function(t,e){if(function(t){return Wr(t)&&t!==C.ABORTED}(e.code)){const n=t.v_.shift();eu(t).e_(),await ja(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await za(t)}}(t,e),$a(t)&&Qa(t)}async function Xa(t,e){const n=A(t);n.asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials");const r=Ma(n);n.M_.add(3),await Aa(n),r&&n.N_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.M_.delete(3),await Da(n)}async function Za(t,e){const n=A(t);e?(n.M_.delete(2),await Da(n)):e||(n.M_.add(2),await Aa(n),n.N_.set("Unknown"))}function tu(t){return t.B_||(t.B_=function(t,e,n){const r=A(t);return r.m_(),new Ia(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{ho:Fa.bind(null,t),Io:Va.bind(null,t),Eo:Ua.bind(null,t),l_:Ba.bind(null,t)}),t.x_.push((async e=>{e?(t.B_.e_(),Pa(t)?Oa(t):t.N_.set("Unknown")):(await t.B_.stop(),La(t))}))),t.B_}function eu(t){return t.k_||(t.k_=function(t,e,n){const r=A(t);return r.m_(),new Ea(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{ho:()=>Promise.resolve(),Io:Wa.bind(null,t),Eo:Ja.bind(null,t),A_:Ya.bind(null,t),d_:Ha.bind(null,t)}),t.x_.push((async e=>{e?(t.k_.e_(),await za(t)):(await t.k_.stop(),t.v_.length>0&&(_("RemoteStore",`Stopping write stream with ${t.v_.length} pending writes`),t.v_=[]))}))),t.k_}class nu{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new k,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new nu(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new N(C.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ru(t,e){if(I("AsyncQueue",`${e}: ${t}`),vt(t))return new N(C.UNAVAILABLE,`${e}: ${t}`);throw t}class iu{constructor(t){this.comparator=t?(e,n)=>t(e,n)||X.comparator(e.key,n.key):(t,e)=>X.comparator(t.key,e.key),this.keyedMap=Jn(),this.sortedSet=new ue(this.comparator)}static emptySet(t){return new iu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof iu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new iu;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class su{constructor(){this.q_=new ue(X.comparator)}track(t){const e=t.doc.key,n=this.q_.get(e);n?0!==t.type&&3===n.type?this.q_=this.q_.insert(e,t):3===t.type&&1!==n.type?this.q_=this.q_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.q_=this.q_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.q_=this.q_.remove(e):1===t.type&&2===n.type?this.q_=this.q_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):S():this.q_=this.q_.insert(e,t)}Q_(){const t=[];return this.q_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class ou{constructor(t,e,n,r,i,s,o,c,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=c,this.hasCachedResults=a}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new ou(t,e,iu.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Bn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class au{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some((t=>t.G_()))}}class uu{constructor(){this.queries=new Qn((t=>qn(t)),Bn),this.onlineState="Unknown",this.z_=new Set}}async function cu(t,e){const n=A(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new au,r=e.G_()?0:1);try{switch(r){case 0:s.K_=await n.onListen(i,!0);break;case 1:s.K_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=ru(t,`Initialization of query '${jn(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.U_.push(e),e.j_(n.onlineState),s.K_&&e.H_(s.K_)&&fu(n)}async function hu(t,e){const n=A(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const t=s.U_.indexOf(e);t>=0&&(s.U_.splice(t,1),0===s.U_.length?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function lu(t,e){const n=A(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.U_)e.H_(t)&&(r=!0);i.K_=t}}r&&fu(n)}function du(t,e,n){const r=A(t),i=r.queries.get(e);if(i)for(const t of i.U_)t.onError(n);r.queries.delete(e)}function fu(t){t.z_.forEach((t=>{t.next()}))}var gu,mu;(mu=gu||(gu={})).J_="default",mu.Cache="cache";class pu{constructor(t,e,n){this.query=t,this.Y_=e,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new ou(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Z_?this.ea(t)&&(this.Y_.next(t),e=!0):this.ta(t,this.onlineState)&&(this.na(t),e=!0),this.X_=t,e}onError(t){this.Y_.error(t)}j_(t){this.onlineState=t;let e=!1;return this.X_&&!this.Z_&&this.ta(this.X_,t)&&(this.na(this.X_),e=!0),e}ta(t,e){if(!t.fromCache)return!0;if(!this.G_())return!0;const n="Offline"!==e;return(!this.options.ra||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}ea(t){if(t.docChanges.length>0)return!0;const e=this.X_&&this.X_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}na(t){t=ou.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Z_=!0,this.Y_.next(t)}G_(){return this.options.source!==gu.Cache}}class yu{constructor(t,e){this.ia=t,this.byteLength=e}sa(){return"metadata"in this.ia}}class wu{constructor(t){this.serializer=t}hs(t){return xi(this.serializer,t)}Ps(t){return t.metadata.exists?Ri(this.serializer,t.document,!1):He.newNoDocument(this.hs(t.metadata.name),this.Is(t.metadata.readTime))}Is(t){return _i(t)}}class vu{constructor(t,e,n){this.oa=t,this.localStore=e,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=bu(t)}_a(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.ia.namedQuery)this.queries.push(t.ia.namedQuery);else if(t.ia.documentMetadata){this.documents.push({metadata:t.ia.documentMetadata}),t.ia.documentMetadata.exists||++e;const n=Y.fromString(t.ia.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.ia.document&&(this.documents[this.documents.length-1].document=t.ia.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}aa(t){const e=new Map,n=new wu(this.serializer);for(const r of t)if(r.metadata.queries){const t=n.hs(r.metadata.name);for(const n of r.metadata.queries){const r=(e.get(n)||sr()).add(t);e.set(n,r)}}return e}async complete(){const t=await async function(t,e,n,r){const i=A(t);let s=sr(),o=Yn();for(const t of n){const n=e.hs(t.metadata.name);t.document&&(s=s.add(n));const r=e.Ps(t);r.setReadTime(e.Is(t.metadata.readTime)),o=o.insert(n,r)}const c=i.ss.newChangeBuffer({trackRemovals:!0}),a=await $o(i,function(t){return Ln(Rn(Y.fromString(`__bundle__/docs/${t}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(t=>Ko(t,c,o).next((e=>(c.apply(t),e))).next((e=>i.qr.removeMatchingKeysForTargetId(t,a.targetId).next((()=>i.qr.addMatchingKeys(t,s,a.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(t,e.us,e.cs))).next((()=>e.us))))))}(this.localStore,new wu(this.serializer),this.documents,this.oa.id),e=this.aa(this.documents);for(const t of this.queries)await Xo(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:t}}}function bu(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class _u{constructor(t){this.key=t}}class Iu{constructor(t){this.key=t}}class Eu{constructor(t,e){this.query=t,this.la=e,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=sr(),this.mutatedKeys=sr(),this.Ia=Gn(t),this.Ta=new iu(this.Ia)}get Ea(){return this.la}da(t,e){const n=e?e.Aa:new su,r=e?e.Ta:this.Ta;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const c="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,a="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=zn(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Ra(u,h)||(n.track({type:2,doc:h}),f=!0,(c&&this.Ia(h,c)>0||a&&this.Ia(h,a)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(c||a)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Ta:s,Aa:n,Zi:o,mutatedKeys:i}}Ra(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.Ta;this.Ta=t.Ta,this.mutatedKeys=t.mutatedKeys;const s=t.Aa.Q_();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return n(t)-n(e)}(t.type,e.type)||this.Ia(t.doc,e.doc))),this.Va(n),r=null!=r&&r;const o=e&&!r?this.ma():[],c=0===this.Pa.size&&this.current&&!r?1:0,a=c!==this.ha;return this.ha=c,0!==s.length||a?{snapshot:new ou(this.query,t.Ta,i,s,t.mutatedKeys,0===c,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:o}:{fa:o}}j_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new su,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(t){return!this.la.has(t)&&!!this.Ta.has(t)&&!this.Ta.get(t).hasLocalMutations}Va(t){t&&(t.addedDocuments.forEach((t=>this.la=this.la.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.la=this.la.delete(t))),this.current=t.current)}ma(){if(!this.current)return[];const t=this.Pa;this.Pa=sr(),this.Ta.forEach((t=>{this.ga(t.key)&&(this.Pa=this.Pa.add(t.key))}));const e=[];return t.forEach((t=>{this.Pa.has(t)||e.push(new Iu(t))})),this.Pa.forEach((n=>{t.has(n)||e.push(new _u(n))})),e}pa(t){this.la=t.ls,this.Pa=sr();const e=this.da(t.documents);return this.applyChanges(e,!0)}ya(){return ou.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class Tu{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Su{constructor(t){this.key=t,this.wa=!1}}class xu{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Sa={},this.ba=new Qn((t=>qn(t)),Bn),this.Da=new Map,this.Ca=new Set,this.va=new ue(X.comparator),this.Fa=new Map,this.Ma=new _o,this.xa={},this.Oa=new Map,this.Na=Ys.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function Du(t,e,n=!0){const r=nc(t);let i;const s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=await Cu(r,e,n,!0),i}async function Au(t,e){const n=nc(t);await Cu(n,e,!0,!1)}async function Cu(t,e,n,r){const i=await $o(t.localStore,Ln(e)),s=i.targetId,o=n?t.sharedClientState.addLocalQueryTarget(s):"not-current";let c;return r&&(c=await Nu(t,e,s,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&Ca(t.remoteStore,i),c}async function Nu(t,e,n,r,i){t.Ba=(e,n,r)=>async function(t,e,n,r){let i=e.view.da(n);i.Zi&&(i=await Wo(t.localStore,e.query,!1).then((({documents:t})=>e.view.da(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),c=e.view.applyChanges(i,t.isPrimaryClient,s,o);return ju(t,e.targetId,c.fa),c.snapshot}(t,e,n,r);const s=await Wo(t.localStore,e,!0),o=new Eu(e,s.ls),c=o.da(s.documents),a=ii.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(c,t.isPrimaryClient,a);ju(t,n,u.fa);const h=new Tu(e,n,o);return t.ba.set(e,h),t.Da.has(n)?t.Da.get(n).push(e):t.Da.set(n,[e]),u.snapshot}async function ku(t,e,n){const r=A(t),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter((t=>!Bn(t,e)))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Qo(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Na(r.remoteStore,i.targetId),Bu(r,i.targetId)})).catch(lt)):(Bu(r,i.targetId),await Qo(r.localStore,i.targetId,!0))}async function Ru(t,e){const n=A(t),r=n.ba.get(e),i=n.Da.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Na(n.remoteStore,r.targetId))}async function Ou(t,e){const n=A(t);try{const t=await function(t,e){const n=A(t),r=e.snapshotVersion;let i=n.ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.ss.newChangeBuffer({trackRemovals:!0});i=n.ts;const o=[];e.targetChanges.forEach(((s,c)=>{const a=i.get(c);if(!a)return;o.push(n.qr.removeMatchingKeys(t,s.removedDocuments,c).next((()=>n.qr.addMatchingKeys(t,s.addedDocuments,c))));let u=a.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(c)?u=u.withResumeToken(ye.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(c,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,s)&&o.push(n.qr.updateTargetData(t,u))}));let c=Yn(),a=sr();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(Ko(t,s,e.documentUpdates).next((t=>{c=t.us,a=t.cs}))),!r.isEqual(Q.min())){const e=n.qr.getLastRemoteSnapshotVersion(t).next((e=>n.qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return ft.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,c,a))).next((()=>c))})).then((t=>(n.ts=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Fa.get(e);r&&(x(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.wa=!0:t.modifiedDocuments.size>0?x(r.wa):t.removedDocuments.size>0&&(x(r.wa),r.wa=!1))})),await Gu(n,t,e)}catch(t){await lt(t)}}function Pu(t,e,n){const r=A(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.ba.forEach(((n,r)=>{const i=r.view.j_(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=A(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.U_)t.j_(e)&&(r=!0)})),r&&fu(n)}(r.eventManager,e),t.length&&r.Sa.l_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Mu(t,e,n){const r=A(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Fa.get(e),s=i&&i.key;if(s){let t=new ue(X.comparator);t=t.insert(s,He.newNoDocument(s,Q.min()));const n=sr().add(s),i=new ri(Q.min(),new Map,new ue(z),t,n);await Ou(r,i),r.va=r.va.remove(s),r.Fa.delete(e),Ku(r)}else await Qo(r.localStore,e,!1).then((()=>Bu(r,e,n))).catch(lt)}async function Lu(t,e){const n=A(t),r=e.batch.batchId;try{const t=await function(t,e){const n=A(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),i=n.ss.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=ft.resolve();return s.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);x(null!==s),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=sr();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);Uu(n,r,null),Vu(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Gu(n,t)}catch(t){await lt(t)}}async function Fu(t,e,n){const r=A(t);try{const t=await function(t,e){const n=A(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(x(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);Uu(r,e,n),Vu(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Gu(r,t)}catch(n){await lt(n)}}function Vu(t,e){(t.Oa.get(e)||[]).forEach((t=>{t.resolve()})),t.Oa.delete(e)}function Uu(t,e,n){const r=A(t);let i=r.xa[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function Bu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Da.get(e))t.ba.delete(r),n&&t.Sa.ka(r,n);t.Da.delete(e),t.isPrimaryClient&&t.Ma.Rr(e).forEach((e=>{t.Ma.containsKey(e)||qu(t,e)}))}function qu(t,e){t.Ca.delete(e.path.canonicalString());const n=t.va.get(e);null!==n&&(Na(t.remoteStore,n),t.va=t.va.remove(e),t.Fa.delete(n),Ku(t))}function ju(t,e,n){for(const r of n)r instanceof _u?(t.Ma.addReference(r.key,e),zu(t,r)):r instanceof Iu?(_("SyncEngine","Document no longer in limbo: "+r.key),t.Ma.removeReference(r.key,e),t.Ma.containsKey(r.key)||qu(t,r.key)):S()}function zu(t,e){const n=e.key,r=n.path.canonicalString();t.va.get(n)||t.Ca.has(r)||(_("SyncEngine","New document in limbo: "+n),t.Ca.add(r),Ku(t))}function Ku(t){for(;t.Ca.size>0&&t.va.size<t.maxConcurrentLimboResolutions;){const e=t.Ca.values().next().value;t.Ca.delete(e);const n=new X(Y.fromString(e)),r=t.Na.next();t.Fa.set(r,new Su(n)),t.va=t.va.insert(n,r),Ca(t.remoteStore,new Qi(Ln(Rn(n.path)),r,"TargetPurposeLimboResolution",xt.oe))}}async function Gu(t,e,n){const r=A(t),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach(((t,c)=>{o.push(r.Ba(c,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);const e=Fo.Qi(c.targetId,t);s.push(e)}})))})),await Promise.all(o),r.Sa.l_(i),await async function(t,e){const n=A(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>ft.forEach(e,(e=>ft.forEach(e.ki,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>ft.forEach(e.qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!vt(t))throw t;_("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ts.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.ts=n.ts.insert(e,i)}}}(r.localStore,s))}async function $u(t,e){const n=A(t);if(!n.currentUser.isEqual(e)){_("SyncEngine","User change. New user:",e.toKey());const t=await jo(n.localStore,e);n.currentUser=e,function(t,e){t.Oa.forEach((t=>{t.forEach((t=>{t.reject(new N(C.CANCELLED,e))}))})),t.Oa.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Gu(n,t._s)}}function Qu(t,e){const n=A(t),r=n.Fa.get(e);if(r&&r.wa)return sr().add(r.key);{let t=sr();const r=n.Da.get(e);if(!r)return t;for(const e of r){const r=n.ba.get(e);t=t.unionWith(r.view.Ea)}return t}}async function Wu(t,e){const n=A(t),r=await Wo(n.localStore,e.query,!0),i=e.view.pa(r);return n.isPrimaryClient&&ju(n,e.targetId,i.fa),i}async function Yu(t,e){const n=A(t);return Ho(n.localStore,e).then((t=>Gu(n,t)))}async function Hu(t,e,n,r){const i=A(t),s=await function(t,e){const n=A(t),r=A(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>r.Cn(t,e).next((e=>e?n.localDocuments.getDocuments(t,e):ft.resolve(null)))))}(i.localStore,e);null!==s?("pending"===n?await za(i.remoteStore):"acknowledged"===n||"rejected"===n?(Uu(i,e,r||null),Vu(i,e),function(t,e){A(A(t).mutationQueue).Fn(e)}(i.localStore,e)):S(),await Gu(i,s)):_("SyncEngine","Cannot apply mutation batch with id: "+e)}async function Ju(t,e,n){const r=A(t),i=[],s=[];for(const t of e){let e;const n=r.Da.get(t);if(n&&0!==n.length){e=await $o(r.localStore,Ln(n[0]));for(const t of n){const e=r.ba.get(t),n=await Wu(r,e);n.snapshot&&s.push(n.snapshot)}}else{const n=await Yo(r.localStore,t);e=await $o(r.localStore,n),await Nu(r,Xu(n),t,!1,e.resumeToken)}i.push(e)}return r.Sa.l_(s),i}function Xu(t){return kn(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Zu(t){return function(t){return A(A(t).persistence).Li()}(A(t).localStore)}async function tc(t,e,n,r){const i=A(t);if(i.La)return void _("SyncEngine","Ignoring unexpected query state notification.");const s=i.Da.get(e);if(s&&s.length>0)switch(n){case"current":case"not-current":{const t=await Ho(i.localStore,Kn(s[0])),r=ri.createSynthesizedRemoteEventForCurrentChange(e,"current"===n,ye.EMPTY_BYTE_STRING);await Gu(i,t,r);break}case"rejected":await Qo(i.localStore,e,!0),Bu(i,e,r);break;default:S()}}async function ec(t,e,n){const r=nc(t);if(r.La){for(const t of e){if(r.Da.has(t)&&r.sharedClientState.isActiveQueryTarget(t)){_("SyncEngine","Adding an already active target "+t);continue}const e=await Yo(r.localStore,t),n=await $o(r.localStore,e);await Nu(r,Xu(e),n.targetId,!1,n.resumeToken),Ca(r.remoteStore,n)}for(const t of n)r.Da.has(t)&&await Qo(r.localStore,t,!1).then((()=>{Na(r.remoteStore,t),Bu(r,t)})).catch(lt)}}function nc(t){const e=A(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ou.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Qu.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Mu.bind(null,e),e.Sa.l_=lu.bind(null,e.eventManager),e.Sa.ka=du.bind(null,e.eventManager),e}function rc(t){const e=A(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Lu.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Fu.bind(null,e),e}class ic{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=va(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return qo(this.persistence,new Uo,t.initialUser,this.serializer)}createPersistence(t){return new Do(Co.jr,this.serializer)}createSharedClientState(t){return new ua}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class sc extends ic{constructor(t,e,n){super(),this.Qa=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.Qa.initialize(this,t),await rc(this.Qa.syncEngine),await za(this.Qa.remoteStore),await this.persistence.mi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(t){return qo(this.persistence,new Uo,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new no(n,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){const n=new St(e,this.persistence);return new Tt(t.asyncQueue,n)}createPersistence(t){const e=Lo(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?qs.withCacheSize(this.cacheSizeBytes):qs.DEFAULT;return new Oo(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,ya(),wa(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new ua}}class oc extends sc{constructor(t,e){super(t,e,!1),this.Qa=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.Qa.syncEngine;this.sharedClientState instanceof aa&&(this.sharedClientState.syncEngine={Ys:Hu.bind(null,e),Zs:tc.bind(null,e),Xs:ec.bind(null,e),Li:Zu.bind(null,e),Js:Yu.bind(null,e)},await this.sharedClientState.start()),await this.persistence.mi((async t=>{await async function(t,e){const n=A(t);if(nc(n),rc(n),!0===e&&!0!==n.La){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await Ju(n,t.toArray());n.La=!0,await Za(n.remoteStore,!0);for(const t of e)Ca(n.remoteStore,t)}else if(!1===e&&!1!==n.La){const t=[];let e=Promise.resolve();n.Da.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?t.push(i):e=e.then((()=>(Bu(n,i),Qo(n.localStore,i,!0)))),Na(n.remoteStore,i)})),await e,await Ju(n,t),function(t){const e=A(t);e.Fa.forEach(((t,n)=>{Na(e.remoteStore,n)})),e.Ma.Vr(),e.Fa=new Map,e.va=new ue(X.comparator)}(n),n.La=!1,await Za(n.remoteStore,!1)}}(this.Qa.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start():t||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(t&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():t||this.indexBackfillerScheduler.stop())}))}createSharedClientState(t){const e=ya();if(!aa.D(e))throw new N(C.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Lo(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new aa(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class ac{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Pu(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=$u.bind(null,this.syncEngine),await Za(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new uu}createDatastore(t){const e=va(t.databaseInfo.databaseId),n=function(t){return new pa(t)}(t.databaseInfo);return function(t,e,n,r){return new Ta(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new xa(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>Pu(this.syncEngine,t,0)),ha.D()?new ha:new ca)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const c=new xu(t,e,n,r,i,s);return o&&(c.La=!0),c}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=A(t);_("RemoteStore","RemoteStore shutting down."),e.M_.add(5),await Aa(e),e.O_.shutdown(),e.N_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}function uc(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const r={value:t.slice(n,n+e),done:!1};return n+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class cc{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ka(this.observer.next,t)}error(t){this.observer.error?this.Ka(this.observer.error,t):I("Uncaught Error in snapshot listener:",t.toString())}$a(){this.muted=!0}Ka(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class hc{constructor(t,e){this.Ua=t,this.serializer=e,this.metadata=new k,this.buffer=new Uint8Array,this.Wa=new TextDecoder("utf-8"),this.Ga().then((t=>{t&&t.sa()?this.metadata.resolve(t.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.ia)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Ua.cancel()}async getMetadata(){return this.metadata.promise}async qa(){return await this.getMetadata(),this.Ga()}async Ga(){const t=await this.za();if(null===t)return null;const e=this.Wa.decode(t),n=Number(e);isNaN(n)&&this.ja(`length string (${e}) is not valid number`);const r=await this.Ha(n);return new yu(JSON.parse(r),t.length+n)}Ja(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async za(){for(;this.Ja()<0&&!await this.Ya(););if(0===this.buffer.length)return null;const t=this.Ja();t<0&&this.ja("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async Ha(t){for(;this.buffer.length<t;)await this.Ya()&&this.ja("Reached the end of bundle when more is expected.");const e=this.Wa.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}ja(t){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${t}`)}async Ya(){const t=await this.Ua.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class lc{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new N(C.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const e=await async function(t,e){const n=A(t),r={documents:e.map((t=>Si(n.serializer,t)))},i=await n.Mo("BatchGetDocuments",n.serializer.databaseId,Y.emptyPath(),r,e.length),s=new Map;i.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){x(!!e.found),e.found.name,e.found.updateTime;const n=xi(t,e.found.name),r=_i(e.found.updateTime),i=e.found.createTime?_i(e.found.createTime):Q.min(),s=new We({mapValue:{fields:e.found.fields}});return He.newFoundDocument(n,r,i,s)}(t,e):"missing"in e?function(t,e){x(!!e.missing),x(!!e.readTime);const n=xi(t,e.missing),r=_i(e.readTime);return He.newNoDocument(n,r)}(t,e):S()}(n.serializer,t);s.set(e.key.toString(),e)}));const o=[];return e.forEach((t=>{const e=s.get(t.toString());x(!!e),o.push(e)})),o}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastTransactionError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new Br(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=X.fromPath(e);this.mutations.push(new qr(n,this.precondition(n)))})),await async function(t,e){const n=A(t),r={writes:e.map((t=>Oi(n.serializer,t)))};await n.Do("Commit",n.serializer.databaseId,Y.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw S();e=Q.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new N(C.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(Q.min())?Dr.exists(!1):Dr.updateTime(e):Dr.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Q.min()))throw new N(C.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Dr.updateTime(e)}return Dr.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class dc{constructor(t,e,n,r,i){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=r,this.deferred=i,this.Za=n.maxAttempts,this.Jo=new ba(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Jo.Ko((async()=>{const t=new lc(this.datastore),e=this.tu(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.nu(t)}))))})).catch((t=>{this.nu(t)}))}))}tu(t){try{const e=this.updateFunction(t);return!Dt(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(t){this.Za>0&&this.ru(t)?(this.Za-=1,this.asyncQueue.enqueueAndForget((()=>(this.eu(),Promise.resolve())))):this.deferred.reject(t)}ru(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||"already-exists"===e||!Wr(e)}return!1}}class fc{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=m.UNAUTHENTICATED,this.clientId=j.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{_("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(_("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new N(C.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new k;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=ru(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function gc(t,e){t.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await jo(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function mc(t,e){t.asyncQueue.verifyOperationInProgress();const n=await yc(t);_("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Xa(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Xa(e.remoteStore,n))),t._onlineComponents=e}function pc(t){return"FirebaseError"===t.name?t.code===C.FAILED_PRECONDITION||t.code===C.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}async function yc(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){_("FirestoreClient","Using user provided OfflineComponentProvider");try{await gc(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!pc(n))throw n;E("Error using user provided cache. Falling back to memory cache: "+n),await gc(t,new ic)}}else _("FirestoreClient","Using default OfflineComponentProvider"),await gc(t,new ic);return t._offlineComponents}async function wc(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(_("FirestoreClient","Using user provided OnlineComponentProvider"),await mc(t,t._uninitializedComponentsProvider._online)):(_("FirestoreClient","Using default OnlineComponentProvider"),await mc(t,new ac))),t._onlineComponents}function vc(t){return yc(t).then((t=>t.persistence))}function bc(t){return yc(t).then((t=>t.localStore))}function _c(t){return wc(t).then((t=>t.remoteStore))}function Ic(t){return wc(t).then((t=>t.syncEngine))}function Ec(t){return wc(t).then((t=>t.datastore))}async function Tc(t){const e=await wc(t),n=e.eventManager;return n.onListen=Du.bind(null,e.syncEngine),n.onUnlisten=ku.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Au.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Ru.bind(null,e.syncEngine),n}function Sc(t,e,n={}){const r=new k;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,i){const s=new cc({next:s=>{e.enqueueAndForget((()=>hu(t,o)));const c=s.docs.has(n);!c&&s.fromCache?i.reject(new N(C.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&s.fromCache&&r&&"server"===r.source?i.reject(new N(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:t=>i.reject(t)}),o=new pu(Rn(n.path),s,{includeMetadataChanges:!0,ra:!0});return cu(t,o)}(await Tc(t),t.asyncQueue,e,n,r))),r.promise}function xc(t,e,n={}){const r=new k;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,i){const s=new cc({next:n=>{e.enqueueAndForget((()=>hu(t,o))),n.fromCache&&"server"===r.source?i.reject(new N(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new pu(n,s,{includeMetadataChanges:!0,ra:!0});return cu(t,o)}(await Tc(t),t.asyncQueue,e,n,r))),r.promise}function Dc(t,e,n,r){const i=function(t,e){let n;return n="string"==typeof t?Jr().encode(t):t,function(t,e){return new hc(t,e)}(function(t,e){if(t instanceof Uint8Array)return uc(t,e);if(t instanceof ArrayBuffer)return uc(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,va(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const r=A(t);(async function(t,e,n){try{const r=await e.getMetadata();if(await function(t,e){const n=A(t),r=_i(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.Kr.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(r)>=0))}(t.localStore,r))return await e.close(),n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(bu(r));const i=new vu(r,t.localStore,e.serializer);let s=await e.qa();for(;s;){const t=await i._a(s);t&&n._updateProgress(t),s=await e.qa()}const o=await i.complete();return await Gu(t,o.ca,void 0),await function(t,e){const n=A(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.Kr.saveBundleMetadata(t,e)))}(t.localStore,r),n._completeWith(o.progress),Promise.resolve(o.ua)}catch(t){return E("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t),Promise.resolve(new Set)}})(r,e,n).then((t=>{r.sharedClientState.notifyBundleLoaded(t)}))}(await Ic(t),i,r)}))}function Ac(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Cc=new Map;function Nc(t,e,n){if(!n)throw new N(C.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function kc(t,e,n,r){if(!0===e&&!0===r)throw new N(C.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Rc(t){if(!X.isDocumentKey(t))throw new N(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Oc(t){if(X.isDocumentKey(t))throw new N(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Pc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":S()}function Mc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new N(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Pc(t);throw new N(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Lc(t,e){if(e<=0)throw new N(C.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class Fc{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new N(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new N(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}kc("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ac(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Vc{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Fc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new N(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new N(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Fc(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new O;switch(t.type){case"firstParty":return new F(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new N(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Cc.get(t);e&&(_("ComponentProvider","Removing Datastore"),Cc.delete(t),e.terminate())}(this),Promise.resolve()}}function Uc(t,e,n,r={}){var i;const s=(t=Mc(t,Vc))._getSettings(),o=`${e}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&E("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=m.MOCK_USER;else{e=Object(l.g)(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new N(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new m(s)}t._authCredentials=new P(new R(e,n))}}class Bc{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Bc(this.firestore,t,this._query)}}class qc{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new jc(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new qc(this.firestore,t,this._key)}}class jc extends Bc{constructor(t,e,n){super(t,e,Rn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new qc(this.firestore,null,new X(t))}withConverter(t){return new jc(this.firestore,t,this._path)}}function zc(t,e,...n){if(t=Object(l.p)(t),Nc("collection","path",e),t instanceof Vc){const r=Y.fromString(e,...n);return Oc(r),new jc(t,null,r)}{if(!(t instanceof qc||t instanceof jc))throw new N(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Y.fromString(e,...n));return Oc(r),new jc(t.firestore,null,r)}}function Kc(t,e){if(t=Mc(t,Vc),Nc("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new N(C.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Bc(t,null,function(t){return new Nn(Y.emptyPath(),t)}(e))}function Gc(t,e,...n){if(t=Object(l.p)(t),1===arguments.length&&(e=j.newId()),Nc("doc","path",e),t instanceof Vc){const r=Y.fromString(e,...n);return Rc(r),new qc(t,null,new X(r))}{if(!(t instanceof qc||t instanceof jc))throw new N(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Y.fromString(e,...n));return Rc(r),new qc(t.firestore,t instanceof jc?t.converter:null,new X(r))}}function $c(t,e){return t=Object(l.p)(t),e=Object(l.p)(e),(t instanceof qc||t instanceof jc)&&(e instanceof qc||e instanceof jc)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Qc(t,e){return t=Object(l.p)(t),e=Object(l.p)(e),t instanceof Bc&&e instanceof Bc&&t.firestore===e.firestore&&Bn(t._query,e._query)&&t.converter===e.converter}class Wc{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new ba(this,"async_queue_retry"),this.hu=()=>{const t=wa();t&&_("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Jo.Uo()};const t=wa();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.ou){this.ou=!0,this.cu=t||!1;const e=wa();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.hu)}}enqueue(t){if(this.Pu(),this.ou)return new Promise((()=>{}));const e=new k;return this.Iu((()=>this.ou&&this.cu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.su.push(t),this.Tu())))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Jo.reset()}catch(t){if(!vt(t))throw t;_("AsyncQueue","Operation failed with retryable error: "+t)}this.su.length>0&&this.Jo.Ko((()=>this.Tu()))}}Iu(t){const e=this.iu.then((()=>(this.uu=!0,t().catch((t=>{this.au=t,this.uu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw I("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.uu=!1,t))))));return this.iu=e,e}enqueueAfterDelay(t,e,n){this.Pu(),this.lu.indexOf(t)>-1&&(e=0);const r=nu.createAndSchedule(this,t,e,n,(t=>this.Eu(t)));return this._u.push(r),r}Pu(){this.au&&S()}verifyOperationInProgress(){}async du(){let t;do{t=this.iu,await t}while(t!==this.iu)}Au(t){for(const e of this._u)if(e.timerId===t)return!0;return!1}Ru(t){return this.du().then((()=>{this._u.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this._u)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.du()}))}Vu(t){this.lu.push(t)}Eu(t){const e=this._u.indexOf(t);this._u.splice(e,1)}}function Yc(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of e)if(t in n&&"function"==typeof n[t])return!0;return!1}(t,["next","error","complete"])}class Hc{constructor(){this._progressObserver={},this._taskCompletionResolver=new k,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const Jc=-1;class Xc extends Vc{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Wc,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||eh(this),this._firestoreClient.terminate()}}function Zc(t){return t._firestoreClient||eh(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function eh(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new Se(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Ac(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new fc(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function nh(t,e){lh(t=Mc(t,Xc));const n=Zc(t);if(n._uninitializedComponentsProvider)throw new N(C.FAILED_PRECONDITION,"SDK cache is already specified.");E("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=t._freezeSettings(),i=new ac;return ih(n,i,new sc(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function rh(t){lh(t=Mc(t,Xc));const e=Zc(t);if(e._uninitializedComponentsProvider)throw new N(C.FAILED_PRECONDITION,"SDK cache is already specified.");E("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings(),r=new ac;return ih(e,r,new oc(r,n.cacheSizeBytes))}function ih(t,e,n){const r=new k;return t.asyncQueue.enqueue((async()=>{try{await gc(t,n),await mc(t,e),r.resolve()}catch(t){const e=t;if(!pc(e))throw e;E("Error enabling indexeddb cache. Falling back to memory cache: "+e),r.reject(e)}})).then((()=>r.promise))}function sh(t){if(t._initialized&&!t._terminated)throw new N(C.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new k;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!mt.D())return Promise.resolve();const e=t+"main";await mt.delete(e)}(Lo(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function oh(t){return function(t){const e=new k;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=A(t);Ma(n.remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=A(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const r=n.Oa.get(t)||[];r.push(e),n.Oa.set(t,r)}catch(t){const n=ru(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await Ic(t),e))),e.promise}(Zc(t=Mc(t,Xc)))}function ah(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await vc(t),n=await _c(t);return e.setNetworkEnabled(!0),function(t){const e=A(t);return e.M_.delete(0),Da(e)}(n)}))}(Zc(t=Mc(t,Xc)))}function uh(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await vc(t),n=await _c(t);return e.setNetworkEnabled(!1),async function(t){const e=A(t);e.M_.add(0),await Aa(e),e.N_.set("Offline")}(n)}))}(Zc(t=Mc(t,Xc)))}function ch(t,e){const n=Zc(t=Mc(t,Xc)),r=new Hc;return Dc(n,t._databaseId,e,r),r}function hh(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=A(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.Kr.getNamedQuery(t,e)))}(await bc(t),e)))}(Zc(t=Mc(t,Xc)),e).then((e=>e?new Bc(t,null,e.query):null))}function lh(t){if(t._initialized||t._terminated)throw new N(C.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class dh{constructor(t){this._byteString=t}static fromBase64String(t){try{return new dh(ye.fromBase64String(t))}catch(t){throw new N(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new dh(ye.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class fh{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new N(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new J(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class gh{constructor(t){this._methodName=t}}class mh{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new N(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new N(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return z(this._lat,t._lat)||z(this._long,t._long)}}const ph=/^__.*__$/;class yh{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Lr(t,this.data,this.fieldMask,e,this.fieldTransforms):new Mr(t,this.data,e,this.fieldTransforms)}}class wh{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Lr(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function vh(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}class bh{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.mu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(t){return new bh(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.gu({path:n,yu:!1});return r.wu(t),r}Su(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.gu({path:n,yu:!1});return r.mu(),r}bu(t){return this.gu({path:void 0,yu:!0})}Du(t){return Bh(t,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}mu(){if(this.path)for(let t=0;t<this.path.length;t++)this.wu(this.path.get(t))}wu(t){if(0===t.length)throw this.Du("Document fields must not be empty");if(vh(this.fu)&&ph.test(t))throw this.Du('Document fields cannot begin and end with "__"')}}class _h{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||va(t)}Fu(t,e,n,r=!1){return new bh({fu:t,methodName:e,vu:n,path:J.emptyPath(),yu:!1,Cu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ih(t){const e=t._freezeSettings(),n=va(t._databaseId);return new _h(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Eh(t,e,n,r,i,s={}){const o=t.Fu(s.merge||s.mergeFields?2:0,e,n,i);Lh("Data must be an object, but it was:",o,r);const c=Ph(r,o);let a,u;if(s.merge)a=new ge(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=Fh(e,r,n);if(!o.contains(i))throw new N(C.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);qh(t,i)||t.push(i)}a=new ge(t),u=o.fieldTransforms.filter((t=>a.covers(t.field)))}else a=null,u=o.fieldTransforms;return new yh(new We(c),a,u)}class Th extends gh{_toFieldTransform(t){if(2!==t.fu)throw 1===t.fu?t.Du(`${this._methodName}() can only appear at the top level of your update data`):t.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Th}}function Sh(t,e,n){return new bh({fu:3,vu:e.settings.vu,methodName:t._methodName,yu:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class xh extends gh{_toFieldTransform(t){return new Sr(t.path,new pr)}isEqual(t){return t instanceof xh}}class Dh extends gh{constructor(t,e){super(t),this.Mu=e}_toFieldTransform(t){const e=Sh(this,t,!0),n=this.Mu.map((t=>Oh(t,e))),r=new yr(n);return new Sr(t.path,r)}isEqual(t){return t instanceof Dh&&Object(l.i)(this.Mu,t.Mu)}}class Ah extends gh{constructor(t,e){super(t),this.Mu=e}_toFieldTransform(t){const e=Sh(this,t,!0),n=this.Mu.map((t=>Oh(t,e))),r=new vr(n);return new Sr(t.path,r)}isEqual(t){return t instanceof Ah&&Object(l.i)(this.Mu,t.Mu)}}class Ch extends gh{constructor(t,e){super(t),this.xu=e}_toFieldTransform(t){const e=new Ir(t.serializer,lr(t.serializer,this.xu));return new Sr(t.path,e)}isEqual(t){return t instanceof Ch&&this.xu===t.xu}}function Nh(t,e,n,r){const i=t.Fu(1,e,n);Lh("Data must be an object, but it was:",i,r);const s=[],o=We.empty();oe(r,((t,r)=>{const c=Uh(e,t,n);r=Object(l.p)(r);const a=i.Su(c);if(r instanceof Th)s.push(c);else{const t=Oh(r,a);null!=t&&(s.push(c),o.set(c,t))}}));const c=new ge(s);return new wh(o,c,i.fieldTransforms)}function kh(t,e,n,r,i,s){const o=t.Fu(1,e,n),c=[Fh(e,r,n)],a=[i];if(s.length%2!=0)throw new N(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<s.length;t+=2)c.push(Fh(e,s[t])),a.push(s[t+1]);const u=[],h=We.empty();for(let t=c.length-1;t>=0;--t)if(!qh(u,c[t])){const e=c[t];let n=a[t];n=Object(l.p)(n);const r=o.Su(e);if(n instanceof Th)u.push(e);else{const t=Oh(n,r);null!=t&&(u.push(e),h.set(e,t))}}const d=new ge(u);return new wh(h,d,o.fieldTransforms)}function Rh(t,e,n,r=!1){return Oh(n,t.Fu(r?4:3,e))}function Oh(t,e){if(Mh(t=Object(l.p)(t)))return Lh("Unsupported field value:",e,t),Ph(t,e);if(t instanceof gh)return function(t,e){if(!vh(e.fu))throw e.Du(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Du(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.yu&&4!==e.fu)throw e.Du("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=Oh(i,e.bu(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(l.p)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return lr(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=$.fromDate(t);return{timestampValue:wi(e.serializer,n)}}if(t instanceof $){const n=new $(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:wi(e.serializer,n)}}if(t instanceof mh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof dh)return{bytesValue:vi(e.serializer,t._byteString)};if(t instanceof qc){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Du(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Ii(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Du(`Unsupported field value: ${Pc(t)}`)}(t,e)}function Ph(t,e){const n={};return ae(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):oe(t,((t,r)=>{const i=Oh(r,e.pu(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Mh(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof $||t instanceof mh||t instanceof dh||t instanceof qc||t instanceof gh)}function Lh(t,e,n){if(!Mh(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Pc(n);throw"an object"===r?e.Du(t+" a custom object"):e.Du(t+" "+r)}}function Fh(t,e,n){if((e=Object(l.p)(e))instanceof fh)return e._internalPath;if("string"==typeof e)return Uh(t,e);throw Bh("Field path arguments must be of type string or ",t,!1,void 0,n)}const Vh=new RegExp("[~\\*/\\[\\]]");function Uh(t,e,n){if(e.search(Vh)>=0)throw Bh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new fh(...e.split("."))._internalPath}catch(r){throw Bh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Bh(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let c=`Function ${e}() called with invalid data`;n&&(c+=" (via `toFirestore()`)"),c+=". ";let a="";return(s||o)&&(a+=" (found",s&&(a+=` in field ${r}`),o&&(a+=` in document ${i}`),a+=")"),new N(C.INVALID_ARGUMENT,c+t+a)}function qh(t,e){return t.some((t=>t.isEqual(e)))}class jh{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new qc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new zh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Kh("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class zh extends jh{data(){return super.data()}}function Kh(t,e){return"string"==typeof e?Uh(t,e):e instanceof fh?e._internalPath:e._delegate._internalPath}function Gh(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new N(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class $h{}class Qh extends $h{}function Wh(t,e,...n){let r=[];e instanceof $h&&r.push(e),r=r.concat(n),function(t){const e=t.filter((t=>t instanceof Jh)).length,n=t.filter((t=>t instanceof Yh)).length;if(e>1||e>0&&n>0)throw new N(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const e of r)t=e._apply(t);return t}class Yh extends Qh{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new Yh(t,e,n)}_apply(t){const e=this._parse(t);return ml(t._query,e),new Bc(t.firestore,t.converter,Vn(t._query,e))}_parse(t){const e=Ih(t.firestore),n=function(t,e,n,r,i,s,o){let c;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new N(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){gl(o,s);const e=[];for(const n of o)e.push(fl(r,t,n));c={arrayValue:{values:e}}}else c=fl(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||gl(o,s),c=Rh(n,e,o,"in"===s||"not-in"===s);return rn.create(i,s,c)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function Hh(t,e,n){const r=e,i=Kh("where",t);return Yh._create(i,r,n)}class Jh extends $h{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Jh(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:sn.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const t of r)ml(n,t),n=Vn(n,t)}(t._query,e),new Bc(t.firestore,t.converter,Vn(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Xh extends Qh{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Xh(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new N(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new N(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new tn(e,n)}(t._query,this._field,this._direction);return new Bc(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Nn(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function Zh(t,e="asc"){const n=e,r=Kh("orderBy",t);return Xh._create(r,n)}class tl extends Qh{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new tl(t,e,n)}_apply(t){return new Bc(t.firestore,t.converter,Un(t._query,this._limit,this._limitType))}}function el(t){return Lc("limit",t),tl._create("limit",t,"F")}function nl(t){return Lc("limitToLast",t),tl._create("limitToLast",t,"L")}class rl extends Qh{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new rl(t,e,n)}_apply(t){const e=ll(t,this.type,this._docOrFields,this._inclusive);return new Bc(t.firestore,t.converter,function(t,e){return new Nn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function il(...t){return rl._create("startAt",t,!0)}function sl(...t){return rl._create("startAfter",t,!1)}class al extends Qh{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new al(t,e,n)}_apply(t){const e=ll(t,this.type,this._docOrFields,this._inclusive);return new Bc(t.firestore,t.converter,function(t,e){return new Nn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function cl(...t){return al._create("endBefore",t,!1)}function hl(...t){return al._create("endAt",t,!0)}function ll(t,e,n,r){if(n[0]=Object(l.p)(n[0]),n[0]instanceof jh)return function(t,e,n,r,i){if(!r)throw new N(C.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Mn(t))if(n.field.isKeyField())s.push(Le(e,r.key));else{const t=r.data.field(n.field);if(Ie(t))throw new N(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new N(C.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}s.push(t)}return new Je(s,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const i=Ih(t.firestore);return function(t,e,n,r,i,s){const o=t.explicitOrderBy;if(i.length>o.length)throw new N(C.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const c=[];for(let s=0;s<i.length;s++){const a=i[s];if(o[s].field.isKeyField()){if("string"!=typeof a)throw new N(C.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof a}`);if(!Pn(t)&&-1!==a.indexOf("/"))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${a}' contains a slash.`);const n=t.path.child(Y.fromString(a));if(!X.isDocumentKey(n))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new X(n);c.push(Le(e,i))}else{const t=Rh(n,r,a);c.push(t)}}return new Je(c,s)}(t._query,t.firestore._databaseId,i,e,n,r)}}function fl(t,e,n){if("string"==typeof(n=Object(l.p)(n))){if(""===n)throw new N(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pn(e)&&-1!==n.indexOf("/"))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Y.fromString(n));if(!X.isDocumentKey(r))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Le(t,new X(r))}if(n instanceof qc)return Le(t,n._key);throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Pc(n)}.`)}function gl(t,e){if(!Array.isArray(t)||0===t.length)throw new N(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ml(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new N(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new N(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class pl{convertValue(t,e="none"){switch(Ce(t)){case 0:return null;case 1:return t.booleanValue;case 2:return be(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(_e(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw S()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return oe(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new mh(be(t.latitude),be(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Ee(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Te(t));default:return null}}convertTimestamp(t){const e=ve(t);return new $(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Y.fromString(t);x($i(n));const r=new xe(n.get(1),n.get(3)),i=new X(n.popFirst(5));return r.isEqual(e)||I(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}function yl(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class wl extends pl{constructor(t){super(),this.firestore=t}convertBytes(t){return new dh(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new qc(this.firestore,null,e)}}class vl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class bl extends jh{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new _l(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Kh("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class _l extends bl{data(t={}){return super.data(t)}}class Il{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new vl(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new _l(this._firestore,this._userDataWriter,n.key,n,new vl(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new N(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new _l(t._firestore,t._userDataWriter,n.doc.key,n.doc,new vl(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new _l(t._firestore,t._userDataWriter,e.doc.key,e.doc,new vl(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:El(e.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function El(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function Tl(t,e){return t instanceof bl&&e instanceof bl?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Il&&e instanceof Il&&t._firestore===e._firestore&&Qc(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Sl(t){t=Mc(t,qc);const e=Mc(t.firestore,Xc);return Sc(Zc(e),t._key).then((n=>Ul(e,t,n)))}class xl extends pl{constructor(t){super(),this.firestore=t}convertBytes(t){return new dh(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new qc(this.firestore,null,e)}}function Dl(t){t=Mc(t,qc);const e=Mc(t.firestore,Xc),n=Zc(e),r=new xl(e);return function(t,e){const n=new k;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await function(t,e){const n=A(t);return n.persistence.runTransaction("read document","readonly",(t=>n.localDocuments.getDocument(t,e)))}(t,e);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new N(C.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const r=ru(t,`Failed to get document '${e} from cache`);n.reject(r)}}(await bc(t),e,n))),n.promise}(n,t._key).then((n=>new bl(e,r,t._key,n,new vl(null!==n&&n.hasLocalMutations,!0),t.converter)))}function Al(t){t=Mc(t,qc);const e=Mc(t.firestore,Xc);return Sc(Zc(e),t._key,{source:"server"}).then((n=>Ul(e,t,n)))}function Cl(t){t=Mc(t,Bc);const e=Mc(t.firestore,Xc),n=Zc(e),r=new xl(e);return Gh(t._query),xc(n,t._query).then((n=>new Il(e,r,t,n)))}function Nl(t){t=Mc(t,Bc);const e=Mc(t.firestore,Xc),n=Zc(e),r=new xl(e);return function(t,e){const n=new k;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await Wo(t,e,!0),i=new Eu(e,r.ls),s=i.da(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(t){const r=ru(t,`Failed to execute query '${e} against cache`);n.reject(r)}}(await bc(t),e,n))),n.promise}(n,t._query).then((n=>new Il(e,r,t,n)))}function kl(t){t=Mc(t,Bc);const e=Mc(t.firestore,Xc),n=Zc(e),r=new xl(e);return xc(n,t._query,{source:"server"}).then((n=>new Il(e,r,t,n)))}function Rl(t,e,n){t=Mc(t,qc);const r=Mc(t.firestore,Xc),i=yl(t.converter,e,n);return Vl(r,[Eh(Ih(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Dr.none())])}function Ol(t,e,n,...r){t=Mc(t,qc);const i=Mc(t.firestore,Xc),s=Ih(i);let o;return o="string"==typeof(e=Object(l.p)(e))||e instanceof fh?kh(s,"updateDoc",t._key,e,n,r):Nh(s,"updateDoc",t._key,e),Vl(i,[o.toMutation(t._key,Dr.exists(!0))])}function Pl(t){return Vl(Mc(t.firestore,Xc),[new Br(t._key,Dr.none())])}function Ml(t,e){const n=Mc(t.firestore,Xc),r=Gc(t),i=yl(t.converter,e);return Vl(n,[Eh(Ih(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Dr.exists(!1))]).then((()=>r))}function Ll(t,...e){var n,r,i;t=Object(l.p)(t);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Yc(e[o])||(s=e[o],o++);const c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Yc(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let a,u,h;if(t instanceof qc)u=Mc(t.firestore,Xc),h=Rn(t._key.path),a={next:n=>{e[o]&&e[o](Ul(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Mc(t,Bc);u=Mc(n.firestore,Xc),h=n._query;const r=new xl(u);a={next:t=>{e[o]&&e[o](new Il(u,r,n,t))},error:e[o+1],complete:e[o+2]},Gh(t._query)}return function(t,e,n,r){const i=new cc(r),s=new pu(e,i,n);return t.asyncQueue.enqueueAndForget((async()=>cu(await Tc(t),s))),()=>{i.$a(),t.asyncQueue.enqueueAndForget((async()=>hu(await Tc(t),s)))}}(Zc(u),h,c,a)}function Fl(t,e){return function(t,e){const n=new cc(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){A(t).z_.add(e),e.next()}(await Tc(t),n))),()=>{n.$a(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){A(t).z_.delete(e)}(await Tc(t),n)))}}(Zc(t=Mc(t,Xc)),Yc(e)?e:{next:e})}function Vl(t,e){return function(t,e){const n=new k;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=rc(t);try{const t=await function(t,e){const n=A(t),r=$.now(),i=e.reduce(((t,e)=>t.add(e.key)),sr());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let c=Yn(),a=sr();return n.ss.getEntries(t,i).next((t=>{c=t,c.forEach(((t,e)=>{e.isValidDocument()||(a=a.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,c))).next((i=>{s=i;const o=[];for(const t of e){const e=Or(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new Lr(t.key,e,Ye(e.value.mapValue),Dr.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(s,a);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Xn(s)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.xa[t.currentUser.toKey()];r||(r=new ue(z)),r=r.insert(e,n),t.xa[t.currentUser.toKey()]=r}(r,t.batchId,n),await Gu(r,t.changes),await za(r.remoteStore)}catch(t){const e=ru(t,"Failed to persist write");n.reject(e)}}(await Ic(t),e,n))),n.promise}(Zc(t),e)}function Ul(t,e,n){const r=n.docs.get(e._key),i=new xl(t);return new bl(t,i,e._key,r,new vl(n.hasPendingWrites,n.fromCache),e.converter)}const Bl={maxAttempts:5};class ql{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Ih(t)}set(t,e,n){this._verifyNotCommitted();const r=jl(t,this._firestore),i=yl(r.converter,e,n),s=Eh(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Dr.none())),this}update(t,e,n,...r){this._verifyNotCommitted();const i=jl(t,this._firestore);let s;return s="string"==typeof(e=Object(l.p)(e))||e instanceof fh?kh(this._dataReader,"WriteBatch.update",i._key,e,n,r):Nh(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(s.toMutation(i._key,Dr.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=jl(t,this._firestore);return this._mutations=this._mutations.concat(new Br(e._key,Dr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function jl(t,e){if((t=Object(l.p)(t)).firestore!==e)throw new N(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class zl extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Ih(t)}get(t){const e=jl(t,this._firestore),n=new wl(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return S();const r=t[0];if(r.isFoundDocument())return new jh(this._firestore,n,r.key,r,e.converter);if(r.isNoDocument())return new jh(this._firestore,n,e._key,null,e.converter);throw S()}))}set(t,e,n){const r=jl(t,this._firestore),i=yl(r.converter,e,n),s=Eh(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(t,e,n,...r){const i=jl(t,this._firestore);let s;return s="string"==typeof(e=Object(l.p)(e))||e instanceof fh?kh(this._dataReader,"Transaction.update",i._key,e,n,r):Nh(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,s),this}delete(t){const e=jl(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=jl(t,this._firestore),n=new xl(this._firestore);return super.get(t).then((t=>new bl(this._firestore,n,e._key,t._document,new vl(!1,!1),e.converter)))}}function Kl(t,e,n){t=Mc(t,Xc);const r=Object.assign(Object.assign({},Bl),n);return function(t){if(t.maxAttempts<1)throw new N(C.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(t,e,n){const r=new k;return t.asyncQueue.enqueueAndForget((async()=>{const i=await Ec(t);new dc(t.asyncQueue,i,n,e,r).Xa()})),r.promise}(Zc(t),(n=>e(new zl(t,n))),r)}function Gl(){return new Th("deleteField")}function $l(){return new xh("serverTimestamp")}function Ql(...t){return new Dh("arrayUnion",t)}function Wl(...t){return new Ah("arrayRemove",t)}function Yl(t){return new Ch("increment",t)}new WeakMap;!function(t,e=!0){!function(t){b=t}(o.SDK_VERSION),Object(o._registerComponent)(new c.a("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new Xc(new M(t.getProvider("auth-internal")),new U(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new N(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xe(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Object(o.registerVersion)(f,"4.6.1",t),Object(o.registerVersion)(f,"4.6.1","esm2017")}()}).call(this,n(204),n(507).Buffer)},507:function(t,e,n){"use strict";(function(t){var r=n(508),o=n(509),c=n(510);function h(){return d.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function l(t,e){if(h()<e)throw new RangeError("Invalid typed array length");return d.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=d.prototype:(null===t&&(t=new d(e)),t.length=e),t}function d(t,e,n){if(!(d.TYPED_ARRAY_SUPPORT||this instanceof d))return new d(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return y(this,t)}return f(this,t,e,n)}function f(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);d.TYPED_ARRAY_SUPPORT?(t=e).__proto__=d.prototype:t=w(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!d.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|_(e,n),o=(t=l(t,r)).write(e,n);o!==r&&(t=t.slice(0,o));return t}(t,e,n):function(t,e){if(d.isBuffer(e)){var n=0|v(e.length);return 0===(t=l(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?l(t,0):w(t,e);if("Buffer"===e.type&&c(e.data))return w(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function m(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function y(t,e){if(m(e),t=l(t,e<0?0:0|v(e)),!d.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function w(t,e){var n=e.length<0?0:0|v(e.length);t=l(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}function v(t){if(t>=h())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+h().toString(16)+" bytes");return 0|t}function _(t,e){if(d.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Y(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return H(t).length;default:if(r)return Y(t).length;e=(""+e).toLowerCase(),r=!0}}function I(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return F(this,e,n);case"utf8":case"utf-8":return O(this,e,n);case"ascii":return M(this,e,n);case"latin1":case"binary":return L(this,e,n);case"base64":return R(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function E(b,t,e){var i=b[t];b[t]=b[e],b[e]=i}function T(t,e,n,r,o){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof e&&(e=d.from(e,r)),d.isBuffer(e))return 0===e.length?-1:S(t,e,n,r,o);if("number"==typeof e)return e&=255,d.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):S(t,[e],n,r,o);throw new TypeError("val must be string, number or Buffer")}function S(t,e,n,r,o){var i,c=1,h=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;c=2,h/=2,l/=2,n/=2}function d(t,i){return 1===c?t[i]:t.readUInt16BE(i*c)}if(o){var f=-1;for(i=n;i<h;i++)if(d(t,i)===d(e,-1===f?0:i-f)){if(-1===f&&(f=i),i-f+1===l)return f*c}else-1!==f&&(i-=i-f),f=-1}else for(n+l>h&&(n=h-l),i=n;i>=0;i--){for(var m=!0,y=0;y<l;y++)if(d(t,i+y)!==d(e,y)){m=!1;break}if(m)return i}return-1}function x(t,e,n,r){n=Number(n)||0;var o=t.length-n;r?(r=Number(r))>o&&(r=o):r=o;var c=e.length;if(c%2!=0)throw new TypeError("Invalid hex string");r>c/2&&(r=c/2);for(var i=0;i<r;++i){var h=parseInt(e.substr(2*i,2),16);if(isNaN(h))return i;t[n+i]=h}return i}function D(t,e,n,r){return J(Y(e,t.length-n),t,n,r)}function A(t,e,n,r){return J(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,n,r)}function C(t,e,n,r){return A(t,e,n,r)}function N(t,e,n,r){return J(H(e),t,n,r)}function k(t,e,n,r){return J(function(t,e){for(var n,r,o,c=[],i=0;i<t.length&&!((e-=2)<0);++i)r=(n=t.charCodeAt(i))>>8,o=n%256,c.push(o),c.push(r);return c}(e,t.length-n),t,n,r)}function R(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function O(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,c,h,l,d=t[i],f=null,m=d>239?4:d>223?3:d>191?2:1;if(i+m<=n)switch(m){case 1:d<128&&(f=d);break;case 2:128==(192&(o=t[i+1]))&&(l=(31&d)<<6|63&o)>127&&(f=l);break;case 3:o=t[i+1],c=t[i+2],128==(192&o)&&128==(192&c)&&(l=(15&d)<<12|(63&o)<<6|63&c)>2047&&(l<55296||l>57343)&&(f=l);break;case 4:o=t[i+1],c=t[i+2],h=t[i+3],128==(192&o)&&128==(192&c)&&128==(192&h)&&(l=(15&d)<<18|(63&o)<<12|(63&c)<<6|63&h)>65535&&l<1114112&&(f=l)}null===f?(f=65533,m=1):f>65535&&(f-=65536,r.push(f>>>10&1023|55296),f=56320|1023&f),r.push(f),i+=m}return function(t){var e=t.length;if(e<=P)return String.fromCharCode.apply(String,t);var n="",i=0;for(;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=P));return n}(r)}e.Buffer=d,e.SlowBuffer=function(t){+t!=t&&(t=0);return d.alloc(+t)},e.INSPECT_MAX_BYTES=50,d.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=h(),d.poolSize=8192,d._augment=function(t){return t.__proto__=d.prototype,t},d.from=function(t,e,n){return f(null,t,e,n)},d.TYPED_ARRAY_SUPPORT&&(d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0})),d.alloc=function(t,e,n){return function(t,e,n,r){return m(e),e<=0?l(t,e):void 0!==n?"string"==typeof r?l(t,e).fill(n,r):l(t,e).fill(n):l(t,e)}(null,t,e,n)},d.allocUnsafe=function(t){return y(null,t)},d.allocUnsafeSlow=function(t){return y(null,t)},d.isBuffer=function(b){return!(null==b||!b._isBuffer)},d.compare=function(a,b){if(!d.isBuffer(a)||!d.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var t=a.length,e=b.length,i=0,n=Math.min(t,e);i<n;++i)if(a[i]!==b[i]){t=a[i],e=b[i];break}return t<e?-1:e<t?1:0},d.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(t,e){if(!c(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return d.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=d.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var o=t[i];if(!d.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,r),r+=o.length}return n},d.byteLength=_,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<t;i+=2)E(this,i,i+1);return this},d.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<t;i+=4)E(this,i,i+3),E(this,i+1,i+2);return this},d.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<t;i+=8)E(this,i,i+7),E(this,i+1,i+6),E(this,i+2,i+5),E(this,i+3,i+4);return this},d.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?O(this,0,t):I.apply(this,arguments)},d.prototype.equals=function(b){if(!d.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===d.compare(this,b)},d.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},d.prototype.compare=function(t,e,n,r,o){if(!d.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),e<0||n>t.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&e>=n)return 0;if(r>=o)return-1;if(e>=n)return 1;if(this===t)return 0;for(var c=(o>>>=0)-(r>>>=0),h=(n>>>=0)-(e>>>=0),l=Math.min(c,h),f=this.slice(r,o),m=t.slice(e,n),i=0;i<l;++i)if(f[i]!==m[i]){c=f[i],h=m[i];break}return c<h?-1:h<c?1:0},d.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},d.prototype.indexOf=function(t,e,n){return T(this,t,e,n,!0)},d.prototype.lastIndexOf=function(t,e,n){return T(this,t,e,n,!1)},d.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var c=!1;;)switch(r){case"hex":return x(this,t,e,n);case"utf8":case"utf-8":return D(this,t,e,n);case"ascii":return A(this,t,e,n);case"latin1":case"binary":return C(this,t,e,n);case"base64":return N(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,n);default:if(c)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),c=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var P=4096;function M(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function L(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function F(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=e;i<n;++i)o+=W(t[i]);return o}function V(t,e,n){for(var r=t.slice(e,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function U(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function B(t,e,n,r,o,c){if(!d.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<c)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function j(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function z(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function K(t,e,n,r,o,c){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function G(t,e,n,r,c){return c||K(t,0,n,4),o.write(t,e,n,r,23,4),n+4}function $(t,e,n,r,c){return c||K(t,0,n,8),o.write(t,e,n,r,52,8),n+8}d.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),d.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=d.prototype;else{var o=e-t;n=new d(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+t]}return n},d.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||U(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r},d.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||U(t,e,this.length);for(var r=this[t+--e],o=1;e>0&&(o*=256);)r+=this[t+--e]*o;return r},d.prototype.readUInt8=function(t,e){return e||U(t,1,this.length),this[t]},d.prototype.readUInt16LE=function(t,e){return e||U(t,2,this.length),this[t]|this[t+1]<<8},d.prototype.readUInt16BE=function(t,e){return e||U(t,2,this.length),this[t]<<8|this[t+1]},d.prototype.readUInt32LE=function(t,e){return e||U(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},d.prototype.readUInt32BE=function(t,e){return e||U(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},d.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||U(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*e)),r},d.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||U(t,e,this.length);for(var i=e,r=1,o=this[t+--i];i>0&&(r*=256);)o+=this[t+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*e)),o},d.prototype.readInt8=function(t,e){return e||U(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},d.prototype.readInt16LE=function(t,e){e||U(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},d.prototype.readInt16BE=function(t,e){e||U(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},d.prototype.readInt32LE=function(t,e){return e||U(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},d.prototype.readInt32BE=function(t,e){return e||U(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},d.prototype.readFloatLE=function(t,e){return e||U(t,4,this.length),o.read(this,t,!0,23,4)},d.prototype.readFloatBE=function(t,e){return e||U(t,4,this.length),o.read(this,t,!1,23,4)},d.prototype.readDoubleLE=function(t,e){return e||U(t,8,this.length),o.read(this,t,!0,52,8)},d.prototype.readDoubleBE=function(t,e){return e||U(t,8,this.length),o.read(this,t,!1,52,8)},d.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||B(this,t,e,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[e]=255&t;++i<n&&(o*=256);)this[e+i]=t/o&255;return e+n},d.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||B(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},d.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||B(this,t,e,1,255,0),d.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},d.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||B(this,t,e,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):j(this,t,e,!0),e+2},d.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||B(this,t,e,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):j(this,t,e,!1),e+2},d.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||B(this,t,e,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):z(this,t,e,!0),e+4},d.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||B(this,t,e,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):z(this,t,e,!1),e+4},d.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);B(this,t,e,n,o-1,-o)}var i=0,c=1,sub=0;for(this[e]=255&t;++i<n&&(c*=256);)t<0&&0===sub&&0!==this[e+i-1]&&(sub=1),this[e+i]=(t/c>>0)-sub&255;return e+n},d.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);B(this,t,e,n,o-1,-o)}var i=n-1,c=1,sub=0;for(this[e+i]=255&t;--i>=0&&(c*=256);)t<0&&0===sub&&0!==this[e+i+1]&&(sub=1),this[e+i]=(t/c>>0)-sub&255;return e+n},d.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||B(this,t,e,1,127,-128),d.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},d.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||B(this,t,e,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):j(this,t,e,!0),e+2},d.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||B(this,t,e,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):j(this,t,e,!1),e+2},d.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||B(this,t,e,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):z(this,t,e,!0),e+4},d.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||B(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),d.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):z(this,t,e,!1),e+4},d.prototype.writeFloatLE=function(t,e,n){return G(this,t,e,!0,n)},d.prototype.writeFloatBE=function(t,e,n){return G(this,t,e,!1,n)},d.prototype.writeDoubleLE=function(t,e,n){return $(this,t,e,!0,n)},d.prototype.writeDoubleBE=function(t,e,n){return $(this,t,e,!1,n)},d.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!d.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},d.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var code=t.charCodeAt(0);code<256&&(t=code)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!d.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var i;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(i=e;i<n;++i)this[i]=t;else{var o=d.isBuffer(t)?t:Y(new d(t,r).toString()),c=o.length;for(i=0;i<n-e;++i)this[i+e]=o[i%c]}return this};var Q=/[^+\/0-9A-Za-z-_]/g;function W(t){return t<16?"0"+t.toString(16):t.toString(16)}function Y(t,e){var n;e=e||1/0;for(var r=t.length,o=null,c=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!o){if(n>56319){(e-=3)>-1&&c.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&c.push(239,191,189);continue}o=n;continue}if(n<56320){(e-=3)>-1&&c.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(e-=3)>-1&&c.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;c.push(n)}else if(n<2048){if((e-=2)<0)break;c.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;c.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;c.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return c}function H(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(Q,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function J(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(73))},508:function(t,e,n){"use strict";e.byteLength=function(t){var e=l(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,i,n=l(t),r=n[0],h=n[1],d=new c(function(t,e,n){return 3*(e+n)/4-n}(0,r,h)),f=0,m=h>0?r-4:r;for(i=0;i<m;i+=4)e=o[t.charCodeAt(i)]<<18|o[t.charCodeAt(i+1)]<<12|o[t.charCodeAt(i+2)]<<6|o[t.charCodeAt(i+3)],d[f++]=e>>16&255,d[f++]=e>>8&255,d[f++]=255&e;2===h&&(e=o[t.charCodeAt(i)]<<2|o[t.charCodeAt(i+1)]>>4,d[f++]=255&e);1===h&&(e=o[t.charCodeAt(i)]<<10|o[t.charCodeAt(i+1)]<<4|o[t.charCodeAt(i+2)]>>2,d[f++]=e>>8&255,d[f++]=255&e);return d},e.fromByteArray=function(t){for(var e,n=t.length,o=n%3,c=[],h=16383,i=0,l=n-o;i<l;i+=h)c.push(d(t,i,i+h>l?l:i+h));1===o?(e=t[n-1],c.push(r[e>>2]+r[e<<4&63]+"==")):2===o&&(e=(t[n-2]<<8)+t[n-1],c.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return c.join("")};for(var r=[],o=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,h=code.length;i<h;++i)r[i]=code[i],o[code.charCodeAt(i)]=i;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function d(t,e,n){for(var o,c,output=[],i=e;i<n;i+=3)o=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(255&t[i+2]),output.push(r[(c=o)>>18&63]+r[c>>12&63]+r[c>>6&63]+r[63&c]);return output.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},509:function(t,e){e.read=function(t,e,n,r,o){var c,h,l=8*o-r-1,d=(1<<l)-1,f=d>>1,m=-7,i=n?o-1:0,y=n?-1:1,s=t[e+i];for(i+=y,c=s&(1<<-m)-1,s>>=-m,m+=l;m>0;c=256*c+t[e+i],i+=y,m-=8);for(h=c&(1<<-m)-1,c>>=-m,m+=r;m>0;h=256*h+t[e+i],i+=y,m-=8);if(0===c)c=1-f;else{if(c===d)return h?NaN:1/0*(s?-1:1);h+=Math.pow(2,r),c-=f}return(s?-1:1)*h*Math.pow(2,c-r)},e.write=function(t,e,n,r,o,c){var h,l,d,f=8*c-o-1,m=(1<<f)-1,y=m>>1,rt=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,i=r?0:c-1,w=r?1:-1,s=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,h=m):(h=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-h))<1&&(h--,d*=2),(e+=h+y>=1?rt/d:rt*Math.pow(2,1-y))*d>=2&&(h++,d/=2),h+y>=m?(l=0,h=m):h+y>=1?(l=(e*d-1)*Math.pow(2,o),h+=y):(l=e*Math.pow(2,y-1)*Math.pow(2,o),h=0));o>=8;t[n+i]=255&l,i+=w,l/=256,o-=8);for(h=h<<o|l,f+=o;f>0;t[n+i]=255&h,i+=w,h/=256,f-=8);t[n+i-w]|=128*s}},510:function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},511:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return _r})),n.d(e,"b",(function(){return Er})),n.d(e,"c",(function(){return Ir})),n.d(e,"d",(function(){return Sr})),n.d(e,"e",(function(){return Cr})),n.d(e,"f",(function(){return Ar})),n.d(e,"g",(function(){return Tr})),n.d(e,"h",(function(){return xr})),n.d(e,"i",(function(){return Dr})),n.d(e,"j",(function(){return wr})),n.d(e,"k",(function(){return vr}));var r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},c={},h=h||{},l=o||self;function d(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var f="closure_uid_"+(1e9*Math.random()>>>0),m=0;function y(a,b,t){return a.call.apply(a.bind,arguments)}function w(a,b,t){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,e),a.apply(b,t)}}return function(){return a.apply(b,arguments)}}function q(a,b,t){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:w).apply(null,arguments)}function v(a,b){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),a.apply(this,e)}}function _(a,b){function t(){}t.prototype=b.prototype,a.$=b.prototype,a.prototype=new t,a.prototype.constructor=a,a.ac=function(t,e,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return b.prototype[e].apply(t,r)}}function I(){this.s=this.s,this.o=this.o}I.prototype.s=!1,I.prototype.sa=function(){var a;!this.s&&(this.s=!0,this.N(),0)&&(a=this,Object.prototype.hasOwnProperty.call(a,f)&&a[f]||(a[f]=++m))},I.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const E=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(let t=0;t<a.length;t++)if(t in a&&a[t]===b)return t;return-1};function T(a){const b=a.length;if(0<b){const t=Array(b);for(let e=0;e<b;e++)t[e]=a[e];return t}return[]}function S(a,b){for(let t=1;t<arguments.length;t++){const e=arguments[t];if(d(e)){const t=a.length||0,n=e.length||0;a.length=t+n;for(let r=0;r<n;r++)a[t+r]=e[r]}else a.push(e)}}function x(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}x.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const t=()=>{};l.addEventListener("test",t,b),l.removeEventListener("test",t,b)}catch(t){}return a}();function A(a){return/^[\s\xa0]*$/.test(a)}function C(){var a=l.navigator;return a&&(a=a.userAgent)?a:""}function N(a){return-1!=C().indexOf(a)}function k(a){return k[" "](a),a}k[" "]=function(){};var R,a,O,P=N("Opera"),M=N("Trident")||N("MSIE"),L=N("Edge"),F=L||M,V=N("Gecko")&&!(-1!=C().toLowerCase().indexOf("webkit")&&!N("Edge"))&&!(N("Trident")||N("MSIE"))&&!N("Edge"),U=-1!=C().toLowerCase().indexOf("webkit")&&!N("Edge");function B(){var a=l.document;return a?a.documentMode:void 0}t:{var j="",z=(a=C(),V?/rv:([^\);]+)(\)|;)/.exec(a):L?/Edge\/([\d\.]+)/.exec(a):M?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):U?/WebKit\/(\S+)/.exec(a):P?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(z&&(j=z?z[1]:""),M){var K=B();if(null!=K&&K>parseFloat(j)){R=String(K);break t}}R=j}if(l.document&&M){var G=B();O=G||(parseInt(R,10)||void 0)}else O=void 0;var $=O;function Q(a,b){if(x.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var t=this.type=a.type,e=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(V){t:{try{k(b.nodeName);var n=!0;break t}catch(t){}n=!1}n||(b=null)}}else"mouseover"==t?b=a.fromElement:"mouseout"==t&&(b=a.toElement);this.relatedTarget=b,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:W[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Q.$.h.call(this)}}_(Q,x);var W={2:"touch",3:"pen",4:"mouse"};Q.prototype.h=function(){Q.$.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Y="closure_listenable_"+(1e6*Math.random()|0),H=0;function J(a,b,t,e,n){this.listener=a,this.proxy=null,this.src=b,this.type=t,this.capture=!!e,this.la=n,this.key=++H,this.fa=this.ia=!1}function X(a){a.fa=!0,a.listener=null,a.proxy=null,a.src=null,a.la=null}function Z(a,b,t){for(const e in a)b.call(t,a[e],e,a)}function tt(a){const b={};for(const t in a)b[t]=a[t];return b}const et="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function nt(a,b){let t,e;for(let n=1;n<arguments.length;n++){for(t in e=arguments[n],e)a[t]=e[t];for(let n=0;n<et.length;n++)t=et[n],Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}}function it(a){this.src=a,this.g={},this.h=0}function st(a,b){var t=b.type;if(t in a.g){var e,n=a.g[t],r=E(n,b);(e=0<=r)&&Array.prototype.splice.call(n,r,1),e&&(X(b),0==a.g[t].length&&(delete a.g[t],a.h--))}}function ot(a,b,t,e){for(var n=0;n<a.length;++n){var r=a[n];if(!r.fa&&r.listener==b&&r.capture==!!t&&r.la==e)return n}return-1}it.prototype.add=function(a,b,t,e,n){var r=a.toString();(a=this.g[r])||(a=this.g[r]=[],this.h++);var o=ot(a,b,e,n);return-1<o?(b=a[o],t||(b.ia=!1)):((b=new J(b,this.src,r,!!e,n)).ia=t,a.push(b)),b};var at="closure_lm_"+(1e6*Math.random()|0),ut={};function ct(a,b,t,e,n){if(e&&e.once)return lt(a,b,t,e,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)ct(a,b[r],t,e,n);return null}return t=vt(t),a&&a[Y]?a.O(b,t,p(e)?!!e.capture:!!e,n):ht(a,b,t,!1,e,n)}function ht(a,b,t,e,n,r){if(!b)throw Error("Invalid event type");var o=p(n)?!!n.capture:!!n,c=yt(a);if(c||(a[at]=c=new it(a)),(t=c.add(b,t,e,o,r)).proxy)return t;if(e=function(){function a(t){return b.call(a.src,a.listener,t)}const b=pt;return a}(),t.proxy=e,e.src=a,e.listener=t,a.addEventListener)D||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),e,n);else if(a.attachEvent)a.attachEvent(mt(b.toString()),e);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(e)}return t}function lt(a,b,t,e,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)lt(a,b[r],t,e,n);return null}return t=vt(t),a&&a[Y]?a.P(b,t,p(e)?!!e.capture:!!e,n):ht(a,b,t,!0,e,n)}function ft(a,b,t,e,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)ft(a,b[r],t,e,n);else e=p(e)?!!e.capture:!!e,t=vt(t),a&&a[Y]?(a=a.i,(b=String(b).toString())in a.g&&(-1<(t=ot(r=a.g[b],t,e,n))&&(X(r[t]),Array.prototype.splice.call(r,t,1),0==r.length&&(delete a.g[b],a.h--)))):a&&(a=yt(a))&&(b=a.g[b.toString()],a=-1,b&&(a=ot(b,t,e,n)),(t=-1<a?b[a]:null)&&gt(t))}function gt(a){if("number"!=typeof a&&a&&!a.fa){var b=a.src;if(b&&b[Y])st(b.i,a);else{var t=a.type,e=a.proxy;b.removeEventListener?b.removeEventListener(t,e,a.capture):b.detachEvent?b.detachEvent(mt(t),e):b.addListener&&b.removeListener&&b.removeListener(e),(t=yt(b))?(st(t,a),0==t.h&&(t.src=null,b[at]=null)):X(a)}}}function mt(a){return a in ut?ut[a]:ut[a]="on"+a}function pt(a,b){if(a.fa)a=!0;else{b=new Q(b,this);var t=a.listener,e=a.la||a.src;a.ia&&gt(a),a=t.call(e,b)}return a}function yt(a){return(a=a[at])instanceof it?a:null}var wt="__closure_events_fn_"+(1e9*Math.random()>>>0);function vt(a){return"function"==typeof a?a:(a[wt]||(a[wt]=function(b){return a.handleEvent(b)}),a[wt])}function bt(){I.call(this),this.i=new it(this),this.S=this,this.J=null}function _t(a,b){var t,e=a.J;if(e)for(t=[];e;e=e.J)t.push(e);if(a=a.S,e=b.type||b,"string"==typeof b)b=new x(b,a);else if(b instanceof x)b.target=b.target||a;else{var n=b;nt(b=new x(e,a),n)}if(n=!0,t)for(var r=t.length-1;0<=r;r--){var o=b.g=t[r];n=It(o,e,!0,b)&&n}if(n=It(o=b.g=a,e,!0,b)&&n,n=It(o,e,!1,b)&&n,t)for(r=0;r<t.length;r++)n=It(o=b.g=t[r],e,!1,b)&&n}function It(a,b,t,e){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.fa&&o.capture==t){var c=o.listener,h=o.la||o.src;o.ia&&st(a.i,o),n=!1!==c.call(h,e)&&n}}return n&&!e.defaultPrevented}_(bt,I),bt.prototype[Y]=!0,bt.prototype.removeEventListener=function(a,b,t,e){ft(this,a,b,t,e)},bt.prototype.N=function(){if(bt.$.N.call(this),this.i){var t,a=this.i;for(t in a.g){for(var e=a.g[t],n=0;n<e.length;n++)X(e[n]);delete a.g[t],a.h--}}this.J=null},bt.prototype.O=function(a,b,t,e){return this.i.add(String(a),b,!1,t,e)},bt.prototype.P=function(a,b,t,e){return this.i.add(String(a),b,!0,t,e)};var Et=l.JSON.stringify;function Tt(){var a=kt;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var St=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new xt),(a=>a.reset()));class xt{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}function Dt(a){var b=1;a=a.split(":");const t=[];for(;0<b&&a.length;)t.push(a.shift()),b--;return a.length&&t.push(a.join(":")),t}function At(a){l.setTimeout((()=>{throw a}),0)}let Ct,Nt=!1,kt=new class{constructor(){this.h=this.g=null}add(a,b){const t=St.get();t.set(a,b),this.h?this.h.next=t:this.g=t,this.h=t}},Rt=()=>{const a=l.Promise.resolve(void 0);Ct=()=>{a.then(Ot)}};var Ot=()=>{for(var a;a=Tt();){try{a.h.call(a.g)}catch(t){At(t)}var b=St;b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}Nt=!1};function Pt(a,b){bt.call(this),this.h=a||1,this.g=b||l,this.j=q(this.qb,this),this.l=Date.now()}function Mt(a){a.ga=!1,a.T&&(a.g.clearTimeout(a.T),a.T=null)}function Lt(a,b,t){if("function"==typeof a)t&&(a=q(a,t));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function Ft(a){a.g=Lt((()=>{a.g=null,a.i&&(a.i=!1,Ft(a))}),a.j);const b=a.h;a.h=null,a.m.apply(null,b)}_(Pt,bt),(r=Pt.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-a):(this.T&&(this.g.clearTimeout(this.T),this.T=null),_t(this,"tick"),this.ga&&(Mt(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){Pt.$.N.call(this),Mt(this),delete this.g};class Vt extends I{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:Ft(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ut(a){I.call(this),this.h=a,this.g={}}_(Ut,I);var Bt=[];function qt(a,b,t,e){Array.isArray(t)||(t&&(Bt[0]=t.toString()),t=Bt);for(var n=0;n<t.length;n++){var r=ct(b,t[n],e||a.handleEvent,!1,a.h||a);if(!r)break;a.g[r.key]=r}}function jt(a){Z(a.g,(function(b,t){this.g.hasOwnProperty(t)&&gt(b)}),a),a.g={}}function zt(){this.g=!0}function Kt(a,b,t,e){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.g)return b;if(!b)return null;try{var t=JSON.parse(b);if(t)for(a=0;a<t.length;a++)if(Array.isArray(t[a])){var e=t[a];if(!(2>e.length)){var n=e[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return Et(t)}catch(t){return b}}(a,t)+(e?" "+e:"")}))}Ut.prototype.N=function(){Ut.$.N.call(this),jt(this)},Ut.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},zt.prototype.Ea=function(){this.g=!1},zt.prototype.info=function(){};var Gt={},$t=null;function Qt(){return $t=$t||new bt}function Wt(a){x.call(this,Gt.Ta,a)}function Yt(a){const b=Qt();_t(b,new Wt(b))}function Ht(a,b){x.call(this,Gt.STAT_EVENT,a),this.stat=b}function Jt(a){const b=Qt();_t(b,new Ht(b,a))}function Xt(a,b){x.call(this,Gt.Ua,a),this.size=b}function Zt(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){a()}),b)}Gt.Ta="serverreachability",_(Wt,x),Gt.STAT_EVENT="statevent",_(Ht,x),Gt.Ua="timingevent",_(Xt,x);var te={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ee={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ne(){}function re(a){return a.h||(a.h=a.i())}function ie(){}ne.prototype.h=null;var se,oe={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ae(){x.call(this,"d")}function ue(){x.call(this,"c")}function ce(){}function he(a,b,t,e){this.l=a,this.j=b,this.m=t,this.W=e||1,this.U=new Ut(this),this.P=de,a=F?125:void 0,this.V=new Pt(a),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new le}function le(){this.i=null,this.g="",this.h=!1}_(ae,x),_(ue,x),_(ce,ne),ce.prototype.g=function(){return new XMLHttpRequest},ce.prototype.i=function(){return{}},se=new ce;var de=45e3,fe={},ge={};function me(a,b,t){a.L=1,a.A=Pe(Ce(b)),a.u=t,a.S=!0,pe(a,null)}function pe(a,b){a.G=Date.now(),be(a),a.B=Ce(a.A);var t=a.B,e=a.W;Array.isArray(e)||(e=[String(e)]),Qe(t.i,"t",e),a.o=0,t=a.l.J,a.h=new le,a.g=Kn(a.l,t?b:null,!a.u),0<a.O&&(a.M=new Vt(q(a.Pa,a,a.g),a.O)),qt(a.U,a.g,"readystatechange",a.nb),b=a.I?tt(a.I):{},a.u?(a.v||(a.v="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ha(a.B,a.v,a.u,b)):(a.v="GET",a.g.ha(a.B,a.v,null,b)),Yt(),function(a,b,t,e,n,r){a.info((function(){if(a.g)if(r)for(var o="",c=r.split("&"),h=0;h<c.length;h++){var l=c[h].split("=");if(1<l.length){var u=l[0];l=l[1];var d=u.split("_");o=2<=d.length&&"type"==d[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+e+") [attempt "+n+"]: "+b+"\n"+t+"\n"+o}))}(a.j,a.v,a.B,a.m,a.W,a.u)}function ye(a){return!!a.g&&("GET"==a.v&&2!=a.L&&a.l.Ha)}function we(a,b,t){let e,n=!0;for(;!a.J&&a.o<t.length;){if(e=ve(a,t),e==ge){4==b&&(a.s=4,Jt(14),n=!1),Kt(a.j,a.m,null,"[Incomplete Response]");break}if(e==fe){a.s=4,Jt(15),Kt(a.j,a.m,t,"[Invalid Chunk]"),n=!1;break}Kt(a.j,a.m,e,null),Se(a,e)}ye(a)&&0!=a.o&&(a.h.g=a.h.g.slice(a.o),a.o=0),4!=b||0!=t.length||a.h.h||(a.s=1,Jt(16),n=!1),a.i=a.i&&n,n?0<t.length&&!a.ba&&(a.ba=!0,(b=a.l).g==a&&b.ca&&!b.M&&(b.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Ln(b),b.M=!0,Jt(11))):(Kt(a.j,a.m,t,"[Invalid Chunked Response]"),Te(a),Ee(a))}function ve(a,b){var t=a.o,e=b.indexOf("\n",t);return-1==e?ge:(t=Number(b.substring(t,e)),isNaN(t)?fe:(e+=1)+t>b.length?ge:(b=b.slice(e,e+t),a.o=e+t,b))}function be(a){a.Y=Date.now()+a.P,_e(a,a.P)}function _e(a,b){if(null!=a.C)throw Error("WatchDog timer not null");a.C=Zt(q(a.lb,a),b)}function Ie(a){a.C&&(l.clearTimeout(a.C),a.C=null)}function Ee(a){0==a.l.H||a.J||Un(a.l,a)}function Te(a){Ie(a);var b=a.M;b&&"function"==typeof b.sa&&b.sa(),a.M=null,Mt(a.V),jt(a.U),a.g&&(b=a.g,a.g=null,b.abort(),b.sa())}function Se(a,b){try{var t=a.l;if(0!=t.H&&(t.g==a||Xe(t.i,a)))if(!a.K&&Xe(t.i,a)&&3==t.H){try{var e=t.Ja.g.parse(b)}catch(t){e=null}if(Array.isArray(e)&&3==e.length){var n=e;if(0==n[0]){t:if(!t.u){if(t.g){if(!(t.g.G+3e3<a.G))break t;Vn(t),An(t)}Mn(t),Jt(18)}}else t.Fa=n[1],0<t.Fa-t.V&&37500>n[2]&&t.G&&0==t.A&&!t.v&&(t.v=Zt(q(t.ib,t),6e3));if(1>=Je(t.i)&&t.oa){try{t.oa()}catch(t){}t.oa=void 0}}else qn(t,11)}else if((a.K||t.g==a)&&Vn(t),!A(b))for(n=t.Ja.g.parse(b),b=0;b<n.length;b++){let l=n[b];if(t.V=l[0],l=l[1],2==t.H)if("c"==l[0]){t.K=l[1],t.pa=l[2];const u=l[3];null!=u&&(t.ra=u,t.l.info("VER="+t.ra));const n=l[4];null!=n&&(t.Ga=n,t.l.info("SVER="+t.Ga));const d=l[5];null!=d&&"number"==typeof d&&0<d&&(e=1.5*d,t.L=e,t.l.info("backChannelRequestTimeoutMs_="+e)),e=t;const f=a.g;if(f){const t=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=e.i;r.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(Ze(r,r.h),r.h=null))}if(e.F){const t=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(e.Da=t,Oe(e.I,e.F,t))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-a.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=a;if((e=t).wa=zn(e,e.J?e.pa:null,e.Y),o.K){tn(e.i,o);var c=o,h=e.L;h&&c.setTimeout(h),c.C&&(Ie(c),be(c)),e.g=o}else Pn(e);0<t.j.length&&Nn(t)}else"stop"!=l[0]&&"close"!=l[0]||qn(t,7);else 3==t.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?qn(t,7):Dn(t):"noop"!=l[0]&&t.h&&t.h.Aa(l),t.A=0)}Yt()}catch(t){}}function xe(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(d(a)||"string"==typeof a)Array.prototype.forEach.call(a,b,void 0);else for(var t=function(a){if(a.ta&&"function"==typeof a.ta)return a.ta();if(!a.Z||"function"!=typeof a.Z){if("undefined"!=typeof Map&&a instanceof Map)return Array.from(a.keys());if(!("undefined"!=typeof Set&&a instanceof Set)){if(d(a)||"string"==typeof a){var b=[];a=a.length;for(var t=0;t<a;t++)b.push(t);return b}b=[],t=0;for(const e in a)b[t++]=e;return b}}}(a),e=function(a){if(a.Z&&"function"==typeof a.Z)return a.Z();if("undefined"!=typeof Map&&a instanceof Map||"undefined"!=typeof Set&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(d(a)){for(var b=[],t=a.length,e=0;e<t;e++)b.push(a[e]);return b}for(e in b=[],t=0,a)b[t++]=a[e];return b}(a),n=e.length,r=0;r<n;r++)b.call(void 0,e[r],t&&t[r],a)}(r=he.prototype).setTimeout=function(a){this.P=a},r.nb=function(a){a=a.target;const b=this.M;b&&3==_n(a)?b.l():this.Pa(a)},r.Pa=function(a){try{if(a==this.g)t:{const u=_n(this.g);var b=this.g.Ia();this.g.da();if(!(3>u)&&(3!=u||F||this.g&&(this.h.h||this.g.ja()||In(this.g)))){this.J||4!=u||7==b||Yt(),Ie(this);var t=this.g.da();this.ca=t;e:if(ye(this)){var e=In(this.g);a="";var n=e.length,r=4==_n(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Te(this),Ee(this);var o="";break e}this.h.i=new l.TextDecoder}for(b=0;b<n;b++)this.h.h=!0,a+=this.h.i.decode(e[b],{stream:r&&b==n-1});e.length=0,this.h.g+=a,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function(a,b,t,e,n,r,o){a.info((function(){return"XMLHTTP RESP ("+e+") [ attempt "+n+"]: "+b+"\n"+t+"\n"+r+" "+o}))}(this.j,this.v,this.B,this.m,this.W,u,t),this.i){if(this.aa&&!this.K){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(c)){var d=c;break e}}d=null}if(!(t=d)){this.i=!1,this.s=3,Jt(12),Te(this),Ee(this);break t}Kt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Se(this,t)}this.S?(we(this,u,o),F&&this.i&&3==u&&(qt(this.U,this.V,"tick",this.mb),this.V.start())):(Kt(this.j,this.m,o,null),Se(this,o)),4==u&&Te(this),this.i&&!this.J&&(4==u?Un(this.l,this):(this.i=!1,be(this)))}else(function(a){const b={};a=(a.g&&2<=_n(a)&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let e=0;e<a.length;e++){if(A(a[e]))continue;var t=Dt(a[e]);const n=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const r=b[n]||[];b[n]=r,r.push(t)}!function(a,b){for(const t in a)b.call(void 0,a[t],t,a)}(b,(function(t){return t.join(", ")}))})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.s=3,Jt(12)):(this.s=0,Jt(13)),Te(this),Ee(this)}}}catch(t){}},r.mb=function(){if(this.g){var a=_n(this.g),b=this.g.ja();this.o<b.length&&(Ie(this),we(this,a,b),this.i&&4!=a&&be(this))}},r.cancel=function(){this.J=!0,Te(this)},r.lb=function(){this.C=null;const a=Date.now();0<=a-this.Y?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.j,this.B),2!=this.L&&(Yt(),Jt(17)),Te(this),this.s=2,Ee(this)):_e(this,this.Y-a)};var De=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ae(a){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,a instanceof Ae){this.h=a.h,Ne(this,a.j),this.s=a.s,this.g=a.g,ke(this,a.m),this.l=a.l;var b=a.i,t=new ze;t.i=b.i,b.g&&(t.g=new Map(b.g),t.h=b.h),Re(this,t),this.o=a.o}else a&&(b=String(a).match(De))?(this.h=!1,Ne(this,b[1]||"",!0),this.s=Me(b[2]||""),this.g=Me(b[3]||"",!0),ke(this,b[4]),this.l=Me(b[5]||"",!0),Re(this,b[6]||"",!0),this.o=Me(b[7]||"")):(this.h=!1,this.i=new ze(null,this.h))}function Ce(a){return new Ae(a)}function Ne(a,b,t){a.j=t?Me(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function ke(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function Re(a,b,t){b instanceof ze?(a.i=b,function(a,b){b&&!a.j&&(Ke(a),a.i=null,a.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Ge(this,e),Qe(this,n,t))}),a)),a.j=b}(a.i,a.h)):(t||(b=Le(b,qe)),a.i=new ze(b,a.h))}function Oe(a,b,t){a.i.set(b,t)}function Pe(a){return Oe(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Me(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Le(a,b,t){return"string"==typeof a?(a=encodeURI(a).replace(b,Fe),t&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Fe(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Ae.prototype.toString=function(){var a=[],b=this.j;b&&a.push(Le(b,Ve,!0),":");var t=this.g;return(t||"file"==b)&&(a.push("//"),(b=this.s)&&a.push(Le(b,Ve,!0),"@"),a.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&a.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&a.push("/"),a.push(Le(t,"/"==t.charAt(0)?Be:Ue,!0))),(t=this.i.toString())&&a.push("?",t),(t=this.o)&&a.push("#",Le(t,je)),a.join("")};var Ve=/[#\/\?@]/g,Ue=/[#\?:]/g,Be=/[#\?]/g,qe=/[#\?@]/g,je=/#/g;function ze(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function Ke(a){a.g||(a.g=new Map,a.h=0,a.i&&function(a,b){if(a){a=a.split("&");for(var t=0;t<a.length;t++){var e=a[t].indexOf("="),n=null;if(0<=e){var r=a[t].substring(0,e);n=a[t].substring(e+1)}else r=a[t];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.i,(function(b,t){a.add(decodeURIComponent(b.replace(/\+/g," ")),t)})))}function Ge(a,b){Ke(a),b=We(a,b),a.g.has(b)&&(a.i=null,a.h-=a.g.get(b).length,a.g.delete(b))}function $e(a,b){return Ke(a),b=We(a,b),a.g.has(b)}function Qe(a,b,t){Ge(a,b),0<t.length&&(a.i=null,a.g.set(We(a,b),T(t)),a.h+=t.length)}function We(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}(r=ze.prototype).add=function(a,b){Ke(this),this.i=null,a=We(this,a);var t=this.g.get(a);return t||this.g.set(a,t=[]),t.push(b),this.h+=1,this},r.forEach=function(a,b){Ke(this),this.g.forEach((function(t,e){t.forEach((function(t){a.call(b,t,e,this)}),this)}),this)},r.ta=function(){Ke(this);const a=Array.from(this.g.values()),b=Array.from(this.g.keys()),t=[];for(let e=0;e<b.length;e++){const n=a[e];for(let r=0;r<n.length;r++)t.push(b[e])}return t},r.Z=function(a){Ke(this);let b=[];if("string"==typeof a)$e(this,a)&&(b=b.concat(this.g.get(We(this,a))));else{a=Array.from(this.g.values());for(let t=0;t<a.length;t++)b=b.concat(a[t])}return b},r.set=function(a,b){return Ke(this),this.i=null,$e(this,a=We(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},r.get=function(a,b){return a&&0<(a=this.Z(a)).length?String(a[0]):b},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],b=Array.from(this.g.keys());for(var t=0;t<b.length;t++){var e=b[t];const r=encodeURIComponent(String(e)),o=this.Z(e);for(e=0;e<o.length;e++){var n=r;""!==o[e]&&(n+="="+encodeURIComponent(String(o[e]))),a.push(n)}}return this.i=a.join("&")};function Ye(a){this.l=a||dd,l.PerformanceNavigationTiming?a=0<(a=l.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(l.g&&l.g.Ka&&l.g.Ka()&&l.g.Ka().dc),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var dd=10;function He(a){return!!a.h||!!a.g&&a.g.size>=a.j}function Je(a){return a.h?1:a.g?a.g.size:0}function Xe(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function Ze(a,b){a.g?a.g.add(b):a.h=b}function tn(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function en(a){if(null!=a.h)return a.i.concat(a.h.F);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const t of a.g.values())b=b.concat(t.F);return b}return T(a.i)}Ye.prototype.cancel=function(){if(this.i=en(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};function nn(){this.g=new class{stringify(a){return l.JSON.stringify(a,void 0)}parse(a){return l.JSON.parse(a,void 0)}}}function rn(a,b,t){const e=t||"";try{xe(a,(function(t,n){let r=t;p(t)&&(r=Et(t)),b.push(e+n+"="+encodeURIComponent(r))}))}catch(t){throw b.push(e+"type="+encodeURIComponent("_badmap")),t}}function sn(a,b,t,e,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(e)}catch(t){}}function on(a){this.l=a.ec||null,this.j=a.ob||!1}function an(a,b){bt.call(this),this.F=a,this.u=b,this.m=void 0,this.readyState=un,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_(on,ne),on.prototype.g=function(){return new an(this.l,this.j)},on.prototype.i=function(a){return function(){return a}}({}),_(an,bt);var un=0;function cn(a){a.j.read().then(a.Xa.bind(a)).catch(a.ka.bind(a))}function hn(a){a.readyState=4,a.l=null,a.j=null,a.A=null,ln(a)}function ln(a){a.onreadystatechange&&a.onreadystatechange.call(a)}(r=an.prototype).open=function(a,b){if(this.readyState!=un)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,ln(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.F||l).fetch(new Request(this.B,b)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,hn(this)),this.readyState=un},r.$a=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ln(this)),this.g&&(this.readyState=3,ln(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==l.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;cn(this)}else a.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?hn(this):ln(this),3==this.readyState&&cn(this)}},r.Za=function(a){this.g&&(this.response=this.responseText=a,hn(this))},r.Ya=function(a){this.g&&(this.response=a,hn(this))},r.ka=function(){this.g&&hn(this)},r.setRequestHeader=function(a,b){this.v.append(a,b)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var t=b.next();!t.done;)t=t.value,a.push(t[0]+": "+t[1]),t=b.next();return a.join("\r\n")},Object.defineProperty(an.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var dn=l.JSON.parse;function fn(a){bt.call(this),this.headers=new Map,this.u=a||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=gn,this.L=this.M=!1}_(fn,bt);var gn="",td=/^https?$/i,mn=["POST","PUT"];function pn(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,yn(a),vn(a)}function yn(a){a.F||(a.F=!0,_t(a,"complete"),_t(a,"error"))}function wn(a){if(a.h&&void 0!==h&&(!a.C[1]||4!=_n(a)||2!=a.da()))if(a.v&&4==_n(a))Lt(a.La,0,a);else if(_t(a,"readystatechange"),4==_n(a)){a.h=!1;try{const o=a.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break t;default:b=!1}var t;if(!(t=b)){var e;if(e=0===o){var n=String(a.I).match(De)[1]||null;!n&&l.self&&l.self.location&&(n=l.self.location.protocol.slice(0,-1)),e=!td.test(n?n.toLowerCase():"")}t=e}if(t)_t(a,"complete"),_t(a,"success");else{a.m=6;try{var r=2<_n(a)?a.g.statusText:""}catch(t){r=""}a.j=r+" ["+a.da()+"]",yn(a)}}finally{vn(a)}}}function vn(a,b){if(a.g){bn(a);const t=a.g,e=a.C[0]?()=>{}:null;a.g=null,a.C=null,b||_t(a,"ready");try{t.onreadystatechange=e}catch(t){}}}function bn(a){a.g&&a.L&&(a.g.ontimeout=null),a.A&&(l.clearTimeout(a.A),a.A=null)}function _n(a){return a.g?a.g.readyState:0}function In(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.K){case gn:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(t){return null}}function En(a){let b="";return Z(a,(function(t,e){b+=e,b+=":",b+=t,b+="\r\n"})),b}function Tn(a,b,t){t:{for(e in t){var e=!1;break t}e=!0}e||(t=En(t),"string"==typeof a?null!=t&&encodeURIComponent(String(t)):Oe(a,b,t))}function Sn(a,b,t){return t&&t.internalChannelParams&&t.internalChannelParams[a]||b}function xn(a){this.Ga=0,this.j=[],this.l=new zt,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Sn("failFast",!1,a),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Sn("baseRetryDelayMs",5e3,a),this.hb=Sn("retryDelaySeedMs",1e4,a),this.eb=Sn("forwardChannelMaxRetries",2,a),this.xa=Sn("forwardChannelRequestTimeoutMs",2e4,a),this.va=a&&a.xmlHttpFactory||void 0,this.Ha=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.i=new Ye(a&&a.concurrentRequestLimit),this.Ja=new nn,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=a&&a.bc||!1,a&&a.Ea&&this.l.Ea(),a&&a.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&a&&a.detectBufferingProxy||!1,this.qa=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.qa=a.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Dn(a){if(Cn(a),3==a.H){var b=a.W++,t=Ce(a.I);if(Oe(t,"SID",a.K),Oe(t,"RID",b),Oe(t,"TYPE","terminate"),Rn(a,t),(b=new he(a,a.l,b)).L=2,b.A=Pe(Ce(t)),t=!1,l.navigator&&l.navigator.sendBeacon)try{t=l.navigator.sendBeacon(b.A.toString(),"")}catch(t){}!t&&l.Image&&((new Image).src=b.A,t=!0),t||(b.g=Kn(b.l,null),b.g.ha(b.A)),b.G=Date.now(),be(b)}jn(a)}function An(a){a.g&&(Ln(a),a.g.cancel(),a.g=null)}function Cn(a){An(a),a.u&&(l.clearTimeout(a.u),a.u=null),Vn(a),a.i.cancel(),a.m&&("number"==typeof a.m&&l.clearTimeout(a.m),a.m=null)}function Nn(a){if(!He(a.i)&&!a.m){a.m=!0;var b=a.Na;Ct||Rt(),Nt||(Ct(),Nt=!0),kt.add(b,a),a.C=0}}function kn(a,b){var t;t=b?b.m:a.W++;const e=Ce(a.I);Oe(e,"SID",a.K),Oe(e,"RID",t),Oe(e,"AID",a.V),Rn(a,e),a.o&&a.s&&Tn(e,a.o,a.s),t=new he(a,a.l,t,a.C+1),null===a.o&&(t.I=a.s),b&&(a.j=b.F.concat(a.j)),b=On(a,t,1e3),t.setTimeout(Math.round(.5*a.xa)+Math.round(.5*a.xa*Math.random())),Ze(a.i,t),me(t,e,b)}function Rn(a,b){a.na&&Z(a.na,(function(t,e){Oe(b,e,t)})),a.h&&xe({},(function(t,e){Oe(b,e,t)}))}function On(a,b,t){t=Math.min(a.j.length,t);var e=a.h?q(a.h.Va,a.h,a):null;t:{var n=a.j;let r=-1;for(;;){const o=["count="+t];-1==r?0<t?(r=n[0].g,o.push("ofs="+r)):r=0:o.push("ofs="+r);let c=!0;for(let h=0;h<t;h++){let t=n[h].g;const u=n[h].map;if(t-=r,0>t)r=Math.max(0,n[h].g-100),c=!1;else try{rn(u,o,"req"+t+"_")}catch(t){e&&e(u)}}if(c){e=o.join("&");break t}}}return a=a.j.splice(0,t),b.F=a,e}function Pn(a){if(!a.g&&!a.u){a.ba=1;var b=a.Ma;Ct||Rt(),Nt||(Ct(),Nt=!0),kt.add(b,a),a.A=0}}function Mn(a){return!(a.g||a.u||3<=a.A)&&(a.ba++,a.u=Zt(q(a.Ma,a),Bn(a,a.A)),a.A++,!0)}function Ln(a){null!=a.B&&(l.clearTimeout(a.B),a.B=null)}function Fn(a){a.g=new he(a,a.l,"rpc",a.ba),null===a.o&&(a.g.I=a.s),a.g.O=0;var b=Ce(a.wa);Oe(b,"RID","rpc"),Oe(b,"SID",a.K),Oe(b,"AID",a.V),Oe(b,"CI",a.G?"0":"1"),!a.G&&a.qa&&Oe(b,"TO",a.qa),Oe(b,"TYPE","xmlhttp"),Rn(a,b),a.o&&a.s&&Tn(b,a.o,a.s),a.L&&a.g.setTimeout(a.L);var t=a.g;a=a.pa,t.L=1,t.A=Pe(Ce(b)),t.u=null,t.S=!0,pe(t,a)}function Vn(a){null!=a.v&&(l.clearTimeout(a.v),a.v=null)}function Un(a,b){var t=null;if(a.g==b){Vn(a),Ln(a),a.g=null;var e=2}else{if(!Xe(a.i,b))return;t=b.F,tn(a.i,b),e=1}if(0!=a.H)if(b.i)if(1==e){t=b.u?b.u.length:0,b=Date.now()-b.G;var n=a.C;_t(e=Qt(),new Xt(e,t)),Nn(a)}else Pn(a);else if(3==(n=b.s)||0==n&&0<b.ca||!(1==e&&function(a,b){return!(Je(a.i)>=a.i.j-(a.m?1:0)||(a.m?(a.j=b.F.concat(a.j),0):1==a.H||2==a.H||a.C>=(a.cb?0:a.eb)||(a.m=Zt(q(a.Na,a,b),Bn(a,a.C)),a.C++,0)))}(a,b)||2==e&&Mn(a)))switch(t&&0<t.length&&(b=a.i,b.i=b.i.concat(t)),n){case 1:qn(a,5);break;case 4:qn(a,10);break;case 3:qn(a,6);break;default:qn(a,2)}}function Bn(a,b){let t=a.ab+Math.floor(Math.random()*a.hb);return a.isActive()||(t*=2),t*b}function qn(a,b){if(a.l.info("Error code "+b),2==b){var t=null;a.h&&(t=null);var e=q(a.pb,a);t||(t=new Ae("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Ne(t,"https"),Pe(t)),function(a,b){const t=new zt;if(l.Image){const e=new Image;e.onload=v(sn,t,e,"TestLoadImage: loaded",!0,b),e.onerror=v(sn,t,e,"TestLoadImage: error",!1,b),e.onabort=v(sn,t,e,"TestLoadImage: abort",!1,b),e.ontimeout=v(sn,t,e,"TestLoadImage: timeout",!1,b),l.setTimeout((function(){e.ontimeout&&e.ontimeout()}),1e4),e.src=a}else b(!1)}(t.toString(),e)}else Jt(2);a.H=0,a.h&&a.h.za(b),jn(a),Cn(a)}function jn(a){if(a.H=0,a.ma=[],a.h){const b=en(a.i);0==b.length&&0==a.j.length||(S(a.ma,b),S(a.ma,a.j),a.i.i.length=0,T(a.j),a.j.length=0),a.h.ya()}}function zn(a,b,t){var e=t instanceof Ae?Ce(t):new Ae(t);if(""!=e.g)b&&(e.g=b+"."+e.g),ke(e,e.m);else{var n=l.location;e=n.protocol,b=b?b+"."+n.hostname:n.hostname,n=+n.port;var r=new Ae(null);e&&Ne(r,e),b&&(r.g=b),n&&ke(r,n),t&&(r.l=t),e=r}return t=a.F,b=a.Da,t&&b&&Oe(e,t,b),Oe(e,"VER",a.ra),Rn(a,e),e}function Kn(a,b,t){if(b&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(b=a.Ha&&!a.va?new fn(new on({ob:t})):new fn(a.va)).Oa(a.J),b}function Gn(){}function $n(){if(M&&!(10<=Number($)))throw Error("Environmental error: no available transport.")}function Qn(a,b){bt.call(this),this.g=new xn(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.s=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.Ca&&(a?a["X-WebChannel-Client-Profile"]=b.Ca:a={"X-WebChannel-Client-Profile":b.Ca}),this.g.U=a,(a=b&&b.cc)&&!A(a)&&(this.g.o=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!A(b)&&(this.g.F=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new Hn(this)}function Wn(a){ae.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var b=a.__sm__;if(b){t:{for(const t in b){a=t;break t}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function Yn(){ue.call(this),this.status=1}function Hn(a){this.g=a}function Jn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Xn(a,b,t){t||(t=0);var e=Array(16);if("string"==typeof b)for(var n=0;16>n;++n)e[n]=b.charCodeAt(t++)|b.charCodeAt(t++)<<8|b.charCodeAt(t++)<<16|b.charCodeAt(t++)<<24;else for(n=0;16>n;++n)e[n]=b[t++]|b[t++]<<8|b[t++]<<16|b[t++]<<24;b=a.g[0],t=a.g[1],n=a.g[2];var r=a.g[3],o=b+(r^t&(n^r))+e[0]+3614090360&4294967295;o=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=t+(o<<7&4294967295|o>>>25))+((o=r+(n^b&(t^n))+e[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=n+(t^r&(b^t))+e[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(b^n&(r^b))+e[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^t&(n^r))+e[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(t^n))+e[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=n+(t^r&(b^t))+e[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(b^n&(r^b))+e[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^t&(n^r))+e[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(t^n))+e[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=n+(t^r&(b^t))+e[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(b^n&(r^b))+e[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^t&(n^r))+e[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(t^n))+e[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=n+(t^r&(b^t))+e[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(b^n&(r^b))+e[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=b+(n^r&(t^n))+e[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(t^n&(b^t))+e[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^t&(r^b))+e[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(r^b&(n^r))+e[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(t^n))+e[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(t^n&(b^t))+e[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^t&(r^b))+e[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(r^b&(n^r))+e[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(t^n))+e[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(t^n&(b^t))+e[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^t&(r^b))+e[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(r^b&(n^r))+e[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(t^n))+e[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(t^n&(b^t))+e[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^t&(r^b))+e[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(r^b&(n^r))+e[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=b+(t^n^r)+e[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^t^n)+e[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^t)+e[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(n^r^b)+e[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=b+(t^n^r)+e[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^t^n)+e[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^t)+e[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(n^r^b)+e[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=b+(t^n^r)+e[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^t^n)+e[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^t)+e[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(n^r^b)+e[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=b+(t^n^r)+e[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^t^n)+e[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^t)+e[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(n^r^b)+e[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=b+(n^(t|~r))+e[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(t^(b|~n))+e[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~t))+e[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(r^(n|~b))+e[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=b+(n^(t|~r))+e[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(t^(b|~n))+e[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~t))+e[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(r^(n|~b))+e[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=b+(n^(t|~r))+e[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(t^(b|~n))+e[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~t))+e[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(r^(n|~b))+e[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(b=t+((o=b+(n^(t|~r))+e[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(t^(b|~n))+e[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((n=r+((o=n+(b^(r|~t))+e[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~b))+e[9]+3951481745&4294967295,a.g[0]=a.g[0]+b&4294967295,a.g[1]=a.g[1]+(n+(o<<21&4294967295|o>>>11))&4294967295,a.g[2]=a.g[2]+n&4294967295,a.g[3]=a.g[3]+r&4294967295}function Zn(a,b){this.h=b;for(var t=[],e=!0,n=a.length-1;0<=n;n--){var r=0|a[n];e&&r==b||(t[n]=r,e=!1)}this.g=t}(r=fn.prototype).Oa=function(a){this.M=a},r.ha=function(a,b,t,e){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+a);b=b?b.toUpperCase():"GET",this.I=a,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():se.g(),this.C=this.u?re(this.u):re(se),this.g.onreadystatechange=q(this.La,this);try{this.G=!0,this.g.open(b,String(a),!0),this.G=!1}catch(t){return void pn(this,t)}if(a=t||"",t=new Map(this.headers),e)if(Object.getPrototypeOf(e)===Object.prototype)for(var n in e)t.set(n,e[n]);else{if("function"!=typeof e.keys||"function"!=typeof e.get)throw Error("Unknown input type for opt_headers: "+String(e));for(const n of e.keys())t.set(n,e.get(n))}e=Array.from(t.keys()).find((t=>"content-type"==t.toLowerCase())),n=l.FormData&&a instanceof l.FormData,!(0<=E(mn,b))||e||n||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,n]of t)this.g.setRequestHeader(e,n);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{bn(this),0<this.B&&((this.L=function(a){return M&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.ua,this)):this.A=Lt(this.ua,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(t){pn(this,t)}},r.ua=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,_t(this,"timeout"),this.abort(8))},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,_t(this,"complete"),_t(this,"abort"),vn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),vn(this,!0)),fn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?wn(this):this.kb())},r.kb=function(){wn(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<_n(this)?this.g.status:-1}catch(t){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Wa=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),dn(b)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=xn.prototype).ra=8,r.H=1,r.Na=function(a){if(this.m)if(this.m=null,1==this.H){if(!a){this.W=Math.floor(1e5*Math.random()),a=this.W++;const n=new he(this,this.l,a);let r=this.s;if(this.U&&(r?(r=tt(r),nt(r,this.U)):r=this.U),null!==this.o||this.O||(n.I=r,r=null),this.P)t:{for(var b=0,t=0;t<this.j.length;t++){var e=this.j[t];if(void 0===(e="__data__"in e.map&&"string"==typeof(e=e.map.__data__)?e.length:void 0))break;if(4096<(b+=e)){b=t;break t}if(4096===b||t===this.j.length-1){b=t+1;break t}}b=1e3}else b=1e3;b=On(this,n,b),Oe(t=Ce(this.I),"RID",a),Oe(t,"CVER",22),this.F&&Oe(t,"X-HTTP-Session-Id",this.F),Rn(this,t),r&&(this.O?b="headers="+encodeURIComponent(String(En(r)))+"&"+b:this.o&&Tn(t,this.o,r)),Ze(this.i,n),this.bb&&Oe(t,"TYPE","init"),this.P?(Oe(t,"$req",b),Oe(t,"SID","null"),n.aa=!0,me(n,t,null)):me(n,t,b),this.H=2}}else 3==this.H&&(a?kn(this,a):0==this.j.length||He(this.i)||kn(this))},r.Ma=function(){if(this.u=null,Fn(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var a=2*this.S;this.l.info("BP detection timer enabled: "+a),this.B=Zt(q(this.jb,this),a)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Jt(10),An(this),Fn(this))},r.ib=function(){null!=this.v&&(this.v=null,An(this),Mn(this),Jt(19))},r.pb=function(a){a?(this.l.info("Successfully pinged google.com"),Jt(2)):(this.l.info("Failed to ping google.com"),Jt(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=Gn.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},$n.prototype.g=function(a,b){return new Qn(a,b)},_(Qn,bt),Qn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var a=this.g,b=this.l,t=this.h||void 0;Jt(0),a.Y=b,a.na=t||{},a.G=a.aa,a.I=zn(a,null,a.Y),Nn(a)},Qn.prototype.close=function(){Dn(this.g)},Qn.prototype.u=function(a){var b=this.g;if("string"==typeof a){var t={};t.__data__=a,a=t}else this.v&&((t={}).__data__=Et(a),a=t);b.j.push(new class{constructor(a,b){this.g=a,this.map=b}}(b.fb++,a)),3==b.H&&Nn(b)},Qn.prototype.N=function(){this.g.h=null,delete this.j,Dn(this.g),delete this.g,Qn.$.N.call(this)},_(Wn,ae),_(Yn,ue),_(Hn,Gn),Hn.prototype.Ba=function(){_t(this.g,"a")},Hn.prototype.Aa=function(a){_t(this.g,new Wn(a))},Hn.prototype.za=function(a){_t(this.g,new Yn)},Hn.prototype.ya=function(){_t(this.g,"b")},_(Jn,(function(){this.blockSize=-1})),Jn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Jn.prototype.j=function(a,b){void 0===b&&(b=a.length);for(var t=b-this.blockSize,e=this.m,n=this.h,r=0;r<b;){if(0==n)for(;r<=t;)Xn(this,a,r),r+=this.blockSize;if("string"==typeof a){for(;r<b;)if(e[n++]=a.charCodeAt(r++),n==this.blockSize){Xn(this,e),n=0;break}}else for(;r<b;)if(e[n++]=a[r++],n==this.blockSize){Xn(this,e),n=0;break}}this.h=n,this.i+=b},Jn.prototype.l=function(){var a=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;var t=8*this.i;for(b=a.length-8;b<a.length;++b)a[b]=255&t,t/=256;for(this.j(a),a=Array(16),b=t=0;4>b;++b)for(var e=0;32>e;e+=8)a[t++]=this.g[b]>>>e&255;return a};var er={};function nr(a){return-128<=a&&128>a?function(a,b){var t=er;return Object.prototype.hasOwnProperty.call(t,a)?t[a]:t[a]=b(a)}(a,(function(b){return new Zn([0|b],0>b?-1:0)})):new Zn([0|a],0>a?-1:0)}function rr(a){if(isNaN(a)||!isFinite(a))return sr;if(0>a)return lr(rr(-a));for(var b=[],t=1,e=0;a>=t;e++)b[e]=a/t|0,t*=ir;return new Zn(b,0)}var ir=4294967296,sr=nr(0),or=nr(1),ar=nr(16777216);function ur(a){if(0!=a.h)return!1;for(var b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function cr(a){return-1==a.h}function lr(a){for(var b=a.g.length,t=[],e=0;e<b;e++)t[e]=~a.g[e];return new Zn(t,~a.h).add(or)}function dr(a,b){return a.add(lr(b))}function fr(a,b){for(;(65535&a[b])!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function gr(a,b){this.g=a,this.h=b}function mr(a,b){if(ur(b))throw Error("division by zero");if(ur(a))return new gr(sr,sr);if(cr(a))return b=mr(lr(a),b),new gr(lr(b.g),lr(b.h));if(cr(b))return b=mr(a,lr(b)),new gr(lr(b.g),b.h);if(30<a.g.length){if(cr(a)||cr(b))throw Error("slowDivide_ only works with positive integers.");for(var t=or,e=b;0>=e.X(a);)t=pr(t),e=pr(e);var n=yr(t,1),r=yr(e,1);for(e=yr(e,2),t=yr(t,2);!ur(e);){var o=r.add(e);0>=o.X(a)&&(n=n.add(t),r=o),e=yr(e,1),t=yr(t,1)}return b=dr(a,n.R(b)),new gr(n,b)}for(n=sr;0<=a.X(b);){for(t=Math.max(1,Math.floor(a.ea()/b.ea())),e=48>=(e=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,e-48),o=(r=rr(t)).R(b);cr(o)||0<o.X(a);)o=(r=rr(t-=e)).R(b);ur(r)&&(r=or),n=n.add(r),a=dr(a,o)}return new gr(n,a)}function pr(a){for(var b=a.g.length+1,t=[],e=0;e<b;e++)t[e]=a.D(e)<<1|a.D(e-1)>>>31;return new Zn(t,a.h)}function yr(a,b){var t=b>>5;b%=32;for(var e=a.g.length-t,n=[],r=0;r<e;r++)n[r]=0<b?a.D(r+t)>>>b|a.D(r+t+1)<<32-b:a.D(r+t);return new Zn(n,a.h)}(r=Zn.prototype).ea=function(){if(cr(this))return-lr(this).ea();for(var a=0,b=1,t=0;t<this.g.length;t++){var e=this.D(t);a+=(0<=e?e:ir+e)*b,b*=ir}return a},r.toString=function(a){if(2>(a=a||10)||36<a)throw Error("radix out of range: "+a);if(ur(this))return"0";if(cr(this))return"-"+lr(this).toString(a);for(var b=rr(Math.pow(a,6)),t=this,e="";;){var n=mr(t,b).g,r=((0<(t=dr(t,n.R(b))).g.length?t.g[0]:t.h)>>>0).toString(a);if(ur(t=n))return r+e;for(;6>r.length;)r="0"+r;e=r+e}},r.D=function(a){return 0>a?0:a<this.g.length?this.g[a]:this.h},r.X=function(a){return cr(a=dr(this,a))?-1:ur(a)?0:1},r.abs=function(){return cr(this)?lr(this):this},r.add=function(a){for(var b=Math.max(this.g.length,a.g.length),t=[],e=0,n=0;n<=b;n++){var r=e+(65535&this.D(n))+(65535&a.D(n)),o=(r>>>16)+(this.D(n)>>>16)+(a.D(n)>>>16);e=o>>>16,r&=65535,o&=65535,t[n]=o<<16|r}return new Zn(t,-2147483648&t[t.length-1]?-1:0)},r.R=function(a){if(ur(this)||ur(a))return sr;if(cr(this))return cr(a)?lr(this).R(lr(a)):lr(lr(this).R(a));if(cr(a))return lr(this.R(lr(a)));if(0>this.X(ar)&&0>a.X(ar))return rr(this.ea()*a.ea());for(var b=this.g.length+a.g.length,t=[],e=0;e<2*b;e++)t[e]=0;for(e=0;e<this.g.length;e++)for(var n=0;n<a.g.length;n++){var r=this.D(e)>>>16,o=65535&this.D(e),c=a.D(n)>>>16,h=65535&a.D(n);t[2*e+2*n]+=o*h,fr(t,2*e+2*n),t[2*e+2*n+1]+=r*h,fr(t,2*e+2*n+1),t[2*e+2*n+1]+=o*c,fr(t,2*e+2*n+1),t[2*e+2*n+2]+=r*c,fr(t,2*e+2*n+2)}for(e=0;e<b;e++)t[e]=t[2*e+1]<<16|t[2*e];for(e=b;e<2*b;e++)t[e]=0;return new Zn(t,0)},r.gb=function(a){return mr(this,a).h},r.and=function(a){for(var b=Math.max(this.g.length,a.g.length),t=[],e=0;e<b;e++)t[e]=this.D(e)&a.D(e);return new Zn(t,this.h&a.h)},r.or=function(a){for(var b=Math.max(this.g.length,a.g.length),t=[],e=0;e<b;e++)t[e]=this.D(e)|a.D(e);return new Zn(t,this.h|a.h)},r.xor=function(a){for(var b=Math.max(this.g.length,a.g.length),t=[],e=0;e<b;e++)t[e]=this.D(e)^a.D(e);return new Zn(t,this.h^a.h)},$n.prototype.createWebChannel=$n.prototype.g,Qn.prototype.send=Qn.prototype.u,Qn.prototype.open=Qn.prototype.m,Qn.prototype.close=Qn.prototype.close,te.NO_ERROR=0,te.TIMEOUT=8,te.HTTP_ERROR=6,ee.COMPLETE="complete",ie.EventType=oe,oe.OPEN="a",oe.CLOSE="b",oe.ERROR="c",oe.MESSAGE="d",bt.prototype.listen=bt.prototype.O,fn.prototype.listenOnce=fn.prototype.P,fn.prototype.getLastError=fn.prototype.Sa,fn.prototype.getLastErrorCode=fn.prototype.Ia,fn.prototype.getStatus=fn.prototype.da,fn.prototype.getResponseJson=fn.prototype.Wa,fn.prototype.getResponseText=fn.prototype.ja,fn.prototype.send=fn.prototype.ha,fn.prototype.setWithCredentials=fn.prototype.Oa,Jn.prototype.digest=Jn.prototype.l,Jn.prototype.reset=Jn.prototype.reset,Jn.prototype.update=Jn.prototype.j,Zn.prototype.add=Zn.prototype.add,Zn.prototype.multiply=Zn.prototype.R,Zn.prototype.modulo=Zn.prototype.gb,Zn.prototype.compare=Zn.prototype.X,Zn.prototype.toNumber=Zn.prototype.ea,Zn.prototype.toString=Zn.prototype.toString,Zn.prototype.getBits=Zn.prototype.D,Zn.fromNumber=rr,Zn.fromString=function t(a,b){if(0==a.length)throw Error("number format error: empty string");if(2>(b=b||10)||36<b)throw Error("radix out of range: "+b);if("-"==a.charAt(0))return lr(t(a.substring(1),b));if(0<=a.indexOf("-"))throw Error('number format error: interior "-" character');for(var e=rr(Math.pow(b,8)),n=sr,r=0;r<a.length;r+=8){var o=Math.min(8,a.length-r),c=parseInt(a.substring(r,r+o),b);8>o?(o=rr(Math.pow(b,o)),n=n.R(o).add(rr(c))):n=(n=n.R(e)).add(rr(c))}return n};var wr=c.createWebChannelTransport=function(){return new $n},vr=c.getStatEventTarget=function(){return Qt()},_r=c.ErrorCode=te,Ir=c.EventType=ee,Er=c.Event=Gt,Tr=c.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Sr=c.FetchXmlHttpFactory=on,xr=c.WebChannel=ie,Dr=c.XhrIo=fn,Ar=c.Md5=Jn,Cr=c.Integer=Zn}).call(this,n(73))},518:function(t,e,n){"use strict";n.r(e);var r=n(448),o=n(506),c=n(444),h=n(446);function l(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new o.g("invalid-argument",`Invalid options passed to function ${t}(): You cannot specify both "merge" and "mergeFields".`);return e}function d(){if("undefined"==typeof Uint8Array)throw new o.g("unimplemented","Uint8Arrays are not available in this environment.")}function f(){if(!Object(o.r)())throw new o.g("unimplemented","Blobs are unavailable in Firestore in this environment.")}class m{constructor(t){this._delegate=t}static fromBase64String(t){return f(),new m(o.b.fromBase64String(t))}static fromUint8Array(t){return d(),new m(o.b.fromUint8Array(t))}toBase64(){return f(),this._delegate.toBase64()}toUint8Array(){return d(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function y(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const object=t;for(const t of e)if(t in object&&"function"==typeof object[t])return!0;return!1}(t,["next","error","complete"])}class w{enableIndexedDbPersistence(t,e){return Object(o.F)(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return Object(o.G)(t._delegate)}clearIndexedDbPersistence(t){return Object(o.x)(t._delegate)}}class v{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof o.m||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){const e=this._delegate._getSettings();t.merge||e.host===t.host||Object(o.s)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)}useEmulator(t,e,n={}){Object(o.A)(this._delegate,t,e,n)}enableNetwork(){return Object(o.H)(this._delegate)}disableNetwork(){return Object(o.D)(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,Object(o.t)("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Object(o.lb)(this._delegate)}onSnapshotsInSync(t){return Object(o.Y)(this._delegate,t)}get app(){if(!this._appCompat)throw new o.g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new P(this,Object(o.y)(this._delegate,t))}catch(t){throw x(t,"collection()","Firestore.collection()")}}doc(t){try{return new S(this,Object(o.E)(this._delegate,t))}catch(t){throw x(t,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new k(this,Object(o.z)(this._delegate,t))}catch(t){throw x(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Object(o.db)(this._delegate,(e=>t(new I(this,e))))}batch(){return Object(o.K)(this._delegate),new E(new o.l(this._delegate,(t=>Object(o.L)(this._delegate,t))))}loadBundle(t){return Object(o.V)(this._delegate,t)}namedQuery(t){return Object(o.W)(this._delegate,t).then((t=>t?new k(this,t):null))}}class _ extends o.a{constructor(t){super(),this.firestore=t}convertBytes(t){return new m(new o.b(t))}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return S.forKey(e,this.firestore,null)}}class I{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new _(t)}get(t){const e=M(t);return this._delegate.get(e).then((t=>new C(this._firestore,new o.e(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,e.converter))))}set(t,data,e){const n=M(t);return e?(l("Transaction.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=M(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=M(t);return this._delegate.delete(e),this}}class E{constructor(t){this._delegate=t}set(t,data,e){const n=M(t);return e?(l("WriteBatch.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=M(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=M(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class T{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){const n=new o.i(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new N(this._firestore,n),null!=e?e:{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){const n=T.INSTANCES;let r=n.get(t);r||(r=new WeakMap,n.set(t,r));let o=r.get(e);return o||(o=new T(t,new _(t),e),r.set(e,o)),o}}T.INSTANCES=new WeakMap;class S{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new _(t)}static forPath(path,t,e){if(path.length%2!=0)throw new o.g("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${path.canonicalString()} has ${path.length}`);return new S(t,new o.d(t._delegate,e,new o.n(path)))}static forKey(t,e,n){return new S(e,new o.d(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new P(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new P(this.firestore,Object(o.y)(this._delegate,t))}catch(t){throw x(t,"collection()","DocumentReference.collection()")}}isEqual(t){return(t=Object(c.p)(t))instanceof o.d&&Object(o.cb)(this._delegate,t)}set(t,e){e=l("DocumentReference.set",e);try{return e?Object(o.fb)(this._delegate,t,e):Object(o.fb)(this._delegate,t)}catch(t){throw x(t,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return 1===arguments.length?Object(o.kb)(this._delegate,t):Object(o.kb)(this._delegate,t,e,...n)}catch(t){throw x(t,"updateDoc()","DocumentReference.update()")}}delete(){return Object(o.B)(this._delegate)}onSnapshot(...t){const e=D(t),n=A(t,(t=>new C(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))));return Object(o.X)(this._delegate,e,n)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.N)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.O)(this._delegate):Object(o.M)(this._delegate),e.then((t=>new C(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))))}withConverter(t){return new S(this.firestore,t?this._delegate.withConverter(T.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function x(t,e,n){return t.message=t.message.replace(e,n),t}function D(t){for(const e of t)if("object"==typeof e&&!y(e))return e;return{}}function A(t,e){var n,r;let o;return o=y(t[0])?t[0]:y(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]},{next:t=>{o.next&&o.next(e(t))},error:null===(n=o.error)||void 0===n?void 0:n.bind(o),complete:null===(r=o.complete)||void 0===r?void 0:r.bind(o)}}class C{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new S(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class N extends C{data(t){const data=this._delegate.data(t);return this._delegate._converter||Object(o.q)(void 0!==data,"Document in a QueryDocumentSnapshot should exist"),data}}class k{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new _(t)}where(t,e,n){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.mb)(t,e,n)))}catch(t){throw x(t,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.Z)(t,e)))}catch(t){throw x(t,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.T)(t)))}catch(t){throw x(t,"limit()","Query.limit()")}}limitToLast(t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.U)(t)))}catch(t){throw x(t,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.jb)(...t)))}catch(t){throw x(t,"startAt()","Query.startAt()")}}startAfter(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.ib)(...t)))}catch(t){throw x(t,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.J)(...t)))}catch(t){throw x(t,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.I)(...t)))}catch(t){throw x(t,"endAt()","Query.endAt()")}}isEqual(t){return Object(o.bb)(this._delegate,t._delegate)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.Q)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.R)(this._delegate):Object(o.P)(this._delegate),e.then((t=>new O(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))))}onSnapshot(...t){const e=D(t),n=A(t,(t=>new O(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))));return Object(o.X)(this._delegate,e,n)}withConverter(t){return new k(this.firestore,t?this._delegate.withConverter(T.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}class R{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new N(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class O{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new k(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((t=>new N(this._firestore,t)))}docChanges(t){return this._delegate.docChanges(t).map((t=>new R(this._firestore,t)))}forEach(t,e){this._delegate.forEach((n=>{t.call(e,new N(this._firestore,n))}))}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class P extends k{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const t=this._delegate.parent;return t?new S(this.firestore,t):null}doc(t){try{return new S(this.firestore,void 0===t?Object(o.E)(this._delegate):Object(o.E)(this._delegate,t))}catch(t){throw x(t,"doc()","CollectionReference.doc()")}}add(data){return Object(o.u)(this._delegate,data).then((t=>new S(this.firestore,t)))}isEqual(t){return Object(o.cb)(this._delegate,t._delegate)}withConverter(t){return new P(this.firestore,t?this._delegate.withConverter(T.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function M(t){return Object(o.p)(t,o.d)}class L{constructor(...t){this._delegate=new o.f(...t)}static documentId(){return new L(o.o.keyField().canonicalString())}isEqual(t){return(t=Object(c.p)(t))instanceof o.f&&this._delegate._internalPath.isEqual(t._internalPath)}}class F{constructor(t){this._delegate=t}static serverTimestamp(){const t=Object(o.eb)();return t._methodName="FieldValue.serverTimestamp",new F(t)}static delete(){const t=Object(o.C)();return t._methodName="FieldValue.delete",new F(t)}static arrayUnion(...t){const e=Object(o.w)(...t);return e._methodName="FieldValue.arrayUnion",new F(e)}static arrayRemove(...t){const e=Object(o.v)(...t);return e._methodName="FieldValue.arrayRemove",new F(e)}static increment(t){const e=Object(o.S)(t);return e._methodName="FieldValue.increment",new F(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}}const V={Firestore:v,GeoPoint:o.h,Timestamp:o.k,Blob:m,Transaction:I,WriteBatch:E,DocumentReference:S,DocumentSnapshot:C,Query:k,QueryDocumentSnapshot:N,QuerySnapshot:O,CollectionReference:P,FieldPath:L,FieldValue:F,setLogLevel:function(t){Object(o.gb)(t)},CACHE_SIZE_UNLIMITED:o.c};var U,B;U=r.a,B=(t,e)=>new v(t,e,new w),U.INTERNAL.registerComponent(new h.a("firestore-compat",(t=>{const e=t.getProvider("app-compat").getImmediate(),n=t.getProvider("firestore").getImmediate();return B(e,n)}),"PUBLIC").setServiceProps(Object.assign({},V))),U.registerVersion("@firebase/firestore-compat","0.3.30")}}]);