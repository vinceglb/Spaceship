/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{448:function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var r=n(444),o=n(446),c=n(449),l=n(450);class h{constructor(e,t){this._delegate=e,this.firebase=t,Object(c._addComponent)(e,new o.a("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),Object(c.deleteApp)(this._delegate))))}_getService(e,t=c._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=c._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(component){Object(c._addComponent)(this._delegate,component)}_addOrOverwriteComponent(component){Object(c._addOrOverwriteComponent)(this._delegate,component)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const d={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},f=new r.b("app-compat","Firebase",d);const m=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(o,l={}){const h=c.initializeApp(o,l);if(Object(r.f)(t,h.name))return t[h.name];const d=new e(h,n);return t[h.name]=d,d},app:o,registerVersion:c.registerVersion,setLogLevel:c.setLogLevel,onLog:c.onLog,apps:null,SDK_VERSION:c.SDK_VERSION,INTERNAL:{registerComponent:function(component){const t=component.name,l=t.replace("-compat","");if(c._registerComponent(component)&&"PUBLIC"===component.type){const c=(e=o())=>{if("function"!=typeof e[l])throw f.create("invalid-app-argument",{appName:t});return e[l]()};void 0!==component.serviceProps&&Object(r.j)(c,component.serviceProps),n[l]=c,e.prototype[l]=function(...e){return this._getService.bind(this,t).apply(this,component.multipleInstances?e:[])}}return"PUBLIC"===component.type?n[l]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:c}};function o(e){if(e=e||c._DEFAULT_ENTRY_NAME,!Object(r.f)(t,e))throw f.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),o.App=e,n}(h);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){Object(r.j)(t,e)},createSubscribe:r.h,ErrorFactory:r.b,deepExtend:r.j}),t}(),y=new l.b("@firebase/app-compat");if(Object(r.r)()&&void 0!==self.firebase){y.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&y.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const w=m;var v;Object(c.registerVersion)("@firebase/app-compat","0.2.6",v)},506:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Bl})),n.d(t,"b",(function(){return Uu})),n.d(t,"c",(function(){return xu})),n.d(t,"d",(function(){return th})),n.d(t,"e",(function(){return $l})),n.d(t,"f",(function(){return ju})),n.d(t,"g",(function(){return A})),n.d(t,"h",(function(){return Ku})),n.d(t,"i",(function(){return Ql})),n.d(t,"j",(function(){return Wl})),n.d(t,"k",(function(){return G})),n.d(t,"l",(function(){return mh})),n.d(t,"m",(function(){return It})),n.d(t,"n",(function(){return H})),n.d(t,"o",(function(){return W})),n.d(t,"p",(function(){return hu})),n.d(t,"q",(function(){return x})),n.d(t,"r",(function(){return lt})),n.d(t,"s",(function(){return T})),n.d(t,"t",(function(){return au})),n.d(t,"u",(function(){return ch})),n.d(t,"v",(function(){return Ih})),n.d(t,"w",(function(){return bh})),n.d(t,"x",(function(){return Ru})),n.d(t,"y",(function(){return wu})),n.d(t,"z",(function(){return vu})),n.d(t,"A",(function(){return gu})),n.d(t,"B",(function(){return ah})),n.d(t,"C",(function(){return wh})),n.d(t,"D",(function(){return Fu})),n.d(t,"E",(function(){return bu})),n.d(t,"F",(function(){return Nu})),n.d(t,"G",(function(){return ku})),n.d(t,"H",(function(){return Lu})),n.d(t,"I",(function(){return Fl})),n.d(t,"J",(function(){return Ll})),n.d(t,"K",(function(){return Cu})),n.d(t,"L",(function(){return hh})),n.d(t,"M",(function(){return Xl})),n.d(t,"N",(function(){return Zl})),n.d(t,"O",(function(){return eh})),n.d(t,"P",(function(){return nh})),n.d(t,"Q",(function(){return rh})),n.d(t,"R",(function(){return sh})),n.d(t,"S",(function(){return Th})),n.d(t,"T",(function(){return Al})),n.d(t,"U",(function(){return Nl})),n.d(t,"V",(function(){return Pu})),n.d(t,"W",(function(){return Vu})),n.d(t,"X",(function(){return uh})),n.d(t,"Y",(function(){return lh})),n.d(t,"Z",(function(){return Dl})),n.d(t,"ab",(function(){return dl})),n.d(t,"bb",(function(){return Tu})),n.d(t,"cb",(function(){return Iu})),n.d(t,"db",(function(){return yh})),n.d(t,"eb",(function(){return vh})),n.d(t,"fb",(function(){return ih})),n.d(t,"gb",(function(){return w})),n.d(t,"hb",(function(){return Yl})),n.d(t,"ib",(function(){return Rl})),n.d(t,"jb",(function(){return Ol})),n.d(t,"kb",(function(){return oh})),n.d(t,"lb",(function(){return Mu})),n.d(t,"mb",(function(){return _l}));var r=n(449),o=n(446),c=n(450),l=n(444),h=n(507);const d="@firebase/firestore";class b{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}b.UNAUTHENTICATED=new b(null),b.GOOGLE_CREDENTIALS=new b("google-credentials-uid"),b.FIRST_PARTY=new b("first-party-uid"),b.MOCK_USER=new b("mock-user");let f="9.19.0";const m=new c.b("@firebase/firestore");function y(){return m.logLevel}function w(e){m.setLogLevel(e)}function v(e,...t){if(m.logLevel<=c.a.DEBUG){const n=t.map(E);m.debug(`Firestore (${f}): ${e}`,...n)}}function I(e,...t){if(m.logLevel<=c.a.ERROR){const n=t.map(E);m.error(`Firestore (${f}): ${e}`,...n)}}function T(e,...t){if(m.logLevel<=c.a.WARN){const n=t.map(E);m.warn(`Firestore (${f}): ${e}`,...n)}}function E(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function _(e="Unexpected state"){const t=`FIRESTORE (${f}) INTERNAL ASSERTION FAILED: `+e;throw I(t),new Error(t)}function S(e,t){e||_()}function x(e,t){e||_()}function D(e,t){return e}const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class A extends l.c{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class q{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class N{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class k{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(b.UNAUTHENTICATED)))}shutdown(){}}class O{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class R{constructor(e){this.t=e,this.currentUser=b.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const s=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new q;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new q,e.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await s(this.currentUser)}))},o=e=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new q)}}),0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(S("string"==typeof t.accessToken),new N(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return S(null===e||"string"==typeof e),new b(e)}}class M{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=b.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class L{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new M(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(b.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class F{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class P{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const n=e=>{null!=e.error&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.T;return this.T=e.token,v("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const s=e=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit((e=>s(e))),setTimeout((()=>{if(!this.appCheck){const e=this.I.getImmediate({optional:!0});e?s(e):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(S("string"==typeof e.token),this.T=e.token,new F(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function V(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class U{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const s=V(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<t&&(n+=e.charAt(s[i]%e.length))}return n}}function j(e,t){return e<t?-1:e>t?1:0}function B(e,t,n){return e.length===t.length&&e.every(((e,s)=>n(e,t[s])))}function K(e){return e+"\0"}class G{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new A(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new A(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new A(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new A(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return G.fromMillis(Date.now())}static fromDate(e){return G.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new G(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?j(this.nanoseconds,e.nanoseconds):j(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class z{constructor(e){this.timestamp=e}static fromTimestamp(e){return new z(e)}static min(){return new z(new G(0,0))}static max(){return new z(new G(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ${constructor(e,t,n){void 0===t?t=0:t>e.length&&_(),void 0===n?n=e.length-t:n>e.length-t&&_(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===$.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const n=e.get(s),i=t.get(s);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class rt extends ${construct(e,t,n){return new rt(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new A(C.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new rt(t)}static emptyPath(){return new rt([])}}const Q=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class W extends ${construct(e,t,n){return new W(e,t,n)}static isValidIdentifier(e){return Q.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),W.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new W(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(0===n.length)throw new A(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let r=!1;for(;s<e.length;){const t=e[s];if("\\"===t){if(s+1===e.length)throw new A(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[s+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new A(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,s+=2}else"`"===t?(r=!r,s++):"."!==t||r?(n+=t,s++):(i(),s++)}if(i(),r)throw new A(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new W(t)}static emptyPath(){return new W([])}}class H{constructor(e){this.path=e}static fromPath(e){return new H(rt.fromString(e))}static fromName(e){return new H(rt.fromString(e).popFirst(5))}static empty(){return new H(rt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===rt.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return rt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new H(new rt(e.slice()))}}class Y{constructor(e,t,n,s){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=s}}function X(e){return e.fields.find((e=>2===e.kind))}function J(e){return e.fields.filter((e=>2!==e.kind))}Y.UNKNOWN_ID=-1;class dt{constructor(e,t){this.fieldPath=e,this.kind=t}}class Z{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Z(0,ne.min())}}function ee(e,t){const n=e.toTimestamp().seconds,s=e.toTimestamp().nanoseconds+1,i=z.fromTimestamp(1e9===s?new G(n+1,0):new G(n,s));return new ne(i,H.empty(),t)}function te(e){return new ne(e.readTime,e.key,-1)}class ne{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ne(z.min(),H.empty(),-1)}static max(){return new ne(z.max(),H.empty(),-1)}}function re(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=H.comparator(e.documentKey,t.documentKey),0!==n?n:j(e.largestBatchId,t.largestBatchId))}const se="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ie{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function oe(e){if(e.code!==C.FAILED_PRECONDITION||e.message!==se)throw e;v("LocalStore","Unexpectedly lost primary lease")}class ae{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&_(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ae(((n,s)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,s)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ae?t:ae.resolve(t)}catch(e){return ae.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ae.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ae.reject(t)}static resolve(e){return new ae(((t,n)=>{t(e)}))}static reject(e){return new ae(((t,n)=>{n(e)}))}static waitFor(e){return new ae(((t,n)=>{let s=0,i=0,r=!1;e.forEach((e=>{++s,e.next((()=>{++i,r&&i===s&&t()}),(e=>n(e)))})),r=!0,i===s&&t()}))}static or(e){let t=ae.resolve(!1);for(const n of e)t=t.next((e=>e?ae.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,s)=>{n.push(t.call(this,e,s))})),this.waitFor(n)}static mapArray(e,t){return new ae(((n,s)=>{const i=e.length,r=new Array(i);let o=0;for(let u=0;u<i;u++){const c=u;t(e[c]).next((e=>{r[c]=e,++o,o===i&&n(r)}),(e=>s(e)))}}))}static doWhile(e,t){return new ae(((n,s)=>{const i=()=>{!0===e()?t().next((()=>{i()}),s):n()};i()}))}}class ce{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.R=new q,this.transaction.oncomplete=()=>{this.R.resolve()},this.transaction.onabort=()=>{t.error?this.R.reject(new he(e,t.error)):this.R.resolve()},this.transaction.onerror=t=>{const n=pe(t.target.error);this.R.reject(new he(e,n))}}static open(e,t,n,s){try{return new ce(t,e.transaction(s,n))}catch(e){throw new he(t,e)}}get v(){return this.R.promise}abort(e){e&&this.R.reject(e),this.aborted||(v("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new fe(t)}}class ue{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===ue.S(Object(l.q)())&&I("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return v("SimpleDb","Removing database:",e),me(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Object(l.v)())return!1;if(ue.C())return!0;const e=Object(l.q)(),t=ue.S(e),n=0<t&&t<10,s=ue.N(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var t;return void 0!==e&&"YES"===(null===(t=e.env)||void 0===t?void 0:t.k)}static O(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async $(e){return this.db||(v("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=e=>{const n=e.target.result;t(n)},s.onblocked=()=>{n(new he(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=t=>{const s=t.target.error;"VersionError"===s.name?n(new A(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===s.name?n(new A(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):n(new he(e,s))},s.onupgradeneeded=e=>{v("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.V.M(t,s.transaction,e.oldVersion,this.version).next((()=>{v("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,s){const i="readonly"===t;let r=0;for(;;){++r;try{this.db=await this.$(e);const t=ce.open(this.db,e,i?"readonly":"readwrite",n),r=s(t).next((e=>(t.P(),e))).catch((e=>(t.abort(e),ae.reject(e)))).toPromise();return r.catch((()=>{})),await t.v,r}catch(e){const t=e,n="FirebaseError"!==t.name&&r<3;if(v("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class le{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return me(this.L.delete())}}class he extends A{constructor(e,t){super(C.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function de(e){return"IndexedDbTransactionError"===e.name}class fe{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(v("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),me(n)}add(e){return v("SimpleDb","ADD",this.store.name,e,e),me(this.store.add(e))}get(e){return me(this.store.get(e)).next((t=>(void 0===t&&(t=null),v("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return v("SimpleDb","DELETE",this.store.name,e),me(this.store.delete(e))}count(){return v("SimpleDb","COUNT",this.store.name),me(this.store.count())}j(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.W(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new ae(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new ae(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}J(e,t){v("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;const s=this.cursor(n);return this.W(s,((e,t,n)=>n.delete()))}Z(e,t){let n;t?n=e:(n={},t=e);const s=this.cursor(n);return this.W(s,t)}X(e){const t=this.cursor({});return new ae(((n,s)=>{t.onerror=e=>{const t=pe(e.target.error);s(t)},t.onsuccess=t=>{const s=t.target.result;s?e(s.primaryKey,s.value).next((e=>{e?s.continue():n()})):n()}}))}W(e,t){const n=[];return new ae(((s,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void s();const r=new le(i),o=t(i.primaryKey,i.value,r);if(o instanceof ae){const e=o.catch((e=>(r.done(),ae.reject(e))));n.push(e)}r.isDone?s():null===r.K?i.continue():i.continue(r.K)}})).next((()=>ae.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function me(e){return new ae(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=pe(e.target.error);n(t)}}))}let ge=!1;function pe(e){const t=ue.S(Object(l.q)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new A("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ge||(ge=!0,setTimeout((()=>{throw e}),0)),e}}return e}class ye{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){v("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{v("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){de(e)?v("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await oe(e)}await this.et(6e4)}))}}class we{constructor(e,t){this.localStore=e,this.persistence=t}async nt(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.st(t,e)))}st(e,t){const n=new Set;let s=t,i=!0;return ae.doWhile((()=>!0===i&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return v("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,s).next((e=>{s-=e,n.add(t)}));i=!1})))).next((()=>t-s))}it(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((s=>this.localStore.localDocuments.getNextDocuments(e,t,s,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.rt(s,n))).next((n=>(v("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}rt(e,t){let n=e;return t.changes.forEach(((e,t)=>{const s=te(t);re(s,n)>0&&(n=s)})),new ne(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ve{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}function be(e){return null==e}function Ie(e){return 0===e&&1/e==-1/0}function Te(e){return"number"==typeof e&&Number.isInteger(e)&&!Ie(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Ee(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Se(t)),t=_e(e.get(n),t);return Se(t)}function _e(e,t){let n=t;const s=e.length;for(let t=0;t<s;t++){const s=e.charAt(t);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function Se(e){return e+""}function xe(e){const t=e.length;if(S(t>=2),2===t)return S(""===e.charAt(0)&&""===e.charAt(1)),rt.emptyPath();const n=t-2,r=[];let s="";for(let i=0;i<t;){const t=e.indexOf("",i);switch((t<0||t>n)&&_(),e.charAt(t+1)){case"":const n=e.substring(i,t);let o;0===s.length?o=n:(s+=n,o=s,s=""),r.push(o);break;case"":s+=e.substring(i,t),s+="\0";break;case"":s+=e.substring(i,t+1);break;default:_()}i=t+2}return new rt(r)}ve.ct=-1;const De=["userId","batchId"];function Ce(e,t){return[e,Ee(t)]}function Ae(e,t,n){return[e,Ee(t),n]}const Ne={},ke=["prefixPath","collectionGroup","readTime","documentId"],Oe=["prefixPath","collectionGroup","documentId"],Re=["collectionGroup","readTime","prefixPath","documentId"],Me=["canonicalId","targetId"],Le=["targetId","path"],Fe=["path","targetId"],Pe=["collectionId","parent"],Ve=["indexId","uid"],qe=["uid","sequenceNumber"],Ue=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],je=["indexId","uid","orderedDocumentKey"],Be=["userId","collectionPath","documentId"],Ke=["userId","collectionPath","largestBatchId"],Ge=["userId","collectionGroup","largestBatchId"],ze=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],$e=[...ze,"documentOverlays"],Qe=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],We=Qe,He=[...We,"indexConfiguration","indexState","indexEntries"];class Ye extends ie{constructor(e,t){super(),this.at=e,this.currentSequenceNumber=t}}function Xe(e,t){const n=D(e);return ue.O(n.at,t)}function Je(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Ze(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function et(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tt{constructor(e,t){this.comparator=e,this.root=t||st.EMPTY}insert(e,t){return new tt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,st.BLACK,null,null))}remove(e){return new tt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,st.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nt(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nt(this.root,e,this.comparator,!1)}getReverseIterator(){return new nt(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nt(this.root,e,this.comparator,!0)}}class nt{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class st{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=null!=n?n:st.RED,this.left=null!=s?s:st.EMPTY,this.right=null!=i?i:st.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new st(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return st.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return st.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,st.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,st.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw _();if(this.right.isRed())throw _();const e=this.left.check();if(e!==this.right.check())throw _();return e+(this.isRed()?0:1)}}st.EMPTY=null,st.RED=!0,st.BLACK=!1,st.EMPTY=new class{constructor(){this.size=0}get key(){throw _()}get value(){throw _()}get color(){throw _()}get left(){throw _()}get right(){throw _()}copy(e,t,n,s,i){return this}insert(e,t,n){return new st(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class it{constructor(e){this.comparator=e,this.data=new tt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ot(this.data.getIterator())}getIteratorFrom(e){return new ot(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof it))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(e,s))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new it(this.comparator);return t.data=e,t}}class ot{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function at(e){return e.hasNext()?e.getNext():void 0}class ct{constructor(e){this.fields=e,e.sort(W.comparator)}static empty(){return new ct([])}unionWith(e){let t=new it(W.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new ct(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return B(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class ut extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function lt(){return"undefined"!=typeof atob}class ht{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ut("Invalid base64 string: "+e):e}}(e);return new ht(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new ht(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return j(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ht.EMPTY_BYTE_STRING=new ht("");const ft=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mt(e){if(S(!!e),"string"==typeof e){let t=0;const n=ft.exec(e);if(S(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:gt(e.seconds),nanos:gt(e.nanos)}}function gt(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function pt(e){return"string"==typeof e?ht.fromBase64String(e):ht.fromUint8Array(e)}function yt(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function wt(e){const t=e.mapValue.fields.__previous_value__;return yt(t)?wt(t):t}function vt(e){const t=mt(e.mapValue.fields.__local_write_time__.timestampValue);return new G(t.seconds,t.nanos)}class bt{constructor(e,t,n,s,i,r,o,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=u}}class It{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new It("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof It&&e.projectId===this.projectId&&e.database===this.database}}const Tt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Et={nullValue:"NULL_VALUE"};function _t(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?yt(e)?4:Vt(e)?9007199254740991:10:_()}function St(e,t){if(e===t)return!0;const n=_t(e);if(n!==_t(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return vt(e).isEqual(vt(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=mt(e.timestampValue),s=mt(t.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return pt(e.bytesValue).isEqual(pt(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return gt(e.geoPointValue.latitude)===gt(t.geoPointValue.latitude)&&gt(e.geoPointValue.longitude)===gt(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return gt(e.integerValue)===gt(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=gt(e.doubleValue),s=gt(t.doubleValue);return n===s?Ie(n)===Ie(s):isNaN(n)&&isNaN(s)}return!1}(e,t);case 9:return B(e.arrayValue.values||[],t.arrayValue.values||[],St);case 10:return function(e,t){const n=e.mapValue.fields||{},s=t.mapValue.fields||{};if(Je(n)!==Je(s))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===s[e]||!St(n[e],s[e])))return!1;return!0}(e,t);default:return _()}}function xt(e,t){return void 0!==(e.values||[]).find((e=>St(e,t)))}function Dt(e,t){if(e===t)return 0;const n=_t(e),s=_t(t);if(n!==s)return j(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return j(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=gt(e.integerValue||e.doubleValue),s=gt(t.integerValue||t.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(e,t);case 3:return Ct(e.timestampValue,t.timestampValue);case 4:return Ct(vt(e),vt(t));case 5:return j(e.stringValue,t.stringValue);case 6:return function(e,t){const n=pt(e),s=pt(t);return n.compareTo(s)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),s=t.split("/");for(let e=0;e<n.length&&e<s.length;e++){const t=j(n[e],s[e]);if(0!==t)return t}return j(n.length,s.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=j(gt(e.latitude),gt(t.latitude));return 0!==n?n:j(gt(e.longitude),gt(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],s=t.values||[];for(let e=0;e<n.length&&e<s.length;++e){const t=Dt(n[e],s[e]);if(t)return t}return j(n.length,s.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Tt.mapValue&&t===Tt.mapValue)return 0;if(e===Tt.mapValue)return 1;if(t===Tt.mapValue)return-1;const n=e.fields||{},s=Object.keys(n),i=t.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let e=0;e<s.length&&e<r.length;++e){const t=j(s[e],r[e]);if(0!==t)return t;const o=Dt(n[s[e]],i[r[e]]);if(0!==o)return o}return j(s.length,r.length)}(e.mapValue,t.mapValue);default:throw _()}}function Ct(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return j(e,t);const n=mt(e),s=mt(t),i=j(n.seconds,s.seconds);return 0!==i?i:j(n.nanos,s.nanos)}function At(e){return Nt(e)}function Nt(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=mt(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?pt(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,H.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const s of e.values||[])n?n=!1:t+=",",t+=Nt(s);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",s=!0;for(const i of t)s?s=!1:n+=",",n+=`${i}:${Nt(e.fields[i])}`;return n+"}"}(e.mapValue):_();var t,n}function kt(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Ot(e){return!!e&&"integerValue"in e}function Rt(e){return!!e&&"arrayValue"in e}function Mt(e){return!!e&&"nullValue"in e}function Lt(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ft(e){return!!e&&"mapValue"in e}function Pt(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Ze(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Pt(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Pt(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Vt(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function qt(e){return"nullValue"in e?Et:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?kt(It.empty(),H.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:_()}function Ut(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?kt(It.empty(),H.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Tt:_()}function jt(e,t){const n=Dt(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Bt(e,t){const n=Dt(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Kt{constructor(e){this.value=e}static empty(){return new Kt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ft(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Pt(t)}setAll(e){let t=W.emptyPath(),n={},s=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,s),n={},s=[],t=i.popLast()}e?n[i.lastSegment()]=Pt(e):s.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());Ft(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return St(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];Ft(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Ze(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Kt(Pt(this.value))}}function Gt(e){const t=[];return Ze(e.fields,((e,n)=>{const s=new W([e]);if(Ft(n)){const e=Gt(n.mapValue).fields;if(0===e.length)t.push(s);else for(const n of e)t.push(s.child(n))}else t.push(s)})),new ct(t)}class zt{constructor(e,t,n,s,i,r,o){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=r,this.documentState=o}static newInvalidDocument(e){return new zt(e,0,z.min(),z.min(),z.min(),Kt.empty(),0)}static newFoundDocument(e,t,n,s){return new zt(e,1,t,z.min(),n,s,0)}static newNoDocument(e,t){return new zt(e,2,t,z.min(),z.min(),Kt.empty(),0)}static newUnknownDocument(e,t){return new zt(e,3,t,z.min(),z.min(),Kt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Kt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof zt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new zt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class $t{constructor(e,t){this.position=e,this.inclusive=t}}function Qt(e,t,n){let s=0;for(let i=0;i<e.position.length;i++){const r=t[i],o=e.position[i];if(s=r.field.isKeyField()?H.comparator(H.fromName(o.referenceValue),n.key):Dt(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return s}function Wt(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!St(e.position[n],t.position[n]))return!1;return!0}class Ht{constructor(e,t="asc"){this.field=e,this.dir=t}}function Yt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Xt{}class Jt extends Xt{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new un(e,t,n):"array-contains"===t?new fn(e,n):"in"===t?new mn(e,n):"not-in"===t?new gn(e,n):"array-contains-any"===t?new pn(e,n):new Jt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new ln(e,n):new hn(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Dt(t,this.value)):null!==t&&_t(this.value)===_t(t)&&this.matchesComparison(Dt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return _()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Zt extends Xt{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new Zt(e,t)}matches(e){return en(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt((e=>e.isInequality()));return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function en(e){return"and"===e.op}function tn(e){return"or"===e.op}function nn(e){return rn(e)&&en(e)}function rn(e){for(const t of e.filters)if(t instanceof Zt)return!1;return!0}function sn(e){if(e instanceof Jt)return e.field.canonicalString()+e.op.toString()+At(e.value);if(nn(e))return e.filters.map((e=>sn(e))).join(",");{const t=e.filters.map((e=>sn(e))).join(",");return`${e.op}(${t})`}}function on(e,t){return e instanceof Jt?function(e,t){return t instanceof Jt&&e.op===t.op&&e.field.isEqual(t.field)&&St(e.value,t.value)}(e,t):e instanceof Zt?function(e,t){return t instanceof Zt&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,s)=>e&&on(n,t.filters[s])),!0)}(e,t):void _()}function an(e,t){const n=e.filters.concat(t);return Zt.create(n,e.op)}function cn(e){return e instanceof Jt?function(e){return`${e.field.canonicalString()} ${e.op} ${At(e.value)}`}(e):e instanceof Zt?function(e){return e.op.toString()+" {"+e.getFilters().map(cn).join(" ,")+"}"}(e):"Filter"}class un extends Jt{constructor(e,t,n){super(e,t,n),this.key=H.fromName(n.referenceValue)}matches(e){const t=H.comparator(e.key,this.key);return this.matchesComparison(t)}}class ln extends Jt{constructor(e,t){super(e,"in",t),this.keys=dn("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class hn extends Jt{constructor(e,t){super(e,"not-in",t),this.keys=dn("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function dn(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>H.fromName(e.referenceValue)))}class fn extends Jt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Rt(t)&&xt(t.arrayValue,this.value)}}class mn extends Jt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&xt(this.value.arrayValue,t)}}class gn extends Jt{constructor(e,t){super(e,"not-in",t)}matches(e){if(xt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!xt(this.value.arrayValue,t)}}class pn extends Jt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Rt(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>xt(this.value.arrayValue,e)))}}class yn{constructor(e,t=null,n=[],s=[],i=null,r=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.ft=null}}function wn(e,t=null,n=[],s=[],i=null,r=null,o=null){return new yn(e,t,n,s,i,r,o)}function vn(e){const t=D(e);if(null===t.ft){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>sn(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),be(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>At(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>At(e))).join(",")),t.ft=e}return t.ft}function bn(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Yt(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!on(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Wt(e.startAt,t.startAt)&&Wt(e.endAt,t.endAt)}function In(e){return H.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Tn(e,t){return e.filters.filter((e=>e instanceof Jt&&e.field.isEqual(t)))}function En(e,t,n){let s=Et,i=!0;for(const n of Tn(e,t)){let e=Et,t=!0;switch(n.op){case"<":case"<=":e=qt(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=Et}jt({value:s,inclusive:i},{value:e,inclusive:t})<0&&(s=e,i=t)}if(null!==n)for(let r=0;r<e.orderBy.length;++r)if(e.orderBy[r].field.isEqual(t)){const e=n.position[r];jt({value:s,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(s=e,i=n.inclusive);break}return{value:s,inclusive:i}}function _n(e,t,n){let s=Tt,i=!0;for(const n of Tn(e,t)){let e=Tt,t=!0;switch(n.op){case">=":case">":e=Ut(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=Tt}Bt({value:s,inclusive:i},{value:e,inclusive:t})>0&&(s=e,i=t)}if(null!==n)for(let r=0;r<e.orderBy.length;++r)if(e.orderBy[r].field.isEqual(t)){const e=n.position[r];Bt({value:s,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(s=e,i=n.inclusive);break}return{value:s,inclusive:i}}class Sn{constructor(e,t=null,n=[],s=[],i=null,r="F",o=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=u,this.dt=null,this.wt=null,this.startAt,this.endAt}}function xn(e,t,n,s,i,r,o,u){return new Sn(e,t,n,s,i,r,o,u)}function Dn(e){return new Sn(e)}function Cn(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function An(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Nn(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function kn(e){return null!==e.collectionGroup}function On(e){const t=D(e);if(null===t.dt){t.dt=[];const e=Nn(t),n=An(t);if(null!==e&&null===n)e.isKeyField()||t.dt.push(new Ht(e)),t.dt.push(new Ht(W.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.dt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.dt.push(new Ht(W.keyField(),e))}}}return t.dt}function Rn(e){const t=D(e);if(!t.wt)if("F"===t.limitType)t.wt=wn(t.path,t.collectionGroup,On(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of On(t)){const t="desc"===n.dir?"asc":"desc";e.push(new Ht(n.field,t))}const n=t.endAt?new $t(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new $t(t.startAt.position,t.startAt.inclusive):null;t.wt=wn(t.path,t.collectionGroup,e,t.filters,t.limit,n,s)}return t.wt}function Mn(e,t){t.getFirstInequalityField(),Nn(e);const n=e.filters.concat([t]);return new Sn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Ln(e,t,n){return new Sn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Fn(e,t){return bn(Rn(e),Rn(t))&&e.limitType===t.limitType}function Pn(e){return`${vn(Rn(e))}|lt:${e.limitType}`}function Vn(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>cn(e))).join(", ")}]`),be(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>At(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>At(e))).join(",")),`Target(${t})`}(Rn(e))}; limitType=${e.limitType})`}function qn(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):H.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of On(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const s=Qt(e,t,n);return e.inclusive?s<=0:s<0}(e.startAt,On(e),t))&&!(e.endAt&&!function(e,t,n){const s=Qt(e,t,n);return e.inclusive?s>=0:s>0}(e.endAt,On(e),t))}(e,t)}function Un(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function jn(e){return(t,n)=>{let s=!1;for(const i of On(e)){const e=Bn(i,t,n);if(0!==e)return e;s=s||i.field.isKeyField()}return 0}}function Bn(e,t,n){const s=e.field.isKeyField()?H.comparator(t.key,n.key):function(e,t,n){const s=t.data.field(e),i=n.data.field(e);return null!==s&&null!==i?Dt(s,i):_()}(e.field,t,n);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return _()}}class Kn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,s]of n)if(this.equalsFn(t,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],e))return void(s[n]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ze(this.inner,((t,n)=>{for(const[t,s]of n)e(t,s)}))}isEmpty(){return et(this.inner)}size(){return this.innerSize}}const Gn=new tt(H.comparator);function zn(){return Gn}const $n=new tt(H.comparator);function Qn(...e){let t=$n;for(const n of e)t=t.insert(n.key,n);return t}function Wn(e){let t=$n;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Hn(){return Xn()}function Yn(){return Xn()}function Xn(){return new Kn((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Jn=new tt(H.comparator),Zn=new it(H.comparator);function er(...e){let t=Zn;for(const n of e)t=t.add(n);return t}const nr=new it(j);function rr(){return nr}function sr(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ie(t)?"-0":t}}function ir(e){return{integerValue:""+e}}function or(e,t){return Te(t)?ir(t):sr(e,t)}class ar{constructor(){this._=void 0}}function cr(e,t,n){return e instanceof dr?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof fr?mr(e,t):e instanceof gr?pr(e,t):function(e,t){const n=lr(e,t),s=wr(n)+wr(e._t);return Ot(n)&&Ot(e._t)?ir(s):sr(e.serializer,s)}(e,t)}function ur(e,t,n){return e instanceof fr?mr(e,t):e instanceof gr?pr(e,t):n}function lr(e,t){return e instanceof yr?Ot(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class dr extends ar{}class fr extends ar{constructor(e){super(),this.elements=e}}function mr(e,t){const n=vr(t);for(const t of e.elements)n.some((e=>St(e,t)))||n.push(t);return{arrayValue:{values:n}}}class gr extends ar{constructor(e){super(),this.elements=e}}function pr(e,t){let n=vr(t);for(const t of e.elements)n=n.filter((e=>!St(e,t)));return{arrayValue:{values:n}}}class yr extends ar{constructor(e,t){super(),this.serializer=e,this._t=t}}function wr(e){return gt(e.integerValue||e.doubleValue)}function vr(e){return Rt(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ir{constructor(e,t){this.field=e,this.transform=t}}class Tr{constructor(e,t){this.version=e,this.transformResults=t}}class Er{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Er}static exists(e){return new Er(void 0,e)}static updateTime(e){return new Er(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function _r(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Sr{}function xr(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Fr(e.key,Er.none()):new kr(e.key,e.data,Er.none());{const n=e.data,s=Kt.empty();let i=new it(W.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?s.delete(e):s.set(e,t),i=i.add(e)}return new Or(e.key,s,new ct(i.toArray()),Er.none())}}function Dr(e,t,n){e instanceof kr?function(e,t,n){const s=e.value.clone(),i=Mr(e.fieldTransforms,t,n.transformResults);s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):e instanceof Or?function(e,t,n){if(!_r(e.precondition,t))return void t.convertToUnknownDocument(n.version);const s=Mr(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Rr(e)),i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Cr(e,t,n,s){return e instanceof kr?function(e,t,n,s){if(!_r(e.precondition,t))return n;const i=e.value.clone(),r=Lr(e.fieldTransforms,s,t);return i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,s):e instanceof Or?function(e,t,n,s){if(!_r(e.precondition,t))return n;const i=Lr(e.fieldTransforms,s,t),r=t.data;return r.setAll(Rr(e)),r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,s):function(e,t,n){return _r(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Ar(e,t){let n=null;for(const s of e.fieldTransforms){const e=t.data.field(s.field),i=lr(s.transform,e||null);null!=i&&(null===n&&(n=Kt.empty()),n.set(s.field,i))}return n||null}function Nr(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&B(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof fr&&t instanceof fr||e instanceof gr&&t instanceof gr?B(e.elements,t.elements,St):e instanceof yr&&t instanceof yr?St(e._t,t._t):e instanceof dr&&t instanceof dr}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class kr extends Sr{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Or extends Sr{constructor(e,t,n,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Rr(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=e.data.field(n);t.set(n,s)}})),t}function Mr(e,t,n){const s=new Map;S(e.length===n.length);for(let i=0;i<n.length;i++){const r=e[i],o=r.transform,u=t.data.field(r.field);s.set(r.field,ur(o,u,n[i]))}return s}function Lr(e,t,n){const s=new Map;for(const i of e){const e=i.transform,r=n.data.field(i.field);s.set(i.field,cr(e,r,t))}return s}class Fr extends Sr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Pr extends Sr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Vr{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const s=this.mutations[t];s.key.isEqual(e.key)&&Dr(s,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Cr(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Cr(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Yn();return this.mutations.forEach((s=>{const i=e.get(s.key),r=i.overlayedDocument;let o=this.applyToLocalView(r,i.mutatedFields);o=t.has(s.key)?null:o;const u=xr(r,o);null!==u&&n.set(s.key,u),r.isValidDocument()||r.convertToNoDocument(z.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),er())}isEqual(e){return this.batchId===e.batchId&&B(this.mutations,e.mutations,((e,t)=>Nr(e,t)))&&B(this.baseMutations,e.baseMutations,((e,t)=>Nr(e,t)))}}class qr{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){S(e.mutations.length===n.length);let s=Jn;const i=e.mutations;for(let e=0;e<i.length;e++)s=s.insert(i[e].key,n[e].version);return new qr(e,t,n,s)}}class Ur{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class jr{constructor(e){this.count=e}}var Br,Kr;function Gr(e){switch(e){default:return _();case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0}}function zr(e){if(void 0===e)return I("GRPC error has no .code"),C.UNKNOWN;switch(e){case Br.OK:return C.OK;case Br.CANCELLED:return C.CANCELLED;case Br.UNKNOWN:return C.UNKNOWN;case Br.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case Br.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case Br.INTERNAL:return C.INTERNAL;case Br.UNAVAILABLE:return C.UNAVAILABLE;case Br.UNAUTHENTICATED:return C.UNAUTHENTICATED;case Br.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case Br.NOT_FOUND:return C.NOT_FOUND;case Br.ALREADY_EXISTS:return C.ALREADY_EXISTS;case Br.PERMISSION_DENIED:return C.PERMISSION_DENIED;case Br.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case Br.ABORTED:return C.ABORTED;case Br.OUT_OF_RANGE:return C.OUT_OF_RANGE;case Br.UNIMPLEMENTED:return C.UNIMPLEMENTED;case Br.DATA_LOSS:return C.DATA_LOSS;default:return _()}}(Kr=Br||(Br={}))[Kr.OK=0]="OK",Kr[Kr.CANCELLED=1]="CANCELLED",Kr[Kr.UNKNOWN=2]="UNKNOWN",Kr[Kr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Kr[Kr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Kr[Kr.NOT_FOUND=5]="NOT_FOUND",Kr[Kr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Kr[Kr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Kr[Kr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Kr[Kr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Kr[Kr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Kr[Kr.ABORTED=10]="ABORTED",Kr[Kr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Kr[Kr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Kr[Kr.INTERNAL=13]="INTERNAL",Kr[Kr.UNAVAILABLE=14]="UNAVAILABLE",Kr[Kr.DATA_LOSS=15]="DATA_LOSS";class $r{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Qr}static getOrCreateInstance(){return null===Qr&&(Qr=new $r),Qr}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach((t=>t(e)))}}let Qr=null;class Wr{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,Hr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Wr(z.min(),s,rr(),zn(),er())}}class Hr{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Hr(n,t,er(),er(),er())}}class li{constructor(e,t,n,s){this.It=e,this.removedTargetIds=t,this.key=n,this.Tt=s}}class Yr{constructor(e,t){this.targetId=e,this.Et=t}}class Xr{constructor(e,t,n=ht.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class Jr{constructor(){this.At=0,this.Rt=ts(),this.vt=ht.EMPTY_BYTE_STRING,this.bt=!1,this.Pt=!0}get current(){return this.bt}get resumeToken(){return this.vt}get Vt(){return 0!==this.At}get St(){return this.Pt}Dt(e){e.approximateByteSize()>0&&(this.Pt=!0,this.vt=e)}Ct(){let e=er(),t=er(),n=er();return this.Rt.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:_()}})),new Hr(this.vt,this.bt,e,t,n)}xt(){this.Pt=!1,this.Rt=ts()}Nt(e,t){this.Pt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.Pt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}$t(){this.At-=1}Mt(){this.Pt=!0,this.bt=!0}}class Zr{constructor(e){this.Ft=e,this.Bt=new Map,this.Lt=zn(),this.qt=es(),this.Ut=new it(j)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}zt(e){this.forEachTarget(e,(t=>{const n=this.jt(t);switch(e.state){case 0:this.Wt(t)&&n.Dt(e.resumeToken);break;case 1:n.$t(),n.Vt||n.xt(),n.Dt(e.resumeToken);break;case 2:n.$t(),n.Vt||this.removeTarget(t);break;case 3:this.Wt(t)&&(n.Mt(),n.Dt(e.resumeToken));break;case 4:this.Wt(t)&&(this.Ht(t),n.Dt(e.resumeToken));break;default:_()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach(((e,n)=>{this.Wt(n)&&t(n)}))}Jt(e){var t;const n=e.targetId,s=e.Et.count,i=this.Yt(n);if(i){const r=i.target;if(In(r))if(0===s){const e=new H(r.path);this.Qt(n,e,zt.newNoDocument(e,z.min()))}else S(1===s);else{const i=this.Zt(n);i!==s&&(this.Ht(n),this.Ut=this.Ut.add(n),null===(t=$r.instance)||void 0===t||t.notifyOnExistenceFilterMismatch({localCacheCount:i,existenceFilterCount:e.Et.count}))}}}Xt(e){const t=new Map;this.Bt.forEach(((n,s)=>{const i=this.Yt(s);if(i){if(n.current&&In(i.target)){const t=new H(i.target.path);null!==this.Lt.get(t)||this.te(s,t)||this.Qt(s,t,zt.newNoDocument(t,e))}n.St&&(t.set(s,n.Ct()),n.xt())}}));let n=er();this.qt.forEach(((e,t)=>{let s=!0;t.forEachWhile((e=>{const t=this.Yt(e);return!t||2===t.purpose||(s=!1,!1)})),s&&(n=n.add(e))})),this.Lt.forEach(((t,n)=>n.setReadTime(e)));const s=new Wr(e,t,this.Ut,this.Lt,n);return this.Lt=zn(),this.qt=es(),this.Ut=new it(j),s}Gt(e,t){if(!this.Wt(e))return;const n=this.te(e,t.key)?2:0;this.jt(e).Nt(t.key,n),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,n){if(!this.Wt(e))return;const s=this.jt(e);this.te(e,t)?s.Nt(t,1):s.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),n&&(this.Lt=this.Lt.insert(t,n))}removeTarget(e){this.Bt.delete(e)}Zt(e){const t=this.jt(e).Ct();return this.Ft.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.jt(e).Ot()}jt(e){let t=this.Bt.get(e);return t||(t=new Jr,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new it(j),this.qt=this.qt.insert(e,t)),t}Wt(e){const t=null!==this.Yt(e);return t||v("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.Ft.ne(e)}Ht(e){this.Bt.set(e,new Jr),this.Ft.getRemoteKeysForTarget(e).forEach((t=>{this.Qt(e,t,null)}))}te(e,t){return this.Ft.getRemoteKeysForTarget(e).has(t)}}function es(){return new tt(H.comparator)}function ts(){return new tt(H.comparator)}const ns={asc:"ASCENDING",desc:"DESCENDING"},rs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ss={and:"AND",or:"OR"};class is{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function os(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function as(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function cs(e,t){return os(e,t.toTimestamp())}function us(e){return S(!!e),z.fromTimestamp(function(e){const t=mt(e);return new G(t.seconds,t.nanos)}(e))}function ls(e,t){return function(e){return new rt(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function hs(e){const t=rt.fromString(e);return S(Rs(t)),t}function ds(e,t){return ls(e.databaseId,t.path)}function fs(e,t){const n=hs(t);if(n.get(1)!==e.databaseId.projectId)throw new A(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new A(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new H(ys(n))}function ms(e,t){return ls(e.databaseId,t)}function gs(e){const t=hs(e);return 4===t.length?rt.emptyPath():ys(t)}function ps(e){return new rt(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ys(e){return S(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function ws(e,t,n){return{name:ds(e,t),fields:n.value.mapValue.fields}}function vs(e,t,n){const s=fs(e,t.name),i=us(t.updateTime),r=t.createTime?us(t.createTime):z.min(),o=new Kt({mapValue:{fields:t.fields}}),u=zt.newFoundDocument(s,i,r,o);return n&&u.setHasCommittedMutations(),n?u.setHasCommittedMutations():u}function bs(e,t){let n;if(t instanceof kr)n={update:ws(e,t.key,t.value)};else if(t instanceof Fr)n={delete:ds(e,t.key)};else if(t instanceof Or)n={update:ws(e,t.key,t.data),updateMask:Os(t.fieldMask)};else{if(!(t instanceof Pr))return _();n={verify:ds(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof dr)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof fr)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof gr)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof yr)return{fieldPath:t.field.canonicalString(),increment:n._t};throw _()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:cs(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:_()}(e,t.precondition)),n}function Is(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Er.updateTime(us(e.updateTime)):void 0!==e.exists?Er.exists(e.exists):Er.none()}(t.currentDocument):Er.none(),s=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)S("REQUEST_TIME"===t.setToServerValue),n=new dr;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new fr(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new gr(e)}else"increment"in t?n=new yr(e,t.increment):_();const s=W.fromServerFormat(t.fieldPath);return new Ir(s,n)}(e,t))):[];if(t.update){t.update.name;const i=fs(e,t.update.name),r=new Kt({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new ct(t.map((e=>W.fromServerFormat(e))))}(t.updateMask);return new Or(i,r,e,n,s)}return new kr(i,r,n,s)}if(t.delete){const s=fs(e,t.delete);return new Fr(s,n)}if(t.verify){const s=fs(e,t.verify);return new Pr(s,n)}return _()}function Ts(e,t){return{documents:[ms(e,t.path)]}}function Es(e,t){const n={structuredQuery:{}},s=t.path;null!==t.collectionGroup?(n.parent=ms(e,s),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=ms(e,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(e){if(0!==e.length)return ks(Zt.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const r=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:As(e.field),direction:xs(e.dir)}}(e)))}(t.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(e,t){return e.useProto3Json||be(t)?t:{value:t}}(e,t.limit);var u;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(u=t.startAt).inclusive,values:u.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function _s(e){let t=gs(e.parent);const n=e.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){S(1===s);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=function(e){const t=Ss(e);return t instanceof Zt&&nn(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new Ht(Ns(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let u=null;n.limit&&(u=function(e){let t;return t="object"==typeof e?e.value:e,be(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new $t(n,t)}(n.startAt));let a=null;return n.endAt&&(a=function(e){const t=!e.before,n=e.values||[];return new $t(n,t)}(n.endAt)),xn(t,i,o,r,u,"F",c,a)}function Ss(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Ns(e.unaryFilter.field);return Jt.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Ns(e.unaryFilter.field);return Jt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Ns(e.unaryFilter.field);return Jt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ns(e.unaryFilter.field);return Jt.create(i,"!=",{nullValue:"NULL_VALUE"});default:return _()}}(e):void 0!==e.fieldFilter?function(e){return Jt.create(Ns(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return _()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Zt.create(e.compositeFilter.filters.map((e=>Ss(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return _()}}(e.compositeFilter.op))}(e):_()}function xs(e){return ns[e]}function Ds(e){return rs[e]}function Cs(e){return ss[e]}function As(e){return{fieldPath:e.canonicalString()}}function Ns(e){return W.fromServerFormat(e.fieldPath)}function ks(e){return e instanceof Jt?function(e){if("=="===e.op){if(Lt(e.value))return{unaryFilter:{field:As(e.field),op:"IS_NAN"}};if(Mt(e.value))return{unaryFilter:{field:As(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Lt(e.value))return{unaryFilter:{field:As(e.field),op:"IS_NOT_NAN"}};if(Mt(e.value))return{unaryFilter:{field:As(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:As(e.field),op:Ds(e.op),value:e.value}}}(e):e instanceof Zt?function(e){const t=e.getFilters().map((e=>ks(e)));return 1===t.length?t[0]:{compositeFilter:{op:Cs(e.op),filters:t}}}(e):_()}function Os(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Rs(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class tr{constructor(e,t,n,s,i=z.min(),r=z.min(),o=ht.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(e){return new tr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new tr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new tr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Ms{constructor(e){this.se=e}}function Ls(e,t){const n=t.key,s={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Fs(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())s.document=function(e,t){return{name:ds(e,t.key),fields:t.data.value.mapValue.fields,updateTime:os(e,t.version.toTimestamp()),createTime:os(e,t.createTime.toTimestamp())}}(e.se,t);else if(t.isNoDocument())s.noDocument={path:n.path.toArray(),readTime:Ps(t.version)};else{if(!t.isUnknownDocument())return _();s.unknownDocument={path:n.path.toArray(),version:Ps(t.version)}}return s}function Fs(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Ps(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Vs(e){const t=new G(e.seconds,e.nanoseconds);return z.fromTimestamp(t)}function qs(e,t){const n=(t.baseMutations||[]).map((t=>Is(e.se,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const s=t.mutations[e+1];n.updateTransforms=s.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const s=t.mutations.map((t=>Is(e.se,t))),i=G.fromMillis(t.localWriteTimeMs);return new Vr(t.batchId,i,n,s)}function Us(e){const t=Vs(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Vs(e.lastLimboFreeSnapshotVersion):z.min();let s;var i;return void 0!==e.query.documents?(S(1===(i=e.query).documents.length),s=Rn(Dn(gs(i.documents[0])))):s=function(e){return Rn(_s(e))}(e.query),new tr(s,e.targetId,0,e.lastListenSequenceNumber,t,n,ht.fromBase64String(e.resumeToken))}function js(e,t){const n=Ps(t.snapshotVersion),s=Ps(t.lastLimboFreeSnapshotVersion);let i;i=In(t.target)?Ts(e.se,t.target):Es(e.se,t.target);const r=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:vn(t.target),readTime:n,resumeToken:r,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:i}}function hr(e){const t=_s({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ln(t,t.limit,"L"):t}function Bs(e,t){return new Ur(t.largestBatchId,Is(e.se,t.overlayMutation))}function Ks(e,t){const n=t.path.lastSegment();return[e,Ee(t.path.popLast()),n]}function Gs(e,t,n,s){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Ps(s.readTime),documentKey:Ee(s.documentKey.path),largestBatchId:s.largestBatchId}}class zs{getBundleMetadata(e,t){return $s(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:Vs(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return $s(e).put({bundleId:(n=t).id,createTime:Ps(us(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Qs(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:hr(t.bundledQuery),readTime:Vs(t.readTime)};var t}))}saveNamedQuery(e,t){return Qs(e).put(function(e){return{name:e.name,readTime:Ps(us(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function $s(e){return Xe(e,"bundles")}function Qs(e){return Xe(e,"namedQueries")}class Ws{constructor(e,t){this.serializer=e,this.userId=t}static ie(e,t){const n=t.uid||"";return new Ws(e,n)}getOverlay(e,t){return Hs(e).get(Ks(this.userId,t)).next((e=>e?Bs(this.serializer,e):null))}getOverlays(e,t){const n=Hn();return ae.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const s=[];return n.forEach(((n,i)=>{const r=new Ur(t,i);s.push(this.re(e,r))})),ae.waitFor(s)}removeOverlaysForBatchId(e,t,n){const s=new Set;t.forEach((e=>s.add(Ee(e.getCollectionPath()))));const i=[];return s.forEach((t=>{const s=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(Hs(e).J("collectionPathOverlayIndex",s))})),ae.waitFor(i)}getOverlaysForCollection(e,t,n){const s=Hn(),i=Ee(t),r=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Hs(e).j("collectionPathOverlayIndex",r).next((e=>{for(const t of e){const e=Bs(this.serializer,t);s.set(e.getKey(),e)}return s}))}getOverlaysForCollectionGroup(e,t,n,s){const i=Hn();let r;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Hs(e).Z({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=Bs(this.serializer,t);i.size()<s||o.largestBatchId===r?(i.set(o.getKey(),o),r=o.largestBatchId):n.done()})).next((()=>i))}re(e,t){return Hs(e).put(function(e,t,n){const[s,i,r]=Ks(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:r,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:bs(e.se,n.mutation)}}(this.serializer,this.userId,t))}}function Hs(e){return Xe(e,"documentOverlays")}class Ys{constructor(){}oe(e,t){this.ue(e,t),t.ce()}ue(e,t){if("nullValue"in e)this.ae(t,5);else if("booleanValue"in e)this.ae(t,10),t.he(e.booleanValue?1:0);else if("integerValue"in e)this.ae(t,15),t.he(gt(e.integerValue));else if("doubleValue"in e){const n=gt(e.doubleValue);isNaN(n)?this.ae(t,13):(this.ae(t,15),Ie(n)?t.he(0):t.he(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ae(t,20),"string"==typeof n?t.le(n):(t.le(`${n.seconds||""}`),t.he(n.nanos||0))}else if("stringValue"in e)this.fe(e.stringValue,t),this.de(t);else if("bytesValue"in e)this.ae(t,30),t.we(pt(e.bytesValue)),this.de(t);else if("referenceValue"in e)this._e(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ae(t,45),t.he(n.latitude||0),t.he(n.longitude||0)}else"mapValue"in e?Vt(e)?this.ae(t,Number.MAX_SAFE_INTEGER):(this.me(e.mapValue,t),this.de(t)):"arrayValue"in e?(this.ge(e.arrayValue,t),this.de(t)):_()}fe(e,t){this.ae(t,25),this.ye(e,t)}ye(e,t){t.le(e)}me(e,t){const n=e.fields||{};this.ae(t,55);for(const e of Object.keys(n))this.fe(e,t),this.ue(n[e],t)}ge(e,t){const n=e.values||[];this.ae(t,50);for(const e of n)this.ue(e,t)}_e(e,t){this.ae(t,37),H.fromName(e).path.forEach((e=>{this.ae(t,60),this.ye(e,t)}))}ae(e,t){e.he(t)}de(e){e.he(2)}}function Xs(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function Js(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const s=Xs(255&e[n]);if(t+=s,8!==s)break}return t}(e);return Math.ceil(t/8)}Ys.pe=new Ys;class Zs{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ie(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Te(n.value),n=t.next();this.Ee()}Ae(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Re(n.value),n=t.next();this.ve()}be(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Te(e);else if(e<2048)this.Te(960|e>>>6),this.Te(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Te(480|e>>>12),this.Te(128|63&e>>>6),this.Te(128|63&e);else{const e=t.codePointAt(0);this.Te(240|e>>>18),this.Te(128|63&e>>>12),this.Te(128|63&e>>>6),this.Te(128|63&e)}}this.Ee()}Pe(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Re(e);else if(e<2048)this.Re(960|e>>>6),this.Re(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Re(480|e>>>12),this.Re(128|63&e>>>6),this.Re(128|63&e);else{const e=t.codePointAt(0);this.Re(240|e>>>18),this.Re(128|63&e>>>12),this.Re(128|63&e>>>6),this.Re(128|63&e)}}this.ve()}Ve(e){const t=this.Se(e),n=Js(t);this.De(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Ce(e){const t=this.Se(e),n=Js(t);this.De(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}xe(){this.Ne(255),this.Ne(255)}ke(){this.Oe(255),this.Oe(255)}reset(){this.position=0}seed(e){this.De(e.length),this.buffer.set(e,this.position),this.position+=e.length}$e(){return this.buffer.slice(0,this.position)}Se(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Te(e){const t=255&e;0===t?(this.Ne(0),this.Ne(255)):255===t?(this.Ne(255),this.Ne(0)):this.Ne(t)}Re(e){const t=255&e;0===t?(this.Oe(0),this.Oe(255)):255===t?(this.Oe(255),this.Oe(0)):this.Oe(e)}Ee(){this.Ne(0),this.Ne(1)}ve(){this.Oe(0),this.Oe(1)}Ne(e){this.De(1),this.buffer[this.position++]=e}Oe(e){this.De(1),this.buffer[this.position++]=~e}De(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class ei{constructor(e){this.Me=e}we(e){this.Me.Ie(e)}le(e){this.Me.be(e)}he(e){this.Me.Ve(e)}ce(){this.Me.xe()}}class ti{constructor(e){this.Me=e}we(e){this.Me.Ae(e)}le(e){this.Me.Pe(e)}he(e){this.Me.Ce(e)}ce(){this.Me.ke()}}class ni{constructor(){this.Me=new Zs,this.Fe=new ei(this.Me),this.Be=new ti(this.Me)}seed(e){this.Me.seed(e)}Le(e){return 0===e?this.Fe:this.Be}$e(){return this.Me.$e()}reset(){this.Me.reset()}}class br{constructor(e,t,n,s){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=s}qe(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new br(this.indexId,this.documentKey,this.arrayValue,n)}}function ri(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=si(e.arrayValue,t.arrayValue),0!==n?n:(n=si(e.directionalValue,t.directionalValue),0!==n?n:H.comparator(e.documentKey,t.documentKey)))}function si(e,t){for(let n=0;n<e.length&&n<t.length;++n){const s=e[n]-t[n];if(0!==s)return s}return e.length-t.length}class ii{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ue=e.orderBy,this.Ke=[];for(const t of e.filters){const e=t;e.isInequality()?this.Ge=e:this.Ke.push(e)}}Qe(e){S(e.collectionGroup===this.collectionId);const t=X(e);if(void 0!==t&&!this.ze(t))return!1;const n=J(e);let s=0,i=0;for(;s<n.length&&this.ze(n[s]);++s);if(s===n.length)return!0;if(void 0!==this.Ge){const e=n[s];if(!this.je(this.Ge,e)||!this.We(this.Ue[i++],e))return!1;++s}for(;s<n.length;++s){const e=n[s];if(i>=this.Ue.length||!this.We(this.Ue[i++],e))return!1}return!0}ze(e){for(const t of this.Ke)if(this.je(t,e))return!0;return!1}je(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}We(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function oi(e){var t,n;if(S(e instanceof Jt||e instanceof Zt),e instanceof Jt){if(e instanceof mn){const s=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>Jt.create(e.field,"==",t))))||[];return Zt.create(s,"or")}return e}const s=e.filters.map((e=>oi(e)));return Zt.create(s,e.op)}function ai(e){if(0===e.getFilters().length)return[];const t=di(oi(e));return S(hi(t)),ci(t)||ui(t)?[t]:t.getFilters()}function ci(e){return e instanceof Jt}function ui(e){return e instanceof Zt&&nn(e)}function hi(e){return ci(e)||ui(e)||function(e){if(e instanceof Zt&&tn(e)){for(const t of e.getFilters())if(!ci(t)&&!ui(t))return!1;return!0}return!1}(e)}function di(e){if(S(e instanceof Jt||e instanceof Zt),e instanceof Jt)return e;if(1===e.filters.length)return di(e.filters[0]);const t=e.filters.map((e=>di(e)));let n=Zt.create(t,e.op);return n=gi(n),hi(n)?n:(S(n instanceof Zt),S(en(n)),S(n.filters.length>1),n.filters.reduce(((e,t)=>fi(e,t))))}function fi(e,t){let n;return S(e instanceof Jt||e instanceof Zt),S(t instanceof Jt||t instanceof Zt),n=e instanceof Jt?t instanceof Jt?function(e,t){return Zt.create([e,t],"and")}(e,t):mi(e,t):t instanceof Jt?mi(t,e):function(e,t){if(S(e.filters.length>0&&t.filters.length>0),en(e)&&en(t))return an(e,t.getFilters());const n=tn(e)?e:t,s=tn(e)?t:e,i=n.filters.map((e=>fi(e,s)));return Zt.create(i,"or")}(e,t),gi(n)}function mi(e,t){if(en(t))return an(t,e.getFilters());{const n=t.filters.map((t=>fi(e,t)));return Zt.create(n,"or")}}function gi(e){if(S(e instanceof Jt||e instanceof Zt),e instanceof Jt)return e;const t=e.getFilters();if(1===t.length)return gi(t[0]);if(rn(e))return e;const n=t.map((e=>gi(e))),s=[];return n.forEach((t=>{t instanceof Jt?s.push(t):t instanceof Zt&&(t.op===e.op?s.push(...t.filters):s.push(t))})),1===s.length?s[0]:Zt.create(s,e.op)}class pi{constructor(){this.He=new yi}addToCollectionParentIndex(e,t){return this.He.add(t),ae.resolve()}getCollectionParents(e,t){return ae.resolve(this.He.getEntries(t))}addFieldIndex(e,t){return ae.resolve()}deleteFieldIndex(e,t){return ae.resolve()}getDocumentsMatchingTarget(e,t){return ae.resolve(null)}getIndexType(e,t){return ae.resolve(0)}getFieldIndexes(e,t){return ae.resolve([])}getNextCollectionGroupToUpdate(e){return ae.resolve(null)}getMinOffset(e,t){return ae.resolve(ne.min())}getMinOffsetFromCollectionGroup(e,t){return ae.resolve(ne.min())}updateCollectionGroup(e,t,n){return ae.resolve()}updateIndexEntries(e,t){return ae.resolve()}}class yi{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new it(rt.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new it(rt.comparator)).toArray()}}const wi=new Uint8Array(0);class vi{constructor(e,t){this.user=e,this.databaseId=t,this.Je=new yi,this.Ye=new Kn((e=>vn(e)),((e,t)=>bn(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Je.has(t)){const n=t.lastSegment(),s=t.popLast();e.addOnCommittedListener((()=>{this.Je.add(t)}));const i={collectionId:n,parent:Ee(s)};return bi(e).put(i)}return ae.resolve()}getCollectionParents(e,t){const n=[],s=IDBKeyRange.bound([t,""],[K(t),""],!1,!0);return bi(e).j(s).next((e=>{for(const s of e){if(s.collectionId!==t)break;n.push(xe(s.parent))}return n}))}addFieldIndex(e,t){const n=Ti(e),s=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete s.indexId;const i=n.add(s);if(t.indexState){const n=Ei(e);return i.next((e=>{n.put(Gs(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Ti(e),s=Ei(e),i=Ii(e);return n.delete(t.indexId).next((()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=Ii(e);let s=!0;const i=new Map;return ae.forEach(this.Ze(t),(t=>this.Xe(e,t).next((e=>{s&&(s=!!e),i.set(t,e)})))).next((()=>{if(s){let e=er();const s=[];return ae.forEach(i,((i,r)=>{var o;v("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${vn(t)}`);const u=function(e,t){const n=X(t);if(void 0===n)return null;for(const t of Tn(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(r,i),c=function(e,t){const n=new Map;for(const s of J(t))for(const t of Tn(e,s.fieldPath))switch(t.op){case"==":case"in":n.set(s.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(s.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(r,i),a=function(e,t){const n=[];let s=!0;for(const i of J(t)){const t=0===i.kind?En(e,i.fieldPath,e.startAt):_n(e,i.fieldPath,e.startAt);n.push(t.value),s&&(s=t.inclusive)}return new $t(n,s)}(r,i),l=function(e,t){const n=[];let s=!0;for(const i of J(t)){const t=0===i.kind?_n(e,i.fieldPath,e.endAt):En(e,i.fieldPath,e.endAt);n.push(t.value),s&&(s=t.inclusive)}return new $t(n,s)}(r,i),h=this.tn(i,r,a),d=this.tn(i,r,l),f=this.en(i,r,c),m=this.nn(i.indexId,u,h,a.inclusive,d,l.inclusive,f);return ae.forEach(m,(i=>n.H(i,t.limit).next((t=>{t.forEach((t=>{const n=H.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),s.push(n))}))}))))})).next((()=>s))}return ae.resolve(null)}))}Ze(e){let t=this.Ye.get(e);return t||(t=0===e.filters.length?[e]:ai(Zt.create(e.filters,"and")).map((t=>wn(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.Ye.set(e,t),t)}nn(e,t,n,s,i,r,o){const u=(null!=t?t.length:1)*Math.max(n.length,i.length),c=u/(null!=t?t.length:1),a=[];for(let l=0;l<u;++l){const u=t?this.sn(t[l/c]):wi,h=this.rn(e,u,n[l%c],s),d=this.on(e,u,i[l%c],r),f=o.map((t=>this.rn(e,u,t,!0)));a.push(...this.createRange(h,d,f))}return a}rn(e,t,n,s){const i=new br(e,H.empty(),t,n);return s?i:i.qe()}on(e,t,n,s){const i=new br(e,H.empty(),t,n);return s?i.qe():i}Xe(e,t){const n=new ii(t),s=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next((e=>{let t=null;for(const s of e)n.Qe(s)&&(!t||s.fields.length>t.fields.length)&&(t=s);return t}))}getIndexType(e,t){let n=2;const s=this.Ze(t);return ae.forEach(s,(t=>this.Xe(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new it(W.comparator),n=!1;for(const s of e.filters)for(const e of s.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&s.length>1&&2===n?1:n))}un(e,t){const n=new ni;for(const s of J(e)){const e=t.data.field(s.fieldPath);if(null==e)return null;const i=n.Le(s.kind);Ys.pe.oe(e,i)}return n.$e()}sn(e){const t=new ni;return Ys.pe.oe(e,t.Le(0)),t.$e()}cn(e,t){const n=new ni;return Ys.pe.oe(kt(this.databaseId,t),n.Le(function(e){const t=J(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.$e()}en(e,t,n){if(null===n)return[];let s=[];s.push(new ni);let i=0;for(const r of J(e)){const e=n[i++];for(const n of s)if(this.an(t,r.fieldPath)&&Rt(e))s=this.hn(s,r,e);else{const t=n.Le(r.kind);Ys.pe.oe(e,t)}}return this.ln(s)}tn(e,t,n){return this.en(e,t,n.position)}ln(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].$e();return t}hn(e,t,n){const s=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of s){const s=new ni;s.seed(n.$e()),Ys.pe.oe(e,s.Le(t.kind)),i.push(s)}return i}an(e,t){return!!e.filters.find((e=>e instanceof Jt&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Ti(e),s=Ei(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next((e=>{const t=[];return ae.forEach(e,(e=>s.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new Z(t.sequenceNumber,new ne(Vs(t.readTime),new H(xe(t.documentKey)),t.largestBatchId)):Z.empty(),s=e.fields.map((([e,t])=>new dt(W.fromServerFormat(e),t)));return new Y(e.indexId,e.collectionGroup,s,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:j(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const s=Ti(e),i=Ei(e);return this.fn(e).next((e=>s.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>ae.forEach(t,(t=>i.put(Gs(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return ae.forEach(t,((t,s)=>{const i=n.get(t.collectionGroup);return(i?ae.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),ae.forEach(i,(n=>this.dn(e,t,n).next((t=>{const i=this.wn(s,n);return t.isEqual(i)?ae.resolve():this._n(e,s,n,t,i)})))))))}))}mn(e,t,n,s){return Ii(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.cn(n,t.key),documentKey:t.key.path.toArray()})}gn(e,t,n,s){return Ii(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.cn(n,t.key),t.key.path.toArray()])}dn(e,t,n){const s=Ii(e);let i=new it(ri);return s.Z({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.cn(n,t)])},((e,s)=>{i=i.add(new br(n.indexId,t,s.arrayValue,s.directionalValue))})).next((()=>i))}wn(e,t){let n=new it(ri);const s=this.un(t,e);if(null==s)return n;const i=X(t);if(null!=i){const r=e.data.field(i.fieldPath);if(Rt(r))for(const i of r.arrayValue.values||[])n=n.add(new br(t.indexId,e.key,this.sn(i),s))}else n=n.add(new br(t.indexId,e.key,wi,s));return n}_n(e,t,n,s,i){v("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const r=[];return function(e,t,n,s,i){const r=e.getIterator(),o=t.getIterator();let u=at(r),c=at(o);for(;u||c;){let e=!1,t=!1;if(u&&c){const s=n(u,c);s<0?t=!0:s>0&&(e=!0)}else null!=u?t=!0:e=!0;e?(s(c),c=at(o)):t?(i(u),u=at(r)):(u=at(r),c=at(o))}}(s,i,ri,(s=>{r.push(this.mn(e,t,n,s))}),(s=>{r.push(this.gn(e,t,n,s))})),ae.waitFor(r)}fn(e){let t=1;return Ei(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,s)=>{s.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>ri(e,t))).filter(((e,t,n)=>!t||0!==ri(e,n[t-1])));const s=[];s.push(e);for(const i of n){const n=ri(i,e),r=ri(i,t);if(0===n)s[0]=e.qe();else if(n>0&&r<0)s.push(i),s.push(i.qe());else if(r>0)break}s.push(t);const i=[];for(let e=0;e<s.length;e+=2){if(this.yn(s[e],s[e+1]))return[];const t=[s[e].indexId,this.uid,s[e].arrayValue,s[e].directionalValue,wi,[]],n=[s[e+1].indexId,this.uid,s[e+1].arrayValue,s[e+1].directionalValue,wi,[]];i.push(IDBKeyRange.bound(t,n))}return i}yn(e,t){return ri(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(_i)}getMinOffset(e,t){return ae.mapArray(this.Ze(t),(t=>this.Xe(e,t).next((e=>e||_())))).next(_i)}}function bi(e){return Xe(e,"collectionParents")}function Ii(e){return Xe(e,"indexEntries")}function Ti(e){return Xe(e,"indexConfiguration")}function Ei(e){return Xe(e,"indexState")}function _i(e){S(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let s=1;s<e.length;s++){const i=e[s].indexState.offset;re(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new ne(t.readTime,t.documentKey,n)}const Si={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class xi{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new xi(e,xi.DEFAULT_COLLECTION_PERCENTILE,xi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Di(e,t,n){const s=e.store("mutations"),i=e.store("documentMutations"),r=[],o=IDBKeyRange.only(n.batchId);let u=0;const c=s.Z({range:o},((e,t,n)=>(u++,n.delete())));r.push(c.next((()=>{S(1===u)})));const a=[];for(const e of n.mutations){const s=Ae(t,e.key.path,n.batchId);r.push(i.delete(s)),a.push(e.key)}return ae.waitFor(r).next((()=>a))}function Ci(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw _();t=e.noDocument}return JSON.stringify(t).length}xi.DEFAULT_COLLECTION_PERCENTILE=10,xi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,xi.DEFAULT=new xi(41943040,xi.DEFAULT_COLLECTION_PERCENTILE,xi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),xi.DISABLED=new xi(-1,0,0);class Ai{constructor(e,t,n,s){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=s,this.pn={}}static ie(e,t,n,s){S(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Ai(i,t,n,s)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ki(e).Z({index:"userMutationsIndex",range:n},((e,n,s)=>{t=!1,s.done()})).next((()=>t))}addMutationBatch(e,t,n,s){const i=Oi(e),r=ki(e);return r.add({}).next((o=>{S("number"==typeof o);const u=new Vr(o,t,n,s),c=function(e,t,n){const s=n.baseMutations.map((t=>bs(e.se,t))),i=n.mutations.map((t=>bs(e.se,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:s,mutations:i}}(this.serializer,this.userId,u),a=[];let l=new it(((e,t)=>j(e.canonicalString(),t.canonicalString())));for(const e of s){const t=Ae(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),a.push(r.put(c)),a.push(i.put(t,Ne))}return l.forEach((t=>{a.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.pn[o]=u.keys()})),ae.waitFor(a).next((()=>u))}))}lookupMutationBatch(e,t){return ki(e).get(t).next((e=>e?(S(e.userId===this.userId),qs(this.serializer,e)):null))}In(e,t){return this.pn[t]?ae.resolve(this.pn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.pn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return ki(e).Z({index:"userMutationsIndex",range:s},((e,t,s)=>{t.userId===this.userId&&(S(t.batchId>=n),i=qs(this.serializer,t)),s.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return ki(e).Z({index:"userMutationsIndex",range:t,reverse:!0},((e,t,s)=>{n=t.batchId,s.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ki(e).j("userMutationsIndex",t).next((e=>e.map((e=>qs(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Ce(this.userId,t.path),s=IDBKeyRange.lowerBound(n),i=[];return Oi(e).Z({range:s},((n,s,r)=>{const[o,u,c]=n,a=xe(u);if(o===this.userId&&t.path.isEqual(a))return ki(e).get(c).next((e=>{if(!e)throw _();S(e.userId===this.userId),i.push(qs(this.serializer,e))}));r.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new it(j);const s=[];return t.forEach((t=>{const i=Ce(this.userId,t.path),r=IDBKeyRange.lowerBound(i),o=Oi(e).Z({range:r},((e,s,i)=>{const[r,o,u]=e,c=xe(o);r===this.userId&&t.path.isEqual(c)?n=n.add(u):i.done()}));s.push(o)})),ae.waitFor(s).next((()=>this.Tn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1,i=Ce(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new it(j);return Oi(e).Z({range:r},((e,t,i)=>{const[r,u,c]=e,a=xe(u);r===this.userId&&n.isPrefixOf(a)?a.length===s&&(o=o.add(c)):i.done()})).next((()=>this.Tn(e,o)))}Tn(e,t){const n=[],s=[];return t.forEach((t=>{s.push(ki(e).get(t).next((e=>{if(null===e)throw _();S(e.userId===this.userId),n.push(qs(this.serializer,e))})))})),ae.waitFor(s).next((()=>n))}removeMutationBatch(e,t){return Di(e.at,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.En(t.batchId)})),ae.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}En(e){delete this.pn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return ae.resolve();const n=IDBKeyRange.lowerBound([this.userId]),s=[];return Oi(e).Z({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=xe(e[1]);s.push(t)}else n.done()})).next((()=>{S(0===s.length)}))}))}containsKey(e,t){return Ni(e,this.userId,t)}An(e){return Ri(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Ni(e,t,n){const s=Ce(t,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return Oi(e).Z({range:r,Y:!0},((e,n,s)=>{const[r,u,c]=e;r===t&&u===i&&(o=!0),s.done()})).next((()=>o))}function ki(e){return Xe(e,"mutations")}function Oi(e){return Xe(e,"documentMutations")}function Ri(e){return Xe(e,"mutationQueues")}class Mi{constructor(e){this.Rn=e}next(){return this.Rn+=2,this.Rn}static vn(){return new Mi(0)}static bn(){return new Mi(-1)}}class Li{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Pn(e).next((t=>{const n=new Mi(t.highestTargetId);return t.highestTargetId=n.next(),this.Vn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.Pn(e).next((e=>z.fromTimestamp(new G(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.Pn(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.Pn(e).next((s=>(s.highestListenSequenceNumber=t,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Vn(e,s))))}addTargetData(e,t){return this.Sn(e,t).next((()=>this.Pn(e).next((n=>(n.targetCount+=1,this.Dn(t,n),this.Vn(e,n))))))}updateTargetData(e,t){return this.Sn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Fi(e).delete(t.targetId))).next((()=>this.Pn(e))).next((t=>(S(t.targetCount>0),t.targetCount-=1,this.Vn(e,t))))}removeTargets(e,t,n){let s=0;const i=[];return Fi(e).Z(((r,o)=>{const u=Us(o);u.sequenceNumber<=t&&null===n.get(u.targetId)&&(s++,i.push(this.removeTargetData(e,u)))})).next((()=>ae.waitFor(i))).next((()=>s))}forEachTarget(e,t){return Fi(e).Z(((e,n)=>{const s=Us(n);t(s)}))}Pn(e){return Pi(e).get("targetGlobalKey").next((e=>(S(null!==e),e)))}Vn(e,t){return Pi(e).put("targetGlobalKey",t)}Sn(e,t){return Fi(e).put(js(this.serializer,t))}Dn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Pn(e).next((e=>e.targetCount))}getTargetData(e,t){const n=vn(t),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Fi(e).Z({range:s,index:"queryTargetsIndex"},((e,n,s)=>{const r=Us(n);bn(t,r.target)&&(i=r,s.done())})).next((()=>i))}addMatchingKeys(e,t,n){const s=[],i=Vi(e);return t.forEach((t=>{const r=Ee(t.path);s.push(i.put({targetId:n,path:r})),s.push(this.referenceDelegate.addReference(e,n,t))})),ae.waitFor(s)}removeMatchingKeys(e,t,n){const s=Vi(e);return ae.forEach(t,(t=>{const i=Ee(t.path);return ae.waitFor([s.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Vi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),s=Vi(e);let i=er();return s.Z({range:n,Y:!0},((e,t,n)=>{const s=xe(e[1]),r=new H(s);i=i.add(r)})).next((()=>i))}containsKey(e,t){const n=Ee(t.path),s=IDBKeyRange.bound([n],[K(n)],!1,!0);let i=0;return Vi(e).Z({index:"documentTargetsIndex",Y:!0,range:s},(([e,t],n,s)=>{0!==e&&(i++,s.done())})).next((()=>i>0))}ne(e,t){return Fi(e).get(t).next((e=>e?Us(e):null))}}function Fi(e){return Xe(e,"targets")}function Pi(e){return Xe(e,"targetGlobal")}function Vi(e){return Xe(e,"targetDocuments")}function qi([e,t],[n,s]){const i=j(e,n);return 0===i?j(t,s):i}class Ui{constructor(e){this.Cn=e,this.buffer=new it(qi),this.xn=0}Nn(){return++this.xn}kn(e){const t=[e,this.Nn()];if(this.buffer.size<this.Cn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();qi(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ji{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.On=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.$n(6e4)}stop(){this.On&&(this.On.cancel(),this.On=null)}get started(){return null!==this.On}$n(e){v("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.On=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.On=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){de(e)?v("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await oe(e)}await this.$n(3e5)}))}}class Bi{constructor(e,t){this.Mn=e,this.params=t}calculateTargetCount(e,t){return this.Mn.Fn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return ae.resolve(ve.ct);const n=new Ui(t);return this.Mn.forEachTarget(e,(e=>n.kn(e.sequenceNumber))).next((()=>this.Mn.Bn(e,(e=>n.kn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.Mn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Mn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector","Garbage collection skipped; disabled"),ae.resolve(Si)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Si):this.Ln(e,t)))}getCacheSize(e){return this.Mn.getCacheSize(e)}Ln(e,t){let n,s,i,r,o,l,a;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),s=this.params.maximumSequenceNumbersToCollect):s=t,r=Date.now(),this.nthSequenceNumber(e,s)))).next((s=>(n=s,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(a=Date.now(),y()<=c.a.DEBUG&&v("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-h}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(l-o)+"ms\n"+`\tRemoved ${e} documents in `+(a-l)+"ms\n"+`Total Duration: ${a-h}ms`),ae.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:e}))))}}class Ki{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Bi(e,t)}(this,t)}Fn(e){const t=this.qn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}qn(e){let t=0;return this.Bn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Bn(e,t){return this.Un(e,((e,n)=>t(n)))}addReference(e,t,n){return Gi(e,n)}removeReference(e,t,n){return Gi(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Gi(e,t)}Kn(e,t){return function(e,t){let n=!1;return Ri(e).X((s=>Ni(e,s,t).next((e=>(e&&(n=!0),ae.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Un(e,((r,o)=>{if(o<=t){const t=this.Kn(e,r).next((t=>{if(!t)return i++,n.getEntry(e,r).next((()=>(n.removeEntry(r,z.min()),Vi(e).delete([0,Ee(r.path)]))))}));s.push(t)}})).next((()=>ae.waitFor(s))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Gi(e,t)}Un(e,t){const n=Vi(e);let s,i=ve.ct;return n.Z({index:"documentTargetsIndex"},(([e,n],{path:r,sequenceNumber:o})=>{0===e?(i!==ve.ct&&t(new H(xe(s)),i),i=o,s=r):i=ve.ct})).next((()=>{i!==ve.ct&&t(new H(xe(s)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Gi(e,t){return Vi(e).put(function(e,t){return{targetId:0,path:Ee(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class zi{constructor(){this.changes=new Kn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,zt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ae.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class $i{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Yi(e).put(n)}removeEntry(e,t,n){return Yi(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Fs(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Gn(e,n))))}getEntry(e,t){let n=zt.newInvalidDocument(t);return Yi(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Xi(t))},((e,s)=>{n=this.Qn(t,s)})).next((()=>n))}zn(e,t){let n={size:0,document:zt.newInvalidDocument(t)};return Yi(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Xi(t))},((e,s)=>{n={document:this.Qn(t,s),size:Ci(s)}})).next((()=>n))}getEntries(e,t){let n=zn();return this.jn(e,t,((e,t)=>{const s=this.Qn(e,t);n=n.insert(e,s)})).next((()=>n))}Wn(e,t){let n=zn(),s=new tt(H.comparator);return this.jn(e,t,((e,t)=>{const i=this.Qn(e,t);n=n.insert(e,i),s=s.insert(e,Ci(t))})).next((()=>({documents:n,Hn:s})))}jn(e,t,n){if(t.isEmpty())return ae.resolve();let s=new it(Zi);t.forEach((e=>s=s.add(e)));const i=IDBKeyRange.bound(Xi(s.first()),Xi(s.last())),r=s.getIterator();let o=r.getNext();return Yi(e).Z({index:"documentKeyIndex",range:i},((e,t,s)=>{const i=H.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&Zi(o,i)<0;)n(o,null),o=r.getNext();o&&o.isEqual(i)&&(n(o,t),o=r.hasNext()?r.getNext():null),o?s.G(Xi(o)):s.done()})).next((()=>{for(;o;)n(o,null),o=r.hasNext()?r.getNext():null}))}getDocumentsMatchingQuery(e,t,n,s){const i=t.path,r=[i.popLast().toArray(),i.lastSegment(),Fs(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Yi(e).j(IDBKeyRange.bound(r,o,!0)).next((e=>{let n=zn();for(const i of e){const e=this.Qn(H.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(qn(t,e)||s.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,s){let i=zn();const r=Ji(t,n),o=Ji(t,ne.max());return Yi(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,o,!0)},((e,t,n)=>{const r=this.Qn(H.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(r.key,r),i.size===s&&n.done()})).next((()=>i))}newChangeBuffer(e){return new Wi(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return Hi(e).get("remoteDocumentGlobalKey").next((e=>(S(!!e),e)))}Gn(e,t){return Hi(e).put("remoteDocumentGlobalKey",t)}Qn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=vs(e.se,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=H.fromSegments(t.noDocument.path),s=Vs(t.noDocument.readTime);n=zt.newNoDocument(e,s),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return _();{const e=H.fromSegments(t.unknownDocument.path),s=Vs(t.unknownDocument.version);n=zt.newUnknownDocument(e,s)}}return t.readTime&&n.setReadTime(function(e){const t=new G(e[0],e[1]);return z.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(z.min()))return e}return zt.newInvalidDocument(e)}}function Qi(e){return new $i(e)}class Wi extends zi{constructor(e,t){super(),this.Jn=e,this.trackRemovals=t,this.Yn=new Kn((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,s=new it(((e,t)=>j(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,r)=>{const o=this.Yn.get(i);if(t.push(this.Jn.removeEntry(e,i,o.readTime)),r.isValidDocument()){const u=Ls(this.Jn.serializer,r);s=s.add(i.path.popLast());const c=Ci(u);n+=c-o.size,t.push(this.Jn.addEntry(e,i,u))}else if(n-=o.size,this.trackRemovals){const n=Ls(this.Jn.serializer,r.convertToNoDocument(z.min()));t.push(this.Jn.addEntry(e,i,n))}})),s.forEach((n=>{t.push(this.Jn.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.Jn.updateMetadata(e,n)),ae.waitFor(t)}getFromCache(e,t){return this.Jn.zn(e,t).next((e=>(this.Yn.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.Jn.Wn(e,t).next((({documents:e,Hn:t})=>(t.forEach(((t,n)=>{this.Yn.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function Hi(e){return Xe(e,"remoteDocumentGlobal")}function Yi(e){return Xe(e,"remoteDocumentsV14")}function Xi(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Ji(e,t){const n=t.documentKey.path.toArray();return[e,Fs(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Zi(e,t){const n=e.path.toArray(),s=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<s.length-2;++e)if(i=j(n[e],s[e]),i)return i;return i=j(n.length,s.length),i||(i=j(n[n.length-2],s[s.length-2]),i||j(n[n.length-1],s[s.length-1]))}class eo{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class to{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(n=s,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Cr(n.mutation,e,ct.empty(),G.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,er()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=er()){const s=Hn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,n).next((e=>{let t=Qn();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Hn();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,er())))}populateOverlays(e,t,n){const s=[];return n.forEach((e=>{t.has(e)||s.push(e)})),this.documentOverlayCache.getOverlays(e,s).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,s){let i=zn();const r=Xn(),o=Xn();return t.forEach(((e,t)=>{const o=n.get(t.key);s.has(t.key)&&(void 0===o||o.mutation instanceof Or)?i=i.insert(t.key,t):void 0!==o?(r.set(t.key,o.mutation.getFieldMask()),Cr(o.mutation,t,o.mutation.getFieldMask(),G.now())):r.set(t.key,ct.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>r.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new eo(t,null!==(n=r.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Xn();let s=new tt(((e,t)=>e-t)),i=er();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const r=t.get(e);if(null===r)return;let o=n.get(e)||ct.empty();o=i.applyToLocalView(r,o),n.set(e,o);const u=(s.get(i.batchId)||er()).add(e);s=s.insert(i.batchId,u)}))})).next((()=>{const r=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),u=s.key,c=s.value,a=Yn();c.forEach((e=>{if(!i.has(e)){const s=xr(t.get(e),n.get(e));null!==s&&a.set(e,s),i=i.add(e)}})),r.push(this.documentOverlayCache.saveOverlays(e,u,a))}return ae.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return H.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):kn(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next((i=>{const r=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):ae.resolve(Hn());let o=-1,u=i;return r.next((t=>ae.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?ae.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{u=u.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,u,t,er()))).next((e=>({batchId:o,changes:Wn(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new H(t)).next((e=>{let t=Qn();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const s=t.collectionGroup;let i=Qn();return this.indexManager.getCollectionParents(e,s).next((r=>ae.forEach(r,(r=>{const o=function(e,t){return new Sn(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,r.child(s));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s)))).next((e=>{s.forEach(((t,n)=>{const s=n.getKey();null===e.get(s)&&(e=e.insert(s,zt.newInvalidDocument(s)))}));let n=Qn();return e.forEach(((e,i)=>{const r=s.get(e);void 0!==r&&Cr(r.mutation,i,ct.empty(),G.now()),qn(t,i)&&(n=n.insert(e,i))})),n}))}}class no{constructor(e){this.serializer=e,this.Zn=new Map,this.Xn=new Map}getBundleMetadata(e,t){return ae.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var n;return this.Zn.set(t.id,{id:(n=t).id,version:n.version,createTime:us(n.createTime)}),ae.resolve()}getNamedQuery(e,t){return ae.resolve(this.Xn.get(t))}saveNamedQuery(e,t){return this.Xn.set(t.name,function(e){return{name:e.name,query:hr(e.bundledQuery),readTime:us(e.readTime)}}(t)),ae.resolve()}}class ro{constructor(){this.overlays=new tt(H.comparator),this.ts=new Map}getOverlay(e,t){return ae.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Hn();return ae.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,s)=>{this.re(e,t,s)})),ae.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.ts.get(n);return void 0!==s&&(s.forEach((e=>this.overlays=this.overlays.remove(e))),this.ts.delete(n)),ae.resolve()}getOverlaysForCollection(e,t,n){const s=Hn(),i=t.length+1,r=new H(t.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const e=o.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===i&&e.largestBatchId>n&&s.set(e.getKey(),e)}return ae.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new tt(((e,t)=>e-t));const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Hn(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Hn(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=s)););return ae.resolve(o)}re(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const e=this.ts.get(s.largestBatchId).delete(n.key);this.ts.set(s.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Ur(t,n));let i=this.ts.get(t);void 0===i&&(i=er(),this.ts.set(t,i)),this.ts.set(t,i.add(n.key))}}class so{constructor(){this.es=new it(io.ns),this.ss=new it(io.rs)}isEmpty(){return this.es.isEmpty()}addReference(e,t){const n=new io(e,t);this.es=this.es.add(n),this.ss=this.ss.add(n)}os(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.us(new io(e,t))}cs(e,t){e.forEach((e=>this.removeReference(e,t)))}hs(e){const t=new H(new rt([])),n=new io(t,e),s=new io(t,e+1),i=[];return this.ss.forEachInRange([n,s],(e=>{this.us(e),i.push(e.key)})),i}ls(){this.es.forEach((e=>this.us(e)))}us(e){this.es=this.es.delete(e),this.ss=this.ss.delete(e)}fs(e){const t=new H(new rt([])),n=new io(t,e),s=new io(t,e+1);let i=er();return this.ss.forEachInRange([n,s],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new io(e,0),n=this.es.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class io{constructor(e,t){this.key=e,this.ds=t}static ns(e,t){return H.comparator(e.key,t.key)||j(e.ds,t.ds)}static rs(e,t){return j(e.ds,t.ds)||H.comparator(e.key,t.key)}}class oo{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this._s=new it(io.ns)}checkEmpty(e){return ae.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const i=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Vr(i,t,n,s);this.mutationQueue.push(r);for(const t of s)this._s=this._s.add(new io(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ae.resolve(r)}lookupMutationBatch(e,t){return ae.resolve(this.gs(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.ys(n),i=s<0?0:s;return ae.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ae.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return ae.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new io(t,0),s=new io(t,Number.POSITIVE_INFINITY),i=[];return this._s.forEachInRange([n,s],(e=>{const t=this.gs(e.ds);i.push(t)})),ae.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new it(j);return t.forEach((e=>{const t=new io(e,0),s=new io(e,Number.POSITIVE_INFINITY);this._s.forEachInRange([t,s],(e=>{n=n.add(e.ds)}))})),ae.resolve(this.ps(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;H.isDocumentKey(i)||(i=i.child(""));const r=new io(new H(i),0);let o=new it(j);return this._s.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===s&&(o=o.add(e.ds)),!0)}),r),ae.resolve(this.ps(o))}ps(e){const t=[];return e.forEach((e=>{const n=this.gs(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){S(0===this.Is(t.batchId,"removed")),this.mutationQueue.shift();let n=this._s;return ae.forEach(t.mutations,(s=>{const i=new io(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this._s=n}))}En(e){}containsKey(e,t){const n=new io(t,0),s=this._s.firstAfterOrEqual(n);return ae.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,ae.resolve()}Is(e,t){return this.ys(e)}ys(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}gs(e){const t=this.ys(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ao{constructor(e){this.Ts=e,this.docs=new tt(H.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,r=this.Ts(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ae.resolve(n?n.document.mutableCopy():zt.newInvalidDocument(t))}getEntries(e,t){let n=zn();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():zt.newInvalidDocument(e))})),ae.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=zn();const r=t.path,o=new H(r.child("")),u=this.docs.getIteratorFrom(o);for(;u.hasNext();){const{key:e,value:{document:o}}=u.getNext();if(!r.isPrefixOf(e.path))break;e.path.length>r.length+1||re(te(o),n)<=0||(s.has(o.key)||qn(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ae.resolve(i)}getAllFromCollectionGroup(e,t,n,s){_()}Es(e,t){return ae.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new co(this)}getSize(e){return ae.resolve(this.size)}}class co extends zi{constructor(e){super(),this.Jn=e}applyChanges(e){const t=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?t.push(this.Jn.addEntry(e,s)):this.Jn.removeEntry(n)})),ae.waitFor(t)}getFromCache(e,t){return this.Jn.getEntry(e,t)}getAllFromCache(e,t){return this.Jn.getEntries(e,t)}}class uo{constructor(e){this.persistence=e,this.As=new Kn((e=>vn(e)),bn),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.Rs=0,this.vs=new so,this.targetCount=0,this.bs=Mi.vn()}forEachTarget(e,t){return this.As.forEach(((e,n)=>t(n))),ae.resolve()}getLastRemoteSnapshotVersion(e){return ae.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ae.resolve(this.Rs)}allocateTargetId(e){return this.highestTargetId=this.bs.next(),ae.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Rs&&(this.Rs=t),ae.resolve()}Sn(e){this.As.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.bs=new Mi(t),this.highestTargetId=t),e.sequenceNumber>this.Rs&&(this.Rs=e.sequenceNumber)}addTargetData(e,t){return this.Sn(t),this.targetCount+=1,ae.resolve()}updateTargetData(e,t){return this.Sn(t),ae.resolve()}removeTargetData(e,t){return this.As.delete(t.target),this.vs.hs(t.targetId),this.targetCount-=1,ae.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.As.forEach(((r,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.As.delete(r),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),s++)})),ae.waitFor(i).next((()=>s))}getTargetCount(e){return ae.resolve(this.targetCount)}getTargetData(e,t){const n=this.As.get(t)||null;return ae.resolve(n)}addMatchingKeys(e,t,n){return this.vs.os(t,n),ae.resolve()}removeMatchingKeys(e,t,n){this.vs.cs(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((t=>{i.push(s.markPotentiallyOrphaned(e,t))})),ae.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.vs.hs(t),ae.resolve()}getMatchingKeysForTargetId(e,t){const n=this.vs.fs(t);return ae.resolve(n)}containsKey(e,t){return ae.resolve(this.vs.containsKey(t))}}class lo{constructor(e,t){this.Ps={},this.overlays={},this.Vs=new ve(0),this.Ss=!1,this.Ss=!0,this.referenceDelegate=e(this),this.Ds=new uo(this),this.indexManager=new pi,this.remoteDocumentCache=function(e){return new ao(e)}((e=>this.referenceDelegate.Cs(e))),this.serializer=new Ms(t),this.xs=new no(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ss=!1,Promise.resolve()}get started(){return this.Ss}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ro,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Ps[e.toKey()];return n||(n=new oo(t,this.referenceDelegate),this.Ps[e.toKey()]=n),n}getTargetCache(){return this.Ds}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.xs}runTransaction(e,t,n){v("MemoryPersistence","Starting transaction:",e);const s=new ho(this.Vs.next());return this.referenceDelegate.Ns(),n(s).next((e=>this.referenceDelegate.ks(s).next((()=>e)))).toPromise().then((e=>(s.raiseOnCommittedEvent(),e)))}Os(e,t){return ae.or(Object.values(this.Ps).map((n=>()=>n.containsKey(e,t))))}}class ho extends ie{constructor(e){super(),this.currentSequenceNumber=e}}class fo{constructor(e){this.persistence=e,this.$s=new so,this.Ms=null}static Fs(e){return new fo(e)}get Bs(){if(this.Ms)return this.Ms;throw _()}addReference(e,t,n){return this.$s.addReference(n,t),this.Bs.delete(n.toString()),ae.resolve()}removeReference(e,t,n){return this.$s.removeReference(n,t),this.Bs.add(n.toString()),ae.resolve()}markPotentiallyOrphaned(e,t){return this.Bs.add(t.toString()),ae.resolve()}removeTarget(e,t){this.$s.hs(t.targetId).forEach((e=>this.Bs.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Bs.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ns(){this.Ms=new Set}ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ae.forEach(this.Bs,(n=>{const s=H.fromPath(n);return this.Ls(e,s).next((e=>{e||t.removeEntry(s,z.min())}))})).next((()=>(this.Ms=null,t.apply(e))))}updateLimboDocument(e,t){return this.Ls(e,t).next((e=>{e?this.Bs.delete(t.toString()):this.Bs.add(t.toString())}))}Cs(e){return 0}Ls(e,t){return ae.or([()=>ae.resolve(this.$s.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Os(e,t)])}}class mo{constructor(e){this.serializer=e}M(e,t,n,s){const i=new ce("createOrUpgrade",t);n<1&&s>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",De,{unique:!0}),e.createObjectStore("documentMutations")}(e),go(e),function(e){e.createObjectStore("remoteDocuments")}(e));let r=ae.resolve();return n<3&&s>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),go(e)),r=r.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&s>=4&&(0!==n&&(r=r.next((()=>function(e,t){return t.store("mutations").j().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",De,{unique:!0});const s=t.store("mutations"),i=n.map((e=>s.put(e)));return ae.waitFor(i)}))}(e,i)))),r=r.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&s>=5&&(r=r.next((()=>this.qs(i)))),n<6&&s>=6&&(r=r.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.Us(i))))),n<7&&s>=7&&(r=r.next((()=>this.Ks(i)))),n<8&&s>=8&&(r=r.next((()=>this.Gs(e,i)))),n<9&&s>=9&&(r=r.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&s>=10&&(r=r.next((()=>this.Qs(i)))),n<11&&s>=11&&(r=r.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&s>=12&&(r=r.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:Be});t.createIndex("collectionPathOverlayIndex",Ke,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Ge,{unique:!1})}(e)}))),n<13&&s>=13&&(r=r.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:ke});t.createIndex("documentKeyIndex",Oe),t.createIndex("collectionGroupIndex",Re)}(e))).next((()=>this.zs(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&s>=14&&(r=r.next((()=>this.js(e,i)))),n<15&&s>=15&&(r=r.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Ve}).createIndex("sequenceNumberIndex",qe,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Ue}).createIndex("documentKeyIndex",je,{unique:!1})}(e)))),r}Us(e){let t=0;return e.store("remoteDocuments").Z(((e,n)=>{t+=Ci(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}qs(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.j().next((t=>ae.forEach(t,(t=>{const s=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.j("userMutationsIndex",s).next((n=>ae.forEach(n,(n=>{S(n.userId===t.userId);const s=qs(this.serializer,n);return Di(e,t.userId,s).next((()=>{}))}))))}))))}Ks(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const s=[];return n.Z(((n,i)=>{const r=new rt(n),o=function(e){return[0,Ee(e)]}(r);s.push(t.get(o).next((n=>n?ae.resolve():(n=>t.put({targetId:0,path:Ee(n),sequenceNumber:e.highestListenSequenceNumber}))(r))))})).next((()=>ae.waitFor(s)))}))}Gs(e,t){e.createObjectStore("collectionParents",{keyPath:Pe});const n=t.store("collectionParents"),s=new yi,i=e=>{if(s.add(e)){const t=e.lastSegment(),s=e.popLast();return n.put({collectionId:t,parent:Ee(s)})}};return t.store("remoteDocuments").Z({Y:!0},((e,t)=>{const n=new rt(e);return i(n.popLast())})).next((()=>t.store("documentMutations").Z({Y:!0},(([e,t,n],s)=>{const r=xe(t);return i(r.popLast())}))))}Qs(e){const t=e.store("targets");return t.Z(((e,n)=>{const s=Us(n),i=js(this.serializer,s);return t.put(i)}))}zs(e,t){const n=t.store("remoteDocuments"),s=[];return n.Z(((e,n)=>{const i=t.store("remoteDocumentsV14"),r=(o=n,o.document?new H(rt.fromString(o.document.name).popFirst(5)):o.noDocument?H.fromSegments(o.noDocument.path):o.unknownDocument?H.fromSegments(o.unknownDocument.path):_()).path.toArray();var o;const u={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};s.push(i.put(u))})).next((()=>ae.waitFor(s)))}js(e,t){const n=t.store("mutations"),s=Qi(this.serializer),i=new lo(fo.Fs,this.serializer.se);return n.j().next((e=>{const n=new Map;return e.forEach((e=>{var t;let s=null!==(t=n.get(e.userId))&&void 0!==t?t:er();qs(this.serializer,e).keys().forEach((e=>s=s.add(e))),n.set(e.userId,s)})),ae.forEach(n,((e,n)=>{const r=new b(n),o=Ws.ie(this.serializer,r),u=i.getIndexManager(r),c=Ai.ie(r,this.serializer,u,i.referenceDelegate);return new to(s,c,o,u).recalculateAndSaveOverlaysForDocumentKeys(new Ye(t,ve.ct),e).next()}))}))}}function go(e){e.createObjectStore("targetDocuments",{keyPath:Le}).createIndex("documentTargetsIndex",Fe,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Me,{unique:!0}),e.createObjectStore("targetGlobal")}const po="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class yo{constructor(e,t,n,s,i,r,o,u,c,a,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Ws=i,this.window=r,this.document=o,this.Hs=c,this.Js=a,this.Ys=l,this.Vs=null,this.Ss=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.Xs=null,this.ti=null,this.ei=Number.NEGATIVE_INFINITY,this.ni=e=>Promise.resolve(),!yo.D())throw new A(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ki(this,s),this.si=t+"main",this.serializer=new Ms(u),this.ii=new ue(this.si,this.Ys,new mo(this.serializer)),this.Ds=new Li(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Qi(this.serializer),this.xs=new zs,this.window&&this.window.localStorage?this.ri=this.window.localStorage:(this.ri=null,!1===a&&I("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.oi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new A(C.FAILED_PRECONDITION,po);return this.ui(),this.ci(),this.ai(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Ds.getHighestSequenceNumber(e)))})).then((e=>{this.Vs=new ve(e,this.Hs)})).then((()=>{this.Ss=!0})).catch((e=>(this.ii&&this.ii.close(),Promise.reject(e))))}hi(e){return this.ni=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ii.B((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ws.enqueueAndForget((async()=>{this.started&&await this.oi()})))}oi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>vo(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.li(e).next((e=>{e||(this.isPrimary=!1,this.Ws.enqueueRetryable((()=>this.ni(!1))))}))})).next((()=>this.fi(e))).next((t=>this.isPrimary&&!t?this.di(e).next((()=>!1)):!!t&&this.wi(e).next((()=>!0)))))).catch((e=>{if(de(e))return v("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return v("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Ws.enqueueRetryable((()=>this.ni(e))),this.isPrimary=e}))}li(e){return wo(e).get("owner").next((e=>ae.resolve(this._i(e))))}mi(e){return vo(e).delete(this.clientId)}async gi(){if(this.isPrimary&&!this.yi(this.ei,18e5)){this.ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Xe(e,"clientMetadata");return t.j().next((e=>{const n=this.pi(e,18e5),s=e.filter((e=>-1===n.indexOf(e)));return ae.forEach(s,(e=>t.delete(e.clientId))).next((()=>s))}))})).catch((()=>[]));if(this.ri)for(const t of e)this.ri.removeItem(this.Ii(t.clientId))}}ai(){this.ti=this.Ws.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.oi().then((()=>this.gi())).then((()=>this.ai()))))}_i(e){return!!e&&e.ownerId===this.clientId}fi(e){return this.Js?ae.resolve(!0):wo(e).get("owner").next((t=>{if(null!==t&&this.yi(t.leaseTimestampMs,5e3)&&!this.Ti(t.ownerId)){if(this._i(t)&&this.networkEnabled)return!0;if(!this._i(t)){if(!t.allowTabSynchronization)throw new A(C.FAILED_PRECONDITION,po);return!1}}return!(!this.networkEnabled||!this.inForeground)||vo(e).j().next((e=>void 0===this.pi(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,s=this.networkEnabled===e.networkEnabled;if(t||n&&s)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&v("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Ss=!1,this.Ei(),this.ti&&(this.ti.cancel(),this.ti=null),this.Ai(),this.Ri(),await this.ii.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new Ye(e,ve.ct);return this.di(t).next((()=>this.mi(t)))})),this.ii.close(),this.vi()}pi(e,t){return e.filter((e=>this.yi(e.updateTimeMs,t)&&!this.Ti(e.clientId)))}bi(){return this.runTransaction("getActiveClients","readonly",(e=>vo(e).j().next((e=>this.pi(e,18e5).map((e=>e.clientId))))))}get started(){return this.Ss}getMutationQueue(e,t){return Ai.ie(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ds}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new vi(e,this.serializer.se.databaseId)}getDocumentOverlayCache(e){return Ws.ie(this.serializer,e)}getBundleCache(){return this.xs}runTransaction(e,t,n){v("IndexedDbPersistence","Starting transaction:",e);const s="readonly"===t?"readonly":"readwrite",i=15===(r=this.Ys)?He:14===r?We:13===r?Qe:12===r?$e:11===r?ze:void _();var r;let o;return this.ii.runTransaction(e,s,i,(s=>(o=new Ye(s,this.Vs?this.Vs.next():ve.ct),"readwrite-primary"===t?this.li(o).next((e=>!!e||this.fi(o))).next((t=>{if(!t)throw I(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ws.enqueueRetryable((()=>this.ni(!1))),new A(C.FAILED_PRECONDITION,se);return n(o)})).next((e=>this.wi(o).next((()=>e)))):this.Pi(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}Pi(e){return wo(e).get("owner").next((e=>{if(null!==e&&this.yi(e.leaseTimestampMs,5e3)&&!this.Ti(e.ownerId)&&!this._i(e)&&!(this.Js||this.allowTabSynchronization&&e.allowTabSynchronization))throw new A(C.FAILED_PRECONDITION,po)}))}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return wo(e).put("owner",t)}static D(){return ue.D()}di(e){const t=wo(e);return t.get("owner").next((e=>this._i(e)?(v("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):ae.resolve()))}yi(e,t){const n=Date.now();return!(e<n-t||e>n&&(I(`Detected an update time that is in the future: ${e} > ${n}`),1))}ui(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Xs=()=>{this.Ws.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.oi())))},this.document.addEventListener("visibilitychange",this.Xs),this.inForeground="visible"===this.document.visibilityState)}Ai(){this.Xs&&(this.document.removeEventListener("visibilitychange",this.Xs),this.Xs=null)}ci(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ei();const e=/(?:Version|Mobile)\/1[456]/;Object(l.z)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ws.enterRestrictedMode(!0),this.Ws.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Zs))}Ri(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ti(e){var t;try{const n=null!==(null===(t=this.ri)||void 0===t?void 0:t.getItem(this.Ii(e)));return v("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return I("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ei(){if(this.ri)try{this.ri.setItem(this.Ii(this.clientId),String(Date.now()))}catch(e){I("Failed to set zombie client id.",e)}}vi(){if(this.ri)try{this.ri.removeItem(this.Ii(this.clientId))}catch(e){}}Ii(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function wo(e){return Xe(e,"owner")}function vo(e){return Xe(e,"clientMetadata")}function bo(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Io{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.Vi=n,this.Si=s}static Di(e,t){let n=er(),s=er();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:s=s.add(e.doc.key)}return new Io(e,t.fromCache,n,s)}}class To{constructor(){this.Ci=!1}initialize(e,t){this.xi=e,this.indexManager=t,this.Ci=!0}getDocumentsMatchingQuery(e,t,n,s){return this.Ni(e,t).next((i=>i||this.ki(e,t,s,n))).next((n=>n||this.Oi(e,t)))}Ni(e,t){if(Cn(t))return ae.resolve(null);let n=Rn(t);return this.indexManager.getIndexType(e,n).next((s=>0===s?null:(null!==t.limit&&1===s&&(t=Ln(t,null,"F"),n=Rn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((s=>{const i=er(...s);return this.xi.getDocuments(e,i).next((s=>this.indexManager.getMinOffset(e,n).next((n=>{const r=this.$i(t,s);return this.Mi(t,r,i,n.readTime)?this.Ni(e,Ln(t,null,"F")):this.Fi(e,r,t,n)}))))})))))}ki(e,t,n,s){return Cn(t)||s.isEqual(z.min())?this.Oi(e,t):this.xi.getDocuments(e,n).next((i=>{const r=this.$i(t,i);return this.Mi(t,r,n,s)?this.Oi(e,t):(y()<=c.a.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Vn(t)),this.Fi(e,r,t,ee(s,-1)))}))}$i(e,t){let n=new it(jn(e));return t.forEach(((t,s)=>{qn(e,s)&&(n=n.add(s))})),n}Mi(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Oi(e,t){return y()<=c.a.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",Vn(t)),this.xi.getDocumentsMatchingQuery(e,t,ne.min())}Fi(e,t,n,s){return this.xi.getDocumentsMatchingQuery(e,n,s).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class Eo{constructor(e,t,n,s){this.persistence=e,this.Bi=t,this.serializer=s,this.Li=new tt(j),this.qi=new Kn((e=>vn(e)),bn),this.Ui=new Map,this.Ki=e.getRemoteDocumentCache(),this.Ds=e.getTargetCache(),this.xs=e.getBundleCache(),this.Gi(n)}Gi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new to(this.Ki,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ki.setIndexManager(this.indexManager),this.Bi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Li)))}}function _o(e,t,n,s){return new Eo(e,t,n,s)}async function So(e,t){const n=D(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let s;return n.mutationQueue.getAllMutationBatches(e).next((i=>(s=i,n.Gi(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],r=[];let o=er();for(const e of s){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({Qi:e,removedBatchIds:i,addedBatchIds:r})))}))}))}function xo(e){const t=D(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Ds.getLastRemoteSnapshotVersion(e)))}function Do(e,t,n){let s=er(),i=er();return n.forEach((e=>s=s.add(e))),t.getEntries(e,s).next((e=>{let s=zn();return n.forEach(((n,r)=>{const o=e.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),r.isNoDocument()&&r.version.isEqual(z.min())?(t.removeEntry(n,r.readTime),s=s.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(r),s=s.insert(n,r)):v("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{zi:s,ji:i}}))}function Co(e,t){const n=D(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Ao(e,t){const n=D(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let s;return n.Ds.getTargetData(e,t).next((i=>i?(s=i,ae.resolve(s)):n.Ds.allocateTargetId(e).next((i=>(s=new tr(t,i,0,e.currentSequenceNumber),n.Ds.addTargetData(e,s).next((()=>s)))))))})).then((e=>{const s=n.Li.get(e.targetId);return(null===s||e.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Li=n.Li.insert(e.targetId,e),n.qi.set(t,e.targetId)),e}))}async function No(e,t,n){const s=D(e),i=s.Li.get(t),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(e=>s.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!de(e))throw e;v("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}s.Li=s.Li.remove(t),s.qi.delete(i.target)}function ko(e,t,n){const s=D(e);let i=z.min(),r=er();return s.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const s=D(e),i=s.qi.get(n);return void 0!==i?ae.resolve(s.Li.get(i)):s.Ds.getTargetData(t,n)}(s,e,Rn(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,s.Ds.getMatchingKeysForTargetId(e,t.targetId).next((e=>{r=e}))})).next((()=>s.Bi.getDocumentsMatchingQuery(e,t,n?i:z.min(),n?r:er()))).next((e=>(Mo(s,Un(t),e),{documents:e,Wi:r})))))}function Oo(e,t){const n=D(e),s=D(n.Ds),i=n.Li.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>s.ne(e,t).next((e=>e?e.target:null))))}function Ro(e,t){const n=D(e),s=n.Ui.get(t)||z.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.Ki.getAllFromCollectionGroup(e,t,ee(s,-1),Number.MAX_SAFE_INTEGER))).then((e=>(Mo(n,t,e),e)))}function Mo(e,t,n){let s=e.Ui.get(t)||z.min();n.forEach(((e,t)=>{t.readTime.compareTo(s)>0&&(s=t.readTime)})),e.Ui.set(t,s)}async function Lo(e,t,n=er()){const s=await Ao(e,Rn(hr(t.bundledQuery))),i=D(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const r=us(t.readTime);if(s.snapshotVersion.compareTo(r)>=0)return i.xs.saveNamedQuery(e,t);const o=s.withResumeToken(ht.EMPTY_BYTE_STRING,r);return i.Li=i.Li.insert(o.targetId,o),i.Ds.updateTargetData(e,o).next((()=>i.Ds.removeMatchingKeysForTargetId(e,s.targetId))).next((()=>i.Ds.addMatchingKeys(e,n,s.targetId))).next((()=>i.xs.saveNamedQuery(e,t)))}))}function Fo(e,t){return`firestore_clients_${e}_${t}`}function Po(e,t,n){let s=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(s+=`_${t.uid}`),s}function Vo(e,t){return`firestore_targets_${e}_${t}`}class qo{constructor(e,t,n,s){this.user=e,this.batchId=t,this.state=n,this.error=s}static Zi(e,t,n){const s=JSON.parse(n);let i,r="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return r&&s.error&&(r="string"==typeof s.error.message&&"string"==typeof s.error.code,r&&(i=new A(s.error.code,s.error.message))),r?new qo(e,t,s.state,i):(I("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Xi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Uo{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){const n=JSON.parse(t);let s,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(s=new A(n.error.code,n.error.message))),i?new Uo(e,n.state,s):(I("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Xi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class jo{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const n=JSON.parse(t);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=rr();for(let e=0;s&&e<n.activeTargetIds.length;++e)s=Te(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return s?new jo(e,i):(I("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Bo{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Bo(t.clientId,t.onlineState):(I("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Ko{constructor(){this.activeTargetIds=rr()}tr(e){this.activeTargetIds=this.activeTargetIds.add(e)}er(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Xi(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Go{constructor(e,t,n,s,i){this.window=e,this.Ws=t,this.persistenceKey=n,this.nr=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.sr=this.ir.bind(this),this.rr=new tt(j),this.started=!1,this.ur=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.cr=Fo(this.persistenceKey,this.nr),this.ar=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.rr=this.rr.insert(this.nr,new Ko),this.hr=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.lr=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.dr=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.wr=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this._r=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.sr)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.bi();for(const t of e){if(t===this.nr)continue;const e=this.getItem(Fo(this.persistenceKey,t));if(e){const n=jo.Zi(t,e);n&&(this.rr=this.rr.insert(n.clientId,n))}}this.mr();const t=this.storage.getItem(this.wr);if(t){const e=this.gr(t);e&&this.yr(e)}for(const e of this.ur)this.ir(e);this.ur=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.ar,JSON.stringify(e))}getAllActiveQueryTargets(){return this.pr(this.rr)}isActiveQueryTarget(e){let t=!1;return this.rr.forEach(((n,s)=>{s.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Ir(e,"pending")}updateMutationState(e,t,n){this.Ir(e,t,n),this.Tr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Vo(this.persistenceKey,e));if(n){const s=Uo.Zi(e,n);s&&(t=s.state)}}return this.Er.tr(e),this.mr(),t}removeLocalQueryTarget(e){this.Er.er(e),this.mr()}isLocalQueryTarget(e){return this.Er.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Vo(this.persistenceKey,e))}updateQueryState(e,t,n){this.Ar(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Tr(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Rr(e)}notifyBundleLoaded(e){this.vr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.sr),this.removeItem(this.cr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return v("SharedClientState","READ",e,t),t}setItem(e,t){v("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){v("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ir(e){const t=e;if(t.storageArea===this.storage){if(v("SharedClientState","EVENT",t.key,t.newValue),t.key===this.cr)return void I("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ws.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.hr.test(t.key)){if(null==t.newValue){const e=this.br(t.key);return this.Pr(e,null)}{const e=this.Vr(t.key,t.newValue);if(e)return this.Pr(e.clientId,e)}}else if(this.lr.test(t.key)){if(null!==t.newValue){const e=this.Sr(t.key,t.newValue);if(e)return this.Dr(e)}}else if(this.dr.test(t.key)){if(null!==t.newValue){const e=this.Cr(t.key,t.newValue);if(e)return this.Nr(e)}}else if(t.key===this.wr){if(null!==t.newValue){const e=this.gr(t.newValue);if(e)return this.yr(e)}}else if(t.key===this.ar){const e=function(e){let t=ve.ct;if(null!=e)try{const n=JSON.parse(e);S("number"==typeof n),t=n}catch(e){I("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==ve.ct&&this.sequenceNumberHandler(e)}else if(t.key===this._r){const e=this.kr(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Or(e))))}}else this.ur.push(t)}))}}get Er(){return this.rr.get(this.nr)}mr(){this.setItem(this.cr,this.Er.Xi())}Ir(e,t,n){const s=new qo(this.currentUser,e,t,n),i=Po(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Xi())}Tr(e){const t=Po(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Rr(e){const t={clientId:this.nr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}Ar(e,t,n){const s=Vo(this.persistenceKey,e),i=new Uo(e,t,n);this.setItem(s,i.Xi())}vr(e){const t=JSON.stringify(Array.from(e));this.setItem(this._r,t)}br(e){const t=this.hr.exec(e);return t?t[1]:null}Vr(e,t){const n=this.br(e);return jo.Zi(n,t)}Sr(e,t){const n=this.lr.exec(e),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return qo.Zi(new b(i),s,t)}Cr(e,t){const n=this.dr.exec(e),s=Number(n[1]);return Uo.Zi(s,t)}gr(e){return Bo.Zi(e)}kr(e){return JSON.parse(e)}async Dr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.$r(e.batchId,e.state,e.error);v("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Nr(e){return this.syncEngine.Mr(e.targetId,e.state,e.error)}Pr(e,t){const n=t?this.rr.insert(e,t):this.rr.remove(e),s=this.pr(this.rr),i=this.pr(n),r=[],o=[];return i.forEach((e=>{s.has(e)||r.push(e)})),s.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.Fr(r,o).then((()=>{this.rr=n}))}yr(e){this.rr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}pr(e){let t=rr();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class zo{constructor(){this.Br=new Ko,this.Lr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Br.tr(e),this.Lr[e]||"not-current"}updateQueryState(e,t,n){this.Lr[e]=t}removeLocalQueryTarget(e){this.Br.er(e)}isLocalQueryTarget(e){return this.Br.activeTargetIds.has(e)}clearQueryState(e){delete this.Lr[e]}getAllActiveQueryTargets(){return this.Br.activeTargetIds}isActiveQueryTarget(e){return this.Br.activeTargetIds.has(e)}start(){return this.Br=new Ko,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class $o{qr(e){}shutdown(){}}class Qo{constructor(){this.Ur=()=>this.Kr(),this.Gr=()=>this.Qr(),this.zr=[],this.jr()}qr(e){this.zr.push(e)}shutdown(){window.removeEventListener("online",this.Ur),window.removeEventListener("offline",this.Gr)}jr(){window.addEventListener("online",this.Ur),window.addEventListener("offline",this.Gr)}Kr(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.zr)e(0)}Qr(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.zr)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Wo=null;function Ho(){return null===Wo?Wo=268435456+Math.round(2147483648*Math.random()):Wo++,"0x"+Wo.toString(16)}const Yo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Xo{constructor(e){this.Wr=e.Wr,this.Hr=e.Hr}Jr(e){this.Yr=e}Zr(e){this.Xr=e}onMessage(e){this.eo=e}close(){this.Hr()}send(e){this.Wr(e)}no(){this.Yr()}so(e){this.Xr(e)}io(e){this.eo(e)}}const Jo="WebChannelConnection";class Zo extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.ro=t+"://"+e.host,this.oo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get uo(){return!1}co(e,t,n,s,i){const r=Ho(),o=this.ao(e,t);v("RestConnection",`Sending RPC '${e}' ${r}:`,o,n);const u={};return this.ho(u,s,i),this.lo(e,o,u,n).then((t=>(v("RestConnection",`Received RPC '${e}' ${r}: `,t),t)),(t=>{throw T("RestConnection",`RPC '${e}' ${r} failed with error: `,t,"url: ",o,"request:",n),t}))}fo(e,t,n,s,i,r){return this.co(e,t,n,s,i)}ho(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+f,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}ao(e,t){const n=Yo[e];return`${this.ro}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}lo(e,t,n,s){const i=Ho();return new Promise(((r,o)=>{const u=new h.g;u.setWithCredentials(!0),u.listenOnce(h.c.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case h.a.NO_ERROR:const t=u.getResponseJson();v(Jo,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),r(t);break;case h.a.TIMEOUT:v(Jo,`RPC '${e}' ${i} timed out`),o(new A(C.DEADLINE_EXCEEDED,"Request time out"));break;case h.a.HTTP_ERROR:const n=u.getStatus();if(v(Jo,`RPC '${e}' ${i} failed with status:`,n,"response text:",u.getResponseText()),n>0){let e=u.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(t)>=0?t:C.UNKNOWN}(t.status);o(new A(e,t.message))}else o(new A(C.UNKNOWN,"Server responded with status "+u.getStatus()))}else o(new A(C.UNAVAILABLE,"Connection failed."));break;default:_()}}finally{v(Jo,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(s);v(Jo,`RPC '${e}' ${i} sending request:`,s),u.send(t,"POST",c,n,15)}))}wo(e,t,n){const s=Ho(),i=[this.ro,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=Object(h.h)(),o=Object(h.i)(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(u.xmlHttpFactory=new h.d({})),this.ho(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;const c=i.join("");v(Jo,`Creating RPC '${e}' stream ${s}: ${c}`,u);const a=r.createWebChannel(c,u);let l=!1,d=!1;const f=new Xo({Wr:t=>{d?v(Jo,`Not sending because RPC '${e}' stream ${s} is closed:`,t):(l||(v(Jo,`Opening RPC '${e}' stream ${s} transport.`),a.open(),l=!0),v(Jo,`RPC '${e}' stream ${s} sending:`,t),a.send(t))},Hr:()=>a.close()}),m=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return m(a,h.f.EventType.OPEN,(()=>{d||v(Jo,`RPC '${e}' stream ${s} transport opened.`)})),m(a,h.f.EventType.CLOSE,(()=>{d||(d=!0,v(Jo,`RPC '${e}' stream ${s} transport closed`),f.so())})),m(a,h.f.EventType.ERROR,(t=>{d||(d=!0,T(Jo,`RPC '${e}' stream ${s} transport errored:`,t),f.so(new A(C.UNAVAILABLE,"The operation could not be completed")))})),m(a,h.f.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];S(!!i);const r=i,o=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){v(Jo,`RPC '${e}' stream ${s} received error:`,o);const t=o.status;let n=function(e){const t=Br[e];if(void 0!==t)return zr(t)}(t),i=o.message;void 0===n&&(n=C.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.so(new A(n,i)),a.close()}else v(Jo,`RPC '${e}' stream ${s} received:`,i),f.io(i)}})),m(o,h.b.STAT_EVENT,(t=>{t.stat===h.e.PROXY?v(Jo,`RPC '${e}' stream ${s} detected buffering proxy`):t.stat===h.e.NOPROXY&&v(Jo,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{f.no()}),0),f}}function ea(){return"undefined"!=typeof window?window:null}function ta(){return"undefined"!=typeof document?document:null}function na(e){return new is(e,!0)}class ra{constructor(e,t,n=1e3,s=1.5,i=6e4){this.Ws=e,this.timerId=t,this._o=n,this.mo=s,this.yo=i,this.po=0,this.Io=null,this.To=Date.now(),this.reset()}reset(){this.po=0}Eo(){this.po=this.yo}Ao(e){this.cancel();const t=Math.floor(this.po+this.Ro()),n=Math.max(0,Date.now()-this.To),s=Math.max(0,t-n);s>0&&v("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.po} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Io=this.Ws.enqueueAfterDelay(this.timerId,s,(()=>(this.To=Date.now(),e()))),this.po*=this.mo,this.po<this._o&&(this.po=this._o),this.po>this.yo&&(this.po=this.yo)}vo(){null!==this.Io&&(this.Io.skipDelay(),this.Io=null)}cancel(){null!==this.Io&&(this.Io.cancel(),this.Io=null)}Ro(){return(Math.random()-.5)*this.po}}class sa{constructor(e,t,n,s,i,r,o,u){this.Ws=e,this.bo=n,this.Po=s,this.connection=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=u,this.state=0,this.Vo=0,this.So=null,this.Do=null,this.stream=null,this.Co=new ra(e,t)}xo(){return 1===this.state||5===this.state||this.No()}No(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.ko()}async stop(){this.xo()&&await this.close(0)}Oo(){this.state=0,this.Co.reset()}$o(){this.No()&&null===this.So&&(this.So=this.Ws.enqueueAfterDelay(this.bo,6e4,(()=>this.Mo())))}Fo(e){this.Bo(),this.stream.send(e)}async Mo(){if(this.No())return this.close(0)}Bo(){this.So&&(this.So.cancel(),this.So=null)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}async close(e,t){this.Bo(),this.Lo(),this.Co.cancel(),this.Vo++,4!==e?this.Co.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(I(t.toString()),I("Using maximum backoff delay to prevent overloading the backend."),this.Co.Eo()):t&&t.code===C.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.qo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}qo(){}auth(){this.state=1;const e=this.Uo(this.Vo),t=this.Vo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Vo===t&&this.Ko(e,n)}),(t=>{e((()=>{const e=new A(C.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Go(e)}))}))}Ko(e,t){const n=this.Uo(this.Vo);this.stream=this.Qo(e,t),this.stream.Jr((()=>{n((()=>(this.state=2,this.Do=this.Ws.enqueueAfterDelay(this.Po,1e4,(()=>(this.No()&&(this.state=3),Promise.resolve()))),this.listener.Jr())))})),this.stream.Zr((e=>{n((()=>this.Go(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}ko(){this.state=5,this.Co.Ao((async()=>{this.state=0,this.start()}))}Go(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Uo(e){return t=>{this.Ws.enqueueAndForget((()=>this.Vo===e?t():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ia extends sa{constructor(e,t,n,s,i,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,r),this.serializer=i}Qo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.Co.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const s=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:_()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],r=function(e,t){return e.useProto3Json?(S(void 0===t||"string"==typeof t),ht.fromBase64String(t||"")):(S(void 0===t||t instanceof Uint8Array),ht.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,u=o&&function(e){const t=void 0===e.code?C.UNKNOWN:zr(e.code);return new A(t,e.message||"")}(o);n=new Xr(s,i,r,u||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const i=fs(e,s.document.name),r=us(s.document.updateTime),o=s.document.createTime?us(s.document.createTime):z.min(),u=new Kt({mapValue:{fields:s.document.fields}}),c=zt.newFoundDocument(i,r,o,u),a=s.targetIds||[],l=s.removedTargetIds||[];n=new li(a,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const i=fs(e,s.document),r=s.readTime?us(s.readTime):z.min(),o=zt.newNoDocument(i,r),u=s.removedTargetIds||[];n=new li([],u,o.key,o)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const i=fs(e,s.document),r=s.removedTargetIds||[];n=new li([],r,i,null)}else{if(!("filter"in t))return _();{t.filter;const e=t.filter;e.targetId;const s=e.count||0,i=new jr(s),r=e.targetId;n=new Yr(r,i)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return z.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?z.min():t.readTime?us(t.readTime):z.min()}(e);return this.listener.zo(t,n)}jo(e){const t={};t.database=ps(this.serializer),t.addTarget=function(e,t){let n;const s=t.target;return n=In(s)?{documents:Ts(e,s)}:{query:Es(e,s)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=as(e,t.resumeToken):t.snapshotVersion.compareTo(z.min())>0&&(n.readTime=os(e,t.snapshotVersion.toTimestamp())),n}(this.serializer,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Fo(t)}Wo(e){const t={};t.database=ps(this.serializer),t.removeTarget=e,this.Fo(t)}}class oa extends sa{constructor(e,t,n,s,i,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,r),this.serializer=i,this.Ho=!1}get Jo(){return this.Ho}start(){this.Ho=!1,this.lastStreamToken=void 0,super.start()}qo(){this.Ho&&this.Yo([])}Qo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(S(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Ho){this.Co.reset();const t=function(e,t){return e&&e.length>0?(S(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?us(e.updateTime):us(t);return n.isEqual(z.min())&&(n=us(t)),new Tr(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=us(e.commitTime);return this.listener.Zo(n,t)}return S(!e.writeResults||0===e.writeResults.length),this.Ho=!0,this.listener.Xo()}tu(){const e={};e.database=ps(this.serializer),this.Fo(e)}Yo(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>bs(this.serializer,e)))};this.Fo(t)}}class aa extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.eu=!1}nu(){if(this.eu)throw new A(C.FAILED_PRECONDITION,"The client has already been terminated.")}co(e,t,n){return this.nu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.co(e,t,n,s,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new A(C.UNKNOWN,e.toString())}))}fo(e,t,n,s){return this.nu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.fo(e,t,n,i,r,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new A(C.UNKNOWN,e.toString())}))}terminate(){this.eu=!0}}class ca{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.su=0,this.iu=null,this.ru=!0}ou(){0===this.su&&(this.uu("Unknown"),this.iu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.iu=null,this.cu("Backend didn't respond within 10 seconds."),this.uu("Offline"),Promise.resolve()))))}au(e){"Online"===this.state?this.uu("Unknown"):(this.su++,this.su>=1&&(this.hu(),this.cu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.uu("Offline")))}set(e){this.hu(),this.su=0,"Online"===e&&(this.ru=!1),this.uu(e)}uu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}cu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ru?(I(t),this.ru=!1):v("OnlineStateTracker",t)}hu(){null!==this.iu&&(this.iu.cancel(),this.iu=null)}}class ua{constructor(e,t,n,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.lu=[],this.fu=new Map,this.du=new Set,this.wu=[],this._u=i,this._u.qr((e=>{n.enqueueAndForget((async()=>{wa(this)&&(v("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=D(e);t.du.add(4),await ha(t),t.mu.set("Unknown"),t.du.delete(4),await la(t)}(this))}))})),this.mu=new ca(n,s)}}async function la(e){if(wa(e))for(const t of e.wu)await t(!0)}async function ha(e){for(const t of e.wu)await t(!1)}function da(e,t){const n=D(e);n.fu.has(t.targetId)||(n.fu.set(t.targetId,t),ya(n)?pa(n):Fa(n).No()&&ma(n,t))}function fa(e,t){const n=D(e),s=Fa(n);n.fu.delete(t),s.No()&&ga(n,t),0===n.fu.size&&(s.No()?s.$o():wa(n)&&n.mu.set("Unknown"))}function ma(e,t){e.gu.Ot(t.targetId),Fa(e).jo(t)}function ga(e,t){e.gu.Ot(t),Fa(e).Wo(t)}function pa(e){e.gu=new Zr({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ne:t=>e.fu.get(t)||null}),Fa(e).start(),e.mu.ou()}function ya(e){return wa(e)&&!Fa(e).xo()&&e.fu.size>0}function wa(e){return 0===D(e).du.size}function va(e){e.gu=void 0}async function ba(e){e.fu.forEach(((t,n)=>{ma(e,t)}))}async function Ia(e,t){va(e),ya(e)?(e.mu.au(t),pa(e)):e.mu.set("Unknown")}async function Ta(e,t,n){if(e.mu.set("Online"),t instanceof Xr&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const s of t.targetIds)e.fu.has(s)&&(await e.remoteSyncer.rejectListen(s,n),e.fu.delete(s),e.gu.removeTarget(s))}(e,t)}catch(n){v("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Ea(e,n)}else if(t instanceof li?e.gu.Kt(t):t instanceof Yr?e.gu.Jt(t):e.gu.zt(t),!n.isEqual(z.min()))try{const t=await xo(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.gu.Xt(t);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.fu.get(s);i&&e.fu.set(s,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.fu.get(t);if(!n)return;e.fu.set(t,n.withResumeToken(ht.EMPTY_BYTE_STRING,n.snapshotVersion)),ga(e,t);const s=new tr(n.target,t,1,n.sequenceNumber);ma(e,s)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){v("RemoteStore","Failed to raise snapshot:",t),await Ea(e,t)}}async function Ea(e,t,n){if(!de(t))throw t;e.du.add(1),await ha(e),e.mu.set("Offline"),n||(n=()=>xo(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{v("RemoteStore","Retrying IndexedDB access"),await n(),e.du.delete(1),await la(e)}))}function _a(e,t){return t().catch((n=>Ea(e,n,t)))}async function Sa(e){const t=D(e),n=Pa(t);let s=t.lu.length>0?t.lu[t.lu.length-1].batchId:-1;for(;xa(t);)try{const e=await Co(t.localStore,s);if(null===e){0===t.lu.length&&n.$o();break}s=e.batchId,Da(t,e)}catch(e){await Ea(t,e)}Ca(t)&&Aa(t)}function xa(e){return wa(e)&&e.lu.length<10}function Da(e,t){e.lu.push(t);const n=Pa(e);n.No()&&n.Jo&&n.Yo(t.mutations)}function Ca(e){return wa(e)&&!Pa(e).xo()&&e.lu.length>0}function Aa(e){Pa(e).start()}async function Na(e){Pa(e).tu()}async function ka(e){const t=Pa(e);for(const n of e.lu)t.Yo(n.mutations)}async function Oa(e,t,n){const s=e.lu.shift(),i=qr.from(s,t,n);await _a(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Sa(e)}async function Ra(e,t){t&&Pa(e).Jo&&await async function(e,t){if(Gr(n=t.code)&&n!==C.ABORTED){const n=e.lu.shift();Pa(e).Oo(),await _a(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Sa(e)}var n}(e,t),Ca(e)&&Aa(e)}async function Ma(e,t){const n=D(e);n.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");const s=wa(n);n.du.add(3),await ha(n),s&&n.mu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.du.delete(3),await la(n)}async function La(e,t){const n=D(e);t?(n.du.delete(2),await la(n)):t||(n.du.add(2),await ha(n),n.mu.set("Unknown"))}function Fa(e){return e.yu||(e.yu=function(e,t,n){const s=D(e);return s.nu(),new ia(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Jr:ba.bind(null,e),Zr:Ia.bind(null,e),zo:Ta.bind(null,e)}),e.wu.push((async t=>{t?(e.yu.Oo(),ya(e)?pa(e):e.mu.set("Unknown")):(await e.yu.stop(),va(e))}))),e.yu}function Pa(e){return e.pu||(e.pu=function(e,t,n){const s=D(e);return s.nu(),new oa(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Jr:Na.bind(null,e),Zr:Ra.bind(null,e),Xo:ka.bind(null,e),Zo:Oa.bind(null,e)}),e.wu.push((async t=>{t?(e.pu.Oo(),await Sa(e)):(await e.pu.stop(),e.lu.length>0&&(v("RemoteStore",`Stopping write stream with ${e.lu.length} pending writes`),e.lu=[]))}))),e.pu}class Va{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new q,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,s,i){const r=Date.now()+n,o=new Va(e,t,r,s,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new A(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qa(e,t){if(I("AsyncQueue",`${t}: ${e}`),de(e))return new A(C.UNAVAILABLE,`${t}: ${e}`);throw e}class Ua{constructor(e){this.comparator=e?(t,n)=>e(t,n)||H.comparator(t.key,n.key):(e,t)=>H.comparator(e.key,t.key),this.keyedMap=Qn(),this.sortedSet=new tt(this.comparator)}static emptySet(e){return new Ua(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ua))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(!e.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ua;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ja{constructor(){this.Iu=new tt(H.comparator)}track(e){const t=e.doc.key,n=this.Iu.get(t);n?0!==e.type&&3===n.type?this.Iu=this.Iu.insert(t,e):3===e.type&&1!==n.type?this.Iu=this.Iu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Iu=this.Iu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Iu=this.Iu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Iu=this.Iu.remove(t):1===e.type&&2===n.type?this.Iu=this.Iu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Iu=this.Iu.insert(t,{type:2,doc:e.doc}):_():this.Iu=this.Iu.insert(t,e)}Tu(){const e=[];return this.Iu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Ba{constructor(e,t,n,s,i,r,o,u,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,s,i){const r=[];return t.forEach((e=>{r.push({type:0,doc:e})})),new Ba(e,t,Ua.emptySet(t),r,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Fn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Ka{constructor(){this.Eu=void 0,this.listeners=[]}}class Ga{constructor(){this.queries=new Kn((e=>Pn(e)),Fn),this.onlineState="Unknown",this.Au=new Set}}async function za(e,t){const n=D(e),s=t.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new Ka),i)try{r.Eu=await n.onListen(s)}catch(e){const n=qa(e,`Initialization of query '${Vn(t.query)}' failed`);return void t.onError(n)}n.queries.set(s,r),r.listeners.push(t),t.Ru(n.onlineState),r.Eu&&t.vu(r.Eu)&&Ha(n)}async function $a(e,t){const n=D(e),s=t.query;let i=!1;const r=n.queries.get(s);if(r){const e=r.listeners.indexOf(t);e>=0&&(r.listeners.splice(e,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}function Qa(e,t){const n=D(e);let s=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.vu(e)&&(s=!0);i.Eu=e}}s&&Ha(n)}function Wa(e,t,n){const s=D(e),i=s.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);s.queries.delete(t)}function Ha(e){e.Au.forEach((e=>{e.next()}))}class Ya{constructor(e,t,n){this.query=e,this.bu=t,this.Pu=!1,this.Vu=null,this.onlineState="Unknown",this.options=n||{}}vu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Ba(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Pu?this.Su(e)&&(this.bu.next(e),t=!0):this.Du(e,this.onlineState)&&(this.Cu(e),t=!0),this.Vu=e,t}onError(e){this.bu.error(e)}Ru(e){this.onlineState=e;let t=!1;return this.Vu&&!this.Pu&&this.Du(this.Vu,e)&&(this.Cu(this.Vu),t=!0),t}Du(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.xu||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Su(e){if(e.docChanges.length>0)return!0;const t=this.Vu&&this.Vu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Cu(e){e=Ba.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Pu=!0,this.bu.next(e)}}class Xa{constructor(e,t){this.Nu=e,this.byteLength=t}ku(){return"metadata"in this.Nu}}class Ja{constructor(e){this.serializer=e}Hi(e){return fs(this.serializer,e)}Ji(e){return e.metadata.exists?vs(this.serializer,e.document,!1):zt.newNoDocument(this.Hi(e.metadata.name),this.Yi(e.metadata.readTime))}Yi(e){return us(e)}}class Za{constructor(e,t,n){this.Ou=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=ec(e)}$u(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Nu.namedQuery)this.queries.push(e.Nu.namedQuery);else if(e.Nu.documentMetadata){this.documents.push({metadata:e.Nu.documentMetadata}),e.Nu.documentMetadata.exists||++t;const n=rt.fromString(e.Nu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Nu.document&&(this.documents[this.documents.length-1].document=e.Nu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Mu(e){const t=new Map,n=new Ja(this.serializer);for(const s of e)if(s.metadata.queries){const e=n.Hi(s.metadata.name);for(const n of s.metadata.queries){const s=(t.get(n)||er()).add(e);t.set(n,s)}}return t}async complete(){const e=await async function(e,t,n,s){const i=D(e);let r=er(),o=zn();for(const e of n){const n=t.Hi(e.metadata.name);e.document&&(r=r.add(n));const s=t.Ji(e);s.setReadTime(t.Yi(e.metadata.readTime)),o=o.insert(n,s)}const u=i.Ki.newChangeBuffer({trackRemovals:!0}),c=await Ao(i,function(e){return Rn(Dn(rt.fromString(`__bundle__/docs/${e}`)))}(s));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>Do(e,u,o).next((t=>(u.apply(e),t))).next((t=>i.Ds.removeMatchingKeysForTargetId(e,c.targetId).next((()=>i.Ds.addMatchingKeys(e,r,c.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.zi,t.ji))).next((()=>t.zi))))))}(this.localStore,new Ja(this.serializer),this.documents,this.Ou.id),t=this.Mu(this.documents);for(const e of this.queries)await Lo(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Fu:this.collectionGroups,Bu:e}}}function ec(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class tc{constructor(e){this.key=e}}class nc{constructor(e){this.key=e}}class rc{constructor(e,t){this.query=e,this.Lu=t,this.qu=null,this.hasCachedResults=!1,this.current=!1,this.Uu=er(),this.mutatedKeys=er(),this.Ku=jn(e),this.Gu=new Ua(this.Ku)}get Qu(){return this.Lu}zu(e,t){const n=t?t.ju:new ja,s=t?t.Gu:this.Gu;let i=t?t.mutatedKeys:this.mutatedKeys,r=s,o=!1;const u="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((e,t)=>{const a=s.get(e),l=qn(this.query,t)?t:null,h=!!a&&this.mutatedKeys.has(a.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;a&&l?a.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Wu(a,l)||(n.track({type:2,doc:l}),f=!0,(u&&this.Ku(l,u)>0||c&&this.Ku(l,c)<0)&&(o=!0)):!a&&l?(n.track({type:0,doc:l}),f=!0):a&&!l&&(n.track({type:1,doc:a}),f=!0,(u||c)&&(o=!0)),f&&(l?(r=r.add(l),i=d?i.add(e):i.delete(e)):(r=r.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const e="F"===this.query.limitType?r.last():r.first();r=r.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Gu:r,ju:n,Mi:o,mutatedKeys:i}}Wu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const s=this.Gu;this.Gu=e.Gu,this.mutatedKeys=e.mutatedKeys;const i=e.ju.Tu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _()}};return n(e)-n(t)}(e.type,t.type)||this.Ku(e.doc,t.doc))),this.Hu(n);const r=t?this.Ju():[],o=0===this.Uu.size&&this.current?1:0,u=o!==this.qu;return this.qu=o,0!==i.length||u?{snapshot:new Ba(this.query,e.Gu,s,i,e.mutatedKeys,0===o,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),Yu:r}:{Yu:r}}Ru(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Gu:this.Gu,ju:new ja,mutatedKeys:this.mutatedKeys,Mi:!1},!1)):{Yu:[]}}Zu(e){return!this.Lu.has(e)&&!!this.Gu.has(e)&&!this.Gu.get(e).hasLocalMutations}Hu(e){e&&(e.addedDocuments.forEach((e=>this.Lu=this.Lu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Lu=this.Lu.delete(e))),this.current=e.current)}Ju(){if(!this.current)return[];const e=this.Uu;this.Uu=er(),this.Gu.forEach((e=>{this.Zu(e.key)&&(this.Uu=this.Uu.add(e.key))}));const t=[];return e.forEach((e=>{this.Uu.has(e)||t.push(new nc(e))})),this.Uu.forEach((n=>{e.has(n)||t.push(new tc(n))})),t}Xu(e){this.Lu=e.Wi,this.Uu=er();const t=this.zu(e.documents);return this.applyChanges(t,!0)}tc(){return Ba.fromInitialDocuments(this.query,this.Gu,this.mutatedKeys,0===this.qu,this.hasCachedResults)}}class sc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ic{constructor(e){this.key=e,this.ec=!1}}class oc{constructor(e,t,n,s,i,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.nc={},this.sc=new Kn((e=>Pn(e)),Fn),this.ic=new Map,this.rc=new Set,this.oc=new tt(H.comparator),this.uc=new Map,this.cc=new so,this.ac={},this.hc=new Map,this.lc=Mi.bn(),this.onlineState="Unknown",this.fc=void 0}get isPrimaryClient(){return!0===this.fc}}async function ac(e,t){const n=Rc(e);let s,i;const r=n.sc.get(t);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.tc();else{const e=await Ao(n.localStore,Rn(t));n.isPrimaryClient&&da(n.remoteStore,e);const r=n.sharedClientState.addLocalQueryTarget(e.targetId);s=e.targetId,i=await cc(n,t,s,"current"===r,e.resumeToken)}return i}async function cc(e,t,n,s,i){e.dc=(t,n,s)=>async function(e,t,n,s){let i=t.view.zu(n);i.Mi&&(i=await ko(e.localStore,t.query,!1).then((({documents:e})=>t.view.zu(e,i))));const r=s&&s.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,r);return vc(e,t.targetId,o.Yu),o.snapshot}(e,t,n,s);const r=await ko(e.localStore,t,!0),o=new rc(t,r.Wi),u=o.zu(r.documents),c=Hr.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==e.onlineState,i),a=o.applyChanges(u,e.isPrimaryClient,c);vc(e,n,a.Yu);const l=new sc(t,n,o);return e.sc.set(t,l),e.ic.has(n)?e.ic.get(n).push(t):e.ic.set(n,[t]),a.snapshot}async function uc(e,t){const n=D(e),s=n.sc.get(t),i=n.ic.get(s.targetId);if(i.length>1)return n.ic.set(s.targetId,i.filter((e=>!Fn(e,t)))),void n.sc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await No(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),fa(n.remoteStore,s.targetId),yc(n,s.targetId)})).catch(oe)):(yc(n,s.targetId),await No(n.localStore,s.targetId,!0))}async function lc(e,t){const n=D(e);try{const e=await function(e,t){const n=D(e),s=t.snapshotVersion;let i=n.Li;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const r=n.Ki.newChangeBuffer({trackRemovals:!0});i=n.Li;const o=[];t.targetChanges.forEach(((r,u)=>{const c=i.get(u);if(!c)return;o.push(n.Ds.removeMatchingKeys(e,r.removedDocuments,u).next((()=>n.Ds.addMatchingKeys(e,r.addedDocuments,u))));let a=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(u)?a=a.withResumeToken(ht.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):r.resumeToken.approximateByteSize()>0&&(a=a.withResumeToken(r.resumeToken,s)),i=i.insert(u,a),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,a,r)&&o.push(n.Ds.updateTargetData(e,a))}));let u=zn(),c=er();if(t.documentUpdates.forEach((s=>{t.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,s))})),o.push(Do(e,r,t.documentUpdates).next((e=>{u=e.zi,c=e.ji}))),!s.isEqual(z.min())){const t=n.Ds.getLastRemoteSnapshotVersion(e).next((t=>n.Ds.setTargetsMetadata(e,e.currentSequenceNumber,s)));o.push(t)}return ae.waitFor(o).next((()=>r.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,u,c))).next((()=>u))})).then((e=>(n.Li=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const s=n.uc.get(t);s&&(S(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?s.ec=!0:e.modifiedDocuments.size>0?S(s.ec):e.removedDocuments.size>0&&(S(s.ec),s.ec=!1))})),await Tc(n,e,t)}catch(e){await oe(e)}}function hc(e,t,n){const s=D(e);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const e=[];s.sc.forEach(((n,s)=>{const i=s.view.Ru(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=D(e);n.onlineState=t;let s=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Ru(t)&&(s=!0)})),s&&Ha(n)}(s.eventManager,t),e.length&&s.nc.zo(e),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function dc(e,t,n){const s=D(e);s.sharedClientState.updateQueryState(t,"rejected",n);const i=s.uc.get(t),r=i&&i.key;if(r){let e=new tt(H.comparator);e=e.insert(r,zt.newNoDocument(r,z.min()));const n=er().add(r),i=new Wr(z.min(),new Map,new it(j),e,n);await lc(s,i),s.oc=s.oc.remove(r),s.uc.delete(t),Ic(s)}else await No(s.localStore,t,!1).then((()=>yc(s,t,n))).catch(oe)}async function fc(e,t){const n=D(e),s=t.batch.batchId;try{const e=await function(e,t){const n=D(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const s=t.batch.keys(),i=n.Ki.newChangeBuffer({trackRemovals:!0});return function(e,t,n,s){const i=n.batch,r=i.keys();let o=ae.resolve();return r.forEach((e=>{o=o.next((()=>s.getEntry(t,e))).next((t=>{const r=n.docVersions.get(e);S(null!==r),t.version.compareTo(r)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),s.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=er();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,s)))}))}(n.localStore,t);pc(n,s,null),gc(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Tc(n,e)}catch(e){await oe(e)}}async function mc(e,t,n){const s=D(e);try{const e=await function(e,t){const n=D(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let s;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(S(null!==t),s=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,s))).next((()=>n.localDocuments.getDocuments(e,s)))}))}(s.localStore,t);pc(s,t,n),gc(s,t),s.sharedClientState.updateMutationState(t,"rejected",n),await Tc(s,e)}catch(n){await oe(n)}}function gc(e,t){(e.hc.get(t)||[]).forEach((e=>{e.resolve()})),e.hc.delete(t)}function pc(e,t,n){const s=D(e);let i=s.ac[s.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),s.ac[s.currentUser.toKey()]=i}}function yc(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const s of e.ic.get(t))e.sc.delete(s),n&&e.nc.wc(s,n);e.ic.delete(t),e.isPrimaryClient&&e.cc.hs(t).forEach((t=>{e.cc.containsKey(t)||wc(e,t)}))}function wc(e,t){e.rc.delete(t.path.canonicalString());const n=e.oc.get(t);null!==n&&(fa(e.remoteStore,n),e.oc=e.oc.remove(t),e.uc.delete(n),Ic(e))}function vc(e,t,n){for(const s of n)s instanceof tc?(e.cc.addReference(s.key,t),bc(e,s)):s instanceof nc?(v("SyncEngine","Document no longer in limbo: "+s.key),e.cc.removeReference(s.key,t),e.cc.containsKey(s.key)||wc(e,s.key)):_()}function bc(e,t){const n=t.key,s=n.path.canonicalString();e.oc.get(n)||e.rc.has(s)||(v("SyncEngine","New document in limbo: "+n),e.rc.add(s),Ic(e))}function Ic(e){for(;e.rc.size>0&&e.oc.size<e.maxConcurrentLimboResolutions;){const t=e.rc.values().next().value;e.rc.delete(t);const n=new H(rt.fromString(t)),s=e.lc.next();e.uc.set(s,new ic(n)),e.oc=e.oc.insert(n,s),da(e.remoteStore,new tr(Rn(Dn(n.path)),s,2,ve.ct))}}async function Tc(e,t,n){const s=D(e),i=[],r=[],o=[];s.sc.isEmpty()||(s.sc.forEach(((e,u)=>{o.push(s.dc(u,t,n).then((e=>{if((e||n)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(u.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Io.Di(u.targetId,e);r.push(t)}})))})),await Promise.all(o),s.nc.zo(i),await async function(e,t){const n=D(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>ae.forEach(t,(t=>ae.forEach(t.Vi,(s=>n.persistence.referenceDelegate.addReference(e,t.targetId,s))).next((()=>ae.forEach(t.Si,(s=>n.persistence.referenceDelegate.removeReference(e,t.targetId,s)))))))))}catch(e){if(!de(e))throw e;v("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Li.get(t),s=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(s);n.Li=n.Li.insert(t,i)}}}(s.localStore,r))}async function Ec(e,t){const n=D(e);if(!n.currentUser.isEqual(t)){v("SyncEngine","User change. New user:",t.toKey());const e=await So(n.localStore,t);n.currentUser=t,function(e,t){e.hc.forEach((e=>{e.forEach((e=>{e.reject(new A(C.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.hc.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Tc(n,e.Qi)}}function _c(e,t){const n=D(e),s=n.uc.get(t);if(s&&s.ec)return er().add(s.key);{let e=er();const s=n.ic.get(t);if(!s)return e;for(const t of s){const s=n.sc.get(t);e=e.unionWith(s.view.Qu)}return e}}async function Sc(e,t){const n=D(e),s=await ko(n.localStore,t.query,!0),i=t.view.Xu(s);return n.isPrimaryClient&&vc(n,t.targetId,i.Yu),i}async function xc(e,t){const n=D(e);return Ro(n.localStore,t).then((e=>Tc(n,e)))}async function Dc(e,t,n,s){const i=D(e),r=await function(e,t){const n=D(e),s=D(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>s.In(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):ae.resolve(null)))))}(i.localStore,t);null!==r?("pending"===n?await Sa(i.remoteStore):"acknowledged"===n||"rejected"===n?(pc(i,t,s||null),gc(i,t),function(e,t){D(D(e).mutationQueue).En(t)}(i.localStore,t)):_(),await Tc(i,r)):v("SyncEngine","Cannot apply mutation batch with id: "+t)}async function Cc(e,t,n){const s=D(e),i=[],r=[];for(const e of t){let t;const n=s.ic.get(e);if(n&&0!==n.length){t=await Ao(s.localStore,Rn(n[0]));for(const e of n){const t=s.sc.get(e),n=await Sc(s,t);n.snapshot&&r.push(n.snapshot)}}else{const n=await Oo(s.localStore,e);t=await Ao(s.localStore,n),await cc(s,Ac(n),e,!1,t.resumeToken)}i.push(t)}return s.nc.zo(r),i}function Ac(e){return xn(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Nc(e){const t=D(e);return D(D(t.localStore).persistence).bi()}async function kc(e,t,n,s){const i=D(e);if(i.fc)return void v("SyncEngine","Ignoring unexpected query state notification.");const r=i.ic.get(t);if(r&&r.length>0)switch(n){case"current":case"not-current":{const e=await Ro(i.localStore,Un(r[0])),s=Wr.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,ht.EMPTY_BYTE_STRING);await Tc(i,e,s);break}case"rejected":await No(i.localStore,t,!0),yc(i,t,s);break;default:_()}}async function Oc(e,t,n){const s=Rc(e);if(s.fc){for(const e of t){if(s.ic.has(e)){v("SyncEngine","Adding an already active target "+e);continue}const t=await Oo(s.localStore,e),n=await Ao(s.localStore,t);await cc(s,Ac(t),n.targetId,!1,n.resumeToken),da(s.remoteStore,n)}for(const e of n)s.ic.has(e)&&await No(s.localStore,e,!1).then((()=>{fa(s.remoteStore,e),yc(s,e)})).catch(oe)}}function Rc(e){const t=D(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=lc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=_c.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=dc.bind(null,t),t.nc.zo=Qa.bind(null,t.eventManager),t.nc.wc=Wa.bind(null,t.eventManager),t}function Mc(e){const t=D(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=fc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=mc.bind(null,t),t}class Lc{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=na(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return _o(this.persistence,new To,e.initialUser,this.serializer)}createPersistence(e){return new lo(fo.Fs,this.serializer)}createSharedClientState(e){return new zo}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Fc extends Lc{constructor(e,t,n){super(),this.mc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.mc.initialize(this,e),await Mc(this.mc.syncEngine),await Sa(this.mc.remoteStore),await this.persistence.hi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return _o(this.persistence,new To,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new ji(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new we(t,this.persistence);return new ye(e.asyncQueue,n)}createPersistence(e){const t=bo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?xi.withCacheSize(this.cacheSizeBytes):xi.DEFAULT;return new yo(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,ea(),ta(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new zo}}class Pc extends Fc{constructor(e,t){super(e,t,!1),this.mc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.mc.syncEngine;this.sharedClientState instanceof Go&&(this.sharedClientState.syncEngine={$r:Dc.bind(null,t),Mr:kc.bind(null,t),Fr:Oc.bind(null,t),bi:Nc.bind(null,t),Or:xc.bind(null,t)},await this.sharedClientState.start()),await this.persistence.hi((async e=>{await async function(e,t){const n=D(e);if(Rc(n),Mc(n),!0===t&&!0!==n.fc){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Cc(n,e.toArray());n.fc=!0,await La(n.remoteStore,!0);for(const e of t)da(n.remoteStore,e)}else if(!1===t&&!1!==n.fc){const e=[];let t=Promise.resolve();n.ic.forEach(((s,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(yc(n,i),No(n.localStore,i,!0)))),fa(n.remoteStore,i)})),await t,await Cc(n,e),function(e){const t=D(e);t.uc.forEach(((e,n)=>{fa(t.remoteStore,n)})),t.cc.ls(),t.uc=new Map,t.oc=new tt(H.comparator)}(n),n.fc=!1,await La(n.remoteStore,!1)}}(this.mc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}createSharedClientState(e){const t=ea();if(!Go.D(t))throw new A(C.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=bo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Go(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Vc{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>hc(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ec.bind(null,this.syncEngine),await La(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Ga}createDatastore(e){const t=na(e.databaseInfo.databaseId),n=(s=e.databaseInfo,new Zo(s));var s;return function(e,t,n,s){return new aa(e,t,n,s)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,s=e.asyncQueue,i=e=>hc(this.syncEngine,e,0),r=Qo.D()?new Qo:new $o,new ua(t,n,s,i,r);var t,n,s,i,r}createSyncEngine(e,t){return function(e,t,n,s,i,r,o){const u=new oc(e,t,n,s,i,r);return o&&(u.fc=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=D(e);v("RemoteStore","RemoteStore shutting down."),t.du.add(5),await ha(t),t._u.shutdown(),t.mu.set("Unknown")}(this.remoteStore)}}function qc(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const s={value:e.slice(n,n+t),done:!1};return n+=t,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class Uc{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.gc(this.observer.next,e)}error(e){this.observer.error?this.gc(this.observer.error,e):I("Uncaught Error in snapshot listener:",e.toString())}yc(){this.muted=!0}gc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class jc{constructor(e,t){this.Ic=e,this.serializer=t,this.metadata=new q,this.buffer=new Uint8Array,this.Tc=new TextDecoder("utf-8"),this.Ec().then((e=>{e&&e.ku()?this.metadata.resolve(e.Nu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Nu)}`))}),(e=>this.metadata.reject(e)))}close(){return this.Ic.cancel()}async getMetadata(){return this.metadata.promise}async _c(){return await this.getMetadata(),this.Ec()}async Ec(){const e=await this.Ac();if(null===e)return null;const t=this.Tc.decode(e),n=Number(t);isNaN(n)&&this.Rc(`length string (${t}) is not valid number`);const s=await this.vc(n);return new Xa(JSON.parse(s),e.length+n)}bc(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async Ac(){for(;this.bc()<0&&!await this.Pc(););if(0===this.buffer.length)return null;const e=this.bc();e<0&&this.Rc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async vc(e){for(;this.buffer.length<e;)await this.Pc()&&this.Rc("Reached the end of bundle when more is expected.");const t=this.Tc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Rc(e){throw this.Ic.cancel(),new Error(`Invalid bundle format: ${e}`)}async Pc(){const e=await this.Ic.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Bc{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new A(C.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=D(e),s=ps(n.serializer)+"/documents",i={documents:t.map((e=>ds(n.serializer,e)))},r=await n.fo("BatchGetDocuments",s,i,t.length),o=new Map;r.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){S(!!t.found),t.found.name,t.found.updateTime;const n=fs(e,t.found.name),s=us(t.found.updateTime),i=t.found.createTime?us(t.found.createTime):z.min(),r=new Kt({mapValue:{fields:t.found.fields}});return zt.newFoundDocument(n,s,i,r)}(e,t):"missing"in t?function(e,t){S(!!t.missing),S(!!t.readTime);const n=fs(e,t.missing),s=us(t.readTime);return zt.newNoDocument(n,s)}(e,t):_()}(n.serializer,e);o.set(t.key.toString(),t)}));const u=[];return t.forEach((e=>{const t=o.get(e.toString());S(!!t),u.push(t)})),u}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Fr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=H.fromPath(t);this.mutations.push(new Pr(n,this.precondition(n)))})),await async function(e,t){const n=D(e),s=ps(n.serializer)+"/documents",i={writes:t.map((e=>bs(n.serializer,e)))};await n.co("Commit",s,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw _();t=z.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new A(C.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(z.min())?Er.exists(!1):Er.updateTime(t):Er.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(z.min()))throw new A(C.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Er.updateTime(t)}return Er.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Kc{constructor(e,t,n,s,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=s,this.deferred=i,this.Vc=n.maxAttempts,this.Co=new ra(this.asyncQueue,"transaction_retry")}run(){this.Vc-=1,this.Sc()}Sc(){this.Co.Ao((async()=>{const e=new Bc(this.datastore),t=this.Dc(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Cc(e)}))))})).catch((e=>{this.Cc(e)}))}))}Dc(e){try{const t=this.updateFunction(e);return!be(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Cc(e){this.Vc>0&&this.xc(e)?(this.Vc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Sc(),Promise.resolve())))):this.deferred.reject(e)}xc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Gr(t)}return!1}}class Gc{constructor(e,t,n,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=b.UNAUTHENTICATED,this.clientId=U.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{v("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(v("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new A(C.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new q;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=qa(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function zc(e,t){e.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let s=n.initialUser;e.setCredentialChangeListener((async e=>{s.isEqual(e)||(await So(t.localStore,e),s=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function $c(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Wc(e);v("FirestoreClient","Initializing OnlineComponentProvider");const s=await e.getConfiguration();await t.initialize(n,s),e.setCredentialChangeListener((e=>Ma(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Ma(t.remoteStore,n))),e._onlineComponents=t}function Qc(e){return"FirebaseError"===e.name?e.code===C.FAILED_PRECONDITION||e.code===C.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function Wc(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{await zc(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!Qc(n))throw n;T("Error using user provided cache. Falling back to memory cache: "+n),await zc(e,new Lc)}}else v("FirestoreClient","Using default OfflineComponentProvider"),await zc(e,new Lc);return e._offlineComponents}async function Hc(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),await $c(e,e._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),await $c(e,new Vc))),e._onlineComponents}function Yc(e){return Wc(e).then((e=>e.persistence))}function Xc(e){return Wc(e).then((e=>e.localStore))}function Jc(e){return Hc(e).then((e=>e.remoteStore))}function Zc(e){return Hc(e).then((e=>e.syncEngine))}function eu(e){return Hc(e).then((e=>e.datastore))}async function tu(e){const t=await Hc(e),n=t.eventManager;return n.onListen=ac.bind(null,t.syncEngine),n.onUnlisten=uc.bind(null,t.syncEngine),n}function nu(e,t,n={}){const s=new q;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,s,i){const r=new Uc({next:r=>{t.enqueueAndForget((()=>$a(e,o)));const u=r.docs.has(n);!u&&r.fromCache?i.reject(new A(C.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&r.fromCache&&s&&"server"===s.source?i.reject(new A(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:e=>i.reject(e)}),o=new Ya(Dn(n.path),r,{includeMetadataChanges:!0,xu:!0});return za(e,o)}(await tu(e),e.asyncQueue,t,n,s))),s.promise}function ru(e,t,n={}){const s=new q;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,s,i){const r=new Uc({next:n=>{t.enqueueAndForget((()=>$a(e,o))),n.fromCache&&"server"===s.source?i.reject(new A(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Ya(n,r,{includeMetadataChanges:!0,xu:!0});return za(e,o)}(await tu(e),e.asyncQueue,t,n,s))),s.promise}function su(e,t,n,s){const i=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new jc(e,t)}(function(e,t){if(e instanceof Uint8Array)return qc(e,t);if(e instanceof ArrayBuffer)return qc(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,na(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const s=D(e);(async function(e,t,n){try{const s=await t.getMetadata();if(await function(e,t){const n=D(e),s=us(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.xs.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(s)>=0))}(e.localStore,s))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(s)),Promise.resolve(new Set);n._updateProgress(ec(s));const i=new Za(s,e.localStore,t.serializer);let r=await t._c();for(;r;){const e=await i.$u(r);e&&n._updateProgress(e),r=await t._c()}const o=await i.complete();return await Tc(e,o.Bu,void 0),await function(e,t){const n=D(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.xs.saveBundleMetadata(e,t)))}(e.localStore,s),n._completeWith(o.progress),Promise.resolve(o.Fu)}catch(e){return T("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(s,t,n).then((e=>{s.sharedClientState.notifyBundleLoaded(e)}))}(await Zc(e),i,s)}))}const iu=new Map;function ou(e,t,n){if(!n)throw new A(C.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function au(e,t,n,s){if(!0===t&&!0===s)throw new A(C.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function cu(e){if(!H.isDocumentKey(e))throw new A(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function uu(e){if(H.isDocumentKey(e))throw new A(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function lu(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":_()}function hu(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new A(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=lu(e);throw new A(C.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function du(e,t){if(t<=0)throw new A(C.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class fu{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new A(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new A(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,au("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class mu{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fu({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new A(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new A(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fu(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new k;switch(e.type){case"firstParty":return new L(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new A(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=iu.get(e);t&&(v("ComponentProvider","Removing Datastore"),iu.delete(e),t.terminate())}(this),Promise.resolve()}}function gu(e,t,n,s={}){var i;const r=(e=hu(e,mu))._getSettings();if("firestore.googleapis.com"!==r.host&&r.host!==t&&T("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},r),{host:`${t}:${n}`,ssl:!1})),s.mockUserToken){let t,n;if("string"==typeof s.mockUserToken)t=s.mockUserToken,n=b.MOCK_USER;else{t=Object(l.g)(s.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new A(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new b(r)}e._authCredentials=new O(new N(t,n))}}class th{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yu(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new th(this.firestore,e,this._key)}}class pu{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new pu(this.firestore,e,this._query)}}class yu extends pu{constructor(e,t,n){super(e,t,Dn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new th(this.firestore,null,new H(e))}withConverter(e){return new yu(this.firestore,e,this._path)}}function wu(e,t,...n){if(e=Object(l.p)(e),ou("collection","path",t),e instanceof mu){const s=rt.fromString(t,...n);return uu(s),new yu(e,null,s)}{if(!(e instanceof th||e instanceof yu))throw new A(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(rt.fromString(t,...n));return uu(s),new yu(e.firestore,null,s)}}function vu(e,t){if(e=hu(e,mu),ou("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new A(C.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new pu(e,null,function(e){return new Sn(rt.emptyPath(),e)}(t))}function bu(e,t,...n){if(e=Object(l.p)(e),1===arguments.length&&(t=U.A()),ou("doc","path",t),e instanceof mu){const s=rt.fromString(t,...n);return cu(s),new th(e,null,new H(s))}{if(!(e instanceof th||e instanceof yu))throw new A(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(rt.fromString(t,...n));return cu(s),new th(e.firestore,e instanceof yu?e.converter:null,new H(s))}}function Iu(e,t){return e=Object(l.p)(e),t=Object(l.p)(t),(e instanceof th||e instanceof yu)&&(t instanceof th||t instanceof yu)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Tu(e,t){return e=Object(l.p)(e),t=Object(l.p)(t),e instanceof pu&&t instanceof pu&&e.firestore===t.firestore&&Fn(e._query,t._query)&&e.converter===t.converter}class Eu{constructor(){this.Nc=Promise.resolve(),this.kc=[],this.Oc=!1,this.$c=[],this.Mc=null,this.Fc=!1,this.Bc=!1,this.Lc=[],this.Co=new ra(this,"async_queue_retry"),this.qc=()=>{const e=ta();e&&v("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Co.vo()};const e=ta();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.qc)}get isShuttingDown(){return this.Oc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Uc(),this.Kc(e)}enterRestrictedMode(e){if(!this.Oc){this.Oc=!0,this.Bc=e||!1;const t=ta();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.qc)}}enqueue(e){if(this.Uc(),this.Oc)return new Promise((()=>{}));const t=new q;return this.Kc((()=>this.Oc&&this.Bc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.kc.push(e),this.Gc())))}async Gc(){if(0!==this.kc.length){try{await this.kc[0](),this.kc.shift(),this.Co.reset()}catch(e){if(!de(e))throw e;v("AsyncQueue","Operation failed with retryable error: "+e)}this.kc.length>0&&this.Co.Ao((()=>this.Gc()))}}Kc(e){const t=this.Nc.then((()=>(this.Fc=!0,e().catch((e=>{this.Mc=e,this.Fc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw I("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Fc=!1,e))))));return this.Nc=t,t}enqueueAfterDelay(e,t,n){this.Uc(),this.Lc.indexOf(e)>-1&&(t=0);const s=Va.createAndSchedule(this,e,t,n,(e=>this.Qc(e)));return this.$c.push(s),s}Uc(){this.Mc&&_()}verifyOperationInProgress(){}async zc(){let e;do{e=this.Nc,await e}while(e!==this.Nc)}jc(e){for(const t of this.$c)if(t.timerId===e)return!0;return!1}Wc(e){return this.zc().then((()=>{this.$c.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.$c)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.zc()}))}Hc(e){this.Lc.push(e)}Qc(e){const t=this.$c.indexOf(e);this.$c.splice(t,1)}}function _u(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class Su{constructor(){this._progressObserver={},this._taskCompletionResolver=new q,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const xu=-1;class Du extends mu{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new Eu,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Au(this),this._firestoreClient.terminate()}}function Cu(e){return e._firestoreClient||Au(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Au(e){var t,n,s;const i=e._freezeSettings(),r=function(e,t,n,s){return new bt(e,t,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new Gc(e._authCredentials,e._appCheckCredentials,e._queue,r),(null===(n=i.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(s=i.cache)||void 0===s?void 0:s._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}function Nu(e,t){qu(e=hu(e,Du));const n=Cu(e);if(n._uninitializedComponentsProvider)throw new A(C.FAILED_PRECONDITION,"SDK cache is already specified.");T("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const s=e._freezeSettings(),i=new Vc;return Ou(n,i,new Fc(i,s.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function ku(e){qu(e=hu(e,Du));const t=Cu(e);if(t._uninitializedComponentsProvider)throw new A(C.FAILED_PRECONDITION,"SDK cache is already specified.");T("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings(),s=new Vc;return Ou(t,s,new Pc(s,n.cacheSizeBytes))}function Ou(e,t,n){const s=new q;return e.asyncQueue.enqueue((async()=>{try{await zc(e,n),await $c(e,t),s.resolve()}catch(e){const t=e;if(!Qc(t))throw t;T("Error enabling indexeddb cache. Falling back to memory cache: "+t),s.reject(t)}})).then((()=>s.promise))}function Ru(e){if(e._initialized&&!e._terminated)throw new A(C.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new q;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!ue.D())return Promise.resolve();const t=e+"main";await ue.delete(t)}(bo(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function Mu(e){return function(e){const t=new q;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=D(e);wa(n.remoteStore)||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=D(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const s=n.hc.get(e)||[];s.push(t),n.hc.set(e,s)}catch(e){const n=qa(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Zc(e),t))),t.promise}(Cu(e=hu(e,Du)))}function Lu(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await Yc(e),n=await Jc(e);return t.setNetworkEnabled(!0),function(e){const t=D(e);return t.du.delete(0),la(t)}(n)}))}(Cu(e=hu(e,Du)))}function Fu(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await Yc(e),n=await Jc(e);return t.setNetworkEnabled(!1),async function(e){const t=D(e);t.du.add(0),await ha(t),t.mu.set("Offline")}(n)}))}(Cu(e=hu(e,Du)))}function Pu(e,t){const n=Cu(e=hu(e,Du)),s=new Su;return su(n,e._databaseId,t,s),s}function Vu(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=D(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.xs.getNamedQuery(e,t)))}(await Xc(e),t)))}(Cu(e=hu(e,Du)),t).then((t=>t?new pu(e,null,t.query):null))}function qu(e){if(e._initialized||e._terminated)throw new A(C.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Uu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Uu(ht.fromBase64String(e))}catch(e){throw new A(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Uu(ht.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ju{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new A(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new W(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Bu{constructor(e){this._methodName=e}}class Ku{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new A(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new A(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return j(this._lat,e._lat)||j(this._long,e._long)}}const Gu=/^__.*__$/;class zu{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Or(e,this.data,this.fieldMask,t,this.fieldTransforms):new kr(e,this.data,t,this.fieldTransforms)}}class $u{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Or(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Qu(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _()}}class Wu{constructor(e,t,n,s,i,r){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.Jc(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get Yc(){return this.settings.Yc}Zc(e){return new Wu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Xc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Zc({path:n,ta:!1});return s.ea(e),s}na(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Zc({path:n,ta:!1});return s.Jc(),s}sa(e){return this.Zc({path:void 0,ta:!0})}ia(e){return yl(e,this.settings.methodName,this.settings.ra||!1,this.path,this.settings.oa)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Jc(){if(this.path)for(let e=0;e<this.path.length;e++)this.ea(this.path.get(e))}ea(e){if(0===e.length)throw this.ia("Document fields must not be empty");if(Qu(this.Yc)&&Gu.test(e))throw this.ia('Document fields cannot begin and end with "__"')}}class Hu{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||na(e)}ua(e,t,n,s=!1){return new Wu({Yc:e,methodName:t,oa:n,path:W.emptyPath(),ta:!1,ra:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Yu(e){const t=e._freezeSettings(),n=na(e._databaseId);return new Hu(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Xu(e,t,n,s,i,r={}){const o=e.ua(r.merge||r.mergeFields?2:0,t,n,i);fl("Data must be an object, but it was:",o,s);const u=ll(s,o);let c,a;if(r.merge)c=new ct(o.fieldMask),a=o.fieldTransforms;else if(r.mergeFields){const e=[];for(const s of r.mergeFields){const i=ml(t,s,n);if(!o.contains(i))throw new A(C.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);ol(e,i)||e.push(i)}c=new ct(e),a=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,a=o.fieldTransforms;return new zu(new Kt(u),c,a)}class Ju extends Bu{_toFieldTransform(e){if(2!==e.Yc)throw 1===e.Yc?e.ia(`${this._methodName}() can only appear at the top level of your update data`):e.ia(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ju}}function Zu(e,t,n){return new Wu({Yc:3,oa:t.settings.oa,methodName:e._methodName,ta:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class el extends Bu{_toFieldTransform(e){return new Ir(e.path,new dr)}isEqual(e){return e instanceof el}}class tl extends Bu{constructor(e,t){super(e),this.ca=t}_toFieldTransform(e){const t=Zu(this,e,!0),n=this.ca.map((e=>cl(e,t))),s=new fr(n);return new Ir(e.path,s)}isEqual(e){return this===e}}class nl extends Bu{constructor(e,t){super(e),this.ca=t}_toFieldTransform(e){const t=Zu(this,e,!0),n=this.ca.map((e=>cl(e,t))),s=new gr(n);return new Ir(e.path,s)}isEqual(e){return this===e}}class rl extends Bu{constructor(e,t){super(e),this.aa=t}_toFieldTransform(e){const t=new yr(e.serializer,or(e.serializer,this.aa));return new Ir(e.path,t)}isEqual(e){return this===e}}function sl(e,t,n,s){const i=e.ua(1,t,n);fl("Data must be an object, but it was:",i,s);const r=[],o=Kt.empty();Ze(s,((e,s)=>{const u=pl(t,e,n);s=Object(l.p)(s);const c=i.na(u);if(s instanceof Ju)r.push(u);else{const e=cl(s,c);null!=e&&(r.push(u),o.set(u,e))}}));const u=new ct(r);return new $u(o,u,i.fieldTransforms)}function il(e,t,n,s,i,r){const o=e.ua(1,t,n),u=[ml(t,s,n)],c=[i];if(r.length%2!=0)throw new A(C.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<r.length;e+=2)u.push(ml(t,r[e])),c.push(r[e+1]);const a=[],h=Kt.empty();for(let e=u.length-1;e>=0;--e)if(!ol(a,u[e])){const t=u[e];let n=c[e];n=Object(l.p)(n);const s=o.na(t);if(n instanceof Ju)a.push(t);else{const e=cl(n,s);null!=e&&(a.push(t),h.set(t,e))}}const d=new ct(a);return new $u(h,d,o.fieldTransforms)}function al(e,t,n,s=!1){return cl(n,e.ua(s?4:3,t))}function cl(e,t){if(hl(e=Object(l.p)(e)))return fl("Unsupported field value:",t,e),ll(e,t);if(e instanceof Bu)return function(e,t){if(!Qu(t.Yc))throw t.ia(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.ia(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.ta&&4!==t.Yc)throw t.ia("Nested arrays are not supported");return function(e,t){const n=[];let s=0;for(const i of e){let e=cl(i,t.sa(s));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),s++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Object(l.p)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return or(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=G.fromDate(e);return{timestampValue:os(t.serializer,n)}}if(e instanceof G){const n=new G(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:os(t.serializer,n)}}if(e instanceof Ku)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Uu)return{bytesValue:as(t.serializer,e._byteString)};if(e instanceof th){const n=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(n))throw t.ia(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ls(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ia(`Unsupported field value: ${lu(e)}`)}(e,t)}function ll(e,t){const n={};return et(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ze(e,((e,s)=>{const i=cl(s,t.Xc(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function hl(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof G||e instanceof Ku||e instanceof Uu||e instanceof th||e instanceof Bu)}function fl(e,t,n){if(!hl(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const s=lu(n);throw"an object"===s?t.ia(e+" a custom object"):t.ia(e+" "+s)}}function ml(e,t,n){if((t=Object(l.p)(t))instanceof ju)return t._internalPath;if("string"==typeof t)return pl(e,t);throw yl("Field path arguments must be of type string or ",e,!1,void 0,n)}const gl=new RegExp("[~\\*/\\[\\]]");function pl(e,t,n){if(t.search(gl)>=0)throw yl(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new ju(...t.split("."))._internalPath}catch(r){throw yl(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function yl(e,t,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let u=`Function ${t}() called with invalid data`;n&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${s}`),o&&(c+=` in document ${i}`),c+=")"),new A(C.INVALID_ARGUMENT,u+e+c)}function ol(e,t){return e.some((e=>e.isEqual(t)))}class ul{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new th(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new wl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(vl("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class wl extends ul{data(){return super.data()}}function vl(e,t){return"string"==typeof t?pl(e,t):t instanceof ju?t._internalPath:t._delegate._internalPath}function bl(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new A(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Il{}class Tl extends Il{}function dl(e,t,...n){let s=[];t instanceof Il&&s.push(t),s=s.concat(n),function(e){const t=e.filter((e=>e instanceof Sl)).length,n=e.filter((e=>e instanceof El)).length;if(t>1||t>0&&n>0)throw new A(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const t of s)e=t._apply(e);return e}class El extends Tl{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new El(e,t,n)}_apply(e){const t=this._parse(e);return Ul(e._query,t),new pu(e.firestore,e.converter,Mn(e._query,t))}_parse(e){const t=Yu(e.firestore),n=function(e,t,n,s,i,r,o){let u;if(i.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new A(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){ql(o,r);const t=[];for(const n of o)t.push(Vl(s,e,n));u={arrayValue:{values:t}}}else u=Vl(s,e,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||ql(o,r),u=al(n,"where",o,"in"===r||"not-in"===r);return Jt.create(i,r,u)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function _l(e,t,n){const s=t,i=vl("where",e);return El._create(i,s,n)}class Sl extends Il{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Sl(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Zt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const s=t.getFlattenedFilters();for(const e of s)Ul(n,e),n=Mn(n,e)}(e._query,t),new pu(e.firestore,e.converter,Mn(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class xl extends Tl{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new xl(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new A(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new A(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Ht(t,n);return function(e,t){if(null===An(e)){const n=Nn(e);null!==n&&jl(e,n,t.field)}}(e,s),s}(e._query,this._field,this._direction);return new pu(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Sn(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Dl(e,t="asc"){const n=t,s=vl("orderBy",e);return xl._create(s,n)}class Cl extends Tl{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Cl(e,t,n)}_apply(e){return new pu(e.firestore,e.converter,Ln(e._query,this._limit,this._limitType))}}function Al(e){return du("limit",e),Cl._create("limit",e,"F")}function Nl(e){return du("limitToLast",e),Cl._create("limitToLast",e,"L")}class kl extends Tl{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new kl(e,t,n)}_apply(e){const t=Pl(e,this.type,this._docOrFields,this._inclusive);return new pu(e.firestore,e.converter,function(e,t){return new Sn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function Ol(...e){return kl._create("startAt",e,!0)}function Rl(...e){return kl._create("startAfter",e,!1)}class Ml extends Tl{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Ml(e,t,n)}_apply(e){const t=Pl(e,this.type,this._docOrFields,this._inclusive);return new pu(e.firestore,e.converter,function(e,t){return new Sn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function Ll(...e){return Ml._create("endBefore",e,!1)}function Fl(...e){return Ml._create("endAt",e,!0)}function Pl(e,t,n,s){if(n[0]=Object(l.p)(n[0]),n[0]instanceof ul)return function(e,t,n,s,i){if(!s)throw new A(C.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const r=[];for(const n of On(e))if(n.field.isKeyField())r.push(kt(t,s.key));else{const e=s.data.field(n.field);if(yt(e))throw new A(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new A(C.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}r.push(e)}return new $t(r,i)}(e._query,e.firestore._databaseId,t,n[0]._document,s);{const i=Yu(e.firestore);return function(e,t,n,s,i,r){const o=e.explicitOrderBy;if(i.length>o.length)throw new A(C.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const u=[];for(let r=0;r<i.length;r++){const c=i[r];if(o[r].field.isKeyField()){if("string"!=typeof c)throw new A(C.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof c}`);if(!kn(e)&&-1!==c.indexOf("/"))throw new A(C.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(rt.fromString(c));if(!H.isDocumentKey(n))throw new A(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new H(n);u.push(kt(t,i))}else{const e=al(n,s,c);u.push(e)}}return new $t(u,r)}(e._query,e.firestore._databaseId,i,t,n,s)}}function Vl(e,t,n){if("string"==typeof(n=Object(l.p)(n))){if(""===n)throw new A(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!kn(t)&&-1!==n.indexOf("/"))throw new A(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=t.path.child(rt.fromString(n));if(!H.isDocumentKey(s))throw new A(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return kt(e,new H(s))}if(n instanceof th)return kt(e,n._key);throw new A(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${lu(n)}.`)}function ql(e,t){if(!Array.isArray(e)||0===e.length)throw new A(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Ul(e,t){if(t.isInequality()){const n=Nn(e),s=t.field;if(null!==n&&!n.isEqual(s))throw new A(C.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${s.toString()}'`);const i=An(e);null!==i&&jl(e,s,i)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new A(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new A(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function jl(e,t,n){if(!n.isEqual(t))throw new A(C.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Bl{convertValue(e,t="none"){switch(_t(e)){case 0:return null;case 1:return e.booleanValue;case 2:return gt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(pt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw _()}}convertObject(e,t){const n={};return Ze(e.fields,((e,s)=>{n[e]=this.convertValue(s,t)})),n}convertGeoPoint(e){return new Ku(gt(e.latitude),gt(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=wt(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(vt(e));default:return null}}convertTimestamp(e){const t=mt(e);return new G(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=rt.fromString(e);S(Rs(n));const s=new It(n.get(1),n.get(3)),i=new H(n.popFirst(5));return s.isEqual(t)||I(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Kl(e,t,n){let s;return s=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,s}class Gl extends Bl{constructor(e){super(),this.firestore=e}convertBytes(e){return new Uu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new th(this.firestore,null,t)}}class zl{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class $l extends ul{constructor(e,t,n,s,i,r){super(e,t,n,s,r),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ql(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(vl("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Ql extends $l{data(e={}){return super.data(e)}}class Wl{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new zl(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Ql(this._firestore,this._userDataWriter,n.key,n,new zl(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new A(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const s=new Ql(e._firestore,e._userDataWriter,n.doc.key,n.doc,new zl(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const s=new Ql(e._firestore,e._userDataWriter,t.doc.key,t.doc,new zl(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,r=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),r=n.indexOf(t.doc.key)),{type:Hl(t.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Hl(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _()}}function Yl(e,t){return e instanceof $l&&t instanceof $l?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Wl&&t instanceof Wl&&e._firestore===t._firestore&&Tu(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Xl(e){e=hu(e,th);const t=hu(e.firestore,Du);return nu(Cu(t),e._key).then((n=>dh(t,e,n)))}class Jl extends Bl{constructor(e){super(),this.firestore=e}convertBytes(e){return new Uu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new th(this.firestore,null,t)}}function Zl(e){e=hu(e,th);const t=hu(e.firestore,Du),n=Cu(t),s=new Jl(t);return function(e,t){const n=new q;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const s=await function(e,t){const n=D(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new A(C.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const s=qa(e,`Failed to get document '${t} from cache`);n.reject(s)}}(await Xc(e),t,n))),n.promise}(n,e._key).then((n=>new $l(t,s,e._key,n,new zl(null!==n&&n.hasLocalMutations,!0),e.converter)))}function eh(e){e=hu(e,th);const t=hu(e.firestore,Du);return nu(Cu(t),e._key,{source:"server"}).then((n=>dh(t,e,n)))}function nh(e){e=hu(e,pu);const t=hu(e.firestore,Du),n=Cu(t),s=new Jl(t);return bl(e._query),ru(n,e._query).then((n=>new Wl(t,s,e,n)))}function rh(e){e=hu(e,pu);const t=hu(e.firestore,Du),n=Cu(t),s=new Jl(t);return function(e,t){const n=new q;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const s=await ko(e,t,!0),i=new rc(t,s.Wi),r=i.zu(s.documents),o=i.applyChanges(r,!1);n.resolve(o.snapshot)}catch(e){const s=qa(e,`Failed to execute query '${t} against cache`);n.reject(s)}}(await Xc(e),t,n))),n.promise}(n,e._query).then((n=>new Wl(t,s,e,n)))}function sh(e){e=hu(e,pu);const t=hu(e.firestore,Du),n=Cu(t),s=new Jl(t);return ru(n,e._query,{source:"server"}).then((n=>new Wl(t,s,e,n)))}function ih(e,t,n){e=hu(e,th);const s=hu(e.firestore,Du),i=Kl(e.converter,t,n);return hh(s,[Xu(Yu(s),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Er.none())])}function oh(e,t,n,...s){e=hu(e,th);const i=hu(e.firestore,Du),r=Yu(i);let o;return o="string"==typeof(t=Object(l.p)(t))||t instanceof ju?il(r,"updateDoc",e._key,t,n,s):sl(r,"updateDoc",e._key,t),hh(i,[o.toMutation(e._key,Er.exists(!0))])}function ah(e){return hh(hu(e.firestore,Du),[new Fr(e._key,Er.none())])}function ch(e,t){const n=hu(e.firestore,Du),s=bu(e),i=Kl(e.converter,t);return hh(n,[Xu(Yu(e.firestore),"addDoc",s._key,i,null!==e.converter,{}).toMutation(s._key,Er.exists(!1))]).then((()=>s))}function uh(e,...t){var n,s,i;e=Object(l.p)(e);let r={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||_u(t[o])||(r=t[o],o++);const u={includeMetadataChanges:r.includeMetadataChanges};if(_u(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(s=e.error)||void 0===s?void 0:s.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,a,h;if(e instanceof th)a=hu(e.firestore,Du),h=Dn(e._key.path),c={next:n=>{t[o]&&t[o](dh(a,e,n))},error:t[o+1],complete:t[o+2]};else{const n=hu(e,pu);a=hu(n.firestore,Du),h=n._query;const s=new Jl(a);c={next:e=>{t[o]&&t[o](new Wl(a,s,n,e))},error:t[o+1],complete:t[o+2]},bl(e._query)}return function(e,t,n,s){const i=new Uc(s),r=new Ya(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>za(await tu(e),r))),()=>{i.yc(),e.asyncQueue.enqueueAndForget((async()=>$a(await tu(e),r)))}}(Cu(a),h,u,c)}function lh(e,t){return function(e,t){const n=new Uc(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){D(e).Au.add(t),t.next()}(await tu(e),n))),()=>{n.yc(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){D(e).Au.delete(t)}(await tu(e),n)))}}(Cu(e=hu(e,Du)),_u(t)?t:{next:t})}function hh(e,t){return function(e,t){const n=new q;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const s=Mc(e);try{const e=await function(e,t){const n=D(e),s=G.now(),i=t.reduce(((e,t)=>e.add(t.key)),er());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let u=zn(),c=er();return n.Ki.getEntries(e,i).next((e=>{u=e,u.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,u))).next((i=>{r=i;const o=[];for(const e of t){const t=Ar(e,r.get(e.key).overlayedDocument);null!=t&&o.push(new Or(e.key,t,Gt(t.value.mapValue),Er.exists(!0)))}return n.mutationQueue.addMutationBatch(e,s,o,t)})).next((t=>{o=t;const s=t.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,s)}))})).then((()=>({batchId:o.batchId,changes:Wn(r)})))}(s.localStore,t);s.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let s=e.ac[e.currentUser.toKey()];s||(s=new tt(j)),s=s.insert(t,n),e.ac[e.currentUser.toKey()]=s}(s,e.batchId,n),await Tc(s,e.changes),await Sa(s.remoteStore)}catch(e){const t=qa(e,"Failed to persist write");n.reject(t)}}(await Zc(e),t,n))),n.promise}(Cu(e),t)}function dh(e,t,n){const s=n.docs.get(t._key),i=new Jl(e);return new $l(e,i,t._key,s,new zl(n.hasPendingWrites,n.fromCache),t.converter)}const fh={maxAttempts:5};class mh{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Yu(e)}set(e,t,n){this._verifyNotCommitted();const s=gh(e,this._firestore),i=Kl(s.converter,t,n),r=Xu(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,n);return this._mutations.push(r.toMutation(s._key,Er.none())),this}update(e,t,n,...s){this._verifyNotCommitted();const i=gh(e,this._firestore);let r;return r="string"==typeof(t=Object(l.p)(t))||t instanceof ju?il(this._dataReader,"WriteBatch.update",i._key,t,n,s):sl(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(r.toMutation(i._key,Er.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=gh(e,this._firestore);return this._mutations=this._mutations.concat(new Fr(t._key,Er.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new A(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function gh(e,t){if((e=Object(l.p)(e)).firestore!==t)throw new A(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class ph extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Yu(e)}get(e){const t=gh(e,this._firestore),n=new Gl(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return _();const s=e[0];if(s.isFoundDocument())return new ul(this._firestore,n,s.key,s,t.converter);if(s.isNoDocument())return new ul(this._firestore,n,t._key,null,t.converter);throw _()}))}set(e,t,n){const s=gh(e,this._firestore),i=Kl(s.converter,t,n),r=Xu(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,n);return this._transaction.set(s._key,r),this}update(e,t,n,...s){const i=gh(e,this._firestore);let r;return r="string"==typeof(t=Object(l.p)(t))||t instanceof ju?il(this._dataReader,"Transaction.update",i._key,t,n,s):sl(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,r),this}delete(e){const t=gh(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=gh(e,this._firestore),n=new Jl(this._firestore);return super.get(e).then((e=>new $l(this._firestore,n,t._key,e._document,new zl(!1,!1),t.converter)))}}function yh(e,t,n){e=hu(e,Du);const s=Object.assign(Object.assign({},fh),n);return function(e){if(e.maxAttempts<1)throw new A(C.INVALID_ARGUMENT,"Max attempts must be at least 1")}(s),function(e,t,n){const s=new q;return e.asyncQueue.enqueueAndForget((async()=>{const i=await eu(e);new Kc(e.asyncQueue,i,n,t,s).run()})),s.promise}(Cu(e),(n=>t(new ph(e,n))),s)}function wh(){return new Ju("deleteField")}function vh(){return new el("serverTimestamp")}function bh(...e){return new tl("arrayUnion",e)}function Ih(...e){return new nl("arrayRemove",e)}function Th(e){return new rl("increment",e)}!function(e,t=!0){!function(e){f=e}(r.SDK_VERSION),Object(r._registerComponent)(new o.a("firestore",((e,{instanceIdentifier:n,options:s})=>{const i=e.getProvider("app").getImmediate(),r=new Du(new R(e.getProvider("auth-internal")),new P(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new A(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new It(e.options.projectId,t)}(i,n),i);return s=Object.assign({useFetchStreams:t},s),r._setSettings(s),r}),"PUBLIC").setMultipleInstances(!0)),Object(r.registerVersion)(d,"3.10.0",e),Object(r.registerVersion)(d,"3.10.0","esm2017")}()}).call(this,n(170))},507:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return ir})),n.d(t,"b",(function(){return ar})),n.d(t,"c",(function(){return or})),n.d(t,"d",(function(){return ur})),n.d(t,"e",(function(){return cr})),n.d(t,"f",(function(){return lr})),n.d(t,"g",(function(){return dr})),n.d(t,"h",(function(){return rr})),n.d(t,"i",(function(){return sr}));var r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},c={},l=l||{},h=o||self;function d(){}function f(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var m="closure_uid_"+(1e9*Math.random()>>>0),y=0;function w(a,b,e){return a.call.apply(a.bind,arguments)}function v(a,b,e){if(!a)throw Error();if(2<arguments.length){var t=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,t),a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function q(a,b,e){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:v).apply(null,arguments)}function I(a,b){var e=Array.prototype.slice.call(arguments,1);return function(){var t=e.slice();return t.push.apply(t,arguments),a.apply(this,t)}}function T(a,b){function e(){}e.prototype=b.prototype,a.X=b.prototype,a.prototype=new e,a.prototype.constructor=a,a.Wb=function(e,t,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return b.prototype[t].apply(e,r)}}function E(){this.s=this.s,this.o=this.o}E.prototype.s=!1,E.prototype.na=function(){var a;!this.s&&(this.s=!0,this.M(),0)&&(a=this,Object.prototype.hasOwnProperty.call(a,m)&&a[m]||(a[m]=++y))},E.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const _=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(let e=0;e<a.length;e++)if(e in a&&a[e]===b)return e;return-1};function S(a){const b=a.length;if(0<b){const e=Array(b);for(let t=0;t<b;t++)e[t]=a[t];return e}return[]}function x(a,b){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(f(t)){const e=a.length||0,n=t.length||0;a.length=e+n;for(let r=0;r<n;r++)a[e+r]=t[r]}else a.push(t)}}function D(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}D.prototype.h=function(){this.defaultPrevented=!0};var C=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{h.addEventListener("test",d,b),h.removeEventListener("test",d,b)}catch(e){}return a}();function A(a){return/^[\s\xa0]*$/.test(a)}var N=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function k(a,b){return a<b?-1:a>b?1:0}function O(){var a=h.navigator;return a&&(a=a.userAgent)?a:""}function R(a){return-1!=O().indexOf(a)}function M(a){return M[" "](a),a}M[" "]=d;var L,a,F=R("Opera"),P=R("Trident")||R("MSIE"),V=R("Edge"),U=V||P,j=R("Gecko")&&!(-1!=O().toLowerCase().indexOf("webkit")&&!R("Edge"))&&!(R("Trident")||R("MSIE"))&&!R("Edge"),B=-1!=O().toLowerCase().indexOf("webkit")&&!R("Edge");function K(){var a=h.document;return a?a.documentMode:void 0}e:{var G="",z=(a=O(),j?/rv:([^\);]+)(\)|;)/.exec(a):V?/Edge\/([\d\.]+)/.exec(a):P?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):B?/WebKit\/(\S+)/.exec(a):F?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(z&&(G=z?z[1]:""),P){var $=K();if(null!=$&&$>parseFloat(G)){L=String($);break e}}L=G}var Q,W={};function H(){return function(a){var b=W;return Object.prototype.hasOwnProperty.call(b,9)?b[9]:b[9]=a(9)}((function(){let a=0;const b=N(String(L)).split("."),e=N("9").split("."),t=Math.max(b.length,e.length);for(let o=0;0==a&&o<t;o++){var n=b[o]||"",r=e[o]||"";do{if(n=/(\d*)(\D*)(.*)/.exec(n)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==n[0].length&&0==r[0].length)break;a=k(0==n[1].length?0:parseInt(n[1],10),0==r[1].length?0:parseInt(r[1],10))||k(0==n[2].length,0==r[2].length)||k(n[2],r[2]),n=n[3],r=r[3]}while(0==a)}return 0<=a}))}if(h.document&&P){var Y=K();Q=Y||(parseInt(L,10)||void 0)}else Q=void 0;var X=Q;function J(a,b){if(D.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var e=this.type=a.type,t=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(j){e:{try{M(b.nodeName);var n=!0;break e}catch(e){}n=!1}n||(b=null)}}else"mouseover"==e?b=a.fromElement:"mouseout"==e&&(b=a.toElement);this.relatedTarget=b,t?(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:Z[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&J.X.h.call(this)}}T(J,D);var Z={2:"touch",3:"pen",4:"mouse"};J.prototype.h=function(){J.X.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var ee="closure_listenable_"+(1e6*Math.random()|0),te=0;function ne(a,b,e,t,n){this.listener=a,this.proxy=null,this.src=b,this.type=e,this.capture=!!t,this.ha=n,this.key=++te,this.ba=this.ea=!1}function re(a){a.ba=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function se(a,b,e){for(const t in a)b.call(e,a[t],t,a)}function ie(a){const b={};for(const e in a)b[e]=a[e];return b}const oe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ae(a,b){let e,t;for(let n=1;n<arguments.length;n++){for(e in t=arguments[n],t)a[e]=t[e];for(let n=0;n<oe.length;n++)e=oe[n],Object.prototype.hasOwnProperty.call(t,e)&&(a[e]=t[e])}}function ce(a){this.src=a,this.g={},this.h=0}function ue(a,b){var e=b.type;if(e in a.g){var t,n=a.g[e],r=_(n,b);(t=0<=r)&&Array.prototype.splice.call(n,r,1),t&&(re(b),0==a.g[e].length&&(delete a.g[e],a.h--))}}function le(a,b,e,t){for(var n=0;n<a.length;++n){var r=a[n];if(!r.ba&&r.listener==b&&r.capture==!!e&&r.ha==t)return n}return-1}ce.prototype.add=function(a,b,e,t,n){var r=a.toString();(a=this.g[r])||(a=this.g[r]=[],this.h++);var o=le(a,b,t,n);return-1<o?(b=a[o],e||(b.ea=!1)):((b=new ne(b,this.src,r,!!t,n)).ea=e,a.push(b)),b};var he="closure_lm_"+(1e6*Math.random()|0),de={};function fe(a,b,e,t,n){if(t&&t.once)return ge(a,b,e,t,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)fe(a,b[r],e,t,n);return null}return e=Te(e),a&&a[ee]?a.N(b,e,p(t)?!!t.capture:!!t,n):me(a,b,e,!1,t,n)}function me(a,b,e,t,n,r){if(!b)throw Error("Invalid event type");var o=p(n)?!!n.capture:!!n,c=be(a);if(c||(a[he]=c=new ce(a)),(e=c.add(b,e,t,o,r)).proxy)return e;if(t=function(){function a(e){return b.call(a.src,a.listener,e)}const b=ve;return a}(),e.proxy=t,t.src=a,t.listener=e,a.addEventListener)C||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),t,n);else if(a.attachEvent)a.attachEvent(we(b.toString()),t);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(t)}return e}function ge(a,b,e,t,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)ge(a,b[r],e,t,n);return null}return e=Te(e),a&&a[ee]?a.O(b,e,p(t)?!!t.capture:!!t,n):me(a,b,e,!0,t,n)}function pe(a,b,e,t,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)pe(a,b[r],e,t,n);else t=p(t)?!!t.capture:!!t,e=Te(e),a&&a[ee]?(a=a.i,(b=String(b).toString())in a.g&&(-1<(e=le(r=a.g[b],e,t,n))&&(re(r[e]),Array.prototype.splice.call(r,e,1),0==r.length&&(delete a.g[b],a.h--)))):a&&(a=be(a))&&(b=a.g[b.toString()],a=-1,b&&(a=le(b,e,t,n)),(e=-1<a?b[a]:null)&&ye(e))}function ye(a){if("number"!=typeof a&&a&&!a.ba){var b=a.src;if(b&&b[ee])ue(b.i,a);else{var e=a.type,t=a.proxy;b.removeEventListener?b.removeEventListener(e,t,a.capture):b.detachEvent?b.detachEvent(we(e),t):b.addListener&&b.removeListener&&b.removeListener(t),(e=be(b))?(ue(e,a),0==e.h&&(e.src=null,b[he]=null)):re(a)}}}function we(a){return a in de?de[a]:de[a]="on"+a}function ve(a,b){if(a.ba)a=!0;else{b=new J(b,this);var e=a.listener,t=a.ha||a.src;a.ea&&ye(a),a=e.call(t,b)}return a}function be(a){return(a=a[he])instanceof ce?a:null}var Ie="__closure_events_fn_"+(1e9*Math.random()>>>0);function Te(a){return"function"==typeof a?a:(a[Ie]||(a[Ie]=function(b){return a.handleEvent(b)}),a[Ie])}function Ee(){E.call(this),this.i=new ce(this),this.P=this,this.I=null}function _e(a,b){var e,t=a.I;if(t)for(e=[];t;t=t.I)e.push(t);if(a=a.P,t=b.type||b,"string"==typeof b)b=new D(b,a);else if(b instanceof D)b.target=b.target||a;else{var n=b;ae(b=new D(t,a),n)}if(n=!0,e)for(var r=e.length-1;0<=r;r--){var o=b.g=e[r];n=Se(o,t,!0,b)&&n}if(n=Se(o=b.g=a,t,!0,b)&&n,n=Se(o,t,!1,b)&&n,e)for(r=0;r<e.length;r++)n=Se(o=b.g=e[r],t,!1,b)&&n}function Se(a,b,e,t){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.ba&&o.capture==e){var c=o.listener,u=o.ha||o.src;o.ea&&ue(a.i,o),n=!1!==c.call(u,t)&&n}}return n&&!t.defaultPrevented}T(Ee,E),Ee.prototype[ee]=!0,Ee.prototype.removeEventListener=function(a,b,e,t){pe(this,a,b,e,t)},Ee.prototype.M=function(){if(Ee.X.M.call(this),this.i){var e,a=this.i;for(e in a.g){for(var t=a.g[e],n=0;n<t.length;n++)re(t[n]);delete a.g[e],a.h--}}this.I=null},Ee.prototype.N=function(a,b,e,t){return this.i.add(String(a),b,!1,e,t)},Ee.prototype.O=function(a,b,e,t){return this.i.add(String(a),b,!0,e,t)};var xe=h.JSON.stringify;function De(){var a=Me;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var Ce,Ae=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new Ne),(a=>a.reset()));class Ne{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}function ke(a){h.setTimeout((()=>{throw a}),0)}function Oe(a,b){Ce||function(){var a=h.Promise.resolve(void 0);Ce=function(){a.then(Le)}}(),Re||(Ce(),Re=!0),Me.add(a,b)}var Re=!1,Me=new class{constructor(){this.h=this.g=null}add(a,b){const e=Ae.get();e.set(a,b),this.h?this.h.next=e:this.g=e,this.h=e}};function Le(){for(var a;a=De();){try{a.h.call(a.g)}catch(e){ke(e)}var b=Ae;b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}Re=!1}function Fe(a,b){Ee.call(this),this.h=a||1,this.g=b||h,this.j=q(this.lb,this),this.l=Date.now()}function Pe(a){a.ca=!1,a.R&&(a.g.clearTimeout(a.R),a.R=null)}function Ve(a,b,e){if("function"==typeof a)e&&(a=q(a,e));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:h.setTimeout(a,b||0)}function qe(a){a.g=Ve((()=>{a.g=null,a.i&&(a.i=!1,qe(a))}),a.j);const b=a.h;a.h=null,a.m.apply(null,b)}T(Fe,Ee),(r=Fe.prototype).ca=!1,r.R=null,r.lb=function(){if(this.ca){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-a):(this.R&&(this.g.clearTimeout(this.R),this.R=null),_e(this,"tick"),this.ca&&(Pe(this),this.start()))}},r.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Fe.X.M.call(this),Pe(this),delete this.g};class Ue extends E{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:qe(this)}M(){super.M(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function je(a){E.call(this),this.h=a,this.g={}}T(je,E);var Be=[];function Ke(a,b,e,t){Array.isArray(e)||(e&&(Be[0]=e.toString()),e=Be);for(var n=0;n<e.length;n++){var r=fe(b,e[n],t||a.handleEvent,!1,a.h||a);if(!r)break;a.g[r.key]=r}}function Ge(a){se(a.g,(function(b,e){this.g.hasOwnProperty(e)&&ye(b)}),a),a.g={}}function ze(){this.g=!0}function $e(a,b,e,t){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.g)return b;if(!b)return null;try{var e=JSON.parse(b);if(e)for(a=0;a<e.length;a++)if(Array.isArray(e[a])){var t=e[a];if(!(2>t.length)){var n=t[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return xe(e)}catch(e){return b}}(a,e)+(t?" "+t:"")}))}je.prototype.M=function(){je.X.M.call(this),Ge(this)},je.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ze.prototype.Aa=function(){this.g=!1},ze.prototype.info=function(){};var Qe={},We=null;function He(){return We=We||new Ee}function Ye(a){D.call(this,Qe.Pa,a)}function Xe(a){const b=He();_e(b,new Ye(b))}function Je(a,b){D.call(this,Qe.STAT_EVENT,a),this.stat=b}function Ze(a){const b=He();_e(b,new Je(b,a))}function et(a,b){D.call(this,Qe.Qa,a),this.size=b}function tt(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return h.setTimeout((function(){a()}),b)}Qe.Pa="serverreachability",T(Ye,D),Qe.STAT_EVENT="statevent",T(Je,D),Qe.Qa="timingevent",T(et,D);var nt={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},st={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function it(){}function ot(a){return a.h||(a.h=a.i())}function at(){}it.prototype.h=null;var ct,ut={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function lt(){D.call(this,"d")}function ht(){D.call(this,"c")}function ft(){}function mt(a,b,e,t){this.l=a,this.j=b,this.m=e,this.U=t||1,this.S=new je(this),this.O=pt,a=U?125:void 0,this.T=new Fe(a),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new gt}function gt(){this.i=null,this.g="",this.h=!1}T(lt,D),T(ht,D),T(ft,it),ft.prototype.g=function(){return new XMLHttpRequest},ft.prototype.i=function(){return{}},ct=new ft;var pt=45e3,yt={},wt={};function vt(a,b,e){a.K=1,a.v=Vt(Rt(b)),a.s=e,a.P=!0,bt(a,null)}function bt(a,b){a.F=Date.now(),_t(a),a.A=Rt(a.v);var e=a.A,t=a.U;Array.isArray(t)||(t=[String(t)]),Xt(e.i,"t",t),a.C=0,e=a.l.H,a.h=new gt,a.g=Hn(a.l,e?b:null,!a.s),0<a.N&&(a.L=new Ue(q(a.La,a,a.g),a.N)),Ke(a.S,a.g,"readystatechange",a.ib),b=a.H?ie(a.H):{},a.s?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.da(a.A,a.u,a.s,b)):(a.u="GET",a.g.da(a.A,a.u,null,b)),Xe(),function(a,b,e,t,n,r){a.info((function(){if(a.g)if(r)for(var o="",c=r.split("&"),u=0;u<c.length;u++){var l=c[u].split("=");if(1<l.length){var h=l[0];l=l[1];var d=h.split("_");o=2<=d.length&&"type"==d[1]?o+(h+"=")+l+"&":o+(h+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+t+") [attempt "+n+"]: "+b+"\n"+e+"\n"+o}))}(a.j,a.u,a.A,a.m,a.U,a.s)}function It(a){return!!a.g&&("GET"==a.u&&2!=a.K&&a.l.Da)}function Tt(a,b,e){let t,n=!0;for(;!a.I&&a.C<e.length;){if(t=Et(a,e),t==wt){4==b&&(a.o=4,Ze(14),n=!1),$e(a.j,a.m,null,"[Incomplete Response]");break}if(t==yt){a.o=4,Ze(15),$e(a.j,a.m,e,"[Invalid Chunk]"),n=!1;break}$e(a.j,a.m,t,null),At(a,t)}It(a)&&t!=wt&&t!=yt&&(a.h.g="",a.C=0),4!=b||0!=e.length||a.h.h||(a.o=1,Ze(16),n=!1),a.i=a.i&&n,n?0<e.length&&!a.$&&(a.$=!0,(b=a.l).g==a&&b.$&&!b.K&&(b.j.info("Great, no buffering proxy detected. Bytes received: "+e.length),jn(b),b.K=!0,Ze(11))):($e(a.j,a.m,e,"[Invalid Chunked Response]"),Ct(a),Dt(a))}function Et(a,b){var e=a.C,t=b.indexOf("\n",e);return-1==t?wt:(e=Number(b.substring(e,t)),isNaN(e)?yt:(t+=1)+e>b.length?wt:(b=b.substr(t,e),a.C=t+e,b))}function _t(a){a.V=Date.now()+a.O,St(a,a.O)}function St(a,b){if(null!=a.B)throw Error("WatchDog timer not null");a.B=tt(q(a.gb,a),b)}function xt(a){a.B&&(h.clearTimeout(a.B),a.B=null)}function Dt(a){0==a.l.G||a.I||Gn(a.l,a)}function Ct(a){xt(a);var b=a.L;b&&"function"==typeof b.na&&b.na(),a.L=null,Pe(a.T),Ge(a.S),a.g&&(b=a.g,a.g=null,b.abort(),b.na())}function At(a,b){try{var e=a.l;if(0!=e.G&&(e.g==a||rn(e.h,a)))if(!a.J&&rn(e.h,a)&&3==e.G){try{var t=e.Fa.g.parse(b)}catch(e){t=null}if(Array.isArray(t)&&3==t.length){var n=t;if(0==n[0]){e:if(!e.u){if(e.g){if(!(e.g.F+3e3<a.F))break e;Kn(e),Rn(e)}Un(e),Ze(18)}}else e.Ba=n[1],0<e.Ba-e.T&&37500>n[2]&&e.L&&0==e.A&&!e.v&&(e.v=tt(q(e.cb,e),6e3));if(1>=nn(e.h)&&e.ja){try{e.ja()}catch(e){}e.ja=void 0}}else $n(e,11)}else if((a.J||e.g==a)&&Kn(e),!A(b))for(n=e.Fa.g.parse(b),b=0;b<n.length;b++){let l=n[b];if(e.T=l[0],l=l[1],2==e.G)if("c"==l[0]){e.I=l[1],e.ka=l[2];const n=l[3];null!=n&&(e.ma=n,e.j.info("VER="+e.ma));const h=l[4];null!=h&&(e.Ca=h,e.j.info("SVER="+e.Ca));const d=l[5];null!=d&&"number"==typeof d&&0<d&&(t=1.5*d,e.J=t,e.j.info("backChannelRequestTimeoutMs_="+t)),t=e;const f=a.g;if(f){const e=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=t.h;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(sn(r,r.h),r.h=null))}if(t.D){const e=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(t.za=e,Pt(t.F,t.D,e))}}e.G=3,e.l&&e.l.xa(),e.$&&(e.P=Date.now()-a.F,e.j.info("Handshake RTT: "+e.P+"ms"));var o=a;if((t=e).sa=Wn(t,t.H?t.ka:null,t.V),o.J){on(t.h,o);var c=o,u=t.J;u&&c.setTimeout(u),c.B&&(xt(c),_t(c)),t.g=o}else qn(t);0<e.i.length&&Ln(e)}else"stop"!=l[0]&&"close"!=l[0]||$n(e,7);else 3==e.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?$n(e,7):On(e):"noop"!=l[0]&&e.l&&e.l.wa(l),e.A=0)}Xe()}catch(e){}}function Nt(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(f(a)||"string"==typeof a)Array.prototype.forEach.call(a,b,void 0);else for(var e=function(a){if(a.oa&&"function"==typeof a.oa)return a.oa();if(!a.W||"function"!=typeof a.W){if("undefined"!=typeof Map&&a instanceof Map)return Array.from(a.keys());if(!("undefined"!=typeof Set&&a instanceof Set)){if(f(a)||"string"==typeof a){var b=[];a=a.length;for(var e=0;e<a;e++)b.push(e);return b}b=[],e=0;for(const t in a)b[e++]=t;return b}}}(a),t=function(a){if(a.W&&"function"==typeof a.W)return a.W();if("undefined"!=typeof Map&&a instanceof Map||"undefined"!=typeof Set&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(f(a)){for(var b=[],e=a.length,t=0;t<e;t++)b.push(a[t]);return b}for(t in b=[],e=0,a)b[e++]=a[t];return b}(a),n=t.length,r=0;r<n;r++)b.call(void 0,t[r],e&&e[r],a)}(r=mt.prototype).setTimeout=function(a){this.O=a},r.ib=function(a){a=a.target;const b=this.L;b&&3==xn(a)?b.l():this.La(a)},r.La=function(a){try{if(a==this.g)e:{const d=xn(this.g);var b=this.g.Ea();this.g.aa();if(!(3>d)&&(3!=d||U||this.g&&(this.h.h||this.g.fa()||Dn(this.g)))){this.I||4!=d||7==b||Xe(),xt(this);var e=this.g.aa();this.Y=e;t:if(It(this)){var t=Dn(this.g);a="";var n=t.length,r=4==xn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ct(this),Dt(this);var o="";break t}this.h.i=new h.TextDecoder}for(b=0;b<n;b++)this.h.h=!0,a+=this.h.i.decode(t[b],{stream:r&&b==n-1});t.splice(0,n),this.h.g+=a,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==e,function(a,b,e,t,n,r,o){a.info((function(){return"XMLHTTP RESP ("+t+") [ attempt "+n+"]: "+b+"\n"+e+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.U,d,e),this.i){if(this.Z&&!this.J){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(c)){var l=c;break t}}l=null}if(!(e=l)){this.i=!1,this.o=3,Ze(12),Ct(this),Dt(this);break e}$e(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,At(this,e)}this.P?(Tt(this,d,o),U&&this.i&&3==d&&(Ke(this.S,this.T,"tick",this.hb),this.T.start())):($e(this.j,this.m,o,null),At(this,o)),4==d&&Ct(this),this.i&&!this.I&&(4==d?Gn(this.l,this):(this.i=!1,_t(this)))}else 400==e&&0<o.indexOf("Unknown SID")?(this.o=3,Ze(12)):(this.o=0,Ze(13)),Ct(this),Dt(this)}}}catch(e){}},r.hb=function(){if(this.g){var a=xn(this.g),b=this.g.fa();this.C<b.length&&(xt(this),Tt(this,a,b),this.i&&4!=a&&_t(this))}},r.cancel=function(){this.I=!0,Ct(this)},r.gb=function(){this.B=null;const a=Date.now();0<=a-this.V?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.j,this.A),2!=this.K&&(Xe(),Ze(17)),Ct(this),this.o=2,Dt(this)):St(this,this.V-a)};var kt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ot(a,b){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,a instanceof Ot){this.h=void 0!==b?b:a.h,Mt(this,a.j),this.s=a.s,this.g=a.g,Lt(this,a.m),this.l=a.l,b=a.i;var e=new Qt;e.i=b.i,b.g&&(e.g=new Map(b.g),e.h=b.h),Ft(this,e),this.o=a.o}else a&&(e=String(a).match(kt))?(this.h=!!b,Mt(this,e[1]||"",!0),this.s=qt(e[2]||""),this.g=qt(e[3]||"",!0),Lt(this,e[4]),this.l=qt(e[5]||"",!0),Ft(this,e[6]||"",!0),this.o=qt(e[7]||"")):(this.h=!!b,this.i=new Qt(null,this.h))}function Rt(a){return new Ot(a)}function Mt(a,b,e){a.j=e?qt(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function Lt(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function Ft(a,b,e){b instanceof Qt?(a.i=b,function(a,b){b&&!a.j&&(Wt(a),a.i=null,a.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Ht(this,t),Xt(this,n,e))}),a)),a.j=b}(a.i,a.h)):(e||(b=Ut(b,zt)),a.i=new Qt(b,a.h))}function Pt(a,b,e){a.i.set(b,e)}function Vt(a){return Pt(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function qt(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Ut(a,b,e){return"string"==typeof a?(a=encodeURI(a).replace(b,jt),e&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function jt(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Ot.prototype.toString=function(){var a=[],b=this.j;b&&a.push(Ut(b,Bt,!0),":");var e=this.g;return(e||"file"==b)&&(a.push("//"),(b=this.s)&&a.push(Ut(b,Bt,!0),"@"),a.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(e=this.m)&&a.push(":",String(e))),(e=this.l)&&(this.g&&"/"!=e.charAt(0)&&a.push("/"),a.push(Ut(e,"/"==e.charAt(0)?Gt:Kt,!0))),(e=this.i.toString())&&a.push("?",e),(e=this.o)&&a.push("#",Ut(e,$t)),a.join("")};var Bt=/[#\/\?@]/g,Kt=/[#\?:]/g,Gt=/[#\?]/g,zt=/[#\?@]/g,$t=/#/g;function Qt(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function Wt(a){a.g||(a.g=new Map,a.h=0,a.i&&function(a,b){if(a){a=a.split("&");for(var e=0;e<a.length;e++){var t=a[e].indexOf("="),n=null;if(0<=t){var r=a[e].substring(0,t);n=a[e].substring(t+1)}else r=a[e];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.i,(function(b,e){a.add(decodeURIComponent(b.replace(/\+/g," ")),e)})))}function Ht(a,b){Wt(a),b=Jt(a,b),a.g.has(b)&&(a.i=null,a.h-=a.g.get(b).length,a.g.delete(b))}function Yt(a,b){return Wt(a),b=Jt(a,b),a.g.has(b)}function Xt(a,b,e){Ht(a,b),0<e.length&&(a.i=null,a.g.set(Jt(a,b),S(e)),a.h+=e.length)}function Jt(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}(r=Qt.prototype).add=function(a,b){Wt(this),this.i=null,a=Jt(this,a);var e=this.g.get(a);return e||this.g.set(a,e=[]),e.push(b),this.h+=1,this},r.forEach=function(a,b){Wt(this),this.g.forEach((function(e,t){e.forEach((function(e){a.call(b,e,t,this)}),this)}),this)},r.oa=function(){Wt(this);const a=Array.from(this.g.values()),b=Array.from(this.g.keys()),e=[];for(let t=0;t<b.length;t++){const n=a[t];for(let r=0;r<n.length;r++)e.push(b[t])}return e},r.W=function(a){Wt(this);let b=[];if("string"==typeof a)Yt(this,a)&&(b=b.concat(this.g.get(Jt(this,a))));else{a=Array.from(this.g.values());for(let e=0;e<a.length;e++)b=b.concat(a[e])}return b},r.set=function(a,b){return Wt(this),this.i=null,Yt(this,a=Jt(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},r.get=function(a,b){return a&&0<(a=this.W(a)).length?String(a[0]):b},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],b=Array.from(this.g.keys());for(var e=0;e<b.length;e++){var t=b[e];const r=encodeURIComponent(String(t)),o=this.W(t);for(t=0;t<o.length;t++){var n=r;""!==o[t]&&(n+="="+encodeURIComponent(String(o[t]))),a.push(n)}}return this.i=a.join("&")};function Zt(a){this.l=a||en,h.PerformanceNavigationTiming?a=0<(a=h.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(h.g&&h.g.Ga&&h.g.Ga()&&h.g.Ga().$b),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var en=10;function tn(a){return!!a.h||!!a.g&&a.g.size>=a.j}function nn(a){return a.h?1:a.g?a.g.size:0}function rn(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function sn(a,b){a.g?a.g.add(b):a.h=b}function on(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function an(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const e of a.g.values())b=b.concat(e.D);return b}return S(a.i)}function cn(){}function un(){this.g=new cn}function ln(a,b,e){const t=e||"";try{Nt(a,(function(e,n){let r=e;p(e)&&(r=xe(e)),b.push(t+n+"="+encodeURIComponent(r))}))}catch(e){throw b.push(t+"type="+encodeURIComponent("_badmap")),e}}function dd(a,b,e,t,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(t)}catch(e){}}function hn(a){this.l=a.ac||null,this.j=a.jb||!1}function dn(a,b){Ee.call(this),this.D=a,this.u=b,this.m=void 0,this.readyState=fn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Zt.prototype.cancel=function(){if(this.i=an(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}},cn.prototype.stringify=function(a){return h.JSON.stringify(a,void 0)},cn.prototype.parse=function(a){return h.JSON.parse(a,void 0)},T(hn,it),hn.prototype.g=function(){return new dn(this.l,this.j)},hn.prototype.i=function(a){return function(){return a}}({}),T(dn,Ee);var fn=0;function mn(a){a.j.read().then(a.Ta.bind(a)).catch(a.ga.bind(a))}function gn(a){a.readyState=4,a.l=null,a.j=null,a.A=null,pn(a)}function pn(a){a.onreadystatechange&&a.onreadystatechange.call(a)}(r=dn.prototype).open=function(a,b){if(this.readyState!=fn)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,pn(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.D||h).fetch(new Request(this.B,b)).then(this.Wa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,gn(this)),this.readyState=fn},r.Wa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,pn(this)),this.g&&(this.readyState=3,pn(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==h.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;mn(this)}else a.text().then(this.Va.bind(this),this.ga.bind(this))},r.Ta=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?gn(this):pn(this),3==this.readyState&&mn(this)}},r.Va=function(a){this.g&&(this.response=this.responseText=a,gn(this))},r.Ua=function(a){this.g&&(this.response=a,gn(this))},r.ga=function(){this.g&&gn(this)},r.setRequestHeader=function(a,b){this.v.append(a,b)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var e=b.next();!e.done;)e=e.value,a.push(e[0]+": "+e[1]),e=b.next();return a.join("\r\n")},Object.defineProperty(dn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var yn=h.JSON.parse;function wn(a){Ee.call(this),this.headers=new Map,this.u=a||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=vn,this.K=this.L=!1}T(wn,Ee);var vn="",bn=/^https?$/i,In=["POST","PUT"];function Tn(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,En(a),_n(a)}function En(a){a.D||(a.D=!0,_e(a,"complete"),_e(a,"error"))}function td(a){if(a.h&&void 0!==l&&(!a.C[1]||4!=xn(a)||2!=a.aa()))if(a.v&&4==xn(a))Ve(a.Ha,0,a);else if(_e(a,"readystatechange"),4==xn(a)){a.h=!1;try{const c=a.aa();e:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break e;default:b=!1}var e;if(!(e=b)){var t;if(t=0===c){var n=String(a.H).match(kt)[1]||null;if(!n&&h.self&&h.self.location){var r=h.self.location.protocol;n=r.substr(0,r.length-1)}t=!bn.test(n?n.toLowerCase():"")}e=t}if(e)_e(a,"complete"),_e(a,"success");else{a.m=6;try{var o=2<xn(a)?a.g.statusText:""}catch(e){o=""}a.j=o+" ["+a.aa()+"]",En(a)}}finally{_n(a)}}}function _n(a,b){if(a.g){Sn(a);const e=a.g,t=a.C[0]?d:null;a.g=null,a.C=null,b||_e(a,"ready");try{e.onreadystatechange=t}catch(e){}}}function Sn(a){a.g&&a.K&&(a.g.ontimeout=null),a.A&&(h.clearTimeout(a.A),a.A=null)}function xn(a){return a.g?a.g.readyState:0}function Dn(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.J){case vn:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Cn(a){let b="";return se(a,(function(e,t){b+=t,b+=":",b+=e,b+="\r\n"})),b}function An(a,b,e){e:{for(t in e){var t=!1;break e}t=!0}t||(e=Cn(e),"string"==typeof a?null!=e&&encodeURIComponent(String(e)):Pt(a,b,e))}function Nn(a,b,e){return e&&e.internalChannelParams&&e.internalChannelParams[a]||b}function kn(a){this.Ca=0,this.i=[],this.j=new ze,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Nn("failFast",!1,a),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Nn("baseRetryDelayMs",5e3,a),this.bb=Nn("retryDelaySeedMs",1e4,a),this.$a=Nn("forwardChannelMaxRetries",2,a),this.ta=Nn("forwardChannelRequestTimeoutMs",2e4,a),this.ra=a&&a.xmlHttpFactory||void 0,this.Da=a&&a.Zb||!1,this.J=void 0,this.H=a&&a.supportsCrossDomainXhr||!1,this.I="",this.h=new Zt(a&&a.concurrentRequestLimit),this.Fa=new un,this.O=a&&a.fastHandshake||!1,this.N=a&&a.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=a&&a.Xb||!1,a&&a.Aa&&this.j.Aa(),a&&a.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&a&&a.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function On(a){if(Mn(a),3==a.G){var b=a.U++,e=Rt(a.F);Pt(e,"SID",a.I),Pt(e,"RID",b),Pt(e,"TYPE","terminate"),Pn(a,e),(b=new mt(a,a.j,b,void 0)).K=2,b.v=Vt(Rt(e)),e=!1,h.navigator&&h.navigator.sendBeacon&&(e=h.navigator.sendBeacon(b.v.toString(),"")),!e&&h.Image&&((new Image).src=b.v,e=!0),e||(b.g=Hn(b.l,null),b.g.da(b.v)),b.F=Date.now(),_t(b)}Qn(a)}function Rn(a){a.g&&(jn(a),a.g.cancel(),a.g=null)}function Mn(a){Rn(a),a.u&&(h.clearTimeout(a.u),a.u=null),Kn(a),a.h.cancel(),a.m&&("number"==typeof a.m&&h.clearTimeout(a.m),a.m=null)}function Ln(a){tn(a.h)||a.m||(a.m=!0,Oe(a.Ja,a),a.C=0)}function Fn(a,b){var e;e=b?b.m:a.U++;const t=Rt(a.F);Pt(t,"SID",a.I),Pt(t,"RID",e),Pt(t,"AID",a.T),Pn(a,t),a.o&&a.s&&An(t,a.o,a.s),e=new mt(a,a.j,e,a.C+1),null===a.o&&(e.H=a.s),b&&(a.i=b.D.concat(a.i)),b=Vn(a,e,1e3),e.setTimeout(Math.round(.5*a.ta)+Math.round(.5*a.ta*Math.random())),sn(a.h,e),vt(e,t,b)}function Pn(a,b){a.ia&&se(a.ia,(function(e,t){Pt(b,t,e)})),a.l&&Nt({},(function(e,t){Pt(b,t,e)}))}function Vn(a,b,e){e=Math.min(a.i.length,e);var t=a.l?q(a.l.Ra,a.l,a):null;e:{var n=a.i;let r=-1;for(;;){const o=["count="+e];-1==r?0<e?(r=n[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let c=!0;for(let u=0;u<e;u++){let e=n[u].h;const l=n[u].g;if(e-=r,0>e)r=Math.max(0,n[u].h-100),c=!1;else try{ln(l,o,"req"+e+"_")}catch(e){t&&t(l)}}if(c){t=o.join("&");break e}}}return a=a.i.splice(0,e),b.D=a,t}function qn(a){a.g||a.u||(a.Z=1,Oe(a.Ia,a),a.A=0)}function Un(a){return!(a.g||a.u||3<=a.A)&&(a.Z++,a.u=tt(q(a.Ia,a),zn(a,a.A)),a.A++,!0)}function jn(a){null!=a.B&&(h.clearTimeout(a.B),a.B=null)}function Bn(a){a.g=new mt(a,a.j,"rpc",a.Z),null===a.o&&(a.g.H=a.s),a.g.N=0;var b=Rt(a.sa);Pt(b,"RID","rpc"),Pt(b,"SID",a.I),Pt(b,"CI",a.L?"0":"1"),Pt(b,"AID",a.T),Pt(b,"TYPE","xmlhttp"),Pn(a,b),a.o&&a.s&&An(b,a.o,a.s),a.J&&a.g.setTimeout(a.J);var e=a.g;a=a.ka,e.K=1,e.v=Vt(Rt(b)),e.s=null,e.P=!0,bt(e,a)}function Kn(a){null!=a.v&&(h.clearTimeout(a.v),a.v=null)}function Gn(a,b){var e=null;if(a.g==b){Kn(a),jn(a),a.g=null;var t=2}else{if(!rn(a.h,b))return;e=b.D,on(a.h,b),t=1}if(0!=a.G)if(a.pa=b.Y,b.i)if(1==t){e=b.s?b.s.length:0,b=Date.now()-b.F;var n=a.C;_e(t=He(),new et(t,e)),Ln(a)}else qn(a);else if(3==(n=b.o)||0==n&&0<a.pa||!(1==t&&function(a,b){return!(nn(a.h)>=a.h.j-(a.m?1:0)||(a.m?(a.i=b.D.concat(a.i),0):1==a.G||2==a.G||a.C>=(a.Za?0:a.$a)||(a.m=tt(q(a.Ja,a,b),zn(a,a.C)),a.C++,0)))}(a,b)||2==t&&Un(a)))switch(e&&0<e.length&&(b=a.h,b.i=b.i.concat(e)),n){case 1:$n(a,5);break;case 4:$n(a,10);break;case 3:$n(a,6);break;default:$n(a,2)}}function zn(a,b){let e=a.Xa+Math.floor(Math.random()*a.bb);return a.l||(e*=2),e*b}function $n(a,b){if(a.j.info("Error code "+b),2==b){var e=null;a.l&&(e=null);var t=q(a.kb,a);e||(e=new Ot("//www.google.com/images/cleardot.gif"),h.location&&"http"==h.location.protocol||Mt(e,"https"),Vt(e)),function(a,b){const e=new ze;if(h.Image){const t=new Image;t.onload=I(dd,e,t,"TestLoadImage: loaded",!0,b),t.onerror=I(dd,e,t,"TestLoadImage: error",!1,b),t.onabort=I(dd,e,t,"TestLoadImage: abort",!1,b),t.ontimeout=I(dd,e,t,"TestLoadImage: timeout",!1,b),h.setTimeout((function(){t.ontimeout&&t.ontimeout()}),1e4),t.src=a}else b(!1)}(e.toString(),t)}else Ze(2);a.G=0,a.l&&a.l.va(b),Qn(a),Mn(a)}function Qn(a){if(a.G=0,a.la=[],a.l){const b=an(a.h);0==b.length&&0==a.i.length||(x(a.la,b),x(a.la,a.i),a.h.i.length=0,S(a.i),a.i.length=0),a.l.ua()}}function Wn(a,b,e){var t=e instanceof Ot?Rt(e):new Ot(e,void 0);if(""!=t.g)b&&(t.g=b+"."+t.g),Lt(t,t.m);else{var n=h.location;t=n.protocol,b=b?b+"."+n.hostname:n.hostname,n=+n.port;var r=new Ot(null,void 0);t&&Mt(r,t),b&&(r.g=b),n&&Lt(r,n),e&&(r.l=e),t=r}return e=a.D,b=a.za,e&&b&&Pt(t,e,b),Pt(t,"VER",a.ma),Pn(a,t),t}function Hn(a,b,e){if(b&&!a.H)throw Error("Can't create secondary domain capable XhrIo object.");return(b=e&&a.Da&&!a.ra?new wn(new hn({jb:!0})):new wn(a.ra)).Ka(a.H),b}function Yn(){}function Xn(){if(P&&!(10<=Number(X)))throw Error("Environmental error: no available transport.")}function Jn(a,b){Ee.call(this),this.g=new kn(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.s=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.ya&&(a?a["X-WebChannel-Client-Profile"]=b.ya:a={"X-WebChannel-Client-Profile":b.ya}),this.g.S=a,(a=b&&b.Yb)&&!A(a)&&(this.g.o=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!A(b)&&(this.g.D=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new nr(this)}function Zn(a){lt.call(this);var b=a.__sm__;if(b){e:{for(const e in b){a=e;break e}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function er(){ht.call(this),this.status=1}function nr(a){this.g=a}(r=wn.prototype).Ka=function(a){this.L=a},r.da=function(a,b,e,t){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+a);b=b?b.toUpperCase():"GET",this.H=a,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ct.g(),this.C=this.u?ot(this.u):ot(ct),this.g.onreadystatechange=q(this.Ha,this);try{this.F=!0,this.g.open(b,String(a),!0),this.F=!1}catch(e){return void Tn(this,e)}if(a=e||"",e=new Map(this.headers),t)if(Object.getPrototypeOf(t)===Object.prototype)for(var n in t)e.set(n,t[n]);else{if("function"!=typeof t.keys||"function"!=typeof t.get)throw Error("Unknown input type for opt_headers: "+String(t));for(const n of t.keys())e.set(n,t.get(n))}t=Array.from(e.keys()).find((e=>"content-type"==e.toLowerCase())),n=h.FormData&&a instanceof h.FormData,!(0<=_(In,b))||t||n||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,n]of e)this.g.setRequestHeader(t,n);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Sn(this),0<this.B&&((this.K=function(a){return P&&H()&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.qa,this)):this.A=Ve(this.qa,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(e){Tn(this,e)}},r.qa=function(){void 0!==l&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,_e(this,"timeout"),this.abort(8))},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,_e(this,"complete"),_e(this,"abort"),_n(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),_n(this,!0)),wn.X.M.call(this)},r.Ha=function(){this.s||(this.F||this.v||this.l?td(this):this.fb())},r.fb=function(){td(this)},r.aa=function(){try{return 2<xn(this)?this.g.status:-1}catch(e){return-1}},r.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Sa=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),yn(b)}},r.Ea=function(){return this.m},r.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=kn.prototype).ma=8,r.G=1,r.Ja=function(a){if(this.m)if(this.m=null,1==this.G){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const n=new mt(this,this.j,a,void 0);let r=this.s;if(this.S&&(r?(r=ie(r),ae(r,this.S)):r=this.S),null!==this.o||this.N||(n.H=r,r=null),this.O)e:{for(var b=0,e=0;e<this.i.length;e++){var t=this.i[e];if(void 0===(t="__data__"in t.g&&"string"==typeof(t=t.g.__data__)?t.length:void 0))break;if(4096<(b+=t)){b=e;break e}if(4096===b||e===this.i.length-1){b=e+1;break e}}b=1e3}else b=1e3;b=Vn(this,n,b),Pt(e=Rt(this.F),"RID",a),Pt(e,"CVER",22),this.D&&Pt(e,"X-HTTP-Session-Id",this.D),Pn(this,e),r&&(this.N?b="headers="+encodeURIComponent(String(Cn(r)))+"&"+b:this.o&&An(e,this.o,r)),sn(this.h,n),this.Ya&&Pt(e,"TYPE","init"),this.O?(Pt(e,"$req",b),Pt(e,"SID","null"),n.Z=!0,vt(n,e,null)):vt(n,e,b),this.G=2}}else 3==this.G&&(a?Fn(this,a):0==this.i.length||tn(this.h)||Fn(this))},r.Ia=function(){if(this.u=null,Bn(this),this.$&&!(this.K||null==this.g||0>=this.P)){var a=2*this.P;this.j.info("BP detection timer enabled: "+a),this.B=tt(q(this.eb,this),a)}},r.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Ze(10),Rn(this),Bn(this))},r.cb=function(){null!=this.v&&(this.v=null,Rn(this),Un(this),Ze(19))},r.kb=function(a){a?(this.j.info("Successfully pinged google.com"),Ze(2)):(this.j.info("Failed to ping google.com"),Ze(1))},(r=Yn.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Ra=function(){},Xn.prototype.g=function(a,b){return new Jn(a,b)},T(Jn,Ee),Jn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var a=this.g,b=this.l,e=this.h||void 0;Ze(0),a.V=b,a.ia=e||{},a.L=a.Y,a.F=Wn(a,null,a.V),Ln(a)},Jn.prototype.close=function(){On(this.g)},Jn.prototype.u=function(a){var b=this.g;if("string"==typeof a){var e={};e.__data__=a,a=e}else this.v&&((e={}).__data__=xe(a),a=e);b.i.push(new class{constructor(a,b){this.h=a,this.g=b}}(b.ab++,a)),3==b.G&&Ln(b)},Jn.prototype.M=function(){this.g.l=null,delete this.j,On(this.g),delete this.g,Jn.X.M.call(this)},T(Zn,lt),T(er,ht),T(nr,Yn),nr.prototype.xa=function(){_e(this.g,"a")},nr.prototype.wa=function(a){_e(this.g,new Zn(a))},nr.prototype.va=function(a){_e(this.g,new er)},nr.prototype.ua=function(){_e(this.g,"b")},Xn.prototype.createWebChannel=Xn.prototype.g,Jn.prototype.send=Jn.prototype.u,Jn.prototype.open=Jn.prototype.m,Jn.prototype.close=Jn.prototype.close,nt.NO_ERROR=0,nt.TIMEOUT=8,nt.HTTP_ERROR=6,st.COMPLETE="complete",at.EventType=ut,ut.OPEN="a",ut.CLOSE="b",ut.ERROR="c",ut.MESSAGE="d",Ee.prototype.listen=Ee.prototype.N,wn.prototype.listenOnce=wn.prototype.O,wn.prototype.getLastError=wn.prototype.Oa,wn.prototype.getLastErrorCode=wn.prototype.Ea,wn.prototype.getStatus=wn.prototype.aa,wn.prototype.getResponseJson=wn.prototype.Sa,wn.prototype.getResponseText=wn.prototype.fa,wn.prototype.send=wn.prototype.da,wn.prototype.setWithCredentials=wn.prototype.Ka;var rr=c.createWebChannelTransport=function(){return new Xn},sr=c.getStatEventTarget=function(){return He()},ir=c.ErrorCode=nt,or=c.EventType=st,ar=c.Event=Qe,cr=c.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},ur=c.FetchXmlHttpFactory=hn,lr=c.WebChannel=at,dr=c.XhrIo=wn}).call(this,n(73))},514:function(e,t,n){"use strict";n.r(t);var r=n(448),o=n(506),c=n(444),l=n(446);function h(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new o.g("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function d(){if("undefined"==typeof Uint8Array)throw new o.g("unimplemented","Uint8Arrays are not available in this environment.")}function f(){if(!Object(o.r)())throw new o.g("unimplemented","Blobs are unavailable in Firestore in this environment.")}class m{constructor(e){this._delegate=e}static fromBase64String(e){return f(),new m(o.b.fromBase64String(e))}static fromUint8Array(e){return d(),new m(o.b.fromUint8Array(e))}toBase64(){return f(),this._delegate.toBase64()}toUint8Array(){return d(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function y(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const object=e;for(const e of t)if(e in object&&"function"==typeof object[e])return!0;return!1}(e,["next","error","complete"])}class w{enableIndexedDbPersistence(e,t){return Object(o.F)(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Object(o.G)(e._delegate)}clearIndexedDbPersistence(e){return Object(o.x)(e._delegate)}}class v{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof o.m||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Object(o.s)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){Object(o.A)(this._delegate,e,t,n)}enableNetwork(){return Object(o.H)(this._delegate)}disableNetwork(){return Object(o.D)(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Object(o.t)("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Object(o.lb)(this._delegate)}onSnapshotsInSync(e){return Object(o.Y)(this._delegate,e)}get app(){if(!this._appCompat)throw new o.g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new M(this,Object(o.y)(this._delegate,e))}catch(e){throw x(e,"collection()","Firestore.collection()")}}doc(e){try{return new S(this,Object(o.E)(this._delegate,e))}catch(e){throw x(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new k(this,Object(o.z)(this._delegate,e))}catch(e){throw x(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Object(o.db)(this._delegate,(t=>e(new T(this,t))))}batch(){return Object(o.K)(this._delegate),new E(new o.l(this._delegate,(e=>Object(o.L)(this._delegate,e))))}loadBundle(e){return Object(o.V)(this._delegate,e)}namedQuery(e){return Object(o.W)(this._delegate,e).then((e=>e?new k(this,e):null))}}class I extends o.a{constructor(e){super(),this.firestore=e}convertBytes(e){return new m(new o.b(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return S.forKey(t,this.firestore,null)}}class T{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new I(e)}get(e){const t=L(e);return this._delegate.get(t).then((e=>new A(this._firestore,new o.e(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,data,t){const n=L(e);return t?(h("Transaction.set",t),this._delegate.set(n,data,t)):this._delegate.set(n,data),this}update(e,t,n,...r){const o=L(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...r),this}delete(e){const t=L(e);return this._delegate.delete(t),this}}class E{constructor(e){this._delegate=e}set(e,data,t){const n=L(e);return t?(h("WriteBatch.set",t),this._delegate.set(n,data,t)):this._delegate.set(n,data),this}update(e,t,n,...r){const o=L(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...r),this}delete(e){const t=L(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class _{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new o.i(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new N(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=_.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let o=r.get(t);return o||(o=new _(e,new I(e),t),r.set(t,o)),o}}_.INSTANCES=new WeakMap;class S{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new I(e)}static forPath(path,e,t){if(path.length%2!=0)throw new o.g("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${path.canonicalString()} has ${path.length}`);return new S(e,new o.d(e._delegate,t,new o.n(path)))}static forKey(e,t,n){return new S(t,new o.d(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new M(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new M(this.firestore,Object(o.y)(this._delegate,e))}catch(e){throw x(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=Object(c.p)(e))instanceof o.d&&Object(o.cb)(this._delegate,e)}set(e,t){t=h("DocumentReference.set",t);try{return t?Object(o.fb)(this._delegate,e,t):Object(o.fb)(this._delegate,e)}catch(e){throw x(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Object(o.kb)(this._delegate,e):Object(o.kb)(this._delegate,e,t,...n)}catch(e){throw x(e,"updateDoc()","DocumentReference.update()")}}delete(){return Object(o.B)(this._delegate)}onSnapshot(...e){const t=D(e),n=C(e,(e=>new A(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return Object(o.X)(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?Object(o.N)(this._delegate):"server"===(null==e?void 0:e.source)?Object(o.O)(this._delegate):Object(o.M)(this._delegate),t.then((e=>new A(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new S(this.firestore,e?this._delegate.withConverter(_.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function x(e,t,n){return e.message=e.message.replace(t,n),e}function D(e){for(const t of e)if("object"==typeof t&&!y(t))return t;return{}}function C(e,t){var n,r;let o;return o=y(e[0])?e[0]:y(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{o.next&&o.next(t(e))},error:null===(n=o.error)||void 0===n?void 0:n.bind(o),complete:null===(r=o.complete)||void 0===r?void 0:r.bind(o)}}class A{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new S(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Object(o.hb)(this._delegate,e._delegate)}}class N extends A{data(e){const data=this._delegate.data(e);return Object(o.q)(void 0!==data,"Document in a QueryDocumentSnapshot should exist"),data}}class k{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new I(e)}where(e,t,n){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.mb)(e,t,n)))}catch(e){throw x(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.Z)(e,t)))}catch(e){throw x(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.T)(e)))}catch(e){throw x(e,"limit()","Query.limit()")}}limitToLast(e){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.U)(e)))}catch(e){throw x(e,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.jb)(...e)))}catch(e){throw x(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.ib)(...e)))}catch(e){throw x(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.J)(...e)))}catch(e){throw x(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.I)(...e)))}catch(e){throw x(e,"endAt()","Query.endAt()")}}isEqual(e){return Object(o.bb)(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?Object(o.Q)(this._delegate):"server"===(null==e?void 0:e.source)?Object(o.R)(this._delegate):Object(o.P)(this._delegate),t.then((e=>new R(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=D(e),n=C(e,(e=>new R(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return Object(o.X)(this._delegate,t,n)}withConverter(e){return new k(this.firestore,e?this._delegate.withConverter(_.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class O{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new N(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class R{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new k(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new N(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new O(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new N(this._firestore,n))}))}isEqual(e){return Object(o.hb)(this._delegate,e._delegate)}}class M extends k{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new S(this.firestore,e):null}doc(e){try{return new S(this.firestore,void 0===e?Object(o.E)(this._delegate):Object(o.E)(this._delegate,e))}catch(e){throw x(e,"doc()","CollectionReference.doc()")}}add(data){return Object(o.u)(this._delegate,data).then((e=>new S(this.firestore,e)))}isEqual(e){return Object(o.cb)(this._delegate,e._delegate)}withConverter(e){return new M(this.firestore,e?this._delegate.withConverter(_.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function L(e){return Object(o.p)(e,o.d)}class F{constructor(...e){this._delegate=new o.f(...e)}static documentId(){return new F(o.o.keyField().canonicalString())}isEqual(e){return(e=Object(c.p)(e))instanceof o.f&&this._delegate._internalPath.isEqual(e._internalPath)}}class P{constructor(e){this._delegate=e}static serverTimestamp(){const e=Object(o.eb)();return e._methodName="FieldValue.serverTimestamp",new P(e)}static delete(){const e=Object(o.C)();return e._methodName="FieldValue.delete",new P(e)}static arrayUnion(...e){const t=Object(o.w)(...e);return t._methodName="FieldValue.arrayUnion",new P(t)}static arrayRemove(...e){const t=Object(o.v)(...e);return t._methodName="FieldValue.arrayRemove",new P(t)}static increment(e){const t=Object(o.S)(e);return t._methodName="FieldValue.increment",new P(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const V={Firestore:v,GeoPoint:o.h,Timestamp:o.k,Blob:m,Transaction:T,WriteBatch:E,DocumentReference:S,DocumentSnapshot:A,Query:k,QueryDocumentSnapshot:N,QuerySnapshot:R,CollectionReference:M,FieldPath:F,FieldValue:P,setLogLevel:function(e){Object(o.gb)(e)},CACHE_SIZE_UNLIMITED:o.c};var U,j;U=r.a,j=(e,t)=>new v(e,t,new w),U.INTERNAL.registerComponent(new l.a("firestore-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return j(t,n)}),"PUBLIC").setServiceProps(Object.assign({},V))),U.registerVersion("@firebase/firestore-compat","0.3.6")}}]);