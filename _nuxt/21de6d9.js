/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{435:function(t,e,n){"use strict";n.d(e,"a",(function(){return w}));var r=n(432),o=n(433),c=n(436),h=n(437);class l{constructor(t,e){this._delegate=t,this.firebase=e,Object(c._addComponent)(t,new o.a("app-compat",(()=>this),"PUBLIC")),this.container=t.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this._delegate.automaticDataCollectionEnabled=t}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((t=>{this._delegate.checkDestroyed(),t()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),Object(c.deleteApp)(this._delegate))))}_getService(t,e=c._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(t);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:e})}_removeServiceInstance(t,e=c._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(t).clearInstance(e)}_addComponent(component){Object(c._addComponent)(this._delegate,component)}_addOrOverwriteComponent(component){Object(c._addOrOverwriteComponent)(this._delegate,component)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const d={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},f=new r.b("app-compat","Firebase",d);const m=function t(){const e=function(t){const e={},n={__esModule:!0,initializeApp:function(o,h={}){const l=c.initializeApp(o,h);if(Object(r.f)(e,l.name))return e[l.name];const d=new t(l,n);return e[l.name]=d,d},app:o,registerVersion:c.registerVersion,setLogLevel:c.setLogLevel,onLog:c.onLog,apps:null,SDK_VERSION:c.SDK_VERSION,INTERNAL:{registerComponent:function(component){const e=component.name,h=e.replace("-compat","");if(c._registerComponent(component)&&"PUBLIC"===component.type){const c=(t=o())=>{if("function"!=typeof t[h])throw f.create("invalid-app-argument",{appName:e});return t[h]()};void 0!==component.serviceProps&&Object(r.j)(c,component.serviceProps),n[h]=c,t.prototype[h]=function(...t){return this._getService.bind(this,e).apply(this,component.multipleInstances?t:[])}}return"PUBLIC"===component.type?n[h]:null},removeApp:function(t){delete e[t]},useAsService:function(t,e){return"serverAuth"===e?null:e},modularAPIs:c}};function o(t){if(t=t||c._DEFAULT_ENTRY_NAME,!Object(r.f)(e,t))throw f.create("no-app",{appName:t});return e[t]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(e).map((t=>e[t]))}}),o.App=t,n}(l);return e.INTERNAL=Object.assign(Object.assign({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){Object(r.j)(e,t)},createSubscribe:r.h,ErrorFactory:r.b,deepExtend:r.j}),e}(),y=new h.b("@firebase/app-compat");if(Object(r.n)()&&void 0!==self.firebase){y.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const t=self.firebase.SDK_VERSION;t&&t.indexOf("LITE")>=0&&y.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const w=m;var v;Object(c.registerVersion)("@firebase/app-compat","0.1.25",v)},492:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return uh})),n.d(e,"b",(function(){return rc})),n.d(e,"c",(function(){return Bu})),n.d(e,"d",(function(){return ku})),n.d(e,"e",(function(){return Lc})),n.d(e,"f",(function(){return nc})),n.d(e,"g",(function(){return N})),n.d(e,"h",(function(){return ic})),n.d(e,"i",(function(){return Vc})),n.d(e,"j",(function(){return Pc})),n.d(e,"k",(function(){return $})),n.d(e,"l",(function(){return lh})),n.d(e,"m",(function(){return lt})),n.d(e,"n",(function(){return pt})),n.d(e,"o",(function(){return J})),n.d(e,"p",(function(){return Au})),n.d(e,"q",(function(){return q})),n.d(e,"r",(function(){return tt})),n.d(e,"s",(function(){return E})),n.d(e,"t",(function(){return Tu})),n.d(e,"u",(function(){return Ih})),n.d(e,"v",(function(){return Ch})),n.d(e,"w",(function(){return Nh})),n.d(e,"x",(function(){return Hu})),n.d(e,"y",(function(){return Ru})),n.d(e,"z",(function(){return Lu})),n.d(e,"A",(function(){return Cu})),n.d(e,"B",(function(){return bh})),n.d(e,"C",(function(){return xh})),n.d(e,"D",(function(){return Ju})),n.d(e,"E",(function(){return Vu})),n.d(e,"F",(function(){return zu})),n.d(e,"G",(function(){return Qu})),n.d(e,"H",(function(){return Xu})),n.d(e,"I",(function(){return nh})),n.d(e,"J",(function(){return eh})),n.d(e,"K",(function(){return Gu})),n.d(e,"L",(function(){return Eh})),n.d(e,"M",(function(){return fh})),n.d(e,"N",(function(){return mh})),n.d(e,"O",(function(){return ph})),n.d(e,"P",(function(){return yh})),n.d(e,"Q",(function(){return ol})),n.d(e,"R",(function(){return ul})),n.d(e,"S",(function(){return kh})),n.d(e,"T",(function(){return Wc})),n.d(e,"U",(function(){return Hc})),n.d(e,"V",(function(){return Zu})),n.d(e,"W",(function(){return tc})),n.d(e,"X",(function(){return Th})),n.d(e,"Y",(function(){return dl})),n.d(e,"Z",(function(){return zc})),n.d(e,"ab",(function(){return Bc})),n.d(e,"bb",(function(){return Fu})),n.d(e,"cb",(function(){return Pu})),n.d(e,"db",(function(){return Ah})),n.d(e,"eb",(function(){return Dh})),n.d(e,"fb",(function(){return wh})),n.d(e,"gb",(function(){return v})),n.d(e,"hb",(function(){return qc})),n.d(e,"ib",(function(){return Jc})),n.d(e,"jb",(function(){return Xc})),n.d(e,"kb",(function(){return vh})),n.d(e,"lb",(function(){return Yu})),n.d(e,"mb",(function(){return Gc}));var r=n(436),o=n(433),c=n(437),h=n(432),l=n(493);const d="@firebase/firestore";class f{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}f.UNAUTHENTICATED=new f(null),f.GOOGLE_CREDENTIALS=new f("google-credentials-uid"),f.FIRST_PARTY=new f("first-party-uid"),f.MOCK_USER=new f("mock-user");let m="9.8.0";const y=new c.b("@firebase/firestore");function w(){return y.logLevel}function v(t){y.setLogLevel(t)}function I(t,...e){if(y.logLevel<=c.a.DEBUG){const n=e.map(_);y.debug(`Firestore (${m}): ${t}`,...n)}}function T(t,...e){if(y.logLevel<=c.a.ERROR){const n=e.map(_);y.error(`Firestore (${m}): ${t}`,...n)}}function E(t,...e){if(y.logLevel<=c.a.WARN){const n=e.map(_);y.warn(`Firestore (${m}): ${t}`,...n)}}function _(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function S(t="Unexpected state"){const e=`FIRESTORE (${m}) INTERNAL ASSERTION FAILED: `+t;throw T(e),new Error(e)}function A(t,e){t||S()}function q(t,e){t||S()}function x(t,e){return t}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class N extends h.c{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class C{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class k{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class O{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(f.UNAUTHENTICATED)))}shutdown(){}}class M{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class R{constructor(t){this.t=t,this.currentUser=f.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new C;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new C,t.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{I("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(I("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new C)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(I("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(A("string"==typeof e.accessToken),new k(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return A(null===t||"string"==typeof t),new f(t)}}class L{constructor(t,e,n){this.type="FirstParty",this.user=f.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const s=t.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class V{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new L(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(f.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class P{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class F{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,e){const n=t=>{null!=t.error&&I("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.p;return this.p=t.token,I("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const s=t=>{I("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit((t=>s(t))),setTimeout((()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?s(t):I("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(A("string"==typeof t.token),this.p=t.token,new P(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class U{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.I(t),this.T=t=>e.writeSequenceNumber(t))}I(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.T&&this.T(t),t}}function j(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}U.A=-1;class B{static R(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=j(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function rt(t,e){return t<e?-1:t>e?1:0}function K(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}function G(t){return t+"\0"}class ${constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new N(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new N(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new N(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new N(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return $.fromMillis(Date.now())}static fromDate(t){return $.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new $(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?rt(this.nanoseconds,t.nanoseconds):rt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class z{constructor(t){this.timestamp=t}static fromTimestamp(t){return new z(t)}static min(){return new z(new $(0,0))}static max(){return new z(new $(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Q(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function W(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function H(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class dt{constructor(t,e,n){void 0===e?e=0:e>t.length&&S(),void 0===n?n=t.length-e:n>t.length-e&&S(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===dt.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof dt?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Y extends dt{construct(t,e,n){return new Y(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new N(D.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Y(e)}static emptyPath(){return new Y([])}}const X=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class J extends dt{construct(t,e,n){return new J(t,e,n)}static isValidIdentifier(t){return X.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),J.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new J(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new N(D.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new N(D.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new N(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new N(D.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new J(e)}static emptyPath(){return new J([])}}class Z{constructor(t){this.fields=t,t.sort(J.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return K(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}function tt(){return"undefined"!=typeof atob}class et{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new et(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new et(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return rt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}et.EMPTY_BYTE_STRING=new et("");const nt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function st(t){if(A(!!t),"string"==typeof t){let e=0;const n=nt.exec(t);if(A(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:it(t.seconds),nanos:it(t.nanos)}}function it(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ot(t){return"string"==typeof t?et.fromBase64String(t):et.fromUint8Array(t)}function at(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ut(t){const e=t.mapValue.fields.__previous_value__;return at(e)?ut(e):e}function ct(t){const e=st(t.mapValue.fields.__local_write_time__.timestampValue);return new $(e.seconds,e.nanos)}class ht{constructor(t,e,n,s,i,r,o,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=u}}class lt{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new lt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof lt&&t.projectId===this.projectId&&t.database===this.database}}function ft(t){return null==t}function gt(t){return 0===t&&1/t==-1/0}function mt(t){return"number"==typeof t&&Number.isInteger(t)&&!gt(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class pt{constructor(t){this.path=t}static fromPath(t){return new pt(Y.fromString(t))}static fromName(t){return new pt(Y.fromString(t).popFirst(5))}static empty(){return new pt(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Y.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new pt(new Y(t.slice()))}}const yt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},wt={nullValue:"NULL_VALUE"};function vt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?at(t)?4:Mt(t)?9007199254740991:10:S()}function bt(t,e){if(t===e)return!0;const n=vt(t);if(n!==vt(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ct(t).isEqual(ct(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=st(t.timestampValue),s=st(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ot(t.bytesValue).isEqual(ot(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return it(t.geoPointValue.latitude)===it(e.geoPointValue.latitude)&&it(t.geoPointValue.longitude)===it(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return it(t.integerValue)===it(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=it(t.doubleValue),s=it(e.doubleValue);return n===s?gt(n)===gt(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return K(t.arrayValue.values||[],e.arrayValue.values||[],bt);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Q(n)!==Q(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!bt(n[t],s[t])))return!1;return!0}(t,e);default:return S()}}function It(t,e){return void 0!==(t.values||[]).find((t=>bt(t,e)))}function Tt(t,e){if(t===e)return 0;const n=vt(t),s=vt(e);if(n!==s)return rt(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return rt(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=it(t.integerValue||t.doubleValue),s=it(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return Et(t.timestampValue,e.timestampValue);case 4:return Et(ct(t),ct(e));case 5:return rt(t.stringValue,e.stringValue);case 6:return function(t,e){const n=ot(t),s=ot(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=rt(n[t],s[t]);if(0!==e)return e}return rt(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=rt(it(t.latitude),it(e.latitude));return 0!==n?n:rt(it(t.longitude),it(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=Tt(n[t],s[t]);if(e)return e}return rt(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===yt.mapValue&&e===yt.mapValue)return 0;if(t===yt.mapValue)return 1;if(e===yt.mapValue)return-1;const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=rt(s[t],r[t]);if(0!==e)return e;const o=Tt(n[s[t]],i[r[t]]);if(0!==o)return o}return rt(s.length,r.length)}(t.mapValue,e.mapValue);default:throw S()}}function Et(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return rt(t,e);const n=st(t),s=st(e),i=rt(n.seconds,s.seconds);return 0!==i?i:rt(n.nanos,s.nanos)}function _t(t){return St(t)}function St(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=st(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ot(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,pt.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=St(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${St(t.fields[i])}`;return n+"}"}(t.mapValue):S();var e,n}function At(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function xt(t){return!!t&&"integerValue"in t}function Dt(t){return!!t&&"arrayValue"in t}function Nt(t){return!!t&&"nullValue"in t}function Ct(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function kt(t){return!!t&&"mapValue"in t}function Ot(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return W(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Ot(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ot(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Mt(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}function Rt(t){return"nullValue"in t?wt:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?At(lt.empty(),pt.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:S()}function Lt(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?At(lt.empty(),pt.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?yt:S()}function Vt(t,e){const n=Tt(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function Pt(t,e){const n=Tt(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}class Ft{constructor(t){this.value=t}static empty(){return new Ft({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!kt(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ot(e)}setAll(t){let e=J.emptyPath(),n={},s=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=i.popLast()}t?n[i.lastSegment()]=Ot(t):s.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());kt(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return bt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];kt(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){W(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Ft(Ot(this.value))}}function qt(t){const e=[];return W(t.fields,((t,n)=>{const s=new J([t]);if(kt(n)){const t=qt(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new Z(e)}class Ut{constructor(t,e,n,s,i,r){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.data=i,this.documentState=r}static newInvalidDocument(t){return new Ut(t,0,z.min(),z.min(),Ft.empty(),0)}static newFoundDocument(t,e,n){return new Ut(t,1,e,z.min(),n,0)}static newNoDocument(t,e){return new Ut(t,2,e,z.min(),Ft.empty(),0)}static newUnknownDocument(t,e){return new Ut(t,3,e,z.min(),Ft.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ft.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ft.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ut&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ut(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class jt{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}function Bt(t){return t.fields.find((t=>2===t.kind))}function Kt(t){return t.fields.filter((t=>2!==t.kind))}jt.UNKNOWN_ID=-1;class Gt{constructor(t,e){this.fieldPath=t,this.kind=e}}class $t{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new $t(0,Wt.min())}}function zt(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,i=z.fromTimestamp(1e9===s?new $(n+1,0):new $(n,s));return new Wt(i,pt.empty(),e)}function Qt(t){return new Wt(t.readTime,t.key,-1)}class Wt{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Wt(z.min(),pt.empty(),-1)}static max(){return new Wt(z.max(),pt.empty(),-1)}}function Ht(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=pt.comparator(t.documentKey,e.documentKey),0!==n?n:rt(t.largestBatchId,e.largestBatchId))}class Yt{constructor(t,e){this.comparator=t,this.root=e||Jt.EMPTY}insert(t,e){return new Yt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Jt.BLACK,null,null))}remove(t){return new Yt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Jt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Xt(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Xt(this.root,t,this.comparator,!1)}getReverseIterator(){return new Xt(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Xt(this.root,t,this.comparator,!0)}}class Xt{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Jt{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:Jt.RED,this.left=null!=s?s:Jt.EMPTY,this.right=null!=i?i:Jt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new Jt(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Jt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return Jt.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Jt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Jt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw S();if(this.right.isRed())throw S();const t=this.left.check();if(t!==this.right.check())throw S();return t+(this.isRed()?0:1)}}Jt.EMPTY=null,Jt.RED=!0,Jt.BLACK=!1,Jt.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(t,e,n,s,i){return this}insert(t,e,n){return new Jt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Zt{constructor(t){this.comparator=t,this.data=new Yt(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new te(this.data.getIterator())}getIteratorFrom(t){return new te(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Zt))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Zt(this.comparator);return e.data=t,e}}class te{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ee(t){return t.hasNext()?t.getNext():void 0}class ne{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.P=null}}function re(t,e=null,n=[],s=[],i=null,r=null,o=null){return new ne(t,e,n,s,i,r,o)}function se(t){const e=x(t);if(null===e.P){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>{return(e=t).field.canonicalString()+e.op.toString()+_t(e.value);var e})).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),ft(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>_t(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>_t(t))).join(",")),e.P=t}return e.P}function ie(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Ie(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!bt(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ee(t.startAt,e.startAt)&&Ee(t.endAt,e.endAt)}function oe(t){return pt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}function ae(t,e){return t.filters.filter((t=>t instanceof he&&t.field.isEqual(e)))}function ue(t,e,n){let s=wt,i=!0;for(const n of ae(t,e)){let t=wt,e=!0;switch(n.op){case"<":case"<=":t=Rt(n.value);break;case"==":case"in":case">=":t=n.value;break;case">":t=n.value,e=!1;break;case"!=":case"not-in":t=wt}Vt({value:s,inclusive:i},{value:t,inclusive:e})<0&&(s=t,i=e)}if(null!==n)for(let r=0;r<t.orderBy.length;++r)if(t.orderBy[r].field.isEqual(e)){const t=n.position[r];Vt({value:s,inclusive:i},{value:t,inclusive:n.inclusive})<0&&(s=t,i=n.inclusive);break}return{value:s,inclusive:i}}function ce(t,e,n){let s=yt,i=!0;for(const n of ae(t,e)){let t=yt,e=!0;switch(n.op){case">=":case">":t=Lt(n.value),e=!1;break;case"==":case"in":case"<=":t=n.value;break;case"<":t=n.value,e=!1;break;case"!=":case"not-in":t=yt}Pt({value:s,inclusive:i},{value:t,inclusive:e})>0&&(s=t,i=e)}if(null!==n)for(let r=0;r<t.orderBy.length;++r)if(t.orderBy[r].field.isEqual(e)){const t=n.position[r];Pt({value:s,inclusive:i},{value:t,inclusive:n.inclusive})>0&&(s=t,i=n.inclusive);break}return{value:s,inclusive:i}}class he extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.V(t,e,n):new le(t,e,n):"array-contains"===e?new me(t,n):"in"===e?new pe(t,n):"not-in"===e?new ye(t,n):"array-contains-any"===e?new we(t,n):new he(t,e,n)}static V(t,e,n){return"in"===e?new de(t,n):new fe(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.v(Tt(e,this.value)):null!==e&&vt(this.value)===vt(e)&&this.v(Tt(e,this.value))}v(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return S()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class le extends he{constructor(t,e,n){super(t,e,n),this.key=pt.fromName(n.referenceValue)}matches(t){const e=pt.comparator(t.key,this.key);return this.v(e)}}class de extends he{constructor(t,e){super(t,"in",e),this.keys=ge("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class fe extends he{constructor(t,e){super(t,"not-in",e),this.keys=ge("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function ge(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>pt.fromName(t.referenceValue)))}class me extends he{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Dt(e)&&It(e.arrayValue,this.value)}}class pe extends he{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&It(this.value.arrayValue,e)}}class ye extends he{constructor(t,e){super(t,"not-in",e)}matches(t){if(It(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!It(this.value.arrayValue,e)}}class we extends he{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Dt(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>It(this.value.arrayValue,t)))}}class ve{constructor(t,e){this.position=t,this.inclusive=e}}class be{constructor(t,e="asc"){this.field=t,this.dir=e}}function Ie(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Te(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.isKeyField()?pt.comparator(pt.fromName(o.referenceValue),n.key):Tt(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return s}function Ee(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!bt(t.position[n],e.position[n]))return!1;return!0}class _e{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=u,this.D=null,this.C=null,this.startAt,this.endAt}}function Se(t,e,n,s,i,r,o,u){return new _e(t,e,n,s,i,r,o,u)}function Ae(t){return new _e(t)}function xe(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function De(t){for(const e of t.filters)if(e.S())return e.field;return null}function Ne(t){return null!==t.collectionGroup}function Ce(t){const e=x(t);if(null===e.D){e.D=[];const t=De(e),n=xe(e);if(null!==t&&null===n)t.isKeyField()||e.D.push(new be(t)),e.D.push(new be(J.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.D.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.D.push(new be(J.keyField(),t))}}}return e.D}function ke(t){const e=x(t);if(!e.C)if("F"===e.limitType)e.C=re(e.path,e.collectionGroup,Ce(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Ce(e)){const e="desc"===n.dir?"asc":"desc";t.push(new be(n.field,e))}const n=e.endAt?new ve(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new ve(e.startAt.position,e.startAt.inclusive):null;e.C=re(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.C}function Oe(t,e,n){return new _e(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Me(t,e){return ie(ke(t),ke(e))&&t.limitType===e.limitType}function Re(t){return`${se(ke(t))}|lt:${t.limitType}`}function Le(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${_t(e.value)}`;var e})).join(", ")}]`),ft(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>_t(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>_t(t))).join(",")),`Target(${e})`}(ke(t))}; limitType=${t.limitType})`}function Ve(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):pt.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const s=Te(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,Ce(t),e))&&!(t.endAt&&!function(t,e,n){const s=Te(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,Ce(t),e))}(t,e)}function Pe(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Fe(t){return(e,n)=>{let s=!1;for(const i of Ce(t)){const t=qe(i,e,n);if(0!==t)return t;s=s||i.field.isKeyField()}return 0}}function qe(t,e,n){const s=t.field.isKeyField()?pt.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),i=n.data.field(t);return null!==s&&null!==i?Tt(s,i):S()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return S()}}function Ue(t,e){if(t.N){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:gt(e)?"-0":e}}function je(t){return{integerValue:""+t}}function Be(t,e){return mt(e)?je(e):Ue(t,e)}class Ke{constructor(){this._=void 0}}function Ge(t,e,n){return t instanceof Qe?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof We?He(t,e):t instanceof Ye?Xe(t,e):function(t,e){const n=ze(t,e),s=Ze(n)+Ze(t.k);return xt(n)&&xt(t.k)?je(s):Ue(t.M,s)}(t,e)}function $e(t,e,n){return t instanceof We?He(t,e):t instanceof Ye?Xe(t,e):n}function ze(t,e){return t instanceof Je?xt(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Qe extends Ke{}class We extends Ke{constructor(t){super(),this.elements=t}}function He(t,e){const n=tn(e);for(const e of t.elements)n.some((t=>bt(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Ye extends Ke{constructor(t){super(),this.elements=t}}function Xe(t,e){let n=tn(e);for(const e of t.elements)n=n.filter((t=>!bt(t,e)));return{arrayValue:{values:n}}}class Je extends Ke{constructor(t,e){super(),this.M=t,this.k=e}}function Ze(t){return it(t.integerValue||t.doubleValue)}function tn(t){return Dt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class en{constructor(t,e){this.field=t,this.transform=e}}class nn{constructor(t,e){this.version=t,this.transformResults=e}}class rn{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new rn}static exists(t){return new rn(void 0,t)}static updateTime(t){return new rn(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function sn(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class on{}function an(t,e,n){t instanceof dn?function(t,e,n){const s=t.value.clone(),i=mn(t.fieldTransforms,e,n.transformResults);s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof fn?function(t,e,n){if(!sn(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=mn(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(gn(t)),i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function un(t,e,n){t instanceof dn?function(t,e,n){if(!sn(t.precondition,e))return;const s=t.value.clone(),i=pn(t.fieldTransforms,n,e);s.setAll(i),e.convertToFoundDocument(ln(e),s).setHasLocalMutations()}(t,e,n):t instanceof fn?function(t,e,n){if(!sn(t.precondition,e))return;const s=pn(t.fieldTransforms,n,e),i=e.data;i.setAll(gn(t)),i.setAll(s),e.convertToFoundDocument(ln(e),i).setHasLocalMutations()}(t,e,n):function(t,e){sn(t.precondition,e)&&e.convertToNoDocument(z.min())}(t,e)}function cn(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),i=ze(s.transform,t||null);null!=i&&(null==n&&(n=Ft.empty()),n.set(s.field,i))}return n||null}function hn(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&K(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof We&&e instanceof We||t instanceof Ye&&e instanceof Ye?K(t.elements,e.elements,bt):t instanceof Je&&e instanceof Je?bt(t.k,e.k):t instanceof Qe&&e instanceof Qe}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ln(t){return t.isFoundDocument()?t.version:z.min()}class dn extends on{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}}class fn extends on{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}}function gn(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function mn(t,e,n){const s=new Map;A(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,u=e.data.field(r.field);s.set(r.field,$e(o,u,n[i]))}return s}function pn(t,e,n){const s=new Map;for(const i of t){const t=i.transform,r=n.data.field(i.field);s.set(i.field,Ge(t,r,e))}return s}class yn extends on{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class wn extends on{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class vn{constructor(t){this.count=t}}var bn,In;function Tn(t){switch(t){default:return S();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0}}function En(t){if(void 0===t)return T("GRPC error has no .code"),D.UNKNOWN;switch(t){case bn.OK:return D.OK;case bn.CANCELLED:return D.CANCELLED;case bn.UNKNOWN:return D.UNKNOWN;case bn.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case bn.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case bn.INTERNAL:return D.INTERNAL;case bn.UNAVAILABLE:return D.UNAVAILABLE;case bn.UNAUTHENTICATED:return D.UNAUTHENTICATED;case bn.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case bn.NOT_FOUND:return D.NOT_FOUND;case bn.ALREADY_EXISTS:return D.ALREADY_EXISTS;case bn.PERMISSION_DENIED:return D.PERMISSION_DENIED;case bn.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case bn.ABORTED:return D.ABORTED;case bn.OUT_OF_RANGE:return D.OUT_OF_RANGE;case bn.UNIMPLEMENTED:return D.UNIMPLEMENTED;case bn.DATA_LOSS:return D.DATA_LOSS;default:return S()}}(In=bn||(bn={}))[In.OK=0]="OK",In[In.CANCELLED=1]="CANCELLED",In[In.UNKNOWN=2]="UNKNOWN",In[In.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",In[In.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",In[In.NOT_FOUND=5]="NOT_FOUND",In[In.ALREADY_EXISTS=6]="ALREADY_EXISTS",In[In.PERMISSION_DENIED=7]="PERMISSION_DENIED",In[In.UNAUTHENTICATED=16]="UNAUTHENTICATED",In[In.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",In[In.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",In[In.ABORTED=10]="ABORTED",In[In.OUT_OF_RANGE=11]="OUT_OF_RANGE",In[In.UNIMPLEMENTED=12]="UNIMPLEMENTED",In[In.INTERNAL=13]="INTERNAL",In[In.UNAVAILABLE=14]="UNAVAILABLE",In[In.DATA_LOSS=15]="DATA_LOSS";class _n{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0===s)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){W(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return H(this.inner)}size(){return this.innerSize}}const Sn=new Yt(pt.comparator);function An(){return Sn}const xn=new Yt(pt.comparator);function Dn(...t){let e=xn;for(const n of t)e=e.insert(n.key,n);return e}function Nn(){return new _n((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Cn=new Yt(pt.comparator),kn=new Zt(pt.comparator);function On(...t){let e=kn;for(const n of t)e=e.add(n);return e}const Mn=new Zt(rt);function Rn(){return Mn}class Ln{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,Vn.createSynthesizedTargetChangeForCurrentChange(t,e)),new Ln(z.min(),n,Rn(),An(),On())}}class Vn{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e){return new Vn(et.EMPTY_BYTE_STRING,e,On(),On(),On())}}class Pn{constructor(t,e,n,s){this.O=t,this.removedTargetIds=e,this.key=n,this.F=s}}class Fn{constructor(t,e){this.targetId=t,this.$=e}}class qn{constructor(t,e,n=et.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Un{constructor(){this.B=0,this.L=Kn(),this.U=et.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(t){t.approximateByteSize()>0&&(this.K=!0,this.U=t)}H(){let t=On(),e=On(),n=On();return this.L.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:S()}})),new Vn(this.U,this.q,t,e,n)}J(){this.K=!1,this.L=Kn()}Y(t,e){this.K=!0,this.L=this.L.insert(t,e)}X(t){this.K=!0,this.L=this.L.remove(t)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class jn{constructor(t){this.nt=t,this.st=new Map,this.it=An(),this.rt=Bn(),this.ot=new Zt(rt)}ut(t){for(const e of t.O)t.F&&t.F.isFoundDocument()?this.at(e,t.F):this.ct(e,t.key,t.F);for(const e of t.removedTargetIds)this.ct(e,t.key,t.F)}ht(t){this.forEachTarget(t,(e=>{const n=this.lt(e);switch(t.state){case 0:this.ft(e)&&n.W(t.resumeToken);break;case 1:n.tt(),n.G||n.J(),n.W(t.resumeToken);break;case 2:n.tt(),n.G||this.removeTarget(e);break;case 3:this.ft(e)&&(n.et(),n.W(t.resumeToken));break;case 4:this.ft(e)&&(this.dt(e),n.W(t.resumeToken));break;default:S()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.st.forEach(((t,n)=>{this.ft(n)&&e(n)}))}_t(t){const e=t.targetId,n=t.$.count,s=this.wt(e);if(s){const t=s.target;if(oe(t))if(0===n){const n=new pt(t.path);this.ct(e,n,Ut.newNoDocument(n,z.min()))}else A(1===n);else this.gt(e)!==n&&(this.dt(e),this.ot=this.ot.add(e))}}yt(t){const e=new Map;this.st.forEach(((n,s)=>{const i=this.wt(s);if(i){if(n.current&&oe(i.target)){const e=new pt(i.target.path);null!==this.it.get(e)||this.It(s,e)||this.ct(s,e,Ut.newNoDocument(e,t))}n.j&&(e.set(s,n.H()),n.J())}}));let n=On();this.rt.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.wt(t);return!e||2===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))})),this.it.forEach(((e,n)=>n.setReadTime(t)));const s=new Ln(t,e,this.ot,this.it,n);return this.it=An(),this.rt=Bn(),this.ot=new Zt(rt),s}at(t,e){if(!this.ft(t))return;const n=this.It(t,e.key)?2:0;this.lt(t).Y(e.key,n),this.it=this.it.insert(e.key,e),this.rt=this.rt.insert(e.key,this.Tt(e.key).add(t))}ct(t,e,n){if(!this.ft(t))return;const s=this.lt(t);this.It(t,e)?s.Y(e,1):s.X(e),this.rt=this.rt.insert(e,this.Tt(e).delete(t)),n&&(this.it=this.it.insert(e,n))}removeTarget(t){this.st.delete(t)}gt(t){const e=this.lt(t).H();return this.nt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Z(t){this.lt(t).Z()}lt(t){let e=this.st.get(t);return e||(e=new Un,this.st.set(t,e)),e}Tt(t){let e=this.rt.get(t);return e||(e=new Zt(rt),this.rt=this.rt.insert(t,e)),e}ft(t){const e=null!==this.wt(t);return e||I("WatchChangeAggregator","Detected inactive target",t),e}wt(t){const e=this.st.get(t);return e&&e.G?null:this.nt.Et(t)}dt(t){this.st.set(t,new Un),this.nt.getRemoteKeysForTarget(t).forEach((e=>{this.ct(t,e,null)}))}It(t,e){return this.nt.getRemoteKeysForTarget(t).has(e)}}function Bn(){return new Yt(pt.comparator)}function Kn(){return new Yt(pt.comparator)}const Gn={asc:"ASCENDING",desc:"DESCENDING"},$n={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class zn{constructor(t,e){this.databaseId=t,this.N=e}}function Qn(t,e){return t.N?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Wn(t,e){return t.N?e.toBase64():e.toUint8Array()}function Hn(t,e){return Qn(t,e.toTimestamp())}function Yn(t){return A(!!t),z.fromTimestamp(function(t){const e=st(t);return new $(e.seconds,e.nanos)}(t))}function Xn(t,e){return function(t){return new Y(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Jn(t){const e=Y.fromString(t);return A(Er(e)),e}function Zn(t,e){return Xn(t.databaseId,e.path)}function er(t,e){const n=Jn(e);if(n.get(1)!==t.databaseId.projectId)throw new N(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new N(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new pt(ir(n))}function nr(t,e){return Xn(t.databaseId,e)}function rr(t){const e=Jn(t);return 4===e.length?Y.emptyPath():ir(e)}function sr(t){return new Y(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ir(t){return A(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function or(t,e,n){return{name:Zn(t,e),fields:n.value.mapValue.fields}}function ar(t,e,n){const s=er(t,e.name),i=Yn(e.updateTime),r=new Ft({mapValue:{fields:e.fields}}),o=Ut.newFoundDocument(s,i,r);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function ur(t,e){let n;if(e instanceof dn)n={update:or(t,e.key,e.value)};else if(e instanceof yn)n={delete:Zn(t,e.key)};else if(e instanceof fn)n={update:or(t,e.key,e.data),updateMask:Tr(e.fieldMask)};else{if(!(e instanceof wn))return S();n={verify:Zn(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Qe)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof We)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ye)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Je)return{fieldPath:e.field.canonicalString(),increment:n.k};throw S()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Hn(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:S()}(t,e.precondition)),n}function cr(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?rn.updateTime(Yn(t.updateTime)):void 0!==t.exists?rn.exists(t.exists):rn.none()}(e.currentDocument):rn.none(),s=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)A("REQUEST_TIME"===e.setToServerValue),n=new Qe;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new We(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Ye(t)}else"increment"in e?n=new Je(t,e.increment):S();const s=J.fromServerFormat(e.fieldPath);return new en(s,n)}(t,e))):[];if(e.update){e.update.name;const i=er(t,e.update.name),r=new Ft({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new Z(e.map((t=>J.fromServerFormat(t))))}(e.updateMask);return new fn(i,r,t,n,s)}return new dn(i,r,n,s)}if(e.delete){const s=er(t,e.delete);return new yn(s,n)}if(e.verify){const s=er(t,e.verify);return new wn(s,n)}return S()}function lr(t,e){return{documents:[nr(t,e.path)]}}function dr(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=nr(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=nr(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Ct(t.value))return{unaryFilter:{field:yr(t.field),op:"IS_NAN"}};if(Nt(t.value))return{unaryFilter:{field:yr(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ct(t.value))return{unaryFilter:{field:yr(t.field),op:"IS_NOT_NAN"}};if(Nt(t.value))return{unaryFilter:{field:yr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:yr(t.field),op:pr(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:yr(t.field),direction:mr(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.N||ft(e)?e:{value:e}}(t,e.limit);var u;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(u=e.startAt).inclusive,values:u.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function fr(t){let e=rr(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){A(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=gr(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new be(wr(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let u=null;n.limit&&(u=function(t){let e;return e="object"==typeof t?t.value:t,ft(e)?null:e}(n.limit));let a=null;n.startAt&&(a=function(t){const e=!!t.before,n=t.values||[];return new ve(n,e)}(n.startAt));let c=null;return n.endAt&&(c=function(t){const e=!t.before,n=t.values||[];return new ve(n,e)}(n.endAt)),Se(e,i,o,r,u,"F",a,c)}function gr(t){return t?void 0!==t.unaryFilter?[Ir(t)]:void 0!==t.fieldFilter?[vr(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>gr(t))).reduce(((t,e)=>t.concat(e))):S():[]}function mr(t){return Gn[t]}function pr(t){return $n[t]}function yr(t){return{fieldPath:t.canonicalString()}}function wr(t){return J.fromServerFormat(t.fieldPath)}function vr(t){return he.create(wr(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ir(t){switch(t.unaryFilter.op){case"IS_NAN":const e=wr(t.unaryFilter.field);return he.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=wr(t.unaryFilter.field);return he.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=wr(t.unaryFilter.field);return he.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=wr(t.unaryFilter.field);return he.create(i,"!=",{nullValue:"NULL_VALUE"});default:return S()}}function Tr(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Er(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function _r(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Ar(e)),e=Sr(t.get(n),e);return Ar(e)}function Sr(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function Ar(t){return t+""}function xr(t){const e=t.length;if(A(e>=2),2===e)return A(""===t.charAt(0)&&""===t.charAt(1)),Y.emptyPath();const n=e-2,s=[];let i="";for(let r=0;r<e;){const e=t.indexOf("",r);switch((e<0||e>n)&&S(),t.charAt(e+1)){case"":const n=t.substring(r,e);let o;0===i.length?o=n:(i+=n,o=i,i=""),s.push(o);break;case"":i+=t.substring(r,e),i+="\0";break;case"":i+=t.substring(r,e+1);break;default:S()}r=e+2}return new Y(s)}const Dr=["userId","batchId"];function Nr(t,e){return[t,_r(e)]}function Cr(t,e,n){return[t,_r(e),n]}const kr={},Or=["prefixPath","collectionGroup","readTime","documentId"],Mr=["prefixPath","collectionGroup","documentId"],Rr=["collectionGroup","readTime","prefixPath","documentId"],Lr=["canonicalId","targetId"],Vr=["targetId","path"],Pr=["path","targetId"],Fr=["collectionId","parent"],qr=["indexId","uid"],Ur=["uid","sequenceNumber"],jr=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Br=["indexId","uid","orderedDocumentKey"],Kr=["userId","collectionPath","documentId"],Gr=["userId","collectionPath","largestBatchId"],li=["userId","collectionGroup","largestBatchId"],$r=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],zr=[...$r,"documentOverlays"],Qr=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Wr=[...Qr,"indexConfiguration","indexState","indexEntries"],Hr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Yr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}class Xr{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Xr(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Xr?e:Xr.resolve(e)}catch(t){return Xr.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Xr.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Xr.reject(e)}static resolve(t){return new Xr(((e,n)=>{e(t)}))}static reject(t){return new Xr(((e,n)=>{n(t)}))}static waitFor(t){return new Xr(((e,n)=>{let s=0,i=0,r=!1;t.forEach((t=>{++s,t.next((()=>{++i,r&&i===s&&e()}),(t=>n(t)))})),r=!0,i===s&&e()}))}static or(t){let e=Xr.resolve(!1);for(const n of t)e=e.next((t=>t?Xr.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}}class Jr{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.At=new C,this.transaction.oncomplete=()=>{this.At.resolve()},this.transaction.onabort=()=>{e.error?this.At.reject(new es(t,e.error)):this.At.resolve()},this.transaction.onerror=e=>{const n=os(e.target.error);this.At.reject(new es(t,n))}}static open(t,e,n,s){try{return new Jr(e,t.transaction(s,n))}catch(t){throw new es(e,t)}}get Rt(){return this.At.promise}abort(t){t&&this.At.reject(t),this.aborted||(I("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}bt(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new rs(e)}}class Zr{constructor(t,e,n){this.name=t,this.version=e,this.Pt=n,12.2===Zr.Vt(Object(h.m)())&&T("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return I("SimpleDb","Removing database:",t),ss(window.indexedDB.deleteDatabase(t)).toPromise()}static vt(){if(!Object(h.s)())return!1;if(Zr.St())return!0;const t=Object(h.m)(),e=Zr.Vt(t),n=0<e&&e<10,s=Zr.Dt(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static St(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.Ct)}static xt(t,e){return t.store(e)}static Vt(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Dt(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Nt(t){return this.db||(I("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=t=>{const n=t.target.result;e(n)},s.onblocked=()=>{n(new es(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{const s=e.target.error;"VersionError"===s.name?n(new N(D.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===s.name?n(new N(D.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):n(new es(t,s))},s.onupgradeneeded=t=>{I("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.Pt.kt(e,s.transaction,t.oldVersion,this.version).next((()=>{I("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.Mt&&(this.db.onversionchange=t=>this.Mt(t)),this.db}Ot(t){this.Mt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i="readonly"===e;let r=0;for(;;){++r;try{this.db=await this.Nt(t);const e=Jr.open(this.db,t,i?"readonly":"readwrite",n),r=s(e).next((t=>(e.bt(),t))).catch((t=>(e.abort(t),Xr.reject(t)))).toPromise();return r.catch((()=>{})),await e.Rt,r}catch(t){const e="FirebaseError"!==t.name&&r<3;if(I("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ts{constructor(t){this.Ft=t,this.$t=!1,this.Bt=null}get isDone(){return this.$t}get Lt(){return this.Bt}set cursor(t){this.Ft=t}done(){this.$t=!0}Ut(t){this.Bt=t}delete(){return ss(this.Ft.delete())}}class es extends N{constructor(t,e){super(D.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function ns(t){return"IndexedDbTransactionError"===t.name}class rs{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(I("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(I("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ss(n)}add(t){return I("SimpleDb","ADD",this.store.name,t,t),ss(this.store.add(t))}get(t){return ss(this.store.get(t)).next((e=>(void 0===e&&(e=null),I("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return I("SimpleDb","DELETE",this.store.name,t),ss(this.store.delete(t))}count(){return I("SimpleDb","COUNT",this.store.name),ss(this.store.count())}qt(t,e){const n=this.options(t,e);if(n.index||"function"!=typeof this.store.getAll){const t=this.cursor(n),e=[];return this.Kt(t,((t,n)=>{e.push(n)})).next((()=>e))}{const t=this.store.getAll(n.range);return new Xr(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}}Gt(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new Xr(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}Qt(t,e){I("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.jt=!1;const s=this.cursor(n);return this.Kt(s,((t,e,n)=>n.delete()))}Wt(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.Kt(s,e)}zt(t){const e=this.cursor({});return new Xr(((n,s)=>{e.onerror=t=>{const e=os(t.target.error);s(e)},e.onsuccess=e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next((t=>{t?s.continue():n()})):n()}}))}Kt(t,e){const n=[];return new Xr(((s,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void s();const r=new ts(i),o=e(i.primaryKey,i.value,r);if(o instanceof Xr){const t=o.catch((t=>(r.done(),Xr.reject(t))));n.push(t)}r.isDone?s():null===r.Lt?i.continue():i.continue(r.Lt)}})).next((()=>Xr.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.jt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function ss(t){return new Xr(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=os(t.target.error);n(e)}}))}let is=!1;function os(t){const e=Zr.Vt(Object(h.m)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return is||(is=!0,setTimeout((()=>{throw t}),0)),t}}return t}class as extends Yr{constructor(t,e){super(),this.Ht=t,this.currentSequenceNumber=e}}function us(t,e){const n=x(t);return Zr.xt(n.Ht,e)}class cs{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&an(s,t,n[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&un(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&un(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const n=t.get(e.key),s=n;this.applyToLocalView(s),n.isValidDocument()||s.convertToNoDocument(z.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),On())}isEqual(t){return this.batchId===t.batchId&&K(this.mutations,t.mutations,((t,e)=>hn(t,e)))&&K(this.baseMutations,t.baseMutations,((t,e)=>hn(t,e)))}}class hs{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){A(t.mutations.length===n.length);let s=Cn;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new hs(t,e,n,s)}}class ls{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ds{constructor(t,e,n,s,i=z.min(),r=z.min(),o=et.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new ds(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new ds(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new ds(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class fs{constructor(t){this.Jt=t}}function gs(t,e){const n=e.key,s={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:ms(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=function(t,e){return{name:Zn(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Qn(t,e.version.toTimestamp())}}(t.Jt,e);else if(e.isNoDocument())s.noDocument={path:n.path.toArray(),readTime:ps(e.version)};else{if(!e.isUnknownDocument())return S();s.unknownDocument={path:n.path.toArray(),version:ps(e.version)}}return s}function ms(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function ps(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ys(t){const e=new $(t.seconds,t.nanoseconds);return z.fromTimestamp(e)}function ws(t,e){const n=(e.baseMutations||[]).map((e=>cr(t.Jt,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const s=e.mutations[t+1];n.updateTransforms=s.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const s=e.mutations.map((e=>cr(t.Jt,e))),i=$.fromMillis(e.localWriteTimeMs);return new cs(e.batchId,i,n,s)}function vs(t){const e=ys(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?ys(t.lastLimboFreeSnapshotVersion):z.min();let s;var i;return void 0!==t.query.documents?(A(1===(i=t.query).documents.length),s=ke(Ae(rr(i.documents[0])))):s=function(t){return ke(fr(t))}(t.query),new ds(s,t.targetId,0,t.lastListenSequenceNumber,e,n,et.fromBase64String(t.resumeToken))}function bs(t,e){const n=ps(e.snapshotVersion),s=ps(e.lastLimboFreeSnapshotVersion);let i;i=oe(e.target)?lr(t.Jt,e.target):dr(t.Jt,e.target);const r=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:se(e.target),readTime:n,resumeToken:r,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:i}}function Is(t){const e=fr({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Oe(e,e.limit,"L"):e}function Ts(t,e){return new ls(e.largestBatchId,cr(t.Jt,e.overlayMutation))}function Es(t,e){const n=e.path.lastSegment();return[t,_r(e.path.popLast()),n]}class _s{getBundleMetadata(t,e){return Ss(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:ys(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return Ss(t).put({bundleId:(n=e).id,createTime:ps(Yn(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return As(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:Is(e.bundledQuery),readTime:ys(e.readTime)};var e}))}saveNamedQuery(t,e){return As(t).put(function(t){return{name:t.name,readTime:ps(Yn(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function Ss(t){return us(t,"bundles")}function As(t){return us(t,"namedQueries")}class xs{constructor(t,e){this.M=t,this.userId=e}static Yt(t,e){const n=e.uid||"";return new xs(t,n)}getOverlay(t,e){return Ds(t).get(Es(this.userId,e)).next((t=>t?Ts(this.M,t):null))}saveOverlays(t,e,n){const s=[];return n.forEach(((n,i)=>{const r=new ls(e,i);s.push(this.Xt(t,r))})),Xr.waitFor(s)}removeOverlaysForBatchId(t,e,n){const s=new Set;e.forEach((t=>s.add(_r(t.getCollectionPath()))));const i=[];return s.forEach((e=>{const s=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);i.push(Ds(t).Qt("collectionPathOverlayIndex",s))})),Xr.waitFor(i)}getOverlaysForCollection(t,e,n){const s=Nn(),i=_r(e),r=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Ds(t).qt("collectionPathOverlayIndex",r).next((t=>{for(const e of t){const t=Ts(this.M,e);s.set(t.getKey(),t)}return s}))}getOverlaysForCollectionGroup(t,e,n,s){const i=Nn();let r;const o=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Ds(t).Wt({index:"collectionGroupOverlayIndex",range:o},((t,e,n)=>{const o=Ts(this.M,e);i.size()<s||o.largestBatchId===r?(i.set(o.getKey(),o),r=o.largestBatchId):n.done()})).next((()=>i))}Xt(t,e){return Ds(t).put(function(t,e,n){const[s,i,r]=Es(e,n.mutation.key);return{userId:e,collectionPath:i,documentId:r,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:ur(t.Jt,n.mutation)}}(this.M,this.userId,e))}}function Ds(t){return us(t,"documentOverlays")}class Ns{constructor(){}Zt(t,e){this.te(t,e),e.ee()}te(t,e){if("nullValue"in t)this.ne(e,5);else if("booleanValue"in t)this.ne(e,10),e.se(t.booleanValue?1:0);else if("integerValue"in t)this.ne(e,15),e.se(it(t.integerValue));else if("doubleValue"in t){const n=it(t.doubleValue);isNaN(n)?this.ne(e,13):(this.ne(e,15),gt(n)?e.se(0):e.se(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ne(e,20),"string"==typeof n?e.ie(n):(e.ie(`${n.seconds||""}`),e.se(n.nanos||0))}else if("stringValue"in t)this.re(t.stringValue,e),this.oe(e);else if("bytesValue"in t)this.ne(e,30),e.ue(ot(t.bytesValue)),this.oe(e);else if("referenceValue"in t)this.ae(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ne(e,45),e.se(n.latitude||0),e.se(n.longitude||0)}else"mapValue"in t?Mt(t)?this.ne(e,Number.MAX_SAFE_INTEGER):(this.ce(t.mapValue,e),this.oe(e)):"arrayValue"in t?(this.he(t.arrayValue,e),this.oe(e)):S()}re(t,e){this.ne(e,25),this.le(t,e)}le(t,e){e.ie(t)}ce(t,e){const n=t.fields||{};this.ne(e,55);for(const t of Object.keys(n))this.re(t,e),this.te(n[t],e)}he(t,e){const n=t.values||[];this.ne(e,50);for(const t of n)this.te(t,e)}ae(t,e){this.ne(e,37),pt.fromName(t).path.forEach((t=>{this.ne(e,60),this.le(t,e)}))}ne(t,e){t.se(e)}oe(t){t.se(2)}}function Cs(t){if(0===t)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function ks(t){const e=64-function(t){let e=0;for(let n=0;n<8;++n){const s=Cs(255&t[n]);if(e+=s,8!==s)break}return e}(t);return Math.ceil(e/8)}Ns.fe=new Ns;class tr{constructor(){this.buffer=new Uint8Array(1024),this.position=0}de(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this._e(n.value),n=e.next();this.we()}me(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.ge(n.value),n=e.next();this.ye()}pe(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this._e(t);else if(t<2048)this._e(960|t>>>6),this._e(128|63&t);else if(e<"\ud800"||"\udbff"<e)this._e(480|t>>>12),this._e(128|63&t>>>6),this._e(128|63&t);else{const t=e.codePointAt(0);this._e(240|t>>>18),this._e(128|63&t>>>12),this._e(128|63&t>>>6),this._e(128|63&t)}}this.we()}Ie(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.ge(t);else if(t<2048)this.ge(960|t>>>6),this.ge(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.ge(480|t>>>12),this.ge(128|63&t>>>6),this.ge(128|63&t);else{const t=e.codePointAt(0);this.ge(240|t>>>18),this.ge(128|63&t>>>12),this.ge(128|63&t>>>6),this.ge(128|63&t)}}this.ye()}Te(t){const e=this.Ee(t),n=ks(e);this.Ae(1+n),this.buffer[this.position++]=255&n;for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=255&e[t]}Re(t){const e=this.Ee(t),n=ks(e);this.Ae(1+n),this.buffer[this.position++]=~(255&n);for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=~(255&e[t])}be(){this.Pe(255),this.Pe(255)}Ve(){this.ve(255),this.ve(255)}reset(){this.position=0}seed(t){this.Ae(t.length),this.buffer.set(t,this.position),this.position+=t.length}Se(){return this.buffer.slice(0,this.position)}Ee(t){const e=function(t){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t,!1),new Uint8Array(e.buffer)}(t),n=0!=(128&e[0]);e[0]^=n?255:128;for(let t=1;t<e.length;++t)e[t]^=n?255:0;return e}_e(t){const e=255&t;0===e?(this.Pe(0),this.Pe(255)):255===e?(this.Pe(255),this.Pe(0)):this.Pe(e)}ge(t){const e=255&t;0===e?(this.ve(0),this.ve(255)):255===e?(this.ve(255),this.ve(0)):this.ve(t)}we(){this.Pe(0),this.Pe(1)}ye(){this.ve(0),this.ve(1)}Pe(t){this.Ae(1),this.buffer[this.position++]=t}ve(t){this.Ae(1),this.buffer[this.position++]=~t}Ae(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class Os{constructor(t){this.De=t}ue(t){this.De.de(t)}ie(t){this.De.pe(t)}se(t){this.De.Te(t)}ee(){this.De.be()}}class Ms{constructor(t){this.De=t}ue(t){this.De.me(t)}ie(t){this.De.Ie(t)}se(t){this.De.Re(t)}ee(){this.De.Ve()}}class Rs{constructor(){this.De=new tr,this.Ce=new Os(this.De),this.xe=new Ms(this.De)}seed(t){this.De.seed(t)}Ne(t){return 0===t?this.Ce:this.xe}Se(){return this.De.Se()}reset(){this.De.reset()}}class Ls{constructor(t,e,n,s){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=s}ke(){const t=this.directionalValue.length,e=0===t||255===this.directionalValue[t-1]?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new Ls(this.indexId,this.documentKey,this.arrayValue,n)}}function Vs(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=Ps(t.arrayValue,e.arrayValue),0!==n?n:(n=Ps(t.directionalValue,e.directionalValue),0!==n?n:pt.comparator(t.documentKey,e.documentKey)))}function Ps(t,e){for(let n=0;n<t.length&&n<e.length;++n){const s=t[n]-e[n];if(0!==s)return s}return t.length-e.length}class Fs{constructor(t){this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Me=t.orderBy,this.Oe=[];for(const e of t.filters){const t=e;t.S()?this.Fe=t:this.Oe.push(t)}}$e(t){const e=Bt(t);if(void 0!==e&&!this.Be(e))return!1;const n=Kt(t);let s=0,i=0;for(;s<n.length&&this.Be(n[s]);++s);if(s===n.length)return!0;if(void 0!==this.Fe){const t=n[s];if(!this.Le(this.Fe,t)||!this.Ue(this.Me[i++],t))return!1;++s}for(;s<n.length;++s){const t=n[s];if(i>=this.Me.length||!this.Ue(this.Me[i++],t))return!1}return!0}Be(t){for(const e of this.Oe)if(this.Le(e,t))return!0;return!1}Le(t,e){if(void 0===t||!t.field.isEqual(e.fieldPath))return!1;const n="array-contains"===t.op||"array-contains-any"===t.op;return 2===e.kind===n}Ue(t,e){return!!t.field.isEqual(e.fieldPath)&&(0===e.kind&&"asc"===t.dir||1===e.kind&&"desc"===t.dir)}}class qs{constructor(){this.qe=new Us}addToCollectionParentIndex(t,e){return this.qe.add(e),Xr.resolve()}getCollectionParents(t,e){return Xr.resolve(this.qe.getEntries(e))}addFieldIndex(t,e){return Xr.resolve()}deleteFieldIndex(t,e){return Xr.resolve()}getDocumentsMatchingTarget(t,e){return Xr.resolve(null)}getIndexType(t,e){return Xr.resolve(0)}getFieldIndexes(t,e){return Xr.resolve([])}getNextCollectionGroupToUpdate(t){return Xr.resolve(null)}getMinOffset(t,e){return Xr.resolve(Wt.min())}updateCollectionGroup(t,e,n){return Xr.resolve()}updateIndexEntries(t,e){return Xr.resolve()}}class Us{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new Zt(Y.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new Zt(Y.comparator)).toArray()}}const hr=new Uint8Array(0);class js{constructor(t,e){this.user=t,this.databaseId=e,this.Ke=new Us,this.Ge=new _n((t=>se(t)),((t,e)=>ie(t,e))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.Ke.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.Ke.add(e)}));const i={collectionId:n,parent:_r(s)};return Bs(t).put(i)}return Xr.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[G(e),""],!1,!0);return Bs(t).qt(s).next((t=>{for(const s of t){if(s.collectionId!==e)break;n.push(xr(s.parent))}return n}))}addFieldIndex(t,e){const n=Gs(t),s=function(t){return{indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map((t=>[t.fieldPath.canonicalString(),t.kind]))}}(e);return delete s.indexId,n.add(s).next()}deleteFieldIndex(t,e){const n=Gs(t),s=$s(t),i=Ks(t);return n.delete(e.indexId).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}getDocumentsMatchingTarget(t,e){const n=Ks(t);let s=!0;const i=new Map;return Xr.forEach(this.Qe(e),(e=>this.je(t,e).next((t=>{s&&(s=!!t),i.set(e,t)})))).next((()=>{if(s){let t=On();const s=[];return Xr.forEach(i,((i,r)=>{var o;I("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((t=>`${t.fieldPath}:${t.kind}`)).join(",")}`} to execute ${se(e)}`);const u=function(t,e){const n=Bt(e);if(void 0===n)return null;for(const e of ae(t,n.fieldPath))switch(e.op){case"array-contains-any":return e.value.arrayValue.values||[];case"array-contains":return[e.value]}return null}(r,i),a=function(t,e){const n=new Map;for(const s of Kt(e))for(const e of ae(t,s.fieldPath))switch(e.op){case"==":case"in":n.set(s.fieldPath.canonicalString(),e.value);break;case"not-in":case"!=":return n.set(s.fieldPath.canonicalString(),e.value),Array.from(n.values())}return null}(r,i),c=function(t,e){const n=[];let s=!0;for(const i of Kt(e)){const e=0===i.kind?ue(t,i.fieldPath,t.startAt):ce(t,i.fieldPath,t.startAt);n.push(e.value),s&&(s=e.inclusive)}return new ve(n,s)}(r,i),h=function(t,e){const n=[];let s=!0;for(const i of Kt(e)){const e=0===i.kind?ce(t,i.fieldPath,t.endAt):ue(t,i.fieldPath,t.endAt);n.push(e.value),s&&(s=e.inclusive)}return new ve(n,s)}(r,i),l=this.We(i,r,c),d=this.We(i,r,h),f=this.ze(i,r,a),m=this.He(i.indexId,u,l,c.inclusive,d,h.inclusive,f);return Xr.forEach(m,(i=>n.Gt(i,e.limit).next((e=>{e.forEach((e=>{const n=pt.fromSegments(e.documentKey);t.has(n)||(t=t.add(n),s.push(n))}))}))))})).next((()=>s))}return Xr.resolve(null)}))}Qe(t){let e=this.Ge.get(t);return e||(e=[t],this.Ge.set(t,e),e)}He(t,e,n,s,i,r,o){const u=(null!=e?e.length:1)*Math.max(n.length,i.length),a=u/(null!=e?e.length:1),c=[];for(let h=0;h<u;++h){const u=e?this.Je(e[h/a]):hr,l=this.Ye(t,u,n[h%a],s),d=this.Xe(t,u,i[h%a],r),f=o.map((e=>this.Ye(t,u,e,!0)));c.push(...this.createRange(l,d,f))}return c}Ye(t,e,n,s){const i=new Ls(t,pt.empty(),e,n);return s?i:i.ke()}Xe(t,e,n,s){const i=new Ls(t,pt.empty(),e,n);return s?i.ke():i}je(t,e){const n=new Fs(e),s=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next((t=>{let e=null;for(const s of t)n.$e(s)&&(!e||s.fields.length>e.fields.length)&&(e=s);return e}))}getIndexType(t,e){let n=2;return Xr.forEach(this.Qe(e),(e=>this.je(t,e).next((t=>{t?0!==n&&t.fields.length<function(t){let e=new Zt(J.comparator),n=!1;for(const s of t.filters){const t=s;t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n=!0:e=e.add(t.field))}for(const n of t.orderBy)n.field.isKeyField()||(e=e.add(n.field));return e.size+(n?1:0)}(e)&&(n=1):n=0})))).next((()=>n))}Ze(t,e){const n=new Rs;for(const s of Kt(t)){const t=e.data.field(s.fieldPath);if(null==t)return null;const i=n.Ne(s.kind);Ns.fe.Zt(t,i)}return n.Se()}Je(t){const e=new Rs;return Ns.fe.Zt(t,e.Ne(0)),e.Se()}tn(t,e){const n=new Rs;return Ns.fe.Zt(At(this.databaseId,e),n.Ne(function(t){const e=Kt(t);return 0===e.length?0:e[e.length-1].kind}(t))),n.Se()}ze(t,e,n){if(null===n)return[];let s=[];s.push(new Rs);let i=0;for(const r of Kt(t)){const t=n[i++];for(const n of s)if(this.en(e,r.fieldPath)&&Dt(t))s=this.nn(s,r,t);else{const e=n.Ne(r.kind);Ns.fe.Zt(t,e)}}return this.sn(s)}We(t,e,n){return this.ze(t,e,n.position)}sn(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Se();return e}nn(t,e,n){const s=[...t],i=[];for(const t of n.arrayValue.values||[])for(const n of s){const s=new Rs;s.seed(n.Se()),Ns.fe.Zt(t,s.Ne(e.kind)),i.push(s)}return i}en(t,e){return!!t.filters.find((t=>t instanceof he&&t.field.isEqual(e)&&("in"===t.op||"not-in"===t.op)))}getFieldIndexes(t,e){const n=Gs(t),s=$s(t);return(e?n.qt("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.qt()).next((t=>{const e=[];return Xr.forEach(t,(t=>s.get([t.indexId,this.uid]).next((n=>{e.push(function(t,e){const n=e?new $t(e.sequenceNumber,new Wt(ys(e.readTime),new pt(xr(e.documentKey)),e.largestBatchId)):$t.empty(),s=t.fields.map((([t,e])=>new Gt(J.fromServerFormat(t),e)));return new jt(t.indexId,t.collectionGroup,s,n)}(t,n))})))).next((()=>e))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((t=>0===t.length?null:(t.sort(((t,e)=>{const n=t.indexState.sequenceNumber-e.indexState.sequenceNumber;return 0!==n?n:rt(t.collectionGroup,e.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(t,e,n){const s=Gs(t),i=$s(t);return this.rn(t).next((t=>s.qt("collectionGroupIndex",IDBKeyRange.bound(e,e)).next((e=>Xr.forEach(e,(e=>i.put(function(t,e,n,s){return{indexId:t,uid:e.uid||"",sequenceNumber:n,readTime:ps(s.readTime),documentKey:_r(s.documentKey.path),largestBatchId:s.largestBatchId}}(e.indexId,this.user,t,n))))))))}updateIndexEntries(t,e){const n=new Map;return Xr.forEach(e,((e,s)=>{const i=n.get(e.collectionGroup);return(i?Xr.resolve(i):this.getFieldIndexes(t,e.collectionGroup)).next((i=>(n.set(e.collectionGroup,i),Xr.forEach(i,(n=>this.on(t,e,n).next((e=>{const i=this.un(s,n);return e.isEqual(i)?Xr.resolve():this.an(t,s,n,e,i)})))))))}))}cn(t,e,n,s){return Ks(t).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.tn(n,e.key),documentKey:e.key.path.toArray()})}hn(t,e,n,s){return Ks(t).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.tn(n,e.key),e.key.path.toArray()])}on(t,e,n){const s=Ks(t);let i=new Zt(Vs);return s.Wt({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.tn(n,e)])},((t,s)=>{i=i.add(new Ls(n.indexId,e,s.arrayValue,s.directionalValue))})).next((()=>i))}un(t,e){let n=new Zt(Vs);const s=this.Ze(e,t);if(null==s)return n;const i=Bt(e);if(null!=i){const r=t.data.field(i.fieldPath);if(Dt(r))for(const i of r.arrayValue.values||[])n=n.add(new Ls(e.indexId,t.key,this.Je(i),s))}else n=n.add(new Ls(e.indexId,t.key,hr,s));return n}an(t,e,n,s,i){I("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const r=[];return function(t,e,n,s,i){const r=t.getIterator(),o=e.getIterator();let u=ee(r),a=ee(o);for(;u||a;){let t=!1,e=!1;if(u&&a){const s=n(u,a);s<0?e=!0:s>0&&(t=!0)}else null!=u?e=!0:t=!0;t?(s(a),a=ee(o)):e?(i(u),u=ee(r)):(u=ee(r),a=ee(o))}}(s,i,Vs,(s=>{r.push(this.cn(t,e,n,s))}),(s=>{r.push(this.hn(t,e,n,s))})),Xr.waitFor(r)}rn(t){let e=1;return $s(t).Wt({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((t,n,s)=>{s.done(),e=n.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((t,e)=>Vs(t,e))).filter(((t,e,n)=>!e||0!==Vs(t,n[e-1])));const s=[];s.push(t);for(const i of n){const n=Vs(i,t),r=Vs(i,e);if(0===n)s[0]=t.ke();else if(n>0&&r<0)s.push(i),s.push(i.ke());else if(r>0)break}s.push(e);const i=[];for(let t=0;t<s.length;t+=2)i.push(IDBKeyRange.bound([s[t].indexId,this.uid,s[t].arrayValue,s[t].directionalValue,hr,[]],[s[t+1].indexId,this.uid,s[t+1].arrayValue,s[t+1].directionalValue,hr,[]]));return i}getMinOffset(t,e){let n;return Xr.forEach(this.Qe(e),(e=>this.je(t,e).next((t=>{t?(!n||Ht(t.indexState.offset,n)<0)&&(n=t.indexState.offset):n=Wt.min()})))).next((()=>n))}}function Bs(t){return us(t,"collectionParents")}function Ks(t){return us(t,"indexEntries")}function Gs(t){return us(t,"indexConfiguration")}function $s(t){return us(t,"indexState")}const zs={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Qs{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Qs(t,Qs.DEFAULT_COLLECTION_PERCENTILE,Qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Ws(t,e,n){const s=t.store("mutations"),i=t.store("documentMutations"),r=[],o=IDBKeyRange.only(n.batchId);let u=0;const a=s.Wt({range:o},((t,e,n)=>(u++,n.delete())));r.push(a.next((()=>{A(1===u)})));const c=[];for(const t of n.mutations){const s=Cr(e,t.key.path,n.batchId);r.push(i.delete(s)),c.push(t.key)}return Xr.waitFor(r).next((()=>c))}function Hs(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw S();e=t.noDocument}return JSON.stringify(e).length}Qs.DEFAULT_COLLECTION_PERCENTILE=10,Qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qs.DEFAULT=new Qs(41943040,Qs.DEFAULT_COLLECTION_PERCENTILE,Qs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qs.DISABLED=new Qs(-1,0,0);class Ys{constructor(t,e,n,s){this.userId=t,this.M=e,this.indexManager=n,this.referenceDelegate=s,this.ln={}}static Yt(t,e,n,s){A(""!==t.uid);const i=t.isAuthenticated()?t.uid:"";return new Ys(i,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Js(t).Wt({index:"userMutationsIndex",range:n},((t,n,s)=>{e=!1,s.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const i=Zs(t),r=Js(t);return r.add({}).next((o=>{A("number"==typeof o);const u=new cs(o,e,n,s),a=function(t,e,n){const s=n.baseMutations.map((e=>ur(t.Jt,e))),i=n.mutations.map((e=>ur(t.Jt,e)));return{userId:e,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:s,mutations:i}}(this.M,this.userId,u),c=[];let h=new Zt(((t,e)=>rt(t.canonicalString(),e.canonicalString())));for(const t of s){const e=Cr(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),c.push(r.put(a)),c.push(i.put(e,kr))}return h.forEach((e=>{c.push(this.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.ln[o]=u.keys()})),Xr.waitFor(c).next((()=>u))}))}lookupMutationBatch(t,e){return Js(t).get(e).next((t=>t?(A(t.userId===this.userId),ws(this.M,t)):null))}fn(t,e){return this.ln[e]?Xr.resolve(this.ln[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.ln[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Js(t).Wt({index:"userMutationsIndex",range:s},((t,e,s)=>{e.userId===this.userId&&(A(e.batchId>=n),i=ws(this.M,e)),s.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Js(t).Wt({index:"userMutationsIndex",range:e,reverse:!0},((t,e,s)=>{n=e.batchId,s.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Js(t).qt("userMutationsIndex",e).next((t=>t.map((t=>ws(this.M,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=Nr(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Zs(t).Wt({range:s},((n,s,r)=>{const[o,u,a]=n,c=xr(u);if(o===this.userId&&e.path.isEqual(c))return Js(t).get(a).next((t=>{if(!t)throw S();A(t.userId===this.userId),i.push(ws(this.M,t))}));r.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Zt(rt);const s=[];return e.forEach((e=>{const i=Nr(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=Zs(t).Wt({range:r},((t,s,i)=>{const[r,o,u]=t,a=xr(o);r===this.userId&&e.path.isEqual(a)?n=n.add(u):i.done()}));s.push(o)})),Xr.waitFor(s).next((()=>this.dn(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,i=Nr(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new Zt(rt);return Zs(t).Wt({range:r},((t,e,i)=>{const[r,u,a]=t,c=xr(u);r===this.userId&&n.isPrefixOf(c)?c.length===s&&(o=o.add(a)):i.done()})).next((()=>this.dn(t,o)))}dn(t,e){const n=[],s=[];return e.forEach((e=>{s.push(Js(t).get(e).next((t=>{if(null===t)throw S();A(t.userId===this.userId),n.push(ws(this.M,t))})))})),Xr.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return Ws(t.Ht,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this._n(e.batchId)})),Xr.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}_n(t){delete this.ln[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return Xr.resolve();const n=IDBKeyRange.lowerBound([this.userId]),s=[];return Zs(t).Wt({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=xr(t[1]);s.push(e)}else n.done()})).next((()=>{A(0===s.length)}))}))}containsKey(t,e){return Xs(t,this.userId,e)}wn(t){return ti(t).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Xs(t,e,n){const s=Nr(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return Zs(t).Wt({range:r,jt:!0},((t,n,s)=>{const[r,u,a]=t;r===e&&u===i&&(o=!0),s.done()})).next((()=>o))}function Js(t){return us(t,"mutations")}function Zs(t){return us(t,"documentMutations")}function ti(t){return us(t,"mutationQueues")}class br{constructor(t){this.mn=t}next(){return this.mn+=2,this.mn}static gn(){return new br(0)}static yn(){return new br(-1)}}class ei{constructor(t,e){this.referenceDelegate=t,this.M=e}allocateTargetId(t){return this.pn(t).next((e=>{const n=new br(e.highestTargetId);return e.highestTargetId=n.next(),this.In(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.pn(t).next((t=>z.fromTimestamp(new $(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.pn(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.pn(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.In(t,s))))}addTargetData(t,e){return this.Tn(t,e).next((()=>this.pn(t).next((n=>(n.targetCount+=1,this.En(e,n),this.In(t,n))))))}updateTargetData(t,e){return this.Tn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>ni(t).delete(e.targetId))).next((()=>this.pn(t))).next((e=>(A(e.targetCount>0),e.targetCount-=1,this.In(t,e))))}removeTargets(t,e,n){let s=0;const i=[];return ni(t).Wt(((r,o)=>{const u=vs(o);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(s++,i.push(this.removeTargetData(t,u)))})).next((()=>Xr.waitFor(i))).next((()=>s))}forEachTarget(t,e){return ni(t).Wt(((t,n)=>{const s=vs(n);e(s)}))}pn(t){return ri(t).get("targetGlobalKey").next((t=>(A(null!==t),t)))}In(t,e){return ri(t).put("targetGlobalKey",e)}Tn(t,e){return ni(t).put(bs(this.M,e))}En(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.pn(t).next((t=>t.targetCount))}getTargetData(t,e){const n=se(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return ni(t).Wt({range:s,index:"queryTargetsIndex"},((t,n,s)=>{const r=vs(n);ie(e,r.target)&&(i=r,s.done())})).next((()=>i))}addMatchingKeys(t,e,n){const s=[],i=si(t);return e.forEach((e=>{const r=_r(e.path);s.push(i.put({targetId:n,path:r})),s.push(this.referenceDelegate.addReference(t,n,e))})),Xr.waitFor(s)}removeMatchingKeys(t,e,n){const s=si(t);return Xr.forEach(e,(e=>{const i=_r(e.path);return Xr.waitFor([s.delete([n,i]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=si(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=si(t);let i=On();return s.Wt({range:n,jt:!0},((t,e,n)=>{const s=xr(t[1]),r=new pt(s);i=i.add(r)})).next((()=>i))}containsKey(t,e){const n=_r(e.path),s=IDBKeyRange.bound([n],[G(n)],!1,!0);let i=0;return si(t).Wt({index:"documentTargetsIndex",jt:!0,range:s},(([t,e],n,s)=>{0!==t&&(i++,s.done())})).next((()=>i>0))}Et(t,e){return ni(t).get(e).next((t=>t?vs(t):null))}}function ni(t){return us(t,"targets")}function ri(t){return us(t,"targetGlobal")}function si(t){return us(t,"targetDocuments")}async function ii(t){if(t.code!==D.FAILED_PRECONDITION||t.message!==Hr)throw t;I("LocalStore","Unexpectedly lost primary lease")}function oi([t,e],[n,s]){const i=rt(t,n);return 0===i?rt(e,s):i}class ai{constructor(t){this.An=t,this.buffer=new Zt(oi),this.Rn=0}bn(){return++this.Rn}Pn(t){const e=[t,this.bn()];if(this.buffer.size<this.An)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();oi(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class ui{constructor(t,e){this.garbageCollector=t,this.asyncQueue=e,this.Vn=!1,this.vn=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Sn(t)}stop(){this.vn&&(this.vn.cancel(),this.vn=null)}get started(){return null!==this.vn}Sn(t){const e=this.Vn?3e5:6e4;I("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.vn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.vn=null,this.Vn=!0;try{await t.collectGarbage(this.garbageCollector)}catch(t){ns(t)?I("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await ii(t)}await this.Sn(t)}))}}class ci{constructor(t,e){this.Dn=t,this.params=e}calculateTargetCount(t,e){return this.Dn.Cn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Xr.resolve(U.A);const n=new ai(e);return this.Dn.forEachTarget(t,(t=>n.Pn(t.sequenceNumber))).next((()=>this.Dn.xn(t,(t=>n.Pn(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.Dn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Dn.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector","Garbage collection skipped; disabled"),Xr.resolve(zs)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zs):this.Nn(t,e)))}getCacheSize(t){return this.Dn.getCacheSize(t)}Nn(t,e){let n,s,i,r,o,a,h;const l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(I("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),s=this.params.maximumSequenceNumbersToCollect):s=e,r=Date.now(),this.nthSequenceNumber(t,s)))).next((s=>(n=s,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(h=Date.now(),w()<=c.a.DEBUG&&I("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-l}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(h-a)+"ms\n"+`Total Duration: ${h-l}ms`),Xr.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:t}))))}}class hi{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new ci(t,e)}(this,e)}Cn(t){const e=this.kn(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}kn(t){let e=0;return this.xn(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}xn(t,e){return this.Mn(t,((t,n)=>e(n)))}addReference(t,e,n){return di(t,n)}removeReference(t,e,n){return di(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return di(t,e)}On(t,e){return function(t,e){let n=!1;return ti(t).zt((s=>Xs(t,s,e).next((t=>(t&&(n=!0),Xr.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Mn(t,((r,o)=>{if(o<=e){const e=this.On(t,r).next((e=>{if(!e)return i++,n.getEntry(t,r).next((()=>(n.removeEntry(r,z.min()),si(t).delete([0,_r(r.path)]))))}));s.push(e)}})).next((()=>Xr.waitFor(s))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return di(t,e)}Mn(t,e){const n=si(t);let s,i=U.A;return n.Wt({index:"documentTargetsIndex"},(([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==U.A&&e(new pt(xr(s)),i),i=o,s=r):i=U.A})).next((()=>{i!==U.A&&e(new pt(xr(s)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function di(t,e){return si(t).put(function(t,e){return{targetId:0,path:_r(t.path),sequenceNumber:e}}(e,t.currentSequenceNumber))}class fi{constructor(){this.changes=new _n((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ut.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Xr.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class gi{constructor(t){this.M=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return yi(t).put(n)}removeEntry(t,e,n){return yi(t).delete(function(t,e){const n=t.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],ms(e),n[n.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.Fn(t,n))))}getEntry(t,e){let n=Ut.newInvalidDocument(e);return yi(t).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(wi(e))},((t,s)=>{n=this.$n(e,s)})).next((()=>n))}Bn(t,e){let n={size:0,document:Ut.newInvalidDocument(e)};return yi(t).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(wi(e))},((t,s)=>{n={document:this.$n(e,s),size:Hs(s)}})).next((()=>n))}getEntries(t,e){let n=An();return this.Ln(t,e,((t,e)=>{const s=this.$n(t,e);n=n.insert(t,s)})).next((()=>n))}Un(t,e){let n=An(),s=new Yt(pt.comparator);return this.Ln(t,e,((t,e)=>{const i=this.$n(t,e);n=n.insert(t,i),s=s.insert(t,Hs(e))})).next((()=>({documents:n,qn:s})))}Ln(t,e,n){if(e.isEmpty())return Xr.resolve();let s=new Zt(bi);e.forEach((t=>s=s.add(t)));const i=IDBKeyRange.bound(wi(s.first()),wi(s.last())),r=s.getIterator();let o=r.getNext();return yi(t).Wt({index:"documentKeyIndex",range:i},((t,e,s)=>{const i=pt.fromSegments([...e.prefixPath,e.collectionGroup,e.documentId]);for(;o&&bi(o,i)<0;)n(o,null),o=r.getNext();o&&o.isEqual(i)&&(n(o,e),o=r.hasNext()?r.getNext():null),o?s.Ut(wi(o)):s.done()})).next((()=>{for(;o;)n(o,null),o=r.hasNext()?r.getNext():null}))}getAllFromCollection(t,e,n){const s=[e.popLast().toArray(),e.lastSegment(),ms(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],i=[e.popLast().toArray(),e.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return yi(t).qt(IDBKeyRange.bound(s,i,!0)).next((t=>{let e=An();for(const n of t){const t=this.$n(pt.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);e=e.insert(t.key,t)}return e}))}getAllFromCollectionGroup(t,e,n,s){let i=An();const r=vi(e,n),o=vi(e,Wt.max());return yi(t).Wt({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,o,!0)},((t,e,n)=>{const r=this.$n(pt.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);i=i.insert(r.key,r),i.size===s&&n.done()})).next((()=>i))}newChangeBuffer(t){return new mi(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return pi(t).get("remoteDocumentGlobalKey").next((t=>(A(!!t),t)))}Fn(t,e){return pi(t).put("remoteDocumentGlobalKey",e)}$n(t,e){if(e){const t=function(t,e){let n;if(e.document)n=ar(t.Jt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const t=pt.fromSegments(e.noDocument.path),s=ys(e.noDocument.readTime);n=Ut.newNoDocument(t,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return S();{const t=pt.fromSegments(e.unknownDocument.path),s=ys(e.unknownDocument.version);n=Ut.newUnknownDocument(t,s)}}return e.readTime&&n.setReadTime(function(t){const e=new $(t[0],t[1]);return z.fromTimestamp(e)}(e.readTime)),n}(this.M,e);if(!t.isNoDocument()||!t.version.isEqual(z.min()))return t}return Ut.newInvalidDocument(t)}}class mi extends fi{constructor(t,e){super(),this.Kn=t,this.trackRemovals=e,this.Gn=new _n((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,s=new Zt(((t,e)=>rt(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((i,r)=>{const o=this.Gn.get(i);if(e.push(this.Kn.removeEntry(t,i,o.readTime)),r.isValidDocument()){const u=gs(this.Kn.M,r);s=s.add(i.path.popLast());const a=Hs(u);n+=a-o.size,e.push(this.Kn.addEntry(t,i,u))}else if(n-=o.size,this.trackRemovals){const n=gs(this.Kn.M,r.convertToNoDocument(z.min()));e.push(this.Kn.addEntry(t,i,n))}})),s.forEach((n=>{e.push(this.Kn.indexManager.addToCollectionParentIndex(t,n))})),e.push(this.Kn.updateMetadata(t,n)),Xr.waitFor(e)}getFromCache(t,e){return this.Kn.Bn(t,e).next((t=>(this.Gn.set(e,{size:t.size,readTime:t.document.readTime}),t.document)))}getAllFromCache(t,e){return this.Kn.Un(t,e).next((({documents:t,qn:e})=>(e.forEach(((e,n)=>{this.Gn.set(e,{size:n,readTime:t.get(e).readTime})})),t)))}}function pi(t){return us(t,"remoteDocumentGlobal")}function yi(t){return us(t,"remoteDocumentsV14")}function wi(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function vi(t,e){const n=e.documentKey.path.toArray();return[t,ms(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function bi(t,e){const n=t.path.toArray(),s=e.path.toArray();let i=0;for(let t=0;t<n.length-2&&t<s.length-2;++t)if(i=rt(n[t],s[t]),i)return i;return i=rt(n.length,s.length),i||(i=rt(n[n.length-2],s[s.length-2]),i||rt(n[n.length-1],s[s.length-1]))}class Ii{constructor(t){this.M=t}kt(t,e,n,s){const i=new Jr("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore("owner")}(t),function(t){t.createObjectStore("mutationQueues",{keyPath:"userId"}),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Dr,{unique:!0}),t.createObjectStore("documentMutations")}(t),Ti(t),function(t){t.createObjectStore("remoteDocuments")}(t));let r=Xr.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore("targetDocuments"),t.deleteObjectStore("targets"),t.deleteObjectStore("targetGlobal")}(t),Ti(t)),r=r.next((()=>function(t){const e=t.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",n)}(i)))),n<4&&s>=4&&(0!==n&&(r=r.next((()=>function(t,e){return e.store("mutations").qt().next((n=>{t.deleteObjectStore("mutations"),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Dr,{unique:!0});const s=e.store("mutations"),i=n.map((t=>s.put(t)));return Xr.waitFor(i)}))}(t,i)))),r=r.next((()=>{!function(t){t.createObjectStore("clientMetadata",{keyPath:"clientId"})}(t)}))),n<5&&s>=5&&(r=r.next((()=>this.Qn(i)))),n<6&&s>=6&&(r=r.next((()=>(function(t){t.createObjectStore("remoteDocumentGlobal")}(t),this.jn(i))))),n<7&&s>=7&&(r=r.next((()=>this.Wn(i)))),n<8&&s>=8&&(r=r.next((()=>this.zn(t,i)))),n<9&&s>=9&&(r=r.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t)}))),n<10&&s>=10&&(r=r.next((()=>this.Hn(i)))),n<11&&s>=11&&(r=r.next((()=>{!function(t){t.createObjectStore("bundles",{keyPath:"bundleId"})}(t),function(t){t.createObjectStore("namedQueries",{keyPath:"name"})}(t)}))),n<12&&s>=12&&(r=r.next((()=>{!function(t){const e=t.createObjectStore("documentOverlays",{keyPath:Kr});e.createIndex("collectionPathOverlayIndex",Gr,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",li,{unique:!1})}(t)}))),n<13&&s>=13&&(r=r.next((()=>function(t){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:Or});e.createIndex("documentKeyIndex",Mr),e.createIndex("collectionGroupIndex",Rr)}(t))).next((()=>this.Jn(t,i))).next((()=>t.deleteObjectStore("remoteDocuments")))),n<14&&s>=14&&(r=r.next((()=>{!function(t){t.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),t.createObjectStore("indexState",{keyPath:qr}).createIndex("sequenceNumberIndex",Ur,{unique:!1}),t.createObjectStore("indexEntries",{keyPath:jr}).createIndex("documentKeyIndex",Br,{unique:!1})}(t)}))),r}jn(t){let e=0;return t.store("remoteDocuments").Wt(((t,n)=>{e+=Hs(n)})).next((()=>{const n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Qn(t){const e=t.store("mutationQueues"),n=t.store("mutations");return e.qt().next((e=>Xr.forEach(e,(e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.qt("userMutationsIndex",s).next((n=>Xr.forEach(n,(n=>{A(n.userId===e.userId);const s=ws(this.M,n);return Ws(t,e.userId,s).next((()=>{}))}))))}))))}Wn(t){const e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next((t=>{const s=[];return n.Wt(((n,i)=>{const r=new Y(n),o=function(t){return[0,_r(t)]}(r);s.push(e.get(o).next((n=>n?Xr.resolve():(n=>e.put({targetId:0,path:_r(n),sequenceNumber:t.highestListenSequenceNumber}))(r))))})).next((()=>Xr.waitFor(s)))}))}zn(t,e){t.createObjectStore("collectionParents",{keyPath:Fr});const n=e.store("collectionParents"),s=new Us,i=t=>{if(s.add(t)){const e=t.lastSegment(),s=t.popLast();return n.put({collectionId:e,parent:_r(s)})}};return e.store("remoteDocuments").Wt({jt:!0},((t,e)=>{const n=new Y(t);return i(n.popLast())})).next((()=>e.store("documentMutations").Wt({jt:!0},(([t,e,n],s)=>{const r=xr(e);return i(r.popLast())}))))}Hn(t){const e=t.store("targets");return e.Wt(((t,n)=>{const s=vs(n),i=bs(this.M,s);return e.put(i)}))}Jn(t,e){const n=e.store("remoteDocuments"),s=[];return n.Wt(((t,n)=>{const i=e.store("remoteDocumentsV14"),r=(o=n,o.document?new pt(Y.fromString(o.document.name).popFirst(5)):o.noDocument?pt.fromSegments(o.noDocument.path):o.unknownDocument?pt.fromSegments(o.unknownDocument.path):S()).path.toArray();var o;const u={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};s.push(i.put(u))})).next((()=>Xr.waitFor(s)))}}function Ti(t){t.createObjectStore("targetDocuments",{keyPath:Vr}).createIndex("documentTargetsIndex",Pr,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Lr,{unique:!0}),t.createObjectStore("targetGlobal")}const Ei="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class _i{constructor(t,e,n,s,i,r,o,u,a,c,h=13){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Yn=i,this.window=r,this.document=o,this.Xn=a,this.Zn=c,this.ts=h,this.es=null,this.ns=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ss=null,this.inForeground=!1,this.rs=null,this.os=null,this.us=Number.NEGATIVE_INFINITY,this.cs=t=>Promise.resolve(),!_i.vt())throw new N(D.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new hi(this,s),this.hs=e+"main",this.M=new fs(u),this.ls=new Zr(this.hs,this.ts,new Ii(this.M)),this.fs=new ei(this.referenceDelegate,this.M),this.ds=function(t){return new gi(t)}(this.M),this._s=new _s,this.window&&this.window.localStorage?this.ws=this.window.localStorage:(this.ws=null,!1===c&&T("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.gs().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(D.FAILED_PRECONDITION,Ei);return this.ys(),this.ps(),this.Is(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.fs.getHighestSequenceNumber(t)))})).then((t=>{this.es=new U(t,this.Xn)})).then((()=>{this.ns=!0})).catch((t=>(this.ls&&this.ls.close(),Promise.reject(t))))}Ts(t){return this.cs=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ls.Ot((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Yn.enqueueAndForget((async()=>{this.started&&await this.gs()})))}gs(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>Ai(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Es(t).next((t=>{t||(this.isPrimary=!1,this.Yn.enqueueRetryable((()=>this.cs(!1))))}))})).next((()=>this.As(t))).next((e=>this.isPrimary&&!e?this.Rs(t).next((()=>!1)):!!e&&this.bs(t).next((()=>!0)))))).catch((t=>{if(ns(t))return I("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return I("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Yn.enqueueRetryable((()=>this.cs(t))),this.isPrimary=t}))}Es(t){return Si(t).get("owner").next((t=>Xr.resolve(this.Ps(t))))}Vs(t){return Ai(t).delete(this.clientId)}async vs(){if(this.isPrimary&&!this.Ss(this.us,18e5)){this.us=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=us(t,"clientMetadata");return e.qt().next((t=>{const n=this.Ds(t,18e5),s=t.filter((t=>-1===n.indexOf(t)));return Xr.forEach(s,(t=>e.delete(t.clientId))).next((()=>s))}))})).catch((()=>[]));if(this.ws)for(const e of t)this.ws.removeItem(this.Cs(e.clientId))}}Is(){this.os=this.Yn.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.gs().then((()=>this.vs())).then((()=>this.Is()))))}Ps(t){return!!t&&t.ownerId===this.clientId}As(t){return this.Zn?Xr.resolve(!0):Si(t).get("owner").next((e=>{if(null!==e&&this.Ss(e.leaseTimestampMs,5e3)&&!this.xs(e.ownerId)){if(this.Ps(e)&&this.networkEnabled)return!0;if(!this.Ps(e)){if(!e.allowTabSynchronization)throw new N(D.FAILED_PRECONDITION,Ei);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ai(t).qt().next((t=>void 0===this.Ds(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&I("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.ns=!1,this.Ns(),this.os&&(this.os.cancel(),this.os=null),this.ks(),this.Ms(),await this.ls.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(t=>{const e=new as(t,U.A);return this.Rs(e).next((()=>this.Vs(e)))})),this.ls.close(),this.Os()}Ds(t,e){return t.filter((t=>this.Ss(t.updateTimeMs,e)&&!this.xs(t.clientId)))}Fs(){return this.runTransaction("getActiveClients","readonly",(t=>Ai(t).qt().next((t=>this.Ds(t,18e5).map((t=>t.clientId))))))}get started(){return this.ns}getMutationQueue(t,e){return Ys.Yt(t,this.M,e,this.referenceDelegate)}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getIndexManager(t){return new js(t,this.M.Jt.databaseId)}getDocumentOverlayCache(t){return xs.Yt(this.M,t)}getBundleCache(){return this._s}runTransaction(t,e,n){I("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite",i=14===(r=this.ts)?Wr:13===r?Qr:12===r?zr:11===r?$r:void S();var r;let o;return this.ls.runTransaction(t,s,i,(s=>(o=new as(s,this.es?this.es.next():U.A),"readwrite-primary"===e?this.Es(o).next((t=>!!t||this.As(o))).next((e=>{if(!e)throw T(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Yn.enqueueRetryable((()=>this.cs(!1))),new N(D.FAILED_PRECONDITION,Hr);return n(o)})).next((t=>this.bs(o).next((()=>t)))):this.$s(o).next((()=>n(o)))))).then((t=>(o.raiseOnCommittedEvent(),t)))}$s(t){return Si(t).get("owner").next((t=>{if(null!==t&&this.Ss(t.leaseTimestampMs,5e3)&&!this.xs(t.ownerId)&&!this.Ps(t)&&!(this.Zn||this.allowTabSynchronization&&t.allowTabSynchronization))throw new N(D.FAILED_PRECONDITION,Ei)}))}bs(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Si(t).put("owner",e)}static vt(){return Zr.vt()}Rs(t){const e=Si(t);return e.get("owner").next((t=>this.Ps(t)?(I("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):Xr.resolve()))}Ss(t,e){const n=Date.now();return!(t<n-e||t>n&&(T(`Detected an update time that is in the future: ${t} > ${n}`),1))}ys(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.rs=()=>{this.Yn.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.gs())))},this.document.addEventListener("visibilitychange",this.rs),this.inForeground="visible"===this.document.visibilityState)}ks(){this.rs&&(this.document.removeEventListener("visibilitychange",this.rs),this.rs=null)}ps(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ss=()=>{this.Ns(),Object(h.w)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Yn.enterRestrictedMode(!0),this.Yn.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ss))}Ms(){this.ss&&(this.window.removeEventListener("pagehide",this.ss),this.ss=null)}xs(t){var e;try{const n=null!==(null===(e=this.ws)||void 0===e?void 0:e.getItem(this.Cs(t)));return I("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return T("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}Ns(){if(this.ws)try{this.ws.setItem(this.Cs(this.clientId),String(Date.now()))}catch(t){T("Failed to set zombie client id.",t)}}Os(){if(this.ws)try{this.ws.removeItem(this.Cs(this.clientId))}catch(t){}}Cs(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Si(t){return us(t,"owner")}function Ai(t){return us(t,"clientMetadata")}function xi(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class Di{constructor(t,e,n){this.ds=t,this.Bs=e,this.indexManager=n}Ls(t,e){return this.Bs.getAllMutationBatchesAffectingDocumentKey(t,e).next((n=>this.Us(t,e,n)))}Us(t,e,n){return this.ds.getEntry(t,e).next((t=>{for(const e of n)e.applyToLocalView(t);return t}))}qs(t,e){t.forEach(((t,n)=>{for(const t of e)t.applyToLocalView(n)}))}Ks(t,e){return this.ds.getEntries(t,e).next((e=>this.Gs(t,e).next((()=>e))))}Gs(t,e){return this.Bs.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.qs(e,t)))}Qs(t,e,n){return function(t){return pt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.js(t,e.path):Ne(e)?this.Ws(t,e,n):this.zs(t,e,n)}js(t,e){return this.Ls(t,new pt(e)).next((t=>{let e=Dn();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}Ws(t,e,n){const s=e.collectionGroup;let i=Dn();return this.indexManager.getCollectionParents(t,s).next((r=>Xr.forEach(r,(r=>{const o=function(t,e){return new _e(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.zs(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}zs(t,e,n){let s;return this.ds.getAllFromCollection(t,e.path,n).next((n=>(s=n,this.Bs.getAllMutationBatchesAffectingQuery(t,e)))).next((t=>{for(const e of t)for(const t of e.mutations){const n=t.key;let i=s.get(n);null==i&&(i=Ut.newInvalidDocument(n),s=s.insert(n,i)),un(t,i,e.localWriteTime),i.isFoundDocument()||(s=s.remove(n))}})).next((()=>(s.forEach(((t,n)=>{Ve(e,n)||(s=s.remove(t))})),s)))}}class Ni{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Hs=n,this.Js=s}static Ys(t,e){let n=On(),s=On();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new Ni(t,e.fromCache,n,s)}}class Ci{constructor(){this.Xs=!1}initialize(t,e){this.Zs=t,this.indexManager=e,this.Xs=!0}Qs(t,e,n,s){return this.ti(t,e).next((i=>i||this.ei(t,e,s,n))).next((n=>n||this.ni(t,e)))}ti(t,e){return Xr.resolve(null)}ei(t,e,n,s){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||s.isEqual(z.min())?this.ni(t,e):this.Zs.Ks(t,n).next((i=>{const r=this.si(e,i);return this.ii(e,r,n,s)?this.ni(t,e):(w()<=c.a.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Le(e)),this.ri(t,r,e,zt(s,-1)))}))}si(t,e){let n=new Zt(Fe(t));return e.forEach(((e,s)=>{Ve(t,s)&&(n=n.add(s))})),n}ii(t,e,n,s){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ni(t,e){return w()<=c.a.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",Le(e)),this.Zs.Qs(t,e,Wt.min())}ri(t,e,n,s){return this.Zs.Qs(t,n,s).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class ki{constructor(t,e,n,s){this.persistence=t,this.oi=e,this.M=s,this.ui=new Yt(rt),this.ai=new _n((t=>se(t)),ie),this.ci=new Map,this.hi=t.getRemoteDocumentCache(),this.fs=t.getTargetCache(),this._s=t.getBundleCache(),this.li(n)}li(t){this.indexManager=this.persistence.getIndexManager(t),this.Bs=this.persistence.getMutationQueue(t,this.indexManager),this.fi=new Di(this.hi,this.Bs,this.indexManager),this.hi.setIndexManager(this.indexManager),this.oi.initialize(this.fi,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ui)))}}function Oi(t,e,n,s){return new ki(t,e,n,s)}async function Mi(t,e){const n=x(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.Bs.getAllMutationBatches(t).next((i=>(s=i,n.li(e),n.Bs.getAllMutationBatches(t)))).next((e=>{const i=[],r=[];let o=On();for(const t of s){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.fi.Ks(t,o).next((t=>({di:t,removedBatchIds:i,addedBatchIds:r})))}))}))}function Ri(t){const e=x(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.fs.getLastRemoteSnapshotVersion(t)))}function Li(t,e,n){let s=On();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=An();return n.forEach(((n,i)=>{const r=t.get(n);i.isNoDocument()&&i.version.isEqual(z.min())?(e.removeEntry(n,i.readTime),s=s.insert(n,i)):!r.isValidDocument()||i.version.compareTo(r.version)>0||0===i.version.compareTo(r.version)&&r.hasPendingWrites?(e.addEntry(i),s=s.insert(n,i)):I("LocalStore","Ignoring outdated watch update for ",n,". Current version:",r.version," Watch version:",i.version)})),s}))}function Vi(t,e){const n=x(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.Bs.getNextMutationBatchAfterBatchId(t,e))))}function Pi(t,e){const n=x(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.fs.getTargetData(t,e).next((i=>i?(s=i,Xr.resolve(s)):n.fs.allocateTargetId(t).next((i=>(s=new ds(e,i,0,t.currentSequenceNumber),n.fs.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.ui.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.ui=n.ui.insert(t.targetId,t),n.ai.set(e,t.targetId)),t}))}async function Fi(t,e,n){const s=x(t),i=s.ui.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(t=>s.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!ns(t))throw t;I("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.ui=s.ui.remove(e),s.ai.delete(i.target)}function qi(t,e,n){const s=x(t);let i=z.min(),r=On();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=x(t),i=s.ai.get(n);return void 0!==i?Xr.resolve(s.ui.get(i)):s.fs.getTargetData(e,n)}(s,t,ke(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.fs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>s.oi.Qs(t,e,n?i:z.min(),n?r:On()))).next((t=>(Bi(s,Pe(e),t),{documents:t,_i:r})))))}function Ui(t,e){const n=x(t),s=x(n.fs),i=n.ui.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(t=>s.Et(t,e).next((t=>t?t.target:null))))}function ji(t,e){const n=x(t),s=n.ci.get(e)||z.min();return n.persistence.runTransaction("Get new document changes","readonly",(t=>n.hi.getAllFromCollectionGroup(t,e,zt(s,-1),Number.MAX_SAFE_INTEGER))).then((t=>(Bi(n,e,t),t)))}function Bi(t,e,n){let s=z.min();n.forEach(((t,e)=>{e.readTime.compareTo(s)>0&&(s=e.readTime)})),t.ci.set(e,s)}async function Ki(t,e,n=On()){const s=await Pi(t,ke(Is(e.bundledQuery))),i=x(t);return i.persistence.runTransaction("Save named query","readwrite",(t=>{const r=Yn(e.readTime);if(s.snapshotVersion.compareTo(r)>=0)return i._s.saveNamedQuery(t,e);const o=s.withResumeToken(et.EMPTY_BYTE_STRING,r);return i.ui=i.ui.insert(o.targetId,o),i.fs.updateTargetData(t,o).next((()=>i.fs.removeMatchingKeysForTargetId(t,s.targetId))).next((()=>i.fs.addMatchingKeys(t,n,s.targetId))).next((()=>i._s.saveNamedQuery(t,e)))}))}class Gi{constructor(t){this.M=t,this.yi=new Map,this.pi=new Map}getBundleMetadata(t,e){return Xr.resolve(this.yi.get(e))}saveBundleMetadata(t,e){var n;return this.yi.set(e.id,{id:(n=e).id,version:n.version,createTime:Yn(n.createTime)}),Xr.resolve()}getNamedQuery(t,e){return Xr.resolve(this.pi.get(e))}saveNamedQuery(t,e){return this.pi.set(e.name,function(t){return{name:t.name,query:Is(t.bundledQuery),readTime:Yn(t.readTime)}}(e)),Xr.resolve()}}class $i{constructor(){this.overlays=new Yt(pt.comparator),this.Ii=new Map}getOverlay(t,e){return Xr.resolve(this.overlays.get(e))}saveOverlays(t,e,n){return n.forEach(((n,s)=>{this.Xt(t,e,s)})),Xr.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.Ii.get(n);return void 0!==s&&(s.forEach((t=>this.overlays=this.overlays.remove(t))),this.Ii.delete(n)),Xr.resolve()}getOverlaysForCollection(t,e,n){const s=Nn(),i=e.length+1,r=new pt(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===i&&t.largestBatchId>n&&s.set(t.getKey(),t)}return Xr.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new Yt(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Nn(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Nn(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=s)););return Xr.resolve(o)}Xt(t,e,n){if(null===n)return;const s=this.overlays.get(n.key);if(null!==s){const t=this.Ii.get(s.largestBatchId).delete(n.key);this.Ii.set(s.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new ls(e,n));let i=this.Ii.get(e);void 0===i&&(i=On(),this.Ii.set(e,i)),this.Ii.set(e,i.add(n.key))}}class zi{constructor(){this.Ti=new Zt(Qi.Ei),this.Ai=new Zt(Qi.Ri)}isEmpty(){return this.Ti.isEmpty()}addReference(t,e){const n=new Qi(t,e);this.Ti=this.Ti.add(n),this.Ai=this.Ai.add(n)}bi(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Pi(new Qi(t,e))}Vi(t,e){t.forEach((t=>this.removeReference(t,e)))}vi(t){const e=new pt(new Y([])),n=new Qi(e,t),s=new Qi(e,t+1),i=[];return this.Ai.forEachInRange([n,s],(t=>{this.Pi(t),i.push(t.key)})),i}Si(){this.Ti.forEach((t=>this.Pi(t)))}Pi(t){this.Ti=this.Ti.delete(t),this.Ai=this.Ai.delete(t)}Di(t){const e=new pt(new Y([])),n=new Qi(e,t),s=new Qi(e,t+1);let i=On();return this.Ai.forEachInRange([n,s],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new Qi(t,0),n=this.Ti.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Qi{constructor(t,e){this.key=t,this.Ci=e}static Ei(t,e){return pt.comparator(t.key,e.key)||rt(t.Ci,e.Ci)}static Ri(t,e){return rt(t.Ci,e.Ci)||pt.comparator(t.key,e.key)}}class Wi{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.Bs=[],this.xi=1,this.Ni=new Zt(Qi.Ei)}checkEmpty(t){return Xr.resolve(0===this.Bs.length)}addMutationBatch(t,e,n,s){const i=this.xi;this.xi++,this.Bs.length>0&&this.Bs[this.Bs.length-1];const r=new cs(i,e,n,s);this.Bs.push(r);for(const e of s)this.Ni=this.Ni.add(new Qi(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Xr.resolve(r)}lookupMutationBatch(t,e){return Xr.resolve(this.ki(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.Mi(n),i=s<0?0:s;return Xr.resolve(this.Bs.length>i?this.Bs[i]:null)}getHighestUnacknowledgedBatchId(){return Xr.resolve(0===this.Bs.length?-1:this.xi-1)}getAllMutationBatches(t){return Xr.resolve(this.Bs.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Qi(e,0),s=new Qi(e,Number.POSITIVE_INFINITY),i=[];return this.Ni.forEachInRange([n,s],(t=>{const e=this.ki(t.Ci);i.push(e)})),Xr.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Zt(rt);return e.forEach((t=>{const e=new Qi(t,0),s=new Qi(t,Number.POSITIVE_INFINITY);this.Ni.forEachInRange([e,s],(t=>{n=n.add(t.Ci)}))})),Xr.resolve(this.Oi(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;pt.isDocumentKey(i)||(i=i.child(""));const r=new Qi(new pt(i),0);let o=new Zt(rt);return this.Ni.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.Ci)),!0)}),r),Xr.resolve(this.Oi(o))}Oi(t){const e=[];return t.forEach((t=>{const n=this.ki(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){A(0===this.Fi(e.batchId,"removed")),this.Bs.shift();let n=this.Ni;return Xr.forEach(e.mutations,(s=>{const i=new Qi(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Ni=n}))}_n(t){}containsKey(t,e){const n=new Qi(e,0),s=this.Ni.firstAfterOrEqual(n);return Xr.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.Bs.length,Xr.resolve()}Fi(t,e){return this.Mi(t)}Mi(t){return 0===this.Bs.length?0:t-this.Bs[0].batchId}ki(t){const e=this.Mi(t);return e<0||e>=this.Bs.length?null:this.Bs[e]}}class Hi{constructor(t){this.$i=t,this.docs=new Yt(pt.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,r=this.$i(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Xr.resolve(n?n.document.mutableCopy():Ut.newInvalidDocument(e))}getEntries(t,e){let n=An();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Ut.newInvalidDocument(t))})),Xr.resolve(n)}getAllFromCollection(t,e,n){let s=An();const i=new pt(e.child("")),r=this.docs.getIteratorFrom(i);for(;r.hasNext();){const{key:t,value:{document:i}}=r.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||Ht(Qt(i),n)<=0||(s=s.insert(i.key,i.mutableCopy()))}return Xr.resolve(s)}getAllFromCollectionGroup(t,e,n,s){S()}Bi(t,e){return Xr.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Yi(this)}getSize(t){return Xr.resolve(this.size)}}class Yi extends fi{constructor(t){super(),this.Kn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Kn.addEntry(t,s)):this.Kn.removeEntry(n)})),Xr.waitFor(e)}getFromCache(t,e){return this.Kn.getEntry(t,e)}getAllFromCache(t,e){return this.Kn.getEntries(t,e)}}class Xi{constructor(t){this.persistence=t,this.Li=new _n((t=>se(t)),ie),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.Ui=0,this.qi=new zi,this.targetCount=0,this.Ki=br.gn()}forEachTarget(t,e){return this.Li.forEach(((t,n)=>e(n))),Xr.resolve()}getLastRemoteSnapshotVersion(t){return Xr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Xr.resolve(this.Ui)}allocateTargetId(t){return this.highestTargetId=this.Ki.next(),Xr.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ui&&(this.Ui=e),Xr.resolve()}Tn(t){this.Li.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ki=new br(e),this.highestTargetId=e),t.sequenceNumber>this.Ui&&(this.Ui=t.sequenceNumber)}addTargetData(t,e){return this.Tn(e),this.targetCount+=1,Xr.resolve()}updateTargetData(t,e){return this.Tn(e),Xr.resolve()}removeTargetData(t,e){return this.Li.delete(e.target),this.qi.vi(e.targetId),this.targetCount-=1,Xr.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.Li.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Li.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),Xr.waitFor(i).next((()=>s))}getTargetCount(t){return Xr.resolve(this.targetCount)}getTargetData(t,e){const n=this.Li.get(e)||null;return Xr.resolve(n)}addMatchingKeys(t,e,n){return this.qi.bi(e,n),Xr.resolve()}removeMatchingKeys(t,e,n){this.qi.Vi(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((e=>{i.push(s.markPotentiallyOrphaned(t,e))})),Xr.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.qi.vi(e),Xr.resolve()}getMatchingKeysForTargetId(t,e){const n=this.qi.Di(e);return Xr.resolve(n)}containsKey(t,e){return Xr.resolve(this.qi.containsKey(e))}}class Ji{constructor(t,e){this.Gi={},this.overlays={},this.es=new U(0),this.ns=!1,this.ns=!0,this.referenceDelegate=t(this),this.fs=new Xi(this),this.indexManager=new qs,this.ds=function(t){return new Hi(t)}((t=>this.referenceDelegate.Qi(t))),this.M=new fs(e),this._s=new Gi(this.M)}start(){return Promise.resolve()}shutdown(){return this.ns=!1,Promise.resolve()}get started(){return this.ns}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new $i,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Gi[t.toKey()];return n||(n=new Wi(e,this.referenceDelegate),this.Gi[t.toKey()]=n),n}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getBundleCache(){return this._s}runTransaction(t,e,n){I("MemoryPersistence","Starting transaction:",t);const s=new Zi(this.es.next());return this.referenceDelegate.ji(),n(s).next((t=>this.referenceDelegate.Wi(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}zi(t,e){return Xr.or(Object.values(this.Gi).map((n=>()=>n.containsKey(t,e))))}}class Zi extends Yr{constructor(t){super(),this.currentSequenceNumber=t}}class to{constructor(t){this.persistence=t,this.Hi=new zi,this.Ji=null}static Yi(t){return new to(t)}get Xi(){if(this.Ji)return this.Ji;throw S()}addReference(t,e,n){return this.Hi.addReference(n,e),this.Xi.delete(n.toString()),Xr.resolve()}removeReference(t,e,n){return this.Hi.removeReference(n,e),this.Xi.add(n.toString()),Xr.resolve()}markPotentiallyOrphaned(t,e){return this.Xi.add(e.toString()),Xr.resolve()}removeTarget(t,e){this.Hi.vi(e.targetId).forEach((t=>this.Xi.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Xi.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}ji(){this.Ji=new Set}Wi(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Xr.forEach(this.Xi,(n=>{const s=pt.fromPath(n);return this.Zi(t,s).next((t=>{t||e.removeEntry(s,z.min())}))})).next((()=>(this.Ji=null,e.apply(t))))}updateLimboDocument(t,e){return this.Zi(t,e).next((t=>{t?this.Xi.delete(e.toString()):this.Xi.add(e.toString())}))}Qi(t){return 0}Zi(t,e){return Xr.or([()=>Xr.resolve(this.Hi.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.zi(t,e)])}}function eo(t,e){return`firestore_clients_${t}_${e}`}function no(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}function ro(t,e){return`firestore_targets_${t}_${e}`}class so{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static tr(t,e,n){const s=JSON.parse(n);let i,r="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return r&&s.error&&(r="string"==typeof s.error.message&&"string"==typeof s.error.code,r&&(i=new N(s.error.code,s.error.message))),r?new so(t,e,s.state,i):(T("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}er(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class io{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static tr(t,e){const n=JSON.parse(e);let s,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(s=new N(n.error.code,n.error.message))),i?new io(t,n.state,s):(T("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}er(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class oo{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static tr(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=Rn();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=mt(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new oo(t,i):(T("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class ao{constructor(t,e){this.clientId=t,this.onlineState=e}static tr(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new ao(e.clientId,e.onlineState):(T("SharedClientState",`Failed to parse online state: ${t}`),null)}}class uo{constructor(){this.activeTargetIds=Rn()}nr(t){this.activeTargetIds=this.activeTargetIds.add(t)}sr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}er(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class co{constructor(t,e,n,s,i){this.window=t,this.Yn=e,this.persistenceKey=n,this.ir=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.rr=this.ur.bind(this),this.ar=new Yt(rt),this.started=!1,this.cr=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.hr=eo(this.persistenceKey,this.ir),this.lr=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.ar=this.ar.insert(this.ir,new uo),this.dr=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this._r=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.wr=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.mr=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.gr=function(t){return`firestore_bundle_loaded_v2_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.rr)}static vt(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.Fs();for(const e of t){if(e===this.ir)continue;const t=this.getItem(eo(this.persistenceKey,e));if(t){const n=oo.tr(e,t);n&&(this.ar=this.ar.insert(n.clientId,n))}}this.yr();const e=this.storage.getItem(this.mr);if(e){const t=this.pr(e);t&&this.Ir(t)}for(const t of this.cr)this.ur(t);this.cr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.lr,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Tr(this.ar)}isActiveQueryTarget(t){let e=!1;return this.ar.forEach(((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.Er(t,"pending")}updateMutationState(t,e,n){this.Er(t,e,n),this.Ar(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(ro(this.persistenceKey,t));if(n){const s=io.tr(t,n);s&&(e=s.state)}}return this.Rr.nr(t),this.yr(),e}removeLocalQueryTarget(t){this.Rr.sr(t),this.yr()}isLocalQueryTarget(t){return this.Rr.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(ro(this.persistenceKey,t))}updateQueryState(t,e,n){this.br(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.Ar(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.Pr(t)}notifyBundleLoaded(t){this.Vr(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.rr),this.removeItem(this.hr),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return I("SharedClientState","READ",t,e),e}setItem(t,e){I("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){I("SharedClientState","REMOVE",t),this.storage.removeItem(t)}ur(t){const e=t;if(e.storageArea===this.storage){if(I("SharedClientState","EVENT",e.key,e.newValue),e.key===this.hr)return void T("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Yn.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.dr.test(e.key)){if(null==e.newValue){const t=this.vr(e.key);return this.Sr(t,null)}{const t=this.Dr(e.key,e.newValue);if(t)return this.Sr(t.clientId,t)}}else if(this._r.test(e.key)){if(null!==e.newValue){const t=this.Cr(e.key,e.newValue);if(t)return this.Nr(t)}}else if(this.wr.test(e.key)){if(null!==e.newValue){const t=this.kr(e.key,e.newValue);if(t)return this.Mr(t)}}else if(e.key===this.mr){if(null!==e.newValue){const t=this.pr(e.newValue);if(t)return this.Ir(t)}}else if(e.key===this.lr){const t=function(t){let e=U.A;if(null!=t)try{const n=JSON.parse(t);A("number"==typeof n),e=n}catch(t){T("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==U.A&&this.sequenceNumberHandler(t)}else if(e.key===this.gr){const t=this.Or(e.newValue);await Promise.all(t.map((t=>this.syncEngine.Fr(t))))}}else this.cr.push(e)}))}}get Rr(){return this.ar.get(this.ir)}yr(){this.setItem(this.hr,this.Rr.er())}Er(t,e,n){const s=new so(this.currentUser,t,e,n),i=no(this.persistenceKey,this.currentUser,t);this.setItem(i,s.er())}Ar(t){const e=no(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Pr(t){const e={clientId:this.ir,onlineState:t};this.storage.setItem(this.mr,JSON.stringify(e))}br(t,e,n){const s=ro(this.persistenceKey,t),i=new io(t,e,n);this.setItem(s,i.er())}Vr(t){const e=JSON.stringify(Array.from(t));this.setItem(this.gr,e)}vr(t){const e=this.dr.exec(t);return e?e[1]:null}Dr(t,e){const n=this.vr(t);return oo.tr(n,e)}Cr(t,e){const n=this._r.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return so.tr(new f(i),s,e)}kr(t,e){const n=this.wr.exec(t),s=Number(n[1]);return io.tr(s,e)}pr(t){return ao.tr(t)}Or(t){return JSON.parse(t)}async Nr(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.$r(t.batchId,t.state,t.error);I("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}Mr(t){return this.syncEngine.Br(t.targetId,t.state,t.error)}Sr(t,e){const n=e?this.ar.insert(t,e):this.ar.remove(t),s=this.Tr(this.ar),i=this.Tr(n),r=[],o=[];return i.forEach((t=>{s.has(t)||r.push(t)})),s.forEach((t=>{i.has(t)||o.push(t)})),this.syncEngine.Lr(r,o).then((()=>{this.ar=n}))}Ir(t){this.ar.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Tr(t){let e=Rn();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class ho{constructor(){this.Ur=new uo,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Ur.nr(t),this.qr[t]||"not-current"}updateQueryState(t,e,n){this.qr[t]=e}removeLocalQueryTarget(t){this.Ur.sr(t)}isLocalQueryTarget(t){return this.Ur.activeTargetIds.has(t)}clearQueryState(t){delete this.qr[t]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(t){return this.Ur.activeTargetIds.has(t)}start(){return this.Ur=new uo,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class lo{Kr(t){}shutdown(){}}class fo{constructor(){this.Gr=()=>this.Qr(),this.jr=()=>this.Wr(),this.zr=[],this.Hr()}Kr(t){this.zr.push(t)}shutdown(){window.removeEventListener("online",this.Gr),window.removeEventListener("offline",this.jr)}Hr(){window.addEventListener("online",this.Gr),window.addEventListener("offline",this.jr)}Qr(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.zr)t(0)}Wr(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.zr)t(1)}static vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const go={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class mo{constructor(t){this.Jr=t.Jr,this.Yr=t.Yr}Xr(t){this.Zr=t}eo(t){this.no=t}onMessage(t){this.so=t}close(){this.Yr()}send(t){this.Jr(t)}io(){this.Zr()}ro(t){this.no(t)}oo(t){this.so(t)}}class po extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.uo=e+"://"+t.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}co(t,e,n,s,i){const r=this.ho(t,e);I("RestConnection","Sending: ",r,n);const o={};return this.lo(o,s,i),this.fo(t,r,o,n).then((t=>(I("RestConnection","Received: ",t),t)),(e=>{throw E("RestConnection",`${t} failed with error: `,e,"url: ",r,"request:",n),e}))}_o(t,e,n,s,i){return this.co(t,e,n,s,i)}lo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+m,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}ho(t,e){const n=go[t];return`${this.uo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}fo(t,e,n,s){return new Promise(((i,r)=>{const o=new l.g;o.listenOnce(l.c.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case l.a.NO_ERROR:const e=o.getResponseJson();I("Connection","XHR received:",JSON.stringify(e)),i(e);break;case l.a.TIMEOUT:I("Connection",'RPC "'+t+'" timed out'),r(new N(D.DEADLINE_EXCEEDED,"Request time out"));break;case l.a.HTTP_ERROR:const n=o.getStatus();if(I("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(e)>=0?e:D.UNKNOWN}(t.status);r(new N(e,t.message))}else r(new N(D.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new N(D.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{I("Connection",'RPC "'+t+'" completed.')}}));const u=JSON.stringify(s);o.send(e,"POST",u,n,15)}))}wo(t,e,n){const s=[this.uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Object(l.h)(),r=Object(l.i)(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new l.d({})),this.lo(o.initMessageHeaders,e,n),Object(h.t)()||Object(h.v)()||Object(h.p)()||Object(h.r)()||Object(h.x)()||Object(h.o)()||(o.httpHeadersOverwriteParam="$httpHeaders");const u=s.join("");I("Connection","Creating WebChannel: "+u,o);const a=i.createWebChannel(u,o);let c=!1,d=!1;const f=new mo({Jr:t=>{d?I("Connection","Not sending because WebChannel is closed:",t):(c||(I("Connection","Opening WebChannel transport."),a.open(),c=!0),I("Connection","WebChannel sending:",t),a.send(t))},Yr:()=>a.close()}),m=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return m(a,l.f.EventType.OPEN,(()=>{d||I("Connection","WebChannel transport opened.")})),m(a,l.f.EventType.CLOSE,(()=>{d||(d=!0,I("Connection","WebChannel transport closed"),f.ro())})),m(a,l.f.EventType.ERROR,(t=>{d||(d=!0,E("Connection","WebChannel transport errored:",t),f.ro(new N(D.UNAVAILABLE,"The operation could not be completed")))})),m(a,l.f.EventType.MESSAGE,(t=>{var e;if(!d){const n=t.data[0];A(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){I("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=bn[t];if(void 0!==e)return En(e)}(t),n=i.message;void 0===e&&(e=D.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),d=!0,f.ro(new N(e,n)),a.close()}else I("Connection","WebChannel received:",n),f.oo(n)}})),m(r,l.b.STAT_EVENT,(t=>{t.stat===l.e.PROXY?I("Connection","Detected buffering proxy"):t.stat===l.e.NOPROXY&&I("Connection","Detected no buffering proxy")})),setTimeout((()=>{f.io()}),0),f}}function yo(){return"undefined"!=typeof window?window:null}function wo(){return"undefined"!=typeof document?document:null}function vo(t){return new zn(t,!0)}class bo{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Yn=t,this.timerId=e,this.mo=n,this.yo=s,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(t){this.cancel();const e=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),s=Math.max(0,e-n);s>0&&I("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Io} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.To=this.Yn.enqueueAfterDelay(this.timerId,s,(()=>(this.Eo=Date.now(),t()))),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Io{constructor(t,e,n,s,i,r,o,u){this.Yn=t,this.Vo=n,this.vo=s,this.So=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=u,this.state=0,this.Do=0,this.Co=null,this.xo=null,this.stream=null,this.No=new bo(t,e)}ko(){return 1===this.state||5===this.state||this.Mo()}Mo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.ko()&&await this.close(0)}Fo(){this.state=0,this.No.reset()}$o(){this.Mo()&&null===this.Co&&(this.Co=this.Yn.enqueueAfterDelay(this.Vo,6e4,(()=>this.Bo())))}Lo(t){this.Uo(),this.stream.send(t)}async Bo(){if(this.Mo())return this.close(0)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}qo(){this.xo&&(this.xo.cancel(),this.xo=null)}async close(t,e){this.Uo(),this.qo(),this.No.cancel(),this.Do++,4!==t?this.No.reset():e&&e.code===D.RESOURCE_EXHAUSTED?(T(e.toString()),T("Using maximum backoff delay to prevent overloading the backend."),this.No.Ao()):e&&e.code===D.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Ko(),this.stream.close(),this.stream=null),this.state=t,await this.listener.eo(e)}Ko(){}auth(){this.state=1;const t=this.Go(this.Do),e=this.Do;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Do===e&&this.Qo(t,n)}),(e=>{t((()=>{const t=new N(D.UNKNOWN,"Fetching auth token failed: "+e.message);return this.jo(t)}))}))}Qo(t,e){const n=this.Go(this.Do);this.stream=this.Wo(t,e),this.stream.Xr((()=>{n((()=>(this.state=2,this.xo=this.Yn.enqueueAfterDelay(this.vo,1e4,(()=>(this.Mo()&&(this.state=3),Promise.resolve()))),this.listener.Xr())))})),this.stream.eo((t=>{n((()=>this.jo(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Oo(){this.state=5,this.No.Ro((async()=>{this.state=0,this.start()}))}jo(t){return I("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Go(t){return e=>{this.Yn.enqueueAndForget((()=>this.Do===t?e():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class To extends Io{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r),this.M=i}Wo(t,e){return this.So.wo("Listen",t,e)}onMessage(t){this.No.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:S()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.N?(A(void 0===e||"string"==typeof e),et.fromBase64String(e||"")):(A(void 0===e||e instanceof Uint8Array),et.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(t){const e=void 0===t.code?D.UNKNOWN:En(t.code);return new N(e,t.message||"")}(o);n=new qn(s,i,r,u||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=er(t,s.document.name),r=Yn(s.document.updateTime),o=new Ft({mapValue:{fields:s.document.fields}}),u=Ut.newFoundDocument(i,r,o),a=s.targetIds||[],c=s.removedTargetIds||[];n=new Pn(a,c,u.key,u)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=er(t,s.document),r=s.readTime?Yn(s.readTime):z.min(),o=Ut.newNoDocument(i,r),u=s.removedTargetIds||[];n=new Pn([],u,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=er(t,s.document),r=s.removedTargetIds||[];n=new Pn([],r,i,null)}else{if(!("filter"in e))return S();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new vn(s),r=t.targetId;n=new Fn(r,i)}}return n}(this.M,t),n=function(t){if(!("targetChange"in t))return z.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?z.min():e.readTime?Yn(e.readTime):z.min()}(t);return this.listener.zo(e,n)}Ho(t){const e={};e.database=sr(this.M),e.addTarget=function(t,e){let n;const s=e.target;return n=oe(s)?{documents:lr(t,s)}:{query:dr(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Wn(t,e.resumeToken):e.snapshotVersion.compareTo(z.min())>0&&(n.readTime=Qn(t,e.snapshotVersion.toTimestamp())),n}(this.M,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return S()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.M,t);n&&(e.labels=n),this.Lo(e)}Jo(t){const e={};e.database=sr(this.M),e.removeTarget=t,this.Lo(e)}}class Eo extends Io{constructor(t,e,n,s,i,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,r),this.M=i,this.Yo=!1}get Xo(){return this.Yo}start(){this.Yo=!1,this.lastStreamToken=void 0,super.start()}Ko(){this.Yo&&this.Zo([])}Wo(t,e){return this.So.wo("Write",t,e)}onMessage(t){if(A(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Yo){this.No.reset();const e=function(t,e){return t&&t.length>0?(A(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Yn(t.updateTime):Yn(e);return n.isEqual(z.min())&&(n=Yn(e)),new nn(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Yn(t.commitTime);return this.listener.tu(n,e)}return A(!t.writeResults||0===t.writeResults.length),this.Yo=!0,this.listener.eu()}nu(){const t={};t.database=sr(this.M),this.Lo(t)}Zo(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>ur(this.M,t)))};this.Lo(e)}}class _o extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.So=n,this.M=s,this.su=!1}iu(){if(this.su)throw new N(D.FAILED_PRECONDITION,"The client has already been terminated.")}co(t,e,n){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.So.co(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new N(D.UNKNOWN,t.toString())}))}_o(t,e,n){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.So._o(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new N(D.UNKNOWN,t.toString())}))}terminate(){this.su=!0}}class So{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.ru=0,this.ou=null,this.uu=!0}au(){0===this.ru&&(this.cu("Unknown"),this.ou=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ou=null,this.hu("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve()))))}lu(t){"Online"===this.state?this.cu("Unknown"):(this.ru++,this.ru>=1&&(this.fu(),this.hu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.cu("Offline")))}set(t){this.fu(),this.ru=0,"Online"===t&&(this.uu=!1),this.cu(t)}cu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}hu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.uu?(T(e),this.uu=!1):I("OnlineStateTracker",e)}fu(){null!==this.ou&&(this.ou.cancel(),this.ou=null)}}class Ao{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.du=[],this._u=new Map,this.wu=new Set,this.mu=[],this.gu=i,this.gu.Kr((t=>{n.enqueueAndForget((async()=>{Lo(this)&&(I("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=x(t);e.wu.add(4),await Do(e),e.yu.set("Unknown"),e.wu.delete(4),await xo(e)}(this))}))})),this.yu=new So(n,s)}}async function xo(t){if(Lo(t))for(const e of t.mu)await e(!0)}async function Do(t){for(const e of t.mu)await e(!1)}function No(t,e){const n=x(t);n._u.has(e.targetId)||(n._u.set(e.targetId,e),Ro(n)?Mo(n):Zo(n).Mo()&&ko(n,e))}function Co(t,e){const n=x(t),s=Zo(n);n._u.delete(e),s.Mo()&&Oo(n,e),0===n._u.size&&(s.Mo()?s.$o():Lo(n)&&n.yu.set("Unknown"))}function ko(t,e){t.pu.Z(e.targetId),Zo(t).Ho(e)}function Oo(t,e){t.pu.Z(e),Zo(t).Jo(e)}function Mo(t){t.pu=new jn({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t._u.get(e)||null}),Zo(t).start(),t.yu.au()}function Ro(t){return Lo(t)&&!Zo(t).ko()&&t._u.size>0}function Lo(t){return 0===x(t).wu.size}function Vo(t){t.pu=void 0}async function Po(t){t._u.forEach(((e,n)=>{ko(t,e)}))}async function Fo(t,e){Vo(t),Ro(t)?(t.yu.lu(e),Mo(t)):t.yu.set("Unknown")}async function qo(t,e,n){if(t.yu.set("Online"),e instanceof qn&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t._u.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t._u.delete(s),t.pu.removeTarget(s))}(t,e)}catch(n){I("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Uo(t,n)}else if(e instanceof Pn?t.pu.ut(e):e instanceof Fn?t.pu._t(e):t.pu.ht(e),!n.isEqual(z.min()))try{const e=await Ri(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.pu.yt(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=t._u.get(s);i&&t._u.set(s,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t._u.get(e);if(!n)return;t._u.set(e,n.withResumeToken(et.EMPTY_BYTE_STRING,n.snapshotVersion)),Oo(t,e);const s=new ds(n.target,e,1,n.sequenceNumber);ko(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){I("RemoteStore","Failed to raise snapshot:",e),await Uo(t,e)}}async function Uo(t,e,n){if(!ns(e))throw e;t.wu.add(1),await Do(t),t.yu.set("Offline"),n||(n=()=>Ri(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{I("RemoteStore","Retrying IndexedDB access"),await n(),t.wu.delete(1),await xo(t)}))}function jo(t,e){return e().catch((n=>Uo(t,n,e)))}async function Bo(t){const e=x(t),n=ta(e);let s=e.du.length>0?e.du[e.du.length-1].batchId:-1;for(;Ko(e);)try{const t=await Vi(e.localStore,s);if(null===t){0===e.du.length&&n.$o();break}s=t.batchId,Go(e,t)}catch(t){await Uo(e,t)}$o(e)&&zo(e)}function Ko(t){return Lo(t)&&t.du.length<10}function Go(t,e){t.du.push(e);const n=ta(t);n.Mo()&&n.Xo&&n.Zo(e.mutations)}function $o(t){return Lo(t)&&!ta(t).ko()&&t.du.length>0}function zo(t){ta(t).start()}async function Qo(t){ta(t).nu()}async function Wo(t){const e=ta(t);for(const n of t.du)e.Zo(n.mutations)}async function Ho(t,e,n){const s=t.du.shift(),i=hs.from(s,e,n);await jo(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await Bo(t)}async function Yo(t,e){e&&ta(t).Xo&&await async function(t,e){if(Tn(n=e.code)&&n!==D.ABORTED){const n=t.du.shift();ta(t).Fo(),await jo(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Bo(t)}var n}(t,e),$o(t)&&zo(t)}async function Xo(t,e){const n=x(t);n.asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials");const s=Lo(n);n.wu.add(3),await Do(n),s&&n.yu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.wu.delete(3),await xo(n)}async function Jo(t,e){const n=x(t);e?(n.wu.delete(2),await xo(n)):e||(n.wu.add(2),await Do(n),n.yu.set("Unknown"))}function Zo(t){return t.Iu||(t.Iu=function(t,e,n){const s=x(t);return s.iu(),new To(e,s.So,s.authCredentials,s.appCheckCredentials,s.M,n)}(t.datastore,t.asyncQueue,{Xr:Po.bind(null,t),eo:Fo.bind(null,t),zo:qo.bind(null,t)}),t.mu.push((async e=>{e?(t.Iu.Fo(),Ro(t)?Mo(t):t.yu.set("Unknown")):(await t.Iu.stop(),Vo(t))}))),t.Iu}function ta(t){return t.Tu||(t.Tu=function(t,e,n){const s=x(t);return s.iu(),new Eo(e,s.So,s.authCredentials,s.appCheckCredentials,s.M,n)}(t.datastore,t.asyncQueue,{Xr:Qo.bind(null,t),eo:Yo.bind(null,t),eu:Wo.bind(null,t),tu:Ho.bind(null,t)}),t.mu.push((async e=>{e?(t.Tu.Fo(),await Bo(t)):(await t.Tu.stop(),t.du.length>0&&(I("RemoteStore",`Stopping write stream with ${t.du.length} pending writes`),t.du=[]))}))),t.Tu}class ea{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new C,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n,o=new ea(t,e,r,s,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new N(D.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function na(t,e){if(T("AsyncQueue",`${e}: ${t}`),ns(t))return new N(D.UNAVAILABLE,`${e}: ${t}`);throw t}class ra{constructor(t){this.comparator=t?(e,n)=>t(e,n)||pt.comparator(e.key,n.key):(t,e)=>pt.comparator(t.key,e.key),this.keyedMap=Dn(),this.sortedSet=new Yt(this.comparator)}static emptySet(t){return new ra(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof ra))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new ra;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class sa{constructor(){this.Eu=new Yt(pt.comparator)}track(t){const e=t.doc.key,n=this.Eu.get(e);n?0!==t.type&&3===n.type?this.Eu=this.Eu.insert(e,t):3===t.type&&1!==n.type?this.Eu=this.Eu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Eu=this.Eu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Eu=this.Eu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Eu=this.Eu.remove(e):1===t.type&&2===n.type?this.Eu=this.Eu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Eu=this.Eu.insert(e,{type:2,doc:t.doc}):S():this.Eu=this.Eu.insert(e,t)}Au(){const t=[];return this.Eu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class ia{constructor(t,e,n,s,i,r,o,u){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=u}static fromInitialDocuments(t,e,n,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new ia(t,e,ra.emptySet(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Me(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class oa{constructor(){this.Ru=void 0,this.listeners=[]}}class aa{constructor(){this.queries=new _n((t=>Re(t)),Me),this.onlineState="Unknown",this.bu=new Set}}async function ua(t,e){const n=x(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new oa),i)try{r.Ru=await n.onListen(s)}catch(t){const n=na(t,`Initialization of query '${Le(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.Pu(n.onlineState),r.Ru&&e.Vu(r.Ru)&&da(n)}async function ca(t,e){const n=x(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}function ha(t,e){const n=x(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.Vu(t)&&(s=!0);i.Ru=t}}s&&da(n)}function la(t,e,n){const s=x(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}function da(t){t.bu.forEach((t=>{t.next()}))}class fa{constructor(t,e,n){this.query=t,this.vu=e,this.Su=!1,this.Du=null,this.onlineState="Unknown",this.options=n||{}}Vu(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new ia(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.Su?this.Cu(t)&&(this.vu.next(t),e=!0):this.xu(t,this.onlineState)&&(this.Nu(t),e=!0),this.Du=t,e}onError(t){this.vu.error(t)}Pu(t){this.onlineState=t;let e=!1;return this.Du&&!this.Su&&this.xu(this.Du,t)&&(this.Nu(this.Du),e=!0),e}xu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.ku&&n||t.docs.isEmpty()&&"Offline"!==e)}Cu(t){if(t.docChanges.length>0)return!0;const e=this.Du&&this.Du.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Nu(t){t=ia.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Su=!0,this.vu.next(t)}}class ga{constructor(t,e){this.payload=t,this.byteLength=e}Mu(){return"metadata"in this.payload}}class ma{constructor(t){this.M=t}wi(t){return er(this.M,t)}mi(t){return t.metadata.exists?ar(this.M,t.document,!1):Ut.newNoDocument(this.wi(t.metadata.name),this.gi(t.metadata.readTime))}gi(t){return Yn(t)}}class pa{constructor(t,e,n){this.Ou=t,this.localStore=e,this.M=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=ya(t)}Fu(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.payload.namedQuery)this.queries.push(t.payload.namedQuery);else if(t.payload.documentMetadata){this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e;const n=Y.fromString(t.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}$u(t){const e=new Map,n=new ma(this.M);for(const s of t)if(s.metadata.queries){const t=n.wi(s.metadata.name);for(const n of s.metadata.queries){const s=(e.get(n)||On()).add(t);e.set(n,s)}}return e}async complete(){const t=await async function(t,e,n,s){const i=x(t);let r=On(),o=An();for(const t of n){const n=e.wi(t.metadata.name);t.document&&(r=r.add(n));const s=e.mi(t);s.setReadTime(e.gi(t.metadata.readTime)),o=o.insert(n,s)}const u=i.hi.newChangeBuffer({trackRemovals:!0}),a=await Pi(i,function(t){return ke(Ae(Y.fromString(`__bundle__/docs/${t}`)))}(s));return i.persistence.runTransaction("Apply bundle documents","readwrite",(t=>Li(t,u,o).next((e=>(u.apply(t),e))).next((e=>i.fs.removeMatchingKeysForTargetId(t,a.targetId).next((()=>i.fs.addMatchingKeys(t,r,a.targetId))).next((()=>i.fi.Gs(t,e))).next((()=>e))))))}(this.localStore,new ma(this.M),this.documents,this.Ou.id),e=this.$u(this.documents);for(const t of this.queries)await Ki(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:t}}}function ya(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class wa{constructor(t){this.key=t}}class va{constructor(t){this.key=t}}class ba{constructor(t,e){this.query=t,this.Uu=e,this.qu=null,this.current=!1,this.Ku=On(),this.mutatedKeys=On(),this.Gu=Fe(t),this.Qu=new ra(this.Gu)}get ju(){return this.Uu}Wu(t,e){const n=e?e.zu:new sa,s=e?e.Qu:this.Qu;let i=e?e.mutatedKeys:this.mutatedKeys,r=s,o=!1;const u="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,a="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const c=s.get(t),h=Ve(this.query,e)?e:null,l=!!c&&this.mutatedKeys.has(c.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;c&&h?c.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Hu(c,h)||(n.track({type:2,doc:h}),f=!0,(u&&this.Gu(h,u)>0||a&&this.Gu(h,a)<0)&&(o=!0)):!c&&h?(n.track({type:0,doc:h}),f=!0):c&&!h&&(n.track({type:1,doc:c}),f=!0,(u||a)&&(o=!0)),f&&(h?(r=r.add(h),i=d?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const t="F"===this.query.limitType?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Qu:r,zu:n,ii:o,mutatedKeys:i}}Hu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.Qu;this.Qu=t.Qu,this.mutatedKeys=t.mutatedKeys;const i=t.zu.Au();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return n(t)-n(e)}(t.type,e.type)||this.Gu(t.doc,e.doc))),this.Ju(n);const r=e?this.Yu():[],o=0===this.Ku.size&&this.current?1:0,u=o!==this.qu;return this.qu=o,0!==i.length||u?{snapshot:new ia(this.query,t.Qu,s,i,t.mutatedKeys,0===o,u,!1),Xu:r}:{Xu:r}}Pu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new sa,mutatedKeys:this.mutatedKeys,ii:!1},!1)):{Xu:[]}}Zu(t){return!this.Uu.has(t)&&!!this.Qu.has(t)&&!this.Qu.get(t).hasLocalMutations}Ju(t){t&&(t.addedDocuments.forEach((t=>this.Uu=this.Uu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Uu=this.Uu.delete(t))),this.current=t.current)}Yu(){if(!this.current)return[];const t=this.Ku;this.Ku=On(),this.Qu.forEach((t=>{this.Zu(t.key)&&(this.Ku=this.Ku.add(t.key))}));const e=[];return t.forEach((t=>{this.Ku.has(t)||e.push(new va(t))})),this.Ku.forEach((n=>{t.has(n)||e.push(new wa(n))})),e}ta(t){this.Uu=t._i,this.Ku=On();const e=this.Wu(t.documents);return this.applyChanges(e,!0)}ea(){return ia.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.qu)}}class Ia{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Ta{constructor(t){this.key=t,this.na=!1}}class Ea{constructor(t,e,n,s,i,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.sa={},this.ia=new _n((t=>Re(t)),Me),this.ra=new Map,this.oa=new Set,this.ua=new Yt(pt.comparator),this.aa=new Map,this.ca=new zi,this.ha={},this.la=new Map,this.fa=br.yn(),this.onlineState="Unknown",this.da=void 0}get isPrimaryClient(){return!0===this.da}}async function _a(t,e){const n=Ya(t);let s,i;const r=n.ia.get(e);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.ea();else{const t=await Pi(n.localStore,ke(e));n.isPrimaryClient&&No(n.remoteStore,t);const r=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,i=await Sa(n,e,s,"current"===r)}return i}async function Sa(t,e,n,s){t._a=(e,n,s)=>async function(t,e,n,s){let i=e.view.Wu(n);i.ii&&(i=await qi(t.localStore,e.query,!1).then((({documents:t})=>e.view.Wu(t,i))));const r=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,r);return Va(t,e.targetId,o.Xu),o.snapshot}(t,e,n,s);const i=await qi(t.localStore,e,!0),r=new ba(e,i._i),o=r.Wu(i.documents),u=Vn.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState),a=r.applyChanges(o,t.isPrimaryClient,u);Va(t,n,a.Xu);const c=new Ia(e,n,r);return t.ia.set(e,c),t.ra.has(n)?t.ra.get(n).push(e):t.ra.set(n,[e]),a.snapshot}async function Aa(t,e){const n=x(t),s=n.ia.get(e),i=n.ra.get(s.targetId);if(i.length>1)return n.ra.set(s.targetId,i.filter((t=>!Me(t,e)))),void n.ia.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Fi(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),Co(n.remoteStore,s.targetId),Ra(n,s.targetId)})).catch(ii)):(Ra(n,s.targetId),await Fi(n.localStore,s.targetId,!0))}async function xa(t,e){const n=x(t);try{const t=await function(t,e){const n=x(t),s=e.snapshotVersion;let i=n.ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.hi.newChangeBuffer({trackRemovals:!0});i=n.ui;const o=[];e.targetChanges.forEach(((r,u)=>{const a=i.get(u);if(!a)return;o.push(n.fs.removeMatchingKeys(t,r.removedDocuments,u).next((()=>n.fs.addMatchingKeys(t,r.addedDocuments,u))));let c=a.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(u)?c=c.withResumeToken(et.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):r.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(r.resumeToken,s)),i=i.insert(u,c),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,r)&&o.push(n.fs.updateTargetData(t,c))}));let u=An();if(e.documentUpdates.forEach((s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(Li(t,r,e.documentUpdates).next((t=>{u=t}))),!s.isEqual(z.min())){const e=n.fs.getLastRemoteSnapshotVersion(t).next((e=>n.fs.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return Xr.waitFor(o).next((()=>r.apply(t))).next((()=>n.fi.Gs(t,u))).next((()=>u))})).then((t=>(n.ui=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.aa.get(e);s&&(A(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.na=!0:t.modifiedDocuments.size>0?A(s.na):t.removedDocuments.size>0&&(A(s.na),s.na=!1))})),await qa(n,t,e)}catch(t){await ii(t)}}function Da(t,e,n){const s=x(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.ia.forEach(((n,s)=>{const i=s.view.Pu(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=x(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Pu(e)&&(s=!0)})),s&&da(n)}(s.eventManager,e),t.length&&s.sa.zo(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function Na(t,e,n){const s=x(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.aa.get(e),r=i&&i.key;if(r){let t=new Yt(pt.comparator);t=t.insert(r,Ut.newNoDocument(r,z.min()));const n=On().add(r),i=new Ln(z.min(),new Map,new Zt(rt),t,n);await xa(s,i),s.ua=s.ua.remove(r),s.aa.delete(e),Fa(s)}else await Fi(s.localStore,e,!1).then((()=>Ra(s,e,n))).catch(ii)}async function Ca(t,e){const n=x(t),s=e.batch.batchId;try{const t=await function(t,e){const n=x(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),i=n.hi.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=Xr.resolve();return r.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);A(null!==r),e.version.compareTo(r)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),s.addEntry(e)))}))})),o.next((()=>t.Bs.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.Bs.performConsistencyCheck(t))).next((()=>n.fi.Ks(t,s)))}))}(n.localStore,e);Ma(n,s,null),Oa(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await qa(n,t)}catch(t){await ii(t)}}async function ka(t,e,n){const s=x(t);try{const t=await function(t,e){const n=x(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.Bs.lookupMutationBatch(t,e).next((e=>(A(null!==e),s=e.keys(),n.Bs.removeMutationBatch(t,e)))).next((()=>n.Bs.performConsistencyCheck(t))).next((()=>n.fi.Ks(t,s)))}))}(s.localStore,e);Ma(s,e,n),Oa(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await qa(s,t)}catch(n){await ii(n)}}function Oa(t,e){(t.la.get(e)||[]).forEach((t=>{t.resolve()})),t.la.delete(e)}function Ma(t,e,n){const s=x(t);let i=s.ha[s.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.ha[s.currentUser.toKey()]=i}}function Ra(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.ra.get(e))t.ia.delete(s),n&&t.sa.wa(s,n);t.ra.delete(e),t.isPrimaryClient&&t.ca.vi(e).forEach((e=>{t.ca.containsKey(e)||La(t,e)}))}function La(t,e){t.oa.delete(e.path.canonicalString());const n=t.ua.get(e);null!==n&&(Co(t.remoteStore,n),t.ua=t.ua.remove(e),t.aa.delete(n),Fa(t))}function Va(t,e,n){for(const s of n)s instanceof wa?(t.ca.addReference(s.key,e),Pa(t,s)):s instanceof va?(I("SyncEngine","Document no longer in limbo: "+s.key),t.ca.removeReference(s.key,e),t.ca.containsKey(s.key)||La(t,s.key)):S()}function Pa(t,e){const n=e.key,s=n.path.canonicalString();t.ua.get(n)||t.oa.has(s)||(I("SyncEngine","New document in limbo: "+n),t.oa.add(s),Fa(t))}function Fa(t){for(;t.oa.size>0&&t.ua.size<t.maxConcurrentLimboResolutions;){const e=t.oa.values().next().value;t.oa.delete(e);const n=new pt(Y.fromString(e)),s=t.fa.next();t.aa.set(s,new Ta(n)),t.ua=t.ua.insert(n,s),No(t.remoteStore,new ds(ke(Ae(n.path)),s,2,U.A))}}async function qa(t,e,n){const s=x(t),i=[],r=[],o=[];s.ia.isEmpty()||(s.ia.forEach(((t,u)=>{o.push(s._a(u,e,n).then((t=>{if(t){s.isPrimaryClient&&s.sharedClientState.updateQueryState(u.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=Ni.Ys(u.targetId,t);r.push(e)}})))})),await Promise.all(o),s.sa.zo(i),await async function(t,e){const n=x(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Xr.forEach(e,(e=>Xr.forEach(e.Hs,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>Xr.forEach(e.Js,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!ns(t))throw t;I("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ui.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.ui=n.ui.insert(e,i)}}}(s.localStore,r))}async function Ua(t,e){const n=x(t);if(!n.currentUser.isEqual(e)){I("SyncEngine","User change. New user:",e.toKey());const t=await Mi(n.localStore,e);n.currentUser=e,function(t,e){t.la.forEach((t=>{t.forEach((t=>{t.reject(new N(D.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.la.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await qa(n,t.di)}}function ja(t,e){const n=x(t),s=n.aa.get(e);if(s&&s.na)return On().add(s.key);{let t=On();const s=n.ra.get(e);if(!s)return t;for(const e of s){const s=n.ia.get(e);t=t.unionWith(s.view.ju)}return t}}async function Ba(t,e){const n=x(t),s=await qi(n.localStore,e.query,!0),i=e.view.ta(s);return n.isPrimaryClient&&Va(n,e.targetId,i.Xu),i}async function Ka(t,e){const n=x(t);return ji(n.localStore,e).then((t=>qa(n,t)))}async function Ga(t,e,n,s){const i=x(t),r=await function(t,e){const n=x(t),s=x(n.Bs);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>s.fn(t,e).next((e=>e?n.fi.Ks(t,e):Xr.resolve(null)))))}(i.localStore,e);null!==r?("pending"===n?await Bo(i.remoteStore):"acknowledged"===n||"rejected"===n?(Ma(i,e,s||null),Oa(i,e),function(t,e){x(x(t).Bs)._n(e)}(i.localStore,e)):S(),await qa(i,r)):I("SyncEngine","Cannot apply mutation batch with id: "+e)}async function $a(t,e,n){const s=x(t),i=[],r=[];for(const t of e){let e;const n=s.ra.get(t);if(n&&0!==n.length){e=await Pi(s.localStore,ke(n[0]));for(const t of n){const e=s.ia.get(t),n=await Ba(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await Ui(s.localStore,t);e=await Pi(s.localStore,n),await Sa(s,za(n),t,!1)}i.push(e)}return s.sa.zo(r),i}function za(t){return Se(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Qa(t){const e=x(t);return x(x(e.localStore).persistence).Fs()}async function Wa(t,e,n,s){const i=x(t);if(i.da)return void I("SyncEngine","Ignoring unexpected query state notification.");const r=i.ra.get(e);if(r&&r.length>0)switch(n){case"current":case"not-current":{const t=await ji(i.localStore,Pe(r[0])),s=Ln.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);await qa(i,t,s);break}case"rejected":await Fi(i.localStore,e,!0),Ra(i,e,s);break;default:S()}}async function Ha(t,e,n){const s=Ya(t);if(s.da){for(const t of e){if(s.ra.has(t)){I("SyncEngine","Adding an already active target "+t);continue}const e=await Ui(s.localStore,t),n=await Pi(s.localStore,e);await Sa(s,za(e),n.targetId,!1),No(s.remoteStore,n)}for(const t of n)s.ra.has(t)&&await Fi(s.localStore,t,!1).then((()=>{Co(s.remoteStore,t),Ra(s,t)})).catch(ii)}}function Ya(t){const e=x(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=xa.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ja.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Na.bind(null,e),e.sa.zo=ha.bind(null,e.eventManager),e.sa.wa=la.bind(null,e.eventManager),e}function Xa(t){const e=x(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ca.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ka.bind(null,e),e}class Ja{constructor(){this.synchronizeTabs=!1}async initialize(t){this.M=vo(t.databaseInfo.databaseId),this.sharedClientState=this.ga(t),this.persistence=this.ya(t),await this.persistence.start(),this.gcScheduler=this.pa(t),this.localStore=this.Ia(t)}pa(t){return null}Ia(t){return Oi(this.persistence,new Ci,t.initialUser,this.M)}ya(t){return new Ji(to.Yi,this.M)}ga(t){return new ho}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Za extends Ja{constructor(t,e,n){super(),this.Ta=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.Ta.initialize(this,t),await Xa(this.Ta.syncEngine),await Bo(this.Ta.remoteStore),await this.persistence.Ts((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve())))}Ia(t){return Oi(this.persistence,new Ci,t.initialUser,this.M)}pa(t){const e=this.persistence.referenceDelegate.garbageCollector;return new ui(e,t.asyncQueue)}ya(t){const e=xi(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Qs.withCacheSize(this.cacheSizeBytes):Qs.DEFAULT;return new _i(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,yo(),wo(),this.M,this.sharedClientState,!!this.forceOwnership)}ga(t){return new ho}}class tu extends Za{constructor(t,e){super(t,e,!1),this.Ta=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.Ta.syncEngine;this.sharedClientState instanceof co&&(this.sharedClientState.syncEngine={$r:Ga.bind(null,e),Br:Wa.bind(null,e),Lr:Ha.bind(null,e),Fs:Qa.bind(null,e),Fr:Ka.bind(null,e)},await this.sharedClientState.start()),await this.persistence.Ts((async t=>{await async function(t,e){const n=x(t);if(Ya(n),Xa(n),!0===e&&!0!==n.da){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await $a(n,t.toArray());n.da=!0,await Jo(n.remoteStore,!0);for(const t of e)No(n.remoteStore,t)}else if(!1===e&&!1!==n.da){const t=[];let e=Promise.resolve();n.ra.forEach(((s,i)=>{n.sharedClientState.isLocalQueryTarget(i)?t.push(i):e=e.then((()=>(Ra(n,i),Fi(n.localStore,i,!0)))),Co(n.remoteStore,i)})),await e,await $a(n,t),function(t){const e=x(t);e.aa.forEach(((t,n)=>{Co(e.remoteStore,n)})),e.ca.Si(),e.aa=new Map,e.ua=new Yt(pt.comparator)}(n),n.da=!1,await Jo(n.remoteStore,!1)}}(this.Ta.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop())}))}ga(t){const e=yo();if(!co.vt(e))throw new N(D.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=xi(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new co(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class eu{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Da(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ua.bind(null,this.syncEngine),await Jo(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new aa}createDatastore(t){const e=vo(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new po(s));var s;return function(t,e,n,s){return new _o(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,s=t.asyncQueue,i=t=>Da(this.syncEngine,t,0),r=fo.vt()?new fo:new lo,new Ao(e,n,s,i,r);var e,n,s,i,r}createSyncEngine(t,e){return function(t,e,n,s,i,r,o){const u=new Ea(t,e,n,s,i,r);return o&&(u.da=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=x(t);I("RemoteStore","RemoteStore shutting down."),e.wu.add(5),await Do(e),e.gu.shutdown(),e.yu.set("Unknown")}(this.remoteStore)}}function nu(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const s={value:t.slice(n,n+e),done:!1};return n+=e,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class ru{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ea(this.observer.next,t)}error(t){this.observer.error?this.Ea(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Aa(){this.muted=!0}Ea(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class su{constructor(t,e){this.Ra=t,this.M=e,this.metadata=new C,this.buffer=new Uint8Array,this.ba=new TextDecoder("utf-8"),this.Pa().then((t=>{t&&t.Mu()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Ra.cancel()}async getMetadata(){return this.metadata.promise}async ma(){return await this.getMetadata(),this.Pa()}async Pa(){const t=await this.Va();if(null===t)return null;const e=this.ba.decode(t),n=Number(e);isNaN(n)&&this.va(`length string (${e}) is not valid number`);const s=await this.Sa(n);return new ga(JSON.parse(s),t.length+n)}Da(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async Va(){for(;this.Da()<0&&!await this.Ca(););if(0===this.buffer.length)return null;const t=this.Da();t<0&&this.va("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async Sa(t){for(;this.buffer.length<t;)await this.Ca()&&this.va("Reached the end of bundle when more is expected.");const e=this.ba.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}va(t){throw this.Ra.cancel(),new Error(`Invalid bundle format: ${t}`)}async Ca(){const t=await this.Ra.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class iu{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new N(D.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=x(t),s=sr(n.M)+"/documents",i={documents:e.map((t=>Zn(n.M,t)))},r=await n._o("BatchGetDocuments",s,i),o=new Map;r.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){A(!!e.found),e.found.name,e.found.updateTime;const n=er(t,e.found.name),s=Yn(e.found.updateTime),i=new Ft({mapValue:{fields:e.found.fields}});return Ut.newFoundDocument(n,s,i)}(t,e):"missing"in e?function(t,e){A(!!e.missing),A(!!e.readTime);const n=er(t,e.missing),s=Yn(e.readTime);return Ut.newNoDocument(n,s)}(t,e):S()}(n.M,t);o.set(e.key.toString(),e)}));const u=[];return e.forEach((t=>{const e=o.get(t.toString());A(!!e),u.push(e)})),u}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new yn(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=pt.fromPath(e);this.mutations.push(new wn(n,this.precondition(n)))})),await async function(t,e){const n=x(t),s=sr(n.M)+"/documents",i={writes:e.map((t=>ur(n.M,t)))};await n.co("Commit",s,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw S();e=z.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new N(D.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?rn.updateTime(e):rn.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(z.min()))throw new N(D.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rn.updateTime(e)}return rn.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class ou{constructor(t,e,n,s,i){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=s,this.deferred=i,this.xa=n.maxAttempts,this.No=new bo(this.asyncQueue,"transaction_retry")}run(){this.xa-=1,this.Na()}Na(){this.No.Ro((async()=>{const t=new iu(this.datastore),e=this.ka(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.Ma(t)}))))})).catch((t=>{this.Ma(t)}))}))}ka(t){try{const e=this.updateFunction(t);return!ft(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Ma(t){this.xa>0&&this.Oa(t)?(this.xa-=1,this.asyncQueue.enqueueAndForget((()=>(this.Na(),Promise.resolve())))):this.deferred.reject(t)}Oa(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!Tn(e)}return!1}}class au{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=f.UNAUTHENTICATED,this.clientId=B.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{I("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(I("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new N(D.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new C;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=na(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function uu(t,e){t.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await Mi(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function cu(t,e){t.asyncQueue.verifyOperationInProgress();const n=await hu(t);I("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>Xo(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Xo(e.remoteStore,n))),t.onlineComponents=e}async function hu(t){return t.offlineComponents||(I("FirestoreClient","Using default OfflineComponentProvider"),await uu(t,new Ja)),t.offlineComponents}async function lu(t){return t.onlineComponents||(I("FirestoreClient","Using default OnlineComponentProvider"),await cu(t,new eu)),t.onlineComponents}function du(t){return hu(t).then((t=>t.persistence))}function fu(t){return hu(t).then((t=>t.localStore))}function gu(t){return lu(t).then((t=>t.remoteStore))}function mu(t){return lu(t).then((t=>t.syncEngine))}async function pu(t){const e=await lu(t),n=e.eventManager;return n.onListen=_a.bind(null,e.syncEngine),n.onUnlisten=Aa.bind(null,e.syncEngine),n}function yu(t,e,n={}){const s=new C;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new ru({next:r=>{e.enqueueAndForget((()=>ca(t,o)));const u=r.docs.has(n);!u&&r.fromCache?i.reject(new N(D.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&r.fromCache&&s&&"server"===s.source?i.reject(new N(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new fa(Ae(n.path),r,{includeMetadataChanges:!0,ku:!0});return ua(t,o)}(await pu(t),t.asyncQueue,e,n,s))),s.promise}function wu(t,e,n={}){const s=new C;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new ru({next:n=>{e.enqueueAndForget((()=>ca(t,o))),n.fromCache&&"server"===s.source?i.reject(new N(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new fa(n,r,{includeMetadataChanges:!0,ku:!0});return ua(t,o)}(await pu(t),t.asyncQueue,e,n,s))),s.promise}function vu(t,e,n,s){const i=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new su(t,e)}(function(t,e){if(t instanceof Uint8Array)return nu(t,e);if(t instanceof ArrayBuffer)return nu(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,vo(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const s=x(t);(async function(t,e,n){try{const s=await e.getMetadata();if(await function(t,e){const n=x(t),s=Yn(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n._s.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(s)>=0))}(t.localStore,s))return await e.close(),n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(s)),Promise.resolve(new Set);n._updateProgress(ya(s));const i=new pa(s,t.localStore,e.M);let r=await e.ma();for(;r;){const t=await i.Fu(r);t&&n._updateProgress(t),r=await e.ma()}const o=await i.complete();return await qa(t,o.Lu,void 0),await function(t,e){const n=x(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n._s.saveBundleMetadata(t,e)))}(t.localStore,s),n._completeWith(o.progress),Promise.resolve(o.Bu)}catch(t){return E("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t),Promise.resolve(new Set)}})(s,e,n).then((t=>{s.sharedClientState.notifyBundleLoaded(t)}))}(await mu(t),i,s)}))}const bu=new Map;function Iu(t,e,n){if(!n)throw new N(D.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Tu(t,e,n,s){if(!0===e&&!0===s)throw new N(D.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Eu(t){if(!pt.isDocumentKey(t))throw new N(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function _u(t){if(pt.isDocumentKey(t))throw new N(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Su(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":S()}function Au(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new N(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Su(t);throw new N(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function xu(t,e){if(e<=0)throw new N(D.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class Du{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new N(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new N(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Tu("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Nu{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Du({}),this._settingsFrozen=!1,t instanceof lt?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new N(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new lt(t.options.projectId)}(t))}get app(){if(!this._app)throw new N(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new N(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Du(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new O;switch(t.type){case"gapi":const e=t.client;return A(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new V(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new N(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=bu.get(t);e&&(I("ComponentProvider","Removing Datastore"),bu.delete(t),e.terminate())}(this),Promise.resolve()}}function Cu(t,e,n,s={}){var i;const r=(t=Au(t,Nu))._getSettings();if("firestore.googleapis.com"!==r.host&&r.host!==e&&E("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${n}`,ssl:!1})),s.mockUserToken){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=f.MOCK_USER;else{e=Object(h.g)(s.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new N(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new f(r)}t._authCredentials=new M(new k(e,n))}}class ku{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mu(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ku(this.firestore,t,this._key)}}class Ou{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Ou(this.firestore,t,this._query)}}class Mu extends Ou{constructor(t,e,n){super(t,e,Ae(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ku(this.firestore,null,new pt(t))}withConverter(t){return new Mu(this.firestore,t,this._path)}}function Ru(t,e,...n){if(t=Object(h.l)(t),Iu("collection","path",e),t instanceof Nu){const s=Y.fromString(e,...n);return _u(s),new Mu(t,null,s)}{if(!(t instanceof ku||t instanceof Mu))throw new N(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Y.fromString(e,...n));return _u(s),new Mu(t.firestore,null,s)}}function Lu(t,e){if(t=Au(t,Nu),Iu("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new N(D.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ou(t,null,function(t){return new _e(Y.emptyPath(),t)}(e))}function Vu(t,e,...n){if(t=Object(h.l)(t),1===arguments.length&&(e=B.R()),Iu("doc","path",e),t instanceof Nu){const s=Y.fromString(e,...n);return Eu(s),new ku(t,null,new pt(s))}{if(!(t instanceof ku||t instanceof Mu))throw new N(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Y.fromString(e,...n));return Eu(s),new ku(t.firestore,t instanceof Mu?t.converter:null,new pt(s))}}function Pu(t,e){return t=Object(h.l)(t),e=Object(h.l)(e),(t instanceof ku||t instanceof Mu)&&(e instanceof ku||e instanceof Mu)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Fu(t,e){return t=Object(h.l)(t),e=Object(h.l)(e),t instanceof Ou&&e instanceof Ou&&t.firestore===e.firestore&&Me(t._query,e._query)&&t.converter===e.converter}class qu{constructor(){this.Fa=Promise.resolve(),this.$a=[],this.Ba=!1,this.La=[],this.Ua=null,this.qa=!1,this.Ka=!1,this.Ga=[],this.No=new bo(this,"async_queue_retry"),this.Qa=()=>{const t=wo();t&&I("AsyncQueue","Visibility state changed to "+t.visibilityState),this.No.Po()};const t=wo();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Qa)}get isShuttingDown(){return this.Ba}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.ja(),this.Wa(t)}enterRestrictedMode(t){if(!this.Ba){this.Ba=!0,this.Ka=t||!1;const e=wo();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Qa)}}enqueue(t){if(this.ja(),this.Ba)return new Promise((()=>{}));const e=new C;return this.Wa((()=>this.Ba&&this.Ka?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.$a.push(t),this.za())))}async za(){if(0!==this.$a.length){try{await this.$a[0](),this.$a.shift(),this.No.reset()}catch(t){if(!ns(t))throw t;I("AsyncQueue","Operation failed with retryable error: "+t)}this.$a.length>0&&this.No.Ro((()=>this.za()))}}Wa(t){const e=this.Fa.then((()=>(this.qa=!0,t().catch((t=>{this.Ua=t,this.qa=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw T("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.qa=!1,t))))));return this.Fa=e,e}enqueueAfterDelay(t,e,n){this.ja(),this.Ga.indexOf(t)>-1&&(e=0);const s=ea.createAndSchedule(this,t,e,n,(t=>this.Ha(t)));return this.La.push(s),s}ja(){this.Ua&&S()}verifyOperationInProgress(){}async Ja(){let t;do{t=this.Fa,await t}while(t!==this.Fa)}Ya(t){for(const e of this.La)if(e.timerId===t)return!0;return!1}Xa(t){return this.Ja().then((()=>{this.La.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.La)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Ja()}))}Za(t){this.Ga.push(t)}Ha(t){const e=this.La.indexOf(t);this.La.splice(e,1)}}function Uu(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class ju{constructor(){this._progressObserver={},this._taskCompletionResolver=new C,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const Bu=-1;class Ku extends Nu{constructor(t,e,n){super(t,e,n),this.type="firestore",this._queue=new qu,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||$u(this),this._firestoreClient.terminate()}}function Gu(t){return t._firestoreClient||$u(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function $u(t){var e;const n=t._freezeSettings(),s=function(t,e,n,s){return new ht(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new au(t._authCredentials,t._appCheckCredentials,t._queue,s)}function zu(t,e){ec(t=Au(t,Ku));const n=Gu(t),s=t._freezeSettings(),i=new eu;return Wu(n,i,new Za(i,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function Qu(t){ec(t=Au(t,Ku));const e=Gu(t),n=t._freezeSettings(),s=new eu;return Wu(e,s,new tu(s,n.cacheSizeBytes))}function Wu(t,e,n){const s=new C;return t.asyncQueue.enqueue((async()=>{try{await uu(t,n),await cu(t,e),s.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===D.FAILED_PRECONDITION||t.code===D.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),s.reject(t)}})).then((()=>s.promise))}function Hu(t){if(t._initialized&&!t._terminated)throw new N(D.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new C;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!Zr.vt())return Promise.resolve();const e=t+"main";await Zr.delete(e)}(xi(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Yu(t){return function(t){const e=new C;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=x(t);Lo(n.remoteStore)||I("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=x(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.Bs.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const s=n.la.get(t)||[];s.push(e),n.la.set(t,s)}catch(t){const n=na(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await mu(t),e))),e.promise}(Gu(t=Au(t,Ku)))}function Xu(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await du(t),n=await gu(t);return e.setNetworkEnabled(!0),function(t){const e=x(t);return e.wu.delete(0),xo(e)}(n)}))}(Gu(t=Au(t,Ku)))}function Ju(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await du(t),n=await gu(t);return e.setNetworkEnabled(!1),async function(t){const e=x(t);e.wu.add(0),await Do(e),e.yu.set("Offline")}(n)}))}(Gu(t=Au(t,Ku)))}function Zu(t,e){const n=Gu(t=Au(t,Ku)),s=new ju;return vu(n,t._databaseId,e,s),s}function tc(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=x(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n._s.getNamedQuery(t,e)))}(await fu(t),e)))}(Gu(t=Au(t,Ku)),e).then((e=>e?new Ou(t,null,e.query):null))}function ec(t){if(t._initialized||t._terminated)throw new N(D.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class nc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new N(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new J(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class rc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new rc(et.fromBase64String(t))}catch(t){throw new N(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new rc(et.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class sc{constructor(t){this._methodName=t}}class ic{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new N(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new N(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return rt(this._lat,t._lat)||rt(this._long,t._long)}}const oc=/^__.*__$/;class ac{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new fn(t,this.data,this.fieldMask,e,this.fieldTransforms):new dn(t,this.data,e,this.fieldTransforms)}}class uc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new fn(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function cc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}class hc{constructor(t,e,n,s,i,r){this.settings=t,this.databaseId=e,this.M=n,this.ignoreUndefinedProperties=s,void 0===i&&this.tc(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get ec(){return this.settings.ec}nc(t){return new hc(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.M,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}sc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.nc({path:n,ic:!1});return s.rc(t),s}oc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.nc({path:n,ic:!1});return s.tc(),s}uc(t){return this.nc({path:void 0,ic:!0})}ac(t){return Nc(t,this.settings.methodName,this.settings.cc||!1,this.path,this.settings.hc)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}tc(){if(this.path)for(let t=0;t<this.path.length;t++)this.rc(this.path.get(t))}rc(t){if(0===t.length)throw this.ac("Document fields must not be empty");if(cc(this.ec)&&oc.test(t))throw this.ac('Document fields cannot begin and end with "__"')}}class lc{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.M=n||vo(t)}lc(t,e,n,s=!1){return new hc({ec:t,methodName:e,hc:n,path:J.emptyPath(),ic:!1,cc:s},this.databaseId,this.M,this.ignoreUndefinedProperties)}}function th(t){const e=t._freezeSettings(),n=vo(t._databaseId);return new lc(t._databaseId,!!e.ignoreUndefinedProperties,n)}function dc(t,e,n,s,i,r={}){const o=t.lc(r.merge||r.mergeFields?2:0,e,n,i);Sc("Data must be an object, but it was:",o,s);const u=Ec(s,o);let a,c;if(r.merge)a=new Z(o.fieldMask),c=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=Ac(e,s,n);if(!o.contains(i))throw new N(D.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Cc(t,i)||t.push(i)}a=new Z(t),c=o.fieldTransforms.filter((t=>a.covers(t.field)))}else a=null,c=o.fieldTransforms;return new ac(new Ft(u),a,c)}class fc extends sc{_toFieldTransform(t){if(2!==t.ec)throw 1===t.ec?t.ac(`${this._methodName}() can only appear at the top level of your update data`):t.ac(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof fc}}function gc(t,e,n){return new hc({ec:3,hc:e.settings.hc,methodName:t._methodName,ic:n},e.databaseId,e.M,e.ignoreUndefinedProperties)}class mc extends sc{_toFieldTransform(t){return new en(t.path,new Qe)}isEqual(t){return t instanceof mc}}class pc extends sc{constructor(t,e){super(t),this.fc=e}_toFieldTransform(t){const e=gc(this,t,!0),n=this.fc.map((t=>Tc(t,e))),s=new We(n);return new en(t.path,s)}isEqual(t){return this===t}}class yc extends sc{constructor(t,e){super(t),this.fc=e}_toFieldTransform(t){const e=gc(this,t,!0),n=this.fc.map((t=>Tc(t,e))),s=new Ye(n);return new en(t.path,s)}isEqual(t){return this===t}}class wc extends sc{constructor(t,e){super(t),this.dc=e}_toFieldTransform(t){const e=new Je(t.M,Be(t.M,this.dc));return new en(t.path,e)}isEqual(t){return this===t}}function vc(t,e,n,s){const i=t.lc(1,e,n);Sc("Data must be an object, but it was:",i,s);const r=[],o=Ft.empty();W(s,((t,s)=>{const u=Dc(e,t,n);s=Object(h.l)(s);const a=i.oc(u);if(s instanceof fc)r.push(u);else{const t=Tc(s,a);null!=t&&(r.push(u),o.set(u,t))}}));const u=new Z(r);return new uc(o,u,i.fieldTransforms)}function bc(t,e,n,s,i,r){const o=t.lc(1,e,n),u=[Ac(e,s,n)],a=[i];if(r.length%2!=0)throw new N(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)u.push(Ac(e,r[t])),a.push(r[t+1]);const c=[],l=Ft.empty();for(let t=u.length-1;t>=0;--t)if(!Cc(c,u[t])){const e=u[t];let n=a[t];n=Object(h.l)(n);const s=o.oc(e);if(n instanceof fc)c.push(e);else{const t=Tc(n,s);null!=t&&(c.push(e),l.set(e,t))}}const d=new Z(c);return new uc(l,d,o.fieldTransforms)}function Ic(t,e,n,s=!1){return Tc(n,t.lc(s?4:3,e))}function Tc(t,e){if(_c(t=Object(h.l)(t)))return Sc("Unsupported field value:",e,t),Ec(t,e);if(t instanceof sc)return function(t,e){if(!cc(e.ec))throw e.ac(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.ac(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.ic&&4!==e.ec)throw e.ac("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=Tc(i,e.uc(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(h.l)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Be(e.M,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=$.fromDate(t);return{timestampValue:Qn(e.M,n)}}if(t instanceof $){const n=new $(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Qn(e.M,n)}}if(t instanceof ic)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof rc)return{bytesValue:Wn(e.M,t._byteString)};if(t instanceof ku){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.ac(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Xn(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.ac(`Unsupported field value: ${Su(t)}`)}(t,e)}function Ec(t,e){const n={};return H(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):W(t,((t,s)=>{const i=Tc(s,e.sc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function _c(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof $||t instanceof ic||t instanceof rc||t instanceof ku||t instanceof sc)}function Sc(t,e,n){if(!_c(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=Su(n);throw"an object"===s?e.ac(t+" a custom object"):e.ac(t+" "+s)}}function Ac(t,e,n){if((e=Object(h.l)(e))instanceof nc)return e._internalPath;if("string"==typeof e)return Dc(t,e);throw Nc("Field path arguments must be of type string or ",t,!1,void 0,n)}const xc=new RegExp("[~\\*/\\[\\]]");function Dc(t,e,n){if(e.search(xc)>=0)throw Nc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new nc(...e.split("."))._internalPath}catch(r){throw Nc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Nc(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let u=`Function ${e}() called with invalid data`;n&&(u+=" (via `toFirestore()`)"),u+=". ";let a="";return(r||o)&&(a+=" (found",r&&(a+=` in field ${s}`),o&&(a+=` in document ${i}`),a+=")"),new N(D.INVALID_ARGUMENT,u+t+a)}function Cc(t,e){return t.some((t=>t.isEqual(e)))}class kc{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ku(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Oc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Mc("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Oc extends kc{data(){return super.data()}}function Mc(t,e){return"string"==typeof e?Dc(t,e):e instanceof nc?e._internalPath:e._delegate._internalPath}class Rc{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Lc extends kc{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Vc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Mc("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Vc extends Lc{data(t={}){return super.data(t)}}class Pc{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Rc(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Vc(this._firestore,this._userDataWriter,n.key,n,new Rc(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new N(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new Vc(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Rc(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Vc(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Rc(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Fc(e.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Fc(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function qc(t,e){return t instanceof Lc&&e instanceof Lc?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Pc&&e instanceof Pc&&t._firestore===e._firestore&&Fu(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Uc(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new N(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class jc{}function Bc(t,...e){for(const n of e)t=n._apply(t);return t}class Kc extends jc{constructor(t,e,n){super(),this._c=t,this.wc=e,this.mc=n,this.type="where"}_apply(t){const e=th(t.firestore),n=function(t,e,n,s,i,r,o){let u;if(i.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new N(D.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){ih(o,r);const e=[];for(const n of o)e.push(sh(s,t,n));u={arrayValue:{values:e}}}else u=sh(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||ih(o,r),u=Ic(n,"where",o,"in"===r||"not-in"===r);const a=he.create(i,r,u);return function(t,e){if(e.S()){const n=De(t);if(null!==n&&!n.isEqual(e.field))throw new N(D.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=xe(t);null!==s&&oh(t,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new N(D.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new N(D.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,a),a}(t._query,0,e,t.firestore._databaseId,this._c,this.wc,this.mc);return new Ou(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new _e(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}function Gc(t,e,n){const s=e,i=Mc("where",t);return new Kc(i,s,n)}class $c extends jc{constructor(t,e){super(),this._c=t,this.gc=e,this.type="orderBy"}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new N(D.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new N(D.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new be(e,n);return function(t,e){if(null===xe(t)){const n=De(t);null!==n&&oh(t,n,e.field)}}(t,s),s}(t._query,this._c,this.gc);return new Ou(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new _e(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function zc(t,e="asc"){const n=e,s=Mc("orderBy",t);return new $c(s,n)}class Qc extends jc{constructor(t,e,n){super(),this.type=t,this.yc=e,this.Ic=n}_apply(t){return new Ou(t.firestore,t.converter,Oe(t._query,this.yc,this.Ic))}}function Wc(t){return xu("limit",t),new Qc("limit",t,"F")}function Hc(t){return xu("limitToLast",t),new Qc("limitToLast",t,"L")}class Yc extends jc{constructor(t,e,n){super(),this.type=t,this.Tc=e,this.Ec=n}_apply(t){const e=rh(t,this.type,this.Tc,this.Ec);return new Ou(t.firestore,t.converter,function(t,e){return new _e(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function Xc(...t){return new Yc("startAt",t,!0)}function Jc(...t){return new Yc("startAfter",t,!1)}class Zc extends jc{constructor(t,e,n){super(),this.type=t,this.Tc=e,this.Ec=n}_apply(t){const e=rh(t,this.type,this.Tc,this.Ec);return new Ou(t.firestore,t.converter,function(t,e){return new _e(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function eh(...t){return new Zc("endBefore",t,!1)}function nh(...t){return new Zc("endAt",t,!0)}function rh(t,e,n,s){if(n[0]=Object(h.l)(n[0]),n[0]instanceof kc)return function(t,e,n,s,i){if(!s)throw new N(D.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const r=[];for(const n of Ce(t))if(n.field.isKeyField())r.push(At(e,s.key));else{const t=s.data.field(n.field);if(at(t))throw new N(D.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new N(D.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new ve(r,i)}(t._query,t.firestore._databaseId,e,n[0]._document,s);{const i=th(t.firestore);return function(t,e,n,s,i,r){const o=t.explicitOrderBy;if(i.length>o.length)throw new N(D.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const u=[];for(let r=0;r<i.length;r++){const a=i[r];if(o[r].field.isKeyField()){if("string"!=typeof a)throw new N(D.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof a}`);if(!Ne(t)&&-1!==a.indexOf("/"))throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${a}' contains a slash.`);const n=t.path.child(Y.fromString(a));if(!pt.isDocumentKey(n))throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new pt(n);u.push(At(e,i))}else{const t=Ic(n,s,a);u.push(t)}}return new ve(u,r)}(t._query,t.firestore._databaseId,i,e,n,s)}}function sh(t,e,n){if("string"==typeof(n=Object(h.l)(n))){if(""===n)throw new N(D.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ne(e)&&-1!==n.indexOf("/"))throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Y.fromString(n));if(!pt.isDocumentKey(s))throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return At(t,new pt(s))}if(n instanceof ku)return At(t,n._key);throw new N(D.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Su(n)}.`)}function ih(t,e){if(!Array.isArray(t)||0===t.length)throw new N(D.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new N(D.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function oh(t,e,n){if(!n.isEqual(e))throw new N(D.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}const ah={maxAttempts:5};class uh{convertValue(t,e="none"){switch(vt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return it(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ot(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw S()}}convertObject(t,e){const n={};return W(t.fields,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new ic(it(t.latitude),it(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ut(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ct(t));default:return null}}convertTimestamp(t){const e=st(t);return new $(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Y.fromString(t);A(Er(n));const s=new lt(n.get(1),n.get(3)),i=new pt(n.popFirst(5));return s.isEqual(e)||T(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}function ch(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}class hh extends uh{constructor(t){super(),this.firestore=t}convertBytes(t){return new rc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ku(this.firestore,null,e)}}class lh{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=th(t)}set(t,e,n){this._verifyNotCommitted();const s=dh(t,this._firestore),i=ch(s.converter,e,n),r=dc(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,n);return this._mutations.push(r.toMutation(s._key,rn.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const i=dh(t,this._firestore);let r;return r="string"==typeof(e=Object(h.l)(e))||e instanceof nc?bc(this._dataReader,"WriteBatch.update",i._key,e,n,s):vc(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(r.toMutation(i._key,rn.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=dh(t,this._firestore);return this._mutations=this._mutations.concat(new yn(e._key,rn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(D.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function dh(t,e){if((t=Object(h.l)(t)).firestore!==e)throw new N(D.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function fh(t){t=Au(t,ku);const e=Au(t.firestore,Ku);return yu(Gu(e),t._key).then((n=>_h(e,t,n)))}class gh extends uh{constructor(t){super(),this.firestore=t}convertBytes(t){return new rc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ku(this.firestore,null,e)}}function mh(t){t=Au(t,ku);const e=Au(t.firestore,Ku),n=Gu(e),s=new gh(e);return function(t,e){const n=new C;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await function(t,e){const n=x(t);return n.persistence.runTransaction("read document","readonly",(t=>n.fi.Ls(t,e)))}(t,e);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new N(D.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=na(t,`Failed to get document '${e} from cache`);n.reject(s)}}(await fu(t),e,n))),n.promise}(n,t._key).then((n=>new Lc(e,s,t._key,n,new Rc(null!==n&&n.hasLocalMutations,!0),t.converter)))}function ph(t){t=Au(t,ku);const e=Au(t.firestore,Ku);return yu(Gu(e),t._key,{source:"server"}).then((n=>_h(e,t,n)))}function yh(t){t=Au(t,Ou);const e=Au(t.firestore,Ku),n=Gu(e),s=new gh(e);return Uc(t._query),wu(n,t._query).then((n=>new Pc(e,s,t,n)))}function ol(t){t=Au(t,Ou);const e=Au(t.firestore,Ku),n=Gu(e),s=new gh(e);return function(t,e){const n=new C;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await qi(t,e,!0),i=new ba(e,s._i),r=i.Wu(s.documents),o=i.applyChanges(r,!1);n.resolve(o.snapshot)}catch(t){const s=na(t,`Failed to execute query '${e} against cache`);n.reject(s)}}(await fu(t),e,n))),n.promise}(n,t._query).then((n=>new Pc(e,s,t,n)))}function ul(t){t=Au(t,Ou);const e=Au(t.firestore,Ku),n=Gu(e),s=new gh(e);return wu(n,t._query,{source:"server"}).then((n=>new Pc(e,s,t,n)))}function wh(t,e,n){t=Au(t,ku);const s=Au(t.firestore,Ku),i=ch(t.converter,e,n);return Eh(s,[dc(th(s),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,rn.none())])}function vh(t,e,n,...s){t=Au(t,ku);const i=Au(t.firestore,Ku),r=th(i);let o;return o="string"==typeof(e=Object(h.l)(e))||e instanceof nc?bc(r,"updateDoc",t._key,e,n,s):vc(r,"updateDoc",t._key,e),Eh(i,[o.toMutation(t._key,rn.exists(!0))])}function bh(t){return Eh(Au(t.firestore,Ku),[new yn(t._key,rn.none())])}function Ih(t,e){const n=Au(t.firestore,Ku),s=Vu(t),i=ch(t.converter,e);return Eh(n,[dc(th(t.firestore),"addDoc",s._key,i,null!==t.converter,{}).toMutation(s._key,rn.exists(!1))]).then((()=>s))}function Th(t,...e){var n,s,i;t=Object(h.l)(t);let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Uu(e[o])||(r=e[o],o++);const u={includeMetadataChanges:r.includeMetadataChanges};if(Uu(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let a,c,l;if(t instanceof ku)c=Au(t.firestore,Ku),l=Ae(t._key.path),a={next:n=>{e[o]&&e[o](_h(c,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Au(t,Ou);c=Au(n.firestore,Ku),l=n._query;const s=new gh(c);a={next:t=>{e[o]&&e[o](new Pc(c,s,n,t))},error:e[o+1],complete:e[o+2]},Uc(t._query)}return function(t,e,n,s){const i=new ru(s),r=new fa(e,i,n);return t.asyncQueue.enqueueAndForget((async()=>ua(await pu(t),r))),()=>{i.Aa(),t.asyncQueue.enqueueAndForget((async()=>ca(await pu(t),r)))}}(Gu(c),l,u,a)}function dl(t,e){return function(t,e){const n=new ru(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){x(t).bu.add(e),e.next()}(await pu(t),n))),()=>{n.Aa(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){x(t).bu.delete(e)}(await pu(t),n)))}}(Gu(t=Au(t,Ku)),Uu(e)?e:{next:e})}function Eh(t,e){return function(t,e){const n=new C;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const s=Xa(t);try{const t=await function(t,e){const n=x(t),s=$.now(),i=e.reduce(((t,e)=>t.add(e.key)),On());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>n.fi.Ks(t,i).next((i=>{r=i;const o=[];for(const t of e){const e=cn(t,r.get(t.key));null!=e&&o.push(new fn(t.key,e,qt(e.value.mapValue),rn.exists(!0)))}return n.Bs.addMutationBatch(t,s,o,e)})))).then((t=>(t.applyToLocalDocumentSet(r),{batchId:t.batchId,changes:r})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.ha[t.currentUser.toKey()];s||(s=new Yt(rt)),s=s.insert(e,n),t.ha[t.currentUser.toKey()]=s}(s,t.batchId,n),await qa(s,t.changes),await Bo(s.remoteStore)}catch(t){const e=na(t,"Failed to persist write");n.reject(e)}}(await mu(t),e,n))),n.promise}(Gu(t),e)}function _h(t,e,n){const s=n.docs.get(e._key),i=new gh(t);return new Lc(t,i,e._key,s,new Rc(n.hasPendingWrites,n.fromCache),e.converter)}class Sh extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=th(t)}get(t){const e=dh(t,this._firestore),n=new hh(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return S();const s=t[0];if(s.isFoundDocument())return new kc(this._firestore,n,s.key,s,e.converter);if(s.isNoDocument())return new kc(this._firestore,n,e._key,null,e.converter);throw S()}))}set(t,e,n){const s=dh(t,this._firestore),i=ch(s.converter,e,n),r=dc(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,n);return this._transaction.set(s._key,r),this}update(t,e,n,...s){const i=dh(t,this._firestore);let r;return r="string"==typeof(e=Object(h.l)(e))||e instanceof nc?bc(this._dataReader,"Transaction.update",i._key,e,n,s):vc(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,r),this}delete(t){const e=dh(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=dh(t,this._firestore),n=new gh(this._firestore);return super.get(t).then((t=>new Lc(this._firestore,n,e._key,t._document,new Rc(!1,!1),e.converter)))}}function Ah(t,e,n){t=Au(t,Ku);const s=Object.assign(Object.assign({},ah),n);return function(t){if(t.maxAttempts<1)throw new N(D.INVALID_ARGUMENT,"Max attempts must be at least 1")}(s),function(t,e,n){const s=new C;return t.asyncQueue.enqueueAndForget((async()=>{const i=await function(t){return lu(t).then((t=>t.datastore))}(t);new ou(t.asyncQueue,i,n,e,s).run()})),s.promise}(Gu(t),(n=>e(new Sh(t,n))),s)}function xh(){return new fc("deleteField")}function Dh(){return new mc("serverTimestamp")}function Nh(...t){return new pc("arrayUnion",t)}function Ch(...t){return new yc("arrayRemove",t)}function kh(t){return new wc("increment",t)}!function(t,e=!0){!function(t){m=t}(r.SDK_VERSION),Object(r._registerComponent)(new o.a("firestore",((t,{options:n})=>{const s=t.getProvider("app").getImmediate(),i=new Ku(s,new R(t.getProvider("auth-internal")),new F(t.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:e},n),i._setSettings(n),i}),"PUBLIC")),Object(r.registerVersion)(d,"3.4.9",t),Object(r.registerVersion)(d,"3.4.9","esm2017")}()}).call(this,n(201))},493:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return mr})),n.d(e,"b",(function(){return yr})),n.d(e,"c",(function(){return pr})),n.d(e,"d",(function(){return vr})),n.d(e,"e",(function(){return wr})),n.d(e,"f",(function(){return Ir})),n.d(e,"g",(function(){return Tr})),n.d(e,"h",(function(){return fr})),n.d(e,"i",(function(){return gr}));var r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},c={},h=h||{},l=o||self;function d(){}function f(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var m="closure_uid_"+(1e9*Math.random()>>>0),y=0;function w(a,b,t){return a.call.apply(a.bind,arguments)}function v(a,b,t){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,e),a.apply(b,t)}}return function(){return a.apply(b,arguments)}}function q(a,b,t){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:v).apply(null,arguments)}function I(a,b){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),a.apply(this,e)}}function T(a,b){function t(){}t.prototype=b.prototype,a.Z=b.prototype,a.prototype=new t,a.prototype.constructor=a,a.Vb=function(t,e,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return b.prototype[e].apply(t,r)}}function E(){this.s=this.s,this.o=this.o}var _={};E.prototype.s=!1,E.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var a=function(a){return Object.prototype.hasOwnProperty.call(a,m)&&a[m]||(a[m]=++y)}(this);delete _[a]}},E.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const S=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(let t=0;t<a.length;t++)if(t in a&&a[t]===b)return t;return-1},A=Array.prototype.forEach?function(a,b,t){Array.prototype.forEach.call(a,b,t)}:function(a,b,t){const e=a.length,n="string"==typeof a?a.split(""):a;for(let r=0;r<e;r++)r in n&&b.call(t,n[r],r,a)};function x(a){return Array.prototype.concat.apply([],arguments)}function D(a){const b=a.length;if(0<b){const t=Array(b);for(let e=0;e<b;e++)t[e]=a[e];return t}return[]}function N(a){return/^[\s\xa0]*$/.test(a)}var C,k=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function O(a,b){return-1!=a.indexOf(b)}function M(a,b){return a<b?-1:a>b?1:0}t:{var R=l.navigator;if(R){var L=R.userAgent;if(L){C=L;break t}}C=""}function V(a,b,t){for(const e in a)b.call(t,a[e],e,a)}function P(a){const b={};for(const t in a)b[t]=a[t];return b}var F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function U(a,b){let t,e;for(let n=1;n<arguments.length;n++){for(t in e=arguments[n],e)a[t]=e[t];for(let n=0;n<F.length;n++)t=F[n],Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}}function j(a){return j[" "](a),a}j[" "]=d;var B,a,K=O(C,"Opera"),G=O(C,"Trident")||O(C,"MSIE"),$=O(C,"Edge"),z=$||G,Q=O(C,"Gecko")&&!(O(C.toLowerCase(),"webkit")&&!O(C,"Edge"))&&!(O(C,"Trident")||O(C,"MSIE"))&&!O(C,"Edge"),W=O(C.toLowerCase(),"webkit")&&!O(C,"Edge");function H(){var a=l.document;return a?a.documentMode:void 0}t:{var Y="",X=(a=C,Q?/rv:([^\);]+)(\)|;)/.exec(a):$?/Edge\/([\d\.]+)/.exec(a):G?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):W?/WebKit\/(\S+)/.exec(a):K?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(X&&(Y=X?X[1]:""),G){var J=H();if(null!=J&&J>parseFloat(Y)){B=String(J);break t}}B=Y}var Z,tt={};function et(){return function(a){var b=tt;return Object.prototype.hasOwnProperty.call(b,9)?b[9]:b[9]=a(9)}((function(){let a=0;const b=k(String(B)).split("."),t=k("9").split("."),e=Math.max(b.length,t.length);for(let o=0;0==a&&o<e;o++){var n=b[o]||"",r=t[o]||"";do{if(n=/(\d*)(\D*)(.*)/.exec(n)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==n[0].length&&0==r[0].length)break;a=M(0==n[1].length?0:parseInt(n[1],10),0==r[1].length?0:parseInt(r[1],10))||M(0==n[2].length,0==r[2].length)||M(n[2],r[2]),n=n[3],r=r[3]}while(0==a)}return 0<=a}))}if(l.document&&G){var nt=H();Z=nt||(parseInt(B,10)||void 0)}else Z=void 0;var st=Z,it=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{l.addEventListener("test",d,b),l.removeEventListener("test",d,b)}catch(t){}return a}();function ot(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}function at(a,b){if(ot.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var t=this.type=a.type,e=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(Q){t:{try{j(b.nodeName);var n=!0;break t}catch(t){}n=!1}n||(b=null)}}else"mouseover"==t?b=a.fromElement:"mouseout"==t&&(b=a.toElement);this.relatedTarget=b,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:ut[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&at.Z.h.call(this)}}ot.prototype.h=function(){this.defaultPrevented=!0},T(at,ot);var ut={2:"touch",3:"pen",4:"mouse"};at.prototype.h=function(){at.Z.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var ct="closure_listenable_"+(1e6*Math.random()|0),ht=0;function lt(a,b,t,e,n){this.listener=a,this.proxy=null,this.src=b,this.type=t,this.capture=!!e,this.ia=n,this.key=++ht,this.ca=this.fa=!1}function ft(a){a.ca=!0,a.listener=null,a.proxy=null,a.src=null,a.ia=null}function gt(a){this.src=a,this.g={},this.h=0}function mt(a,b){var t=b.type;if(t in a.g){var e,n=a.g[t],r=S(n,b);(e=0<=r)&&Array.prototype.splice.call(n,r,1),e&&(ft(b),0==a.g[t].length&&(delete a.g[t],a.h--))}}function pt(a,b,t,e){for(var n=0;n<a.length;++n){var r=a[n];if(!r.ca&&r.listener==b&&r.capture==!!t&&r.ia==e)return n}return-1}gt.prototype.add=function(a,b,t,e,n){var r=a.toString();(a=this.g[r])||(a=this.g[r]=[],this.h++);var o=pt(a,b,e,n);return-1<o?(b=a[o],t||(b.fa=!1)):((b=new lt(b,this.src,r,!!e,n)).fa=t,a.push(b)),b};var yt="closure_lm_"+(1e6*Math.random()|0),wt={};function vt(a,b,t,e,n){if(e&&e.once)return It(a,b,t,e,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)vt(a,b[r],t,e,n);return null}return t=Dt(t),a&&a[ct]?a.N(b,t,p(e)?!!e.capture:!!e,n):bt(a,b,t,!1,e,n)}function bt(a,b,t,e,n,r){if(!b)throw Error("Invalid event type");var o=p(n)?!!n.capture:!!n,c=At(a);if(c||(a[yt]=c=new gt(a)),(t=c.add(b,t,e,o,r)).proxy)return t;if(e=function(){function a(t){return b.call(a.src,a.listener,t)}var b=St;return a}(),t.proxy=e,e.src=a,e.listener=t,a.addEventListener)it||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),e,n);else if(a.attachEvent)a.attachEvent(_t(b.toString()),e);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(e)}return t}function It(a,b,t,e,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)It(a,b[r],t,e,n);return null}return t=Dt(t),a&&a[ct]?a.O(b,t,p(e)?!!e.capture:!!e,n):bt(a,b,t,!0,e,n)}function Tt(a,b,t,e,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)Tt(a,b[r],t,e,n);else e=p(e)?!!e.capture:!!e,t=Dt(t),a&&a[ct]?(a=a.i,(b=String(b).toString())in a.g&&(-1<(t=pt(r=a.g[b],t,e,n))&&(ft(r[t]),Array.prototype.splice.call(r,t,1),0==r.length&&(delete a.g[b],a.h--)))):a&&(a=At(a))&&(b=a.g[b.toString()],a=-1,b&&(a=pt(b,t,e,n)),(t=-1<a?b[a]:null)&&Et(t))}function Et(a){if("number"!=typeof a&&a&&!a.ca){var b=a.src;if(b&&b[ct])mt(b.i,a);else{var t=a.type,e=a.proxy;b.removeEventListener?b.removeEventListener(t,e,a.capture):b.detachEvent?b.detachEvent(_t(t),e):b.addListener&&b.removeListener&&b.removeListener(e),(t=At(b))?(mt(t,a),0==t.h&&(t.src=null,b[yt]=null)):ft(a)}}}function _t(a){return a in wt?wt[a]:wt[a]="on"+a}function St(a,b){if(a.ca)a=!0;else{b=new at(b,this);var t=a.listener,e=a.ia||a.src;a.fa&&Et(a),a=t.call(e,b)}return a}function At(a){return(a=a[yt])instanceof gt?a:null}var xt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Dt(a){return"function"==typeof a?a:(a[xt]||(a[xt]=function(b){return a.handleEvent(b)}),a[xt])}function Nt(){E.call(this),this.i=new gt(this),this.P=this,this.I=null}function Ct(a,b){var t,e=a.I;if(e)for(t=[];e;e=e.I)t.push(e);if(a=a.P,e=b.type||b,"string"==typeof b)b=new ot(b,a);else if(b instanceof ot)b.target=b.target||a;else{var n=b;U(b=new ot(e,a),n)}if(n=!0,t)for(var r=t.length-1;0<=r;r--){var o=b.g=t[r];n=kt(o,e,!0,b)&&n}if(n=kt(o=b.g=a,e,!0,b)&&n,n=kt(o,e,!1,b)&&n,t)for(r=0;r<t.length;r++)n=kt(o=b.g=t[r],e,!1,b)&&n}function kt(a,b,t,e){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.ca&&o.capture==t){var c=o.listener,u=o.ia||o.src;o.fa&&mt(a.i,o),n=!1!==c.call(u,e)&&n}}return n&&!e.defaultPrevented}T(Nt,E),Nt.prototype[ct]=!0,Nt.prototype.removeEventListener=function(a,b,t,e){Tt(this,a,b,t,e)},Nt.prototype.M=function(){if(Nt.Z.M.call(this),this.i){var t,a=this.i;for(t in a.g){for(var e=a.g[t],n=0;n<e.length;n++)ft(e[n]);delete a.g[t],a.h--}}this.I=null},Nt.prototype.N=function(a,b,t,e){return this.i.add(String(a),b,!1,t,e)},Nt.prototype.O=function(a,b,t,e){return this.i.add(String(a),b,!0,t,e)};var Ot=l.JSON.stringify;function Mt(){var a=Ut;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var Rt,Lt=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new Vt),(a=>a.reset()));class Vt{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}function Pt(a){l.setTimeout((()=>{throw a}),0)}function Ft(a,b){Rt||function(){var a=l.Promise.resolve(void 0);Rt=function(){a.then(jt)}}(),qt||(Rt(),qt=!0),Ut.add(a,b)}var qt=!1,Ut=new class{constructor(){this.h=this.g=null}add(a,b){const t=Lt.get();t.set(a,b),this.h?this.h.next=t:this.g=t,this.h=t}};function jt(){for(var a;a=Mt();){try{a.h.call(a.g)}catch(t){Pt(t)}var b=Lt;b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}qt=!1}function Bt(a,b){Nt.call(this),this.h=a||1,this.g=b||l,this.j=q(this.kb,this),this.l=Date.now()}function Kt(a){a.da=!1,a.S&&(a.g.clearTimeout(a.S),a.S=null)}function Gt(a,b,t){if("function"==typeof a)t&&(a=q(a,t));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function $t(a){a.g=Gt((()=>{a.g=null,a.i&&(a.i=!1,$t(a))}),a.j);const b=a.h;a.h=null,a.m.apply(null,b)}T(Bt,Nt),(r=Bt.prototype).da=!1,r.S=null,r.kb=function(){if(this.da){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-a):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ct(this,"tick"),this.da&&(Kt(this),this.start()))}},r.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Bt.Z.M.call(this),Kt(this),delete this.g};class zt extends E{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:$t(this)}M(){super.M(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qt(a){E.call(this),this.h=a,this.g={}}T(Qt,E);var Wt=[];function Ht(a,b,t,e){Array.isArray(t)||(t&&(Wt[0]=t.toString()),t=Wt);for(var n=0;n<t.length;n++){var r=vt(b,t[n],e||a.handleEvent,!1,a.h||a);if(!r)break;a.g[r.key]=r}}function Yt(a){V(a.g,(function(b,t){this.g.hasOwnProperty(t)&&Et(b)}),a),a.g={}}function Xt(){this.g=!0}function Jt(a,b,t,e){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.g)return b;if(!b)return null;try{var t=JSON.parse(b);if(t)for(a=0;a<t.length;a++)if(Array.isArray(t[a])){var e=t[a];if(!(2>e.length)){var n=e[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return Ot(t)}catch(t){return b}}(a,t)+(e?" "+e:"")}))}Qt.prototype.M=function(){Qt.Z.M.call(this),Yt(this)},Qt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Xt.prototype.Aa=function(){this.g=!1},Xt.prototype.info=function(){};var Zt={},te=null;function ee(){return te=te||new Nt}function ne(a){ot.call(this,Zt.Ma,a)}function re(a){const b=ee();Ct(b,new ne(b,a))}function se(a,b){ot.call(this,Zt.STAT_EVENT,a),this.stat=b}function ie(a){const b=ee();Ct(b,new se(b,a))}function oe(a,b){ot.call(this,Zt.Na,a),this.size=b}function ae(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){a()}),b)}Zt.Ma="serverreachability",T(ne,ot),Zt.STAT_EVENT="statevent",T(se,ot),Zt.Na="timingevent",T(oe,ot);var ue={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ce={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function he(){}function le(a){return a.h||(a.h=a.i())}function de(){}he.prototype.h=null;var fe,ge={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function me(){ot.call(this,"d")}function pe(){ot.call(this,"c")}function ye(){}function we(a,b,t,e){this.l=a,this.j=b,this.m=t,this.X=e||1,this.V=new Qt(this),this.P=be,a=z?125:void 0,this.W=new Bt(a),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ve}function ve(){this.i=null,this.g="",this.h=!1}T(me,ot),T(pe,ot),T(ye,he),ye.prototype.g=function(){return new XMLHttpRequest},ye.prototype.i=function(){return{}},fe=new ye;var be=45e3,Ie={},Te={};function Ee(a,b,t){a.K=1,a.v=ze(Ue(b)),a.s=t,a.U=!0,_e(a,null)}function _e(a,b){a.F=Date.now(),De(a),a.A=Ue(a.v);var t=a.A,e=a.X;Array.isArray(e)||(e=[String(e)]),sn(t.h,"t",e),a.C=0,t=a.l.H,a.h=new ve,a.g=ir(a.l,t?b:null,!a.s),0<a.O&&(a.L=new zt(q(a.Ia,a,a.g),a.O)),Ht(a.V,a.g,"readystatechange",a.gb),b=a.H?P(a.H):{},a.s?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.s,b)):(a.u="GET",a.g.ea(a.A,a.u,null,b)),re(1),function(a,b,t,e,n,r){a.info((function(){if(a.g)if(r)for(var o="",c=r.split("&"),u=0;u<c.length;u++){var h=c[u].split("=");if(1<h.length){var l=h[0];h=h[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+h+"&":o+(l+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+e+") [attempt "+n+"]: "+b+"\n"+t+"\n"+o}))}(a.j,a.u,a.A,a.m,a.X,a.s)}function Se(a){return!!a.g&&("GET"==a.u&&2!=a.K&&a.l.Ba)}function Ae(a,b,t){let e,n=!0;for(;!a.I&&a.C<t.length;){if(e=xe(a,t),e==Te){4==b&&(a.o=4,ie(14),n=!1),Jt(a.j,a.m,null,"[Incomplete Response]");break}if(e==Ie){a.o=4,ie(15),Jt(a.j,a.m,t,"[Invalid Chunk]"),n=!1;break}Jt(a.j,a.m,e,null),Me(a,e)}Se(a)&&e!=Te&&e!=Ie&&(a.h.g="",a.C=0),4!=b||0!=t.length||a.h.h||(a.o=1,ie(16),n=!1),a.i=a.i&&n,n?0<t.length&&!a.aa&&(a.aa=!0,(b=a.l).g==a&&b.$&&!b.L&&(b.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),Yn(b),b.L=!0,ie(11))):(Jt(a.j,a.m,t,"[Invalid Chunked Response]"),Oe(a),ke(a))}function xe(a,b){var t=a.C,e=b.indexOf("\n",t);return-1==e?Te:(t=Number(b.substring(t,e)),isNaN(t)?Ie:(e+=1)+t>b.length?Te:(b=b.substr(e,t),a.C=e+t,b))}function De(a){a.Y=Date.now()+a.P,Ne(a,a.P)}function Ne(a,b){if(null!=a.B)throw Error("WatchDog timer not null");a.B=ae(q(a.eb,a),b)}function Ce(a){a.B&&(l.clearTimeout(a.B),a.B=null)}function ke(a){0==a.l.G||a.I||Zn(a.l,a)}function Oe(a){Ce(a);var b=a.L;b&&"function"==typeof b.na&&b.na(),a.L=null,Kt(a.W),Yt(a.V),a.g&&(b=a.g,a.g=null,b.abort(),b.na())}function Me(a,b){try{var t=a.l;if(0!=t.G&&(t.g==a||ln(t.i,a)))if(t.I=a.N,!a.J&&ln(t.i,a)&&3==t.G){try{var e=t.Ca.g.parse(b)}catch(t){e=null}if(Array.isArray(e)&&3==e.length){var n=e;if(0==n[0]){t:if(!t.u){if(t.g){if(!(t.g.F+3e3<a.F))break t;Jn(t),jn(t)}Hn(t),ie(18)}}else t.ta=n[1],0<t.ta-t.U&&37500>n[2]&&t.N&&0==t.A&&!t.v&&(t.v=ae(q(t.ab,t),6e3));if(1>=hn(t.i)&&t.ka){try{t.ka()}catch(t){}t.ka=void 0}}else nr(t,11)}else if((a.J||t.g==a)&&Jn(t),!N(b))for(n=t.Ca.g.parse(b),b=0;b<n.length;b++){let h=n[b];if(t.U=h[0],h=h[1],2==t.G)if("c"==h[0]){t.J=h[1],t.la=h[2];const n=h[3];null!=n&&(t.ma=n,t.h.info("VER="+t.ma));const l=h[4];null!=l&&(t.za=l,t.h.info("SVER="+t.za));const d=h[5];null!=d&&"number"==typeof d&&0<d&&(e=1.5*d,t.K=e,t.h.info("backChannelRequestTimeoutMs_="+e)),e=t;const f=a.g;if(f){const t=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=e.i;!r.g&&(O(t,"spdy")||O(t,"quic")||O(t,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(dn(r,r.h),r.h=null))}if(e.D){const t=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(e.sa=t,$e(e.F,e.D,t))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-a.F,t.h.info("Handshake RTT: "+t.O+"ms"));var o=a;if((e=t).oa=sr(e,e.H?e.la:null,e.W),o.J){fn(e.i,o);var c=o,u=e.K;u&&c.setTimeout(u),c.B&&(Ce(c),De(c)),e.g=o}else Wn(e);0<t.l.length&&Gn(t)}else"stop"!=h[0]&&"close"!=h[0]||nr(t,7);else 3==t.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?nr(t,7):Un(t):"noop"!=h[0]&&t.j&&t.j.wa(h),t.A=0)}re(4)}catch(t){}}function Re(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(f(a)||"string"==typeof a)A(a,b,void 0);else{if(a.T&&"function"==typeof a.T)var t=a.T();else if(a.R&&"function"==typeof a.R)t=void 0;else if(f(a)||"string"==typeof a){t=[];for(var e=a.length,n=0;n<e;n++)t.push(n)}else for(n in t=[],e=0,a)t[e++]=n;e=function(a){if(a.R&&"function"==typeof a.R)return a.R();if("string"==typeof a)return a.split("");if(f(a)){for(var b=[],t=a.length,e=0;e<t;e++)b.push(a[e]);return b}for(e in b=[],t=0,a)b[t++]=a[e];return b}(a),n=e.length;for(var r=0;r<n;r++)b.call(void 0,e[r],t&&t[r],a)}}function Le(a,b){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var e=0;e<t;e+=2)this.set(arguments[e],arguments[e+1])}else if(a)if(a instanceof Le)for(t=a.T(),e=0;e<t.length;e++)this.set(t[e],a.get(t[e]));else for(e in a)this.set(e,a[e])}function Ve(a){if(a.i!=a.g.length){for(var b=0,t=0;b<a.g.length;){var e=a.g[b];Pe(a.h,e)&&(a.g[t++]=e),b++}a.g.length=t}if(a.i!=a.g.length){var n={};for(t=b=0;b<a.g.length;)Pe(n,e=a.g[b])||(a.g[t++]=e,n[e]=1),b++;a.g.length=t}}function Pe(a,b){return Object.prototype.hasOwnProperty.call(a,b)}(r=we.prototype).setTimeout=function(a){this.P=a},r.gb=function(a){a=a.target;const b=this.L;b&&3==Ln(a)?b.l():this.Ia(a)},r.Ia=function(a){try{if(a==this.g)t:{const d=Ln(this.g);var b=this.g.Da();const f=this.g.ba();if(!(3>d)&&(3!=d||z||this.g&&(this.h.h||this.g.ga()||Vn(this.g)))){this.I||4!=d||7==b||re(8==b||0>=f?3:2),Ce(this);var t=this.g.ba();this.N=t;e:if(Se(this)){var e=Vn(this.g);a="";var n=e.length,r=4==Ln(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Oe(this),ke(this);var o="";break e}this.h.i=new l.TextDecoder}for(b=0;b<n;b++)this.h.h=!0,a+=this.h.i.decode(e[b],{stream:r&&b==n-1});e.splice(0,n),this.h.g+=a,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==t,function(a,b,t,e,n,r,o){a.info((function(){return"XMLHTTP RESP ("+e+") [ attempt "+n+"]: "+b+"\n"+t+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.X,d,t),this.i){if(this.$&&!this.J){e:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(c)){var h=c;break e}}h=null}if(!(t=h)){this.i=!1,this.o=3,ie(12),Oe(this),ke(this);break t}Jt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Me(this,t)}this.U?(Ae(this,d,o),z&&this.i&&3==d&&(Ht(this.V,this.W,"tick",this.fb),this.W.start())):(Jt(this.j,this.m,o,null),Me(this,o)),4==d&&Oe(this),this.i&&!this.I&&(4==d?Zn(this.l,this):(this.i=!1,De(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,ie(12)):(this.o=0,ie(13)),Oe(this),ke(this)}}}catch(t){}},r.fb=function(){if(this.g){var a=Ln(this.g),b=this.g.ga();this.C<b.length&&(Ce(this),Ae(this,a,b),this.i&&4!=a&&De(this))}},r.cancel=function(){this.I=!0,Oe(this)},r.eb=function(){this.B=null;const a=Date.now();0<=a-this.Y?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.j,this.A),2!=this.K&&(re(3),ie(17)),Oe(this),this.o=2,ke(this)):Ne(this,this.Y-a)},(r=Le.prototype).R=function(){Ve(this);for(var a=[],b=0;b<this.g.length;b++)a.push(this.h[this.g[b]]);return a},r.T=function(){return Ve(this),this.g.concat()},r.get=function(a,b){return Pe(this.h,a)?this.h[a]:b},r.set=function(a,b){Pe(this.h,a)||(this.i++,this.g.push(a)),this.h[a]=b},r.forEach=function(a,b){for(var t=this.T(),e=0;e<t.length;e++){var n=t[e],r=this.get(n);a.call(b,r,n,this)}};var Fe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function qe(a,b){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,a instanceof qe){this.g=void 0!==b?b:a.g,je(this,a.j),this.s=a.s,Be(this,a.i),Ke(this,a.m),this.l=a.l,b=a.h;var t=new en;t.i=b.i,b.g&&(t.g=new Le(b.g),t.h=b.h),Ge(this,t),this.o=a.o}else a&&(t=String(a).match(Fe))?(this.g=!!b,je(this,t[1]||"",!0),this.s=Qe(t[2]||""),Be(this,t[3]||"",!0),Ke(this,t[4]),this.l=Qe(t[5]||"",!0),Ge(this,t[6]||"",!0),this.o=Qe(t[7]||"")):(this.g=!!b,this.h=new en(null,this.g))}function Ue(a){return new qe(a)}function je(a,b,t){a.j=t?Qe(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function Be(a,b,t){a.i=t?Qe(b,!0):b}function Ke(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function Ge(a,b,t){b instanceof en?(a.h=b,function(a,b){b&&!a.j&&(nn(a),a.i=null,a.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(dd(this,e),sn(this,n,t))}),a)),a.j=b}(a.h,a.g)):(t||(b=We(b,Ze)),a.h=new en(b,a.g))}function $e(a,b,t){a.h.set(b,t)}function ze(a){return $e(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Qe(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function We(a,b,t){return"string"==typeof a?(a=encodeURI(a).replace(b,He),t&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function He(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}qe.prototype.toString=function(){var a=[],b=this.j;b&&a.push(We(b,Ye,!0),":");var t=this.i;return(t||"file"==b)&&(a.push("//"),(b=this.s)&&a.push(We(b,Ye,!0),"@"),a.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&a.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&a.push("/"),a.push(We(t,"/"==t.charAt(0)?Je:Xe,!0))),(t=this.h.toString())&&a.push("?",t),(t=this.o)&&a.push("#",We(t,tn)),a.join("")};var Ye=/[#\/\?@]/g,Xe=/[#\?:]/g,Je=/[#\?]/g,Ze=/[#\?@]/g,tn=/#/g;function en(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function nn(a){a.g||(a.g=new Le,a.h=0,a.i&&function(a,b){if(a){a=a.split("&");for(var t=0;t<a.length;t++){var e=a[t].indexOf("="),n=null;if(0<=e){var r=a[t].substring(0,e);n=a[t].substring(e+1)}else r=a[t];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.i,(function(b,t){a.add(decodeURIComponent(b.replace(/\+/g," ")),t)})))}function dd(a,b){nn(a),b=on(a,b),Pe(a.g.h,b)&&(a.i=null,a.h-=a.g.get(b).length,Pe((a=a.g).h,b)&&(delete a.h[b],a.i--,a.g.length>2*a.i&&Ve(a)))}function rn(a,b){return nn(a),b=on(a,b),Pe(a.g.h,b)}function sn(a,b,t){dd(a,b),0<t.length&&(a.i=null,a.g.set(on(a,b),D(t)),a.h+=t.length)}function on(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}(r=en.prototype).add=function(a,b){nn(this),this.i=null,a=on(this,a);var t=this.g.get(a);return t||this.g.set(a,t=[]),t.push(b),this.h+=1,this},r.forEach=function(a,b){nn(this),this.g.forEach((function(t,e){A(t,(function(t){a.call(b,t,e,this)}),this)}),this)},r.T=function(){nn(this);for(var a=this.g.R(),b=this.g.T(),t=[],e=0;e<b.length;e++)for(var n=a[e],r=0;r<n.length;r++)t.push(b[e]);return t},r.R=function(a){nn(this);var b=[];if("string"==typeof a)rn(this,a)&&(b=x(b,this.g.get(on(this,a))));else{a=this.g.R();for(var t=0;t<a.length;t++)b=x(b,a[t])}return b},r.set=function(a,b){return nn(this),this.i=null,rn(this,a=on(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},r.get=function(a,b){return a&&0<(a=this.R(a)).length?String(a[0]):b},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var a=[],b=this.g.T(),t=0;t<b.length;t++){var e=b[t],n=encodeURIComponent(String(e));e=this.R(e);for(var r=0;r<e.length;r++){var o=n;""!==e[r]&&(o+="="+encodeURIComponent(String(e[r]))),a.push(o)}}return this.i=a.join("&")};function an(a){this.l=a||un,l.PerformanceNavigationTiming?a=0<(a=l.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(l.g&&l.g.Ea&&l.g.Ea()&&l.g.Ea().Zb),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var un=10;function cn(a){return!!a.h||!!a.g&&a.g.size>=a.j}function hn(a){return a.h?1:a.g?a.g.size:0}function ln(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function dn(a,b){a.g?a.g.add(b):a.h=b}function fn(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function gn(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const t of a.g.values())b=b.concat(t.D);return b}return D(a.i)}function mn(){}function pn(){this.g=new mn}function yn(a,b,t){const e=t||"";try{Re(a,(function(t,n){let r=t;p(t)&&(r=Ot(t)),b.push(e+n+"="+encodeURIComponent(r))}))}catch(t){throw b.push(e+"type="+encodeURIComponent("_badmap")),t}}function wn(a,b,t,e,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(e)}catch(t){}}function vn(a){this.l=a.$b||null,this.j=a.ib||!1}function bn(a,b){Nt.call(this),this.D=a,this.u=b,this.m=void 0,this.readyState=In,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}an.prototype.cancel=function(){if(this.i=gn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}},mn.prototype.stringify=function(a){return l.JSON.stringify(a,void 0)},mn.prototype.parse=function(a){return l.JSON.parse(a,void 0)},T(vn,he),vn.prototype.g=function(){return new bn(this.l,this.j)},vn.prototype.i=function(a){return function(){return a}}({}),T(bn,Nt);var In=0;function Tn(a){a.j.read().then(a.Sa.bind(a)).catch(a.ha.bind(a))}function td(a){a.readyState=4,a.l=null,a.j=null,a.A=null,En(a)}function En(a){a.onreadystatechange&&a.onreadystatechange.call(a)}(r=bn.prototype).open=function(a,b){if(this.readyState!=In)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,En(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.D||l).fetch(new Request(this.B,b)).then(this.Va.bind(this),this.ha.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,td(this)),this.readyState=In},r.Va=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,En(this)),this.g&&(this.readyState=3,En(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==l.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Tn(this)}else a.text().then(this.Ua.bind(this),this.ha.bind(this))},r.Sa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?td(this):En(this),3==this.readyState&&Tn(this)}},r.Ua=function(a){this.g&&(this.response=this.responseText=a,td(this))},r.Ta=function(a){this.g&&(this.response=a,td(this))},r.ha=function(){this.g&&td(this)},r.setRequestHeader=function(a,b){this.v.append(a,b)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var t=b.next();!t.done;)t=t.value,a.push(t[0]+": "+t[1]),t=b.next();return a.join("\r\n")},Object.defineProperty(bn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var _n=l.JSON.parse;function Sn(a){Nt.call(this),this.headers=new Le,this.u=a||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=An,this.K=this.L=!1}T(Sn,Nt);var An="",xn=/^https?$/i,Dn=["POST","PUT"];function Nn(a){return"content-type"==a.toLowerCase()}function Cn(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,kn(a),Mn(a)}function kn(a){a.D||(a.D=!0,Ct(a,"complete"),Ct(a,"error"))}function On(a){if(a.h&&void 0!==h&&(!a.C[1]||4!=Ln(a)||2!=a.ba()))if(a.v&&4==Ln(a))Gt(a.Fa,0,a);else if(Ct(a,"readystatechange"),4==Ln(a)){a.h=!1;try{const c=a.ba();t:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break t;default:b=!1}var t;if(!(t=b)){var e;if(e=0===c){var n=String(a.H).match(Fe)[1]||null;if(!n&&l.self&&l.self.location){var r=l.self.location.protocol;n=r.substr(0,r.length-1)}e=!xn.test(n?n.toLowerCase():"")}t=e}if(t)Ct(a,"complete"),Ct(a,"success");else{a.m=6;try{var o=2<Ln(a)?a.g.statusText:""}catch(t){o=""}a.j=o+" ["+a.ba()+"]",kn(a)}}finally{Mn(a)}}}function Mn(a,b){if(a.g){Rn(a);const t=a.g,e=a.C[0]?d:null;a.g=null,a.C=null,b||Ct(a,"ready");try{t.onreadystatechange=e}catch(t){}}}function Rn(a){a.g&&a.K&&(a.g.ontimeout=null),a.A&&(l.clearTimeout(a.A),a.A=null)}function Ln(a){return a.g?a.g.readyState:0}function Vn(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.J){case An:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Pn(a,b,t){t:{for(e in t){var e=!1;break t}e=!0}e||(t=function(a){let b="";return V(a,(function(t,e){b+=e,b+=":",b+=t,b+="\r\n"})),b}(t),"string"==typeof a?null!=t&&encodeURIComponent(String(t)):$e(a,b,t))}function Fn(a,b,t){return t&&t.internalChannelParams&&t.internalChannelParams[a]||b}function qn(a){this.za=0,this.l=[],this.h=new Xt,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Fn("failFast",!1,a),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Fn("baseRetryDelayMs",5e3,a),this.$a=Fn("retryDelaySeedMs",1e4,a),this.Ya=Fn("forwardChannelMaxRetries",2,a),this.ra=Fn("forwardChannelRequestTimeoutMs",2e4,a),this.qa=a&&a.xmlHttpFactory||void 0,this.Ba=a&&a.Yb||!1,this.K=void 0,this.H=a&&a.supportsCrossDomainXhr||!1,this.J="",this.i=new an(a&&a.concurrentRequestLimit),this.Ca=new pn,this.ja=a&&a.fastHandshake||!1,this.Ra=a&&a.Wb||!1,a&&a.Aa&&this.h.Aa(),a&&a.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&a&&a.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!a||!1!==a.Xb}function Un(a){if(Bn(a),3==a.G){var b=a.V++,t=Ue(a.F);$e(t,"SID",a.J),$e(t,"RID",b),$e(t,"TYPE","terminate"),zn(a,t),(b=new we(a,a.h,b,void 0)).K=2,b.v=ze(Ue(t)),t=!1,l.navigator&&l.navigator.sendBeacon&&(t=l.navigator.sendBeacon(b.v.toString(),"")),!t&&l.Image&&((new Image).src=b.v,t=!0),t||(b.g=ir(b.l,null),b.g.ea(b.v)),b.F=Date.now(),De(b)}rr(a)}function jn(a){a.g&&(Yn(a),a.g.cancel(),a.g=null)}function Bn(a){jn(a),a.u&&(l.clearTimeout(a.u),a.u=null),Jn(a),a.i.cancel(),a.m&&("number"==typeof a.m&&l.clearTimeout(a.m),a.m=null)}function Kn(a,b){a.l.push(new class{constructor(a,b){this.h=a,this.g=b}}(a.Za++,b)),3==a.G&&Gn(a)}function Gn(a){cn(a.i)||a.m||(a.m=!0,Ft(a.Ha,a),a.C=0)}function $n(a,b){var t;t=b?b.m:a.V++;const e=Ue(a.F);$e(e,"SID",a.J),$e(e,"RID",t),$e(e,"AID",a.U),zn(a,e),a.o&&a.s&&Pn(e,a.o,a.s),t=new we(a,a.h,t,a.C+1),null===a.o&&(t.H=a.s),b&&(a.l=b.D.concat(a.l)),b=Qn(a,t,1e3),t.setTimeout(Math.round(.5*a.ra)+Math.round(.5*a.ra*Math.random())),dn(a.i,t),Ee(t,e,b)}function zn(a,b){a.j&&Re({},(function(t,e){$e(b,e,t)}))}function Qn(a,b,t){t=Math.min(a.l.length,t);var e=a.j?q(a.j.Oa,a.j,a):null;t:{var n=a.l;let r=-1;for(;;){const o=["count="+t];-1==r?0<t?(r=n[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let c=!0;for(let u=0;u<t;u++){let t=n[u].h;const h=n[u].g;if(t-=r,0>t)r=Math.max(0,n[u].h-100),c=!1;else try{yn(h,o,"req"+t+"_")}catch(t){e&&e(h)}}if(c){e=o.join("&");break t}}}return a=a.l.splice(0,t),b.D=a,e}function Wn(a){a.g||a.u||(a.Y=1,Ft(a.Ga,a),a.A=0)}function Hn(a){return!(a.g||a.u||3<=a.A)&&(a.Y++,a.u=ae(q(a.Ga,a),er(a,a.A)),a.A++,!0)}function Yn(a){null!=a.B&&(l.clearTimeout(a.B),a.B=null)}function Xn(a){a.g=new we(a,a.h,"rpc",a.Y),null===a.o&&(a.g.H=a.s),a.g.O=0;var b=Ue(a.oa);$e(b,"RID","rpc"),$e(b,"SID",a.J),$e(b,"CI",a.N?"0":"1"),$e(b,"AID",a.U),zn(a,b),$e(b,"TYPE","xmlhttp"),a.o&&a.s&&Pn(b,a.o,a.s),a.K&&a.g.setTimeout(a.K);var t=a.g;a=a.la,t.K=1,t.v=ze(Ue(b)),t.s=null,t.U=!0,_e(t,a)}function Jn(a){null!=a.v&&(l.clearTimeout(a.v),a.v=null)}function Zn(a,b){var t=null;if(a.g==b){Jn(a),Yn(a),a.g=null;var e=2}else{if(!ln(a.i,b))return;t=b.D,fn(a.i,b),e=1}if(a.I=b.N,0!=a.G)if(b.i)if(1==e){t=b.s?b.s.length:0,b=Date.now()-b.F;var n=a.C;Ct(e=ee(),new oe(e,t,b,n)),Gn(a)}else Wn(a);else if(3==(n=b.o)||0==n&&0<a.I||!(1==e&&function(a,b){return!(hn(a.i)>=a.i.j-(a.m?1:0)||(a.m?(a.l=b.D.concat(a.l),0):1==a.G||2==a.G||a.C>=(a.Xa?0:a.Ya)||(a.m=ae(q(a.Ha,a,b),er(a,a.C)),a.C++,0)))}(a,b)||2==e&&Hn(a)))switch(t&&0<t.length&&(b=a.i,b.i=b.i.concat(t)),n){case 1:nr(a,5);break;case 4:nr(a,10);break;case 3:nr(a,6);break;default:nr(a,2)}}function er(a,b){let t=a.Pa+Math.floor(Math.random()*a.$a);return a.j||(t*=2),t*b}function nr(a,b){if(a.h.info("Error code "+b),2==b){var t=null;a.j&&(t=null);var e=q(a.jb,a);t||(t=new qe("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||je(t,"https"),ze(t)),function(a,b){const t=new Xt;if(l.Image){const e=new Image;e.onload=I(wn,t,e,"TestLoadImage: loaded",!0,b),e.onerror=I(wn,t,e,"TestLoadImage: error",!1,b),e.onabort=I(wn,t,e,"TestLoadImage: abort",!1,b),e.ontimeout=I(wn,t,e,"TestLoadImage: timeout",!1,b),l.setTimeout((function(){e.ontimeout&&e.ontimeout()}),1e4),e.src=a}else b(!1)}(t.toString(),e)}else ie(2);a.G=0,a.j&&a.j.va(b),rr(a),Bn(a)}function rr(a){a.G=0,a.I=-1,a.j&&(0==gn(a.i).length&&0==a.l.length||(a.i.i.length=0,D(a.l),a.l.length=0),a.j.ua())}function sr(a,b,t){let e=function(a){return a instanceof qe?Ue(a):new qe(a,void 0)}(t);if(""!=e.i)b&&Be(e,b+"."+e.i),Ke(e,e.m);else{const n=l.location;e=function(a,b,t,e){var n=new qe(null,void 0);return a&&je(n,a),b&&Be(n,b),t&&Ke(n,t),e&&(n.l=e),n}(n.protocol,b?b+"."+n.hostname:n.hostname,+n.port,t)}return a.aa&&V(a.aa,(function(t,n){$e(e,n,t)})),b=a.D,t=a.sa,b&&t&&$e(e,b,t),$e(e,"VER",a.ma),zn(a,e),e}function ir(a,b,t){if(b&&!a.H)throw Error("Can't create secondary domain capable XhrIo object.");return(b=t&&a.Ba&&!a.qa?new Sn(new vn({ib:!0})):new Sn(a.qa)).L=a.H,b}function or(){}function ar(){if(G&&!(10<=Number(st)))throw Error("Environmental error: no available transport.")}function ur(a,b){Nt.call(this),this.g=new qn(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.s=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.ya&&(a?a["X-WebChannel-Client-Profile"]=b.ya:a={"X-WebChannel-Client-Profile":b.ya}),this.g.P=a,(a=b&&b.httpHeadersOverwriteParam)&&!N(a)&&(this.g.o=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!N(b)&&(this.g.D=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new dr(this)}function cr(a){me.call(this);var b=a.__sm__;if(b){t:{for(const t in b){a=t;break t}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function lr(){pe.call(this),this.status=1}function dr(a){this.g=a}(r=Sn.prototype).ea=function(a,b,t,e){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+a);b=b?b.toUpperCase():"GET",this.H=a,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():fe.g(),this.C=this.u?le(this.u):le(fe),this.g.onreadystatechange=q(this.Fa,this);try{this.F=!0,this.g.open(b,String(a),!0),this.F=!1}catch(t){return void Cn(this,t)}a=t||"";const n=new Le(this.headers);e&&Re(e,(function(t,e){n.set(e,t)})),e=function(a){t:{var b=Nn;const t=a.length,e="string"==typeof a?a.split(""):a;for(let n=0;n<t;n++)if(n in e&&b.call(void 0,e[n],n,a)){b=n;break t}b=-1}return 0>b?null:"string"==typeof a?a.charAt(b):a[b]}(n.T()),t=l.FormData&&a instanceof l.FormData,!(0<=S(Dn,b))||e||t||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Rn(this),0<this.B&&((this.K=function(a){return G&&et()&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.pa,this)):this.A=Gt(this.pa,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(t){Cn(this,t)}},r.pa=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ct(this,"timeout"),this.abort(8))},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,Ct(this,"complete"),Ct(this,"abort"),Mn(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Mn(this,!0)),Sn.Z.M.call(this)},r.Fa=function(){this.s||(this.F||this.v||this.l?On(this):this.cb())},r.cb=function(){On(this)},r.ba=function(){try{return 2<Ln(this)?this.g.status:-1}catch(t){return-1}},r.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Qa=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),_n(b)}},r.Da=function(){return this.m},r.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=qn.prototype).ma=8,r.G=1,r.hb=function(a){try{this.h.info("Origin Trials invoked: "+a)}catch(t){}},r.Ha=function(a){if(this.m)if(this.m=null,1==this.G){if(!a){this.V=Math.floor(1e5*Math.random()),a=this.V++;const n=new we(this,this.h,a,void 0);let r=this.s;if(this.P&&(r?(r=P(r),U(r,this.P)):r=this.P),null===this.o&&(n.H=r),this.ja)t:{for(var b=0,t=0;t<this.l.length;t++){var e=this.l[t];if(void 0===(e="__data__"in e.g&&"string"==typeof(e=e.g.__data__)?e.length:void 0))break;if(4096<(b+=e)){b=t;break t}if(4096===b||t===this.l.length-1){b=t+1;break t}}b=1e3}else b=1e3;b=Qn(this,n,b),$e(t=Ue(this.F),"RID",a),$e(t,"CVER",22),this.D&&$e(t,"X-HTTP-Session-Id",this.D),zn(this,t),this.o&&r&&Pn(t,this.o,r),dn(this.i,n),this.Ra&&$e(t,"TYPE","init"),this.ja?($e(t,"$req",b),$e(t,"SID","null"),n.$=!0,Ee(n,t,null)):Ee(n,t,b),this.G=2}}else 3==this.G&&(a?$n(this,a):0==this.l.length||cn(this.i)||$n(this))},r.Ga=function(){if(this.u=null,Xn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var a=2*this.O;this.h.info("BP detection timer enabled: "+a),this.B=ae(q(this.bb,this),a)}},r.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ie(10),jn(this),Xn(this))},r.ab=function(){null!=this.v&&(this.v=null,jn(this),Hn(this),ie(19))},r.jb=function(a){a?(this.h.info("Successfully pinged google.com"),ie(2)):(this.h.info("Failed to ping google.com"),ie(1))},(r=or.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Oa=function(){},ar.prototype.g=function(a,b){return new ur(a,b)},T(ur,Nt),ur.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var a=this.g,b=this.l,t=this.h||void 0;a.Wa&&(a.h.info("Origin Trials enabled."),Ft(q(a.hb,a,b))),ie(0),a.W=b,a.aa=t||{},a.N=a.X,a.F=sr(a,null,a.W),Gn(a)},ur.prototype.close=function(){Un(this.g)},ur.prototype.u=function(a){if("string"==typeof a){var b={};b.__data__=a,Kn(this.g,b)}else this.v?((b={}).__data__=Ot(a),Kn(this.g,b)):Kn(this.g,a)},ur.prototype.M=function(){this.g.j=null,delete this.j,Un(this.g),delete this.g,ur.Z.M.call(this)},T(cr,me),T(lr,pe),T(dr,or),dr.prototype.xa=function(){Ct(this.g,"a")},dr.prototype.wa=function(a){Ct(this.g,new cr(a))},dr.prototype.va=function(a){Ct(this.g,new lr(a))},dr.prototype.ua=function(){Ct(this.g,"b")},ar.prototype.createWebChannel=ar.prototype.g,ur.prototype.send=ur.prototype.u,ur.prototype.open=ur.prototype.m,ur.prototype.close=ur.prototype.close,ue.NO_ERROR=0,ue.TIMEOUT=8,ue.HTTP_ERROR=6,ce.COMPLETE="complete",de.EventType=ge,ge.OPEN="a",ge.CLOSE="b",ge.ERROR="c",ge.MESSAGE="d",Nt.prototype.listen=Nt.prototype.N,Sn.prototype.listenOnce=Sn.prototype.O,Sn.prototype.getLastError=Sn.prototype.La,Sn.prototype.getLastErrorCode=Sn.prototype.Da,Sn.prototype.getStatus=Sn.prototype.ba,Sn.prototype.getResponseJson=Sn.prototype.Qa,Sn.prototype.getResponseText=Sn.prototype.ga,Sn.prototype.send=Sn.prototype.ea;var fr=c.createWebChannelTransport=function(){return new ar},gr=c.getStatEventTarget=function(){return ee()},mr=c.ErrorCode=ue,pr=c.EventType=ce,yr=c.Event=Zt,wr=c.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},vr=c.FetchXmlHttpFactory=vn,Ir=c.WebChannel=de,Tr=c.XhrIo=Sn}).call(this,n(74))},500:function(t,e,n){"use strict";n.r(e);var r=n(435),o=n(492),c=n(432),h=n(433);function l(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new o.g("invalid-argument",`Invalid options passed to function ${t}(): You cannot specify both "merge" and "mergeFields".`);return e}function d(){if("undefined"==typeof Uint8Array)throw new o.g("unimplemented","Uint8Arrays are not available in this environment.")}function f(){if(!Object(o.r)())throw new o.g("unimplemented","Blobs are unavailable in Firestore in this environment.")}class m{constructor(t){this._delegate=t}static fromBase64String(t){return f(),new m(o.b.fromBase64String(t))}static fromUint8Array(t){return d(),new m(o.b.fromUint8Array(t))}toBase64(){return f(),this._delegate.toBase64()}toUint8Array(){return d(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function y(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const object=t;for(const t of e)if(t in object&&"function"==typeof object[t])return!0;return!1}(t,["next","error","complete"])}class w{enableIndexedDbPersistence(t,e){return Object(o.F)(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return Object(o.G)(t._delegate)}clearIndexedDbPersistence(t){return Object(o.x)(t._delegate)}}class v{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof o.m||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){const e=this._delegate._getSettings();t.merge||e.host===t.host||Object(o.s)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)}useEmulator(t,e,n={}){Object(o.A)(this._delegate,t,e,n)}enableNetwork(){return Object(o.H)(this._delegate)}disableNetwork(){return Object(o.D)(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,Object(o.t)("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Object(o.lb)(this._delegate)}onSnapshotsInSync(t){return Object(o.Y)(this._delegate,t)}get app(){if(!this._appCompat)throw new o.g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new R(this,Object(o.y)(this._delegate,t))}catch(t){throw A(t,"collection()","Firestore.collection()")}}doc(t){try{return new S(this,Object(o.E)(this._delegate,t))}catch(t){throw A(t,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new k(this,Object(o.z)(this._delegate,t))}catch(t){throw A(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Object(o.db)(this._delegate,(e=>t(new T(this,e))))}batch(){return Object(o.K)(this._delegate),new E(new o.l(this._delegate,(t=>Object(o.L)(this._delegate,t))))}loadBundle(t){return Object(o.V)(this._delegate,t)}namedQuery(t){return Object(o.W)(this._delegate,t).then((t=>t?new k(this,t):null))}}class I extends o.a{constructor(t){super(),this.firestore=t}convertBytes(t){return new m(new o.b(t))}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return S.forKey(e,this.firestore,null)}}class T{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new I(t)}get(t){const e=L(t);return this._delegate.get(e).then((t=>new N(this._firestore,new o.e(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,e.converter))))}set(t,data,e){const n=L(t);return e?(l("Transaction.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=L(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=L(t);return this._delegate.delete(e),this}}class E{constructor(t){this._delegate=t}set(t,data,e){const n=L(t);return e?(l("WriteBatch.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=L(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=L(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class _{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){const n=new o.i(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new C(this._firestore,n),null!=e?e:{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){const n=_.INSTANCES;let r=n.get(t);r||(r=new WeakMap,n.set(t,r));let o=r.get(e);return o||(o=new _(t,new I(t),e),r.set(e,o)),o}}_.INSTANCES=new WeakMap;class S{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new I(t)}static forPath(path,t,e){if(path.length%2!=0)throw new o.g("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${path.canonicalString()} has ${path.length}`);return new S(t,new o.d(t._delegate,e,new o.n(path)))}static forKey(t,e,n){return new S(e,new o.d(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new R(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new R(this.firestore,Object(o.y)(this._delegate,t))}catch(t){throw A(t,"collection()","DocumentReference.collection()")}}isEqual(t){return(t=Object(c.l)(t))instanceof o.d&&Object(o.cb)(this._delegate,t)}set(t,e){e=l("DocumentReference.set",e);try{return e?Object(o.fb)(this._delegate,t,e):Object(o.fb)(this._delegate,t)}catch(t){throw A(t,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return 1===arguments.length?Object(o.kb)(this._delegate,t):Object(o.kb)(this._delegate,t,e,...n)}catch(t){throw A(t,"updateDoc()","DocumentReference.update()")}}delete(){return Object(o.B)(this._delegate)}onSnapshot(...t){const e=x(t),n=D(t,(t=>new N(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))));return Object(o.X)(this._delegate,e,n)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.N)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.O)(this._delegate):Object(o.M)(this._delegate),e.then((t=>new N(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))))}withConverter(t){return new S(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function A(t,e,n){return t.message=t.message.replace(e,n),t}function x(t){for(const e of t)if("object"==typeof e&&!y(e))return e;return{}}function D(t,e){var n,r;let o;return o=y(t[0])?t[0]:y(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]},{next:t=>{o.next&&o.next(e(t))},error:null===(n=o.error)||void 0===n?void 0:n.bind(o),complete:null===(r=o.complete)||void 0===r?void 0:r.bind(o)}}class N{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new S(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class C extends N{data(t){const data=this._delegate.data(t);return Object(o.q)(void 0!==data,"Document in a QueryDocumentSnapshot should exist"),data}}class k{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new I(t)}where(t,e,n){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.mb)(t,e,n)))}catch(t){throw A(t,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.Z)(t,e)))}catch(t){throw A(t,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.T)(t)))}catch(t){throw A(t,"limit()","Query.limit()")}}limitToLast(t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.U)(t)))}catch(t){throw A(t,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.jb)(...t)))}catch(t){throw A(t,"startAt()","Query.startAt()")}}startAfter(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.ib)(...t)))}catch(t){throw A(t,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.J)(...t)))}catch(t){throw A(t,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new k(this.firestore,Object(o.ab)(this._delegate,Object(o.I)(...t)))}catch(t){throw A(t,"endAt()","Query.endAt()")}}isEqual(t){return Object(o.bb)(this._delegate,t._delegate)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.Q)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.R)(this._delegate):Object(o.P)(this._delegate),e.then((t=>new M(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))))}onSnapshot(...t){const e=x(t),n=D(t,(t=>new M(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))));return Object(o.X)(this._delegate,e,n)}withConverter(t){return new k(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}class O{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new C(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class M{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new k(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((t=>new C(this._firestore,t)))}docChanges(t){return this._delegate.docChanges(t).map((t=>new O(this._firestore,t)))}forEach(t,e){this._delegate.forEach((n=>{t.call(e,new C(this._firestore,n))}))}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class R extends k{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const t=this._delegate.parent;return t?new S(this.firestore,t):null}doc(t){try{return new S(this.firestore,void 0===t?Object(o.E)(this._delegate):Object(o.E)(this._delegate,t))}catch(t){throw A(t,"doc()","CollectionReference.doc()")}}add(data){return Object(o.u)(this._delegate,data).then((t=>new S(this.firestore,t)))}isEqual(t){return Object(o.cb)(this._delegate,t._delegate)}withConverter(t){return new R(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function L(t){return Object(o.p)(t,o.d)}class V{constructor(...t){this._delegate=new o.f(...t)}static documentId(){return new V(o.o.keyField().canonicalString())}isEqual(t){return(t=Object(c.l)(t))instanceof o.f&&this._delegate._internalPath.isEqual(t._internalPath)}}class P{constructor(t){this._delegate=t}static serverTimestamp(){const t=Object(o.eb)();return t._methodName="FieldValue.serverTimestamp",new P(t)}static delete(){const t=Object(o.C)();return t._methodName="FieldValue.delete",new P(t)}static arrayUnion(...t){const e=Object(o.w)(...t);return e._methodName="FieldValue.arrayUnion",new P(e)}static arrayRemove(...t){const e=Object(o.v)(...t);return e._methodName="FieldValue.arrayRemove",new P(e)}static increment(t){const e=Object(o.S)(t);return e._methodName="FieldValue.increment",new P(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}}const F={Firestore:v,GeoPoint:o.h,Timestamp:o.k,Blob:m,Transaction:T,WriteBatch:E,DocumentReference:S,DocumentSnapshot:N,Query:k,QueryDocumentSnapshot:C,QuerySnapshot:M,CollectionReference:R,FieldPath:V,FieldValue:P,setLogLevel:function(t){Object(o.gb)(t)},CACHE_SIZE_UNLIMITED:o.c};var U,j;U=r.a,j=(t,e)=>new v(t,e,new w),U.INTERNAL.registerComponent(new h.a("firestore-compat",(t=>{const e=t.getProvider("app-compat").getImmediate(),n=t.getProvider("firestore").getImmediate();return j(e,n)}),"PUBLIC").setServiceProps(Object.assign({},F))),U.registerVersion("@firebase/firestore-compat","0.1.18")}}]);